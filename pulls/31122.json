{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122",
    "id": 2134676355,
    "node_id": "PR_kwDOABII585_PJOD",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31122",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31122.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31122.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31122",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31122/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/32ac5cd59b1fc4819de26ce52b439317149ca5de",
    "number": 31122,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "cluster mempool: Implement changeset interface for mempool",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "part of cluster mempool: #30289 \r\n\r\nIt became clear while working on cluster mempool that it would be helpful for transaction validation if we could consider a full set of proposed changes to the mempool -- consisting of a set of transactions to add, and a set of transactions (ie conflicts) to simultaneously remove -- and perform calculations on what the mempool would look like if the proposed changes were to be applied.  Two specific examples of where we'd like to do this:\r\n\r\n- Determining if ancestor/descendant/TRUC limits would be violated (in the future, cluster limits) if either a single transaction or a package of transactions were to be accepted\r\n- Determining if an RBF would make the mempool \"better\", however that idea is defined, both in the single transaction and package of transaction cases\r\n\r\nIn preparation for cluster mempool, I have pulled this reworking of the mempool interface out of #28676 so it can be reviewed on its own.  I have not re-implemented ancestor/descendant limits to be run through the changeset, since with cluster mempool those limits will be going away, so this seems like wasted effort.  However, I have rebased #28676 on top of this branch so reviewers can see what the new mempool interface could look like in the cluster mempool setting.\r\n\r\nThere are some minor behavior changes here, which I believe are inconsequential:\r\n- In the package validation setting, transactions would be added to the mempool before the `ConsensusScriptChecks()` are run. In theory, `ConsensusScriptChecks()` should always pass if the `PolicyScriptChecks()` have passed and it's just a belt-and-suspenders for us, but if somehow they were to diverge then there could be some small behavior change from adding transactions and then removing them, versus never adding them at all.\r\n- The error reporting on `CheckConflictTopology()` has slightly changed due to no longer distinguishing between direct conflicts and indirect conflicts. I believe this should be entirely inconsequential because there shouldn't be a logical difference between those two ideas from the perspective of this function, but I did have to update some error strings in some tests.\r\n- Because, in a package setting, RBFs now happen as part of the entire package being accepted, the logging has changed slightly because we do not know which transaction specifically evicted a given removed transaction.",
    "labels": [
      {
        "id": 164208572,
        "node_id": "MDU6TGFiZWwxNjQyMDg1NzI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Mempool",
        "name": "Mempool",
        "color": "fef2c0",
        "default": false
      }
    ],
    "created_at": "2024-10-20T17:46:28Z",
    "updated_at": "2024-10-22T22:12:00Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "e7c82f52e4c0a20ce76412d93ab9ac4534a10a82",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "sdaftuar:2024-10-mempool-changeset",
      "ref": "2024-10-mempool-changeset",
      "sha": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 28761781,
        "node_id": "MDEwOlJlcG9zaXRvcnkyODc2MTc4MQ==",
        "name": "bitcoin",
        "full_name": "sdaftuar/bitcoin",
        "owner": {
          "login": "sdaftuar",
          "id": 7463573,
          "node_id": "MDQ6VXNlcjc0NjM1NzM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sdaftuar",
          "html_url": "https://github.com/sdaftuar",
          "followers_url": "https://api.github.com/users/sdaftuar/followers",
          "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
          "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
          "repos_url": "https://api.github.com/users/sdaftuar/repos",
          "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/sdaftuar/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sdaftuar/bitcoin",
        "archive_url": "https://api.github.com/repos/sdaftuar/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sdaftuar/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sdaftuar/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sdaftuar/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sdaftuar/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sdaftuar/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sdaftuar/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sdaftuar/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sdaftuar/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sdaftuar/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sdaftuar/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sdaftuar/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sdaftuar/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sdaftuar/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sdaftuar/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sdaftuar/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sdaftuar/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sdaftuar/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sdaftuar/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sdaftuar/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sdaftuar/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sdaftuar/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sdaftuar/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sdaftuar/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sdaftuar/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sdaftuar/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sdaftuar/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sdaftuar/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sdaftuar/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sdaftuar/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sdaftuar/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sdaftuar/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sdaftuar/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sdaftuar/bitcoin/hooks",
        "svn_url": "https://github.com/sdaftuar/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 280821,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-10-22T22:11:58Z",
        "created_at": "2015-01-04T02:52:13Z",
        "updated_at": "2024-02-09T22:47:48Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "ffe4261cb0669b1e1a926638e0498ae5b63f3599",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36268,
        "stargazers_count": 78986,
        "watchers_count": 78986,
        "size": 270025,
        "default_branch": "master",
        "open_issues_count": 651,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-10-22T14:52:58Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-10-22T22:45:53Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 553,
    "deletions": 352,
    "changed_files": 22,
    "commits": 11,
    "review_comments": 12,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 2425149525,
      "node_id": "IC_kwDOABII586QjNhV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2425149525",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-20T17:46:31Z",
      "updated_at": "2024-10-22T13:10:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/31122).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/31122#pullrequestreview-2383546169), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/31122#pullrequestreview-2385159381) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30391](https://github.com/bitcoin/bitcoin/pull/30391) (BlockAssembler: return selected packages vsize and feerate by ismaelsadeeq)\n* [#30157](https://github.com/bitcoin/bitcoin/pull/30157) (Fee Estimation via Fee rate Forecasters by ismaelsadeeq)\n* [#29680](https://github.com/bitcoin/bitcoin/pull/29680) (wallet: fix unrelated parent conflict doesn't cause child tx to be marked as conflict by Eunovo)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#issuecomment-2425149525",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31122"
    },
    {
      "event": "labeled",
      "id": 14754851711,
      "node_id": "LE_lADOABII586bBCeXzwAAAANvdSt_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14754851711",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-20T17:48:00Z",
      "label": {
        "name": "Mempool",
        "color": "fef2c0"
      }
    },
    {
      "event": "labeled",
      "id": 14755142049,
      "node_id": "LE_lADOABII586bBCeXzwAAAANveZmh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14755142049",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-20T19:19:58Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2425184701,
      "node_id": "IC_kwDOABII586QjWG9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2425184701",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-20T19:19:59Z",
      "updated_at": "2024-10-20T19:19:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/31793556861</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#issuecomment-2425184701",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31122"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14755665335,
      "node_id": "HRFPE_lADOABII586bBCeXzwAAAANvgZW3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14755665335",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-20T23:38:55Z"
    },
    {
      "event": "unlabeled",
      "id": 14755962530,
      "node_id": "UNLE_lADOABII586bBCeXzwAAAANvhh6i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14755962530",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-21T00:55:16Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unsubscribed",
      "id": 14758033128,
      "node_id": "UE_lADOABII586bBCeXzwAAAANvpbbo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14758033128",
      "actor": {
        "login": "gsannikov",
        "id": 52405655,
        "node_id": "MDQ6VXNlcjUyNDA1NjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/52405655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gsannikov",
        "html_url": "https://github.com/gsannikov",
        "followers_url": "https://api.github.com/users/gsannikov/followers",
        "following_url": "https://api.github.com/users/gsannikov/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gsannikov/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gsannikov/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gsannikov/subscriptions",
        "organizations_url": "https://api.github.com/users/gsannikov/orgs",
        "repos_url": "https://api.github.com/users/gsannikov/repos",
        "events_url": "https://api.github.com/users/gsannikov/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gsannikov/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-21T05:36:37Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14763926218,
      "node_id": "HRFPE_lADOABII586bBCeXzwAAAANv_6LK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14763926218",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-21T12:30:32Z"
    },
    {
      "event": "reviewed",
      "id": 2383546169,
      "node_id": "PRR_kwDOABII586OEgc5",
      "url": null,
      "actor": null,
      "commit_id": "aeefd31c973b9933afcf38109f1f25c76ab9f689",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK, did a first pass",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#pullrequestreview-2383546169",
      "submitted_at": "2024-10-22T02:04:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
    },
    {
      "event": "reviewed",
      "id": 2385138219,
      "node_id": "PRR_kwDOABII586OKlIr",
      "url": null,
      "actor": null,
      "commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#pullrequestreview-2385138219",
      "submitted_at": "2024-10-22T13:02:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
    },
    {
      "event": "reviewed",
      "id": 2385150906,
      "node_id": "PRR_kwDOABII586OKoO6",
      "url": null,
      "actor": null,
      "commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#pullrequestreview-2385150906",
      "submitted_at": "2024-10-22T13:07:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
    },
    {
      "event": "reviewed",
      "id": 2385159381,
      "node_id": "PRR_kwDOABII586OKqTV",
      "url": null,
      "actor": null,
      "commit_id": "aeefd31c973b9933afcf38109f1f25c76ab9f689",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nThe changes are straightforward to understand, and the large diff is primarily due to changes in the error message and the removal of `addUnchecked`.",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#pullrequestreview-2385159381",
      "submitted_at": "2024-10-22T13:10:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14789278739,
      "node_id": "HRFPE_lADOABII586bBCeXzwAAAANxgnwT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14789278739",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T16:55:28Z"
    },
    {
      "event": "commented",
      "id": 2429804570,
      "node_id": "IC_kwDOABII586Q0-Aa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2429804570",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T17:01:08Z",
      "updated_at": "2024-10-22T17:01:08Z",
      "author_association": "MEMBER",
      "body": "Thanks @glozow and @ismaelsadeeq for the review; I've incorporated some of the comments.  If you have suggestions for how the logging can be improved in the package RBF case (and how the USDT tracing messages can be improved, similarly) please let me know your thoughts.\r\n\r\nAlso, I wanted to flag that the locking is a bit of a mess in this branch.  Initially, I tried to add lock annotations to the `CTxMemPoolChangeSet` functions to guarantee that the mempool itself was locked whenever any of those functions were invoked.  I had mixed results with the compiler understanding those annotations, and ran into a roadblock at some point with a unit test which was taking the mempool lock and should have satisfied the annotations, but the compiler wasn't recognizing the lock as being the same one that needed to be held.  I assume the complication is mostly that the changeset is a different object than the mempool, so one thing I could try is moving all the changeset methods to instead be methods of the mempool itself (which take a changeset as an argument, potentially) -- but that also seems like a little bit of a mess to me, so wasn't sure if that was worth doing.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#issuecomment-2429804570",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31122"
    },
    {
      "event": "mentioned",
      "id": 14789364117,
      "node_id": "MEE_lADOABII586bBCeXzwAAAANxg8mV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14789364117",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T17:01:10Z"
    },
    {
      "event": "subscribed",
      "id": 14789364142,
      "node_id": "SE_lADOABII586bBCeXzwAAAANxg8mu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14789364142",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T17:01:10Z"
    },
    {
      "event": "mentioned",
      "id": 14789364185,
      "node_id": "MEE_lADOABII586bBCeXzwAAAANxg8nZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14789364185",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T17:01:10Z"
    },
    {
      "event": "subscribed",
      "id": 14789364201,
      "node_id": "SE_lADOABII586bBCeXzwAAAANxg8np",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14789364201",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T17:01:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14791754763,
      "node_id": "HRFPE_lADOABII586bBCeXzwAAAANxqEQL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14791754763",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T19:49:45Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14793672164,
      "node_id": "HRFPE_lADOABII586bBCeXzwAAAANxxYXk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14793672164",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T22:10:08Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg4ZTEwOWYxMDkxNTYxNjM5YWNhMzIzY2I0NTUxODAzMTdhMTJiMzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/88e109f1091561639aca323cb455180317a12b32",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/88e109f1091561639aca323cb455180317a12b32",
      "tree": {
        "sha": "945392bf08291e58e7c3815647cdabc1230ee8e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/945392bf08291e58e7c3815647cdabc1230ee8e1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e8f72aefd20049eac81b150e7f0d33709acd18ed",
          "sha": "e8f72aefd20049eac81b150e7f0d33709acd18ed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e8f72aefd20049eac81b150e7f0d33709acd18ed"
        }
      ],
      "message": "refactor: introduce mempool changesets\n\nIntroduce the CTxMemPoolChangeSet, a wrapper for creating (potential) new\nmempool entries and removing conflicts.",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-08-23T22:45:49Z"
      },
      "sha": "88e109f1091561639aca323cb455180317a12b32"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMyMTAxMzMwZWM2ZjZlOWM0ZDQ2N2RlYzM3MGM4NDhjZjRkMTRmMjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/32101330ec6f6e9c4d467dec370c848cf4d14f23",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/32101330ec6f6e9c4d467dec370c848cf4d14f23",
      "tree": {
        "sha": "40e9eb942ac5b140047c47baa2fa5acf4ea517c9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/40e9eb942ac5b140047c47baa2fa5acf4ea517c9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/88e109f1091561639aca323cb455180317a12b32",
          "sha": "88e109f1091561639aca323cb455180317a12b32",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/88e109f1091561639aca323cb455180317a12b32"
        }
      ],
      "message": "Move changeset from workspace to subpackage",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-08-24T10:53:43Z"
      },
      "sha": "32101330ec6f6e9c4d467dec370c848cf4d14f23"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEyN2Q4MWM1ODBmMDZmMmYyNzUyZjgxMjg1YTQ5ZGE5NWE0Y2RkNDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a27d81c580f06f2f2752f81285a49da95a4cdd44",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a27d81c580f06f2f2752f81285a49da95a4cdd44",
      "tree": {
        "sha": "69e17fcff6968327962498d39a56d67f173e55ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/69e17fcff6968327962498d39a56d67f173e55ad"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/32101330ec6f6e9c4d467dec370c848cf4d14f23",
          "sha": "32101330ec6f6e9c4d467dec370c848cf4d14f23",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/32101330ec6f6e9c4d467dec370c848cf4d14f23"
        }
      ],
      "message": "Clean up FinalizeSubpackage to avoid workspace-specific information",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-08-24T11:26:09Z"
      },
      "sha": "a27d81c580f06f2f2752f81285a49da95a4cdd44"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFiZTE4ZjI0ODk5ZDE2YjUzZTU0NjA1MjEyY2FjZDg4N2I5YzQyOWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/abe18f24899d16b53e54605212cacd887b9c429b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/abe18f24899d16b53e54605212cacd887b9c429b",
      "tree": {
        "sha": "a83ca45f9d6c32d72bdbb52ba9e1b64dd11084d2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a83ca45f9d6c32d72bdbb52ba9e1b64dd11084d2"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a27d81c580f06f2f2752f81285a49da95a4cdd44",
          "sha": "a27d81c580f06f2f2752f81285a49da95a4cdd44",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a27d81c580f06f2f2752f81285a49da95a4cdd44"
        }
      ],
      "message": "Apply mempool changeset transactions directly into the mempool\n\nRather than individually calling addUnchecked for each transaction added in a\nchangeset (after removing all the to-be-removed transactions), instead we can\ntake advantage of boost::multi_index's splicing features to extract and insert\nentries directly from the staging multi_index into mapTx.\n\nThis has the immediate advantage of saving allocation overhead for mempool\nentries which have already been allocated once. This also means that the memory\nlocations of mempool entries will not change when transactions go from staging\nto the main mempool.\n\nAdditionally, eliminate addUnchecked and require all new transactions to enter\nthe mempool via a CTxMemPoolChangeSet.",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-10T18:59:23Z"
      },
      "sha": "abe18f24899d16b53e54605212cacd887b9c429b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM3OWMxZmE0YzAzYjVhMzFhYjJmODNkZmIwNTc4ODhkNWE1MjJlOWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c79c1fa4c03b5a31ab2f83dfb057888d5a522e9f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c79c1fa4c03b5a31ab2f83dfb057888d5a522e9f",
      "tree": {
        "sha": "acea1fb5ce153e934bed2c051216bc9735b7401f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/acea1fb5ce153e934bed2c051216bc9735b7401f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/abe18f24899d16b53e54605212cacd887b9c429b",
          "sha": "abe18f24899d16b53e54605212cacd887b9c429b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/abe18f24899d16b53e54605212cacd887b9c429b"
        }
      ],
      "message": "Enforce that there is only one changeset at a time",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-14T14:19:44Z"
      },
      "sha": "c79c1fa4c03b5a31ab2f83dfb057888d5a522e9f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdlMDc0ZWIxNTUzZjAyOWIzY2RhYmFkMTc4MzRjNDkwYTlhYThlYjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7e074eb1553f029b3cdabad17834c490a9aa8eb3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7e074eb1553f029b3cdabad17834c490a9aa8eb3",
      "tree": {
        "sha": "fc444a5adbdac08ab2857ed8244e12c3a4693b24",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fc444a5adbdac08ab2857ed8244e12c3a4693b24"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c79c1fa4c03b5a31ab2f83dfb057888d5a522e9f",
          "sha": "c79c1fa4c03b5a31ab2f83dfb057888d5a522e9f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c79c1fa4c03b5a31ab2f83dfb057888d5a522e9f"
        }
      ],
      "message": "Duplicate transactions are not permitted within a changeset",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-14T14:27:27Z"
      },
      "sha": "7e074eb1553f029b3cdabad17834c490a9aa8eb3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFhNjVhYjEyNTMxYTMyYjMzOTZmMDY0MTIyZjc1N2EyMWJmZWFkZmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa65ab12531a32b3396f064122f757a21bfeadff",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aa65ab12531a32b3396f064122f757a21bfeadff",
      "tree": {
        "sha": "66319f9b97fee9f3d586107a9929b73a0bcc2ae1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/66319f9b97fee9f3d586107a9929b73a0bcc2ae1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7e074eb1553f029b3cdabad17834c490a9aa8eb3",
          "sha": "7e074eb1553f029b3cdabad17834c490a9aa8eb3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7e074eb1553f029b3cdabad17834c490a9aa8eb3"
        }
      ],
      "message": "Don't distinguish between direct conflicts and all conflicts when doing cluster-size-2-rbf checks",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-14T15:11:17Z"
      },
      "sha": "aa65ab12531a32b3396f064122f757a21bfeadff"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE4MDBkN2UwMDU5NWRjZTY0YjNmMTk2MWYzOWFmZmUzNjZiYzc1ZDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1800d7e00595dce64b3f1961f39affe366bc75d8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1800d7e00595dce64b3f1961f39affe366bc75d8",
      "tree": {
        "sha": "5ba3527227f3af8a61f9883a2ec3b641147259d3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5ba3527227f3af8a61f9883a2ec3b641147259d3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa65ab12531a32b3396f064122f757a21bfeadff",
          "sha": "aa65ab12531a32b3396f064122f757a21bfeadff",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/aa65ab12531a32b3396f064122f757a21bfeadff"
        }
      ],
      "message": "Move CalculateChunksForRBF() to the mempool changeset",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-16T13:09:44Z"
      },
      "sha": "1800d7e00595dce64b3f1961f39affe366bc75d8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdjMDU1MDI2MDYzODA3Y2Q4YTdmZGZiMGQ2ZmI0MzE3OGI1YmFkNTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c055026063807cd8a7fdfb0d6fb43178b5bad59",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7c055026063807cd8a7fdfb0d6fb43178b5bad59",
      "tree": {
        "sha": "d7890292c36c720fbb51245fc94449fb99604a09",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d7890292c36c720fbb51245fc94449fb99604a09"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1800d7e00595dce64b3f1961f39affe366bc75d8",
          "sha": "1800d7e00595dce64b3f1961f39affe366bc75d8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1800d7e00595dce64b3f1961f39affe366bc75d8"
        }
      ],
      "message": "Move prioritisation into changeset",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-16T20:36:36Z"
      },
      "sha": "7c055026063807cd8a7fdfb0d6fb43178b5bad59"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE3MWJkZjI0ODNjZDc5YTJkZGFkZjE0N2FiNmFjNDA5NzI0ZTc1Njk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a71bdf2483cd79a2ddadf147ab6ac409724e7569",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a71bdf2483cd79a2ddadf147ab6ac409724e7569",
      "tree": {
        "sha": "0155b62ae53b0cfa4658a78ac94d16077d1cd888",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0155b62ae53b0cfa4658a78ac94d16077d1cd888"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c055026063807cd8a7fdfb0d6fb43178b5bad59",
          "sha": "7c055026063807cd8a7fdfb0d6fb43178b5bad59",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7c055026063807cd8a7fdfb0d6fb43178b5bad59"
        }
      ],
      "message": "Assume() no mempool removals are permitted while changeset is outstanding",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2024-10-18T14:36:36Z"
      },
      "sha": "a71bdf2483cd79a2ddadf147ab6ac409724e7569"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMyYWM1Y2Q1OWIxZmM0ODE5ZGUyNmNlNTJiNDM5MzE3MTQ5Y2E1ZGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "tree": {
        "sha": "7f416c95d127f1191a212058cd630f97b655b45d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7f416c95d127f1191a212058cd630f97b655b45d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a71bdf2483cd79a2ddadf147ab6ac409724e7569",
          "sha": "a71bdf2483cd79a2ddadf147ab6ac409724e7569",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a71bdf2483cd79a2ddadf147ab6ac409724e7569"
        }
      ],
      "message": "Ensure that we don't add duplicate transactions in rbf fuzz tests",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-22T22:11:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2024-10-19T14:18:53Z"
      },
      "sha": "32ac5cd59b1fc4819de26ce52b439317149ca5de"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14793691023,
      "node_id": "HRFPE_lADOABII586bBCeXzwAAAANxxc-P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14793691023",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T22:12:00Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809704580",
      "pull_request_review_id": 2383546169,
      "id": 1809704580,
      "node_id": "PRRC_kwDOABII585r3eaE",
      "diff_hunk": "@@ -816,6 +816,40 @@ class CTxMemPool\n         assert(m_epoch.guarded()); // verify guard even when it==nullopt\n         return !it || visited(*it);\n     }\n+\n+    class CTxMemPoolChangeSet {\n+    public:\n+        explicit CTxMemPoolChangeSet(CTxMemPool* pool) : m_pool(pool) {}\n+        ~CTxMemPoolChangeSet() = default;\n+\n+        CTxMemPoolChangeSet(const CTxMemPoolChangeSet&) = delete;\n+        CTxMemPoolChangeSet& operator=(const CTxMemPoolChangeSet&) = delete;\n+\n+        using TxHandle = CTxMemPool::txiter;\n+\n+        TxHandle AddTx(const CTransactionRef& tx, const CAmount fee, int64_t time, unsigned int entry_height, uint64_t entry_sequence, bool spends_coinbase, int64_t sigops_cost, LockPoints lp);\n+        void RemoveTx(CTxMemPool::txiter it) { m_all_conflicts.insert(it); }",
      "path": "src/txmempool.h",
      "position": null,
      "original_position": 16,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "fc03c77f8b9a50459076bce3000d18e687f52820",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`StageAddition` and `StageRemoval` seem a bit more intuitive, but it's a nit",
      "created_at": "2024-10-22T00:57:53Z",
      "updated_at": "2024-10-22T02:04:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1809704580",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809704580"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": 830,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 831,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809735446",
      "pull_request_review_id": 2383546169,
      "id": 1809735446,
      "node_id": "PRRC_kwDOABII585r3l8W",
      "diff_hunk": "@@ -816,6 +816,40 @@ class CTxMemPool\n         assert(m_epoch.guarded()); // verify guard even when it==nullopt\n         return !it || visited(*it);\n     }\n+\n+    class CTxMemPoolChangeSet {\n+    public:\n+        explicit CTxMemPoolChangeSet(CTxMemPool* pool) : m_pool(pool) {}\n+        ~CTxMemPoolChangeSet() = default;\n+\n+        CTxMemPoolChangeSet(const CTxMemPoolChangeSet&) = delete;\n+        CTxMemPoolChangeSet& operator=(const CTxMemPoolChangeSet&) = delete;\n+\n+        using TxHandle = CTxMemPool::txiter;\n+\n+        TxHandle AddTx(const CTransactionRef& tx, const CAmount fee, int64_t time, unsigned int entry_height, uint64_t entry_sequence, bool spends_coinbase, int64_t sigops_cost, LockPoints lp);\n+        void RemoveTx(CTxMemPool::txiter it) { m_all_conflicts.insert(it); }\n+\n+        util::Result<CTxMemPool::setEntries> CalculateMemPoolAncestors(TxHandle tx, const Limits& limits) {\n+            LOCK(m_pool->cs);\n+            auto ret = m_pool->CalculateMemPoolAncestors(*tx, limits);\n+            if (ret) m_ancestors.insert({tx, *ret});\n+            else m_ancestors.erase(tx);\n+            return ret;\n+        }\n+\n+        void Apply() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    private:\n+        CTxMemPool* m_pool;\n+        CTxMemPool::indexed_transaction_set m_stage_tx;\n+        std::vector<CTxMemPool::txiter> m_entry_vec; // track the added transactions' insertion order\n+        // map from the stage_tx index to the ancestors for the transaction\n+        std::map<CTxMemPool::txiter, CTxMemPool::setEntries, CompareIteratorByHash> m_ancestors;\n+        CTxMemPool::setEntries m_all_conflicts;",
      "path": "src/txmempool.h",
      "position": null,
      "original_position": 34,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "fc03c77f8b9a50459076bce3000d18e687f52820",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Similarly, `m_stage_tx` and `m_all_conflicts` could be `m_to_add` and `m_to_remove`?",
      "created_at": "2024-10-22T01:50:03Z",
      "updated_at": "2024-10-22T02:04:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1809735446",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809735446"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": 845,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 849,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809737214",
      "pull_request_review_id": 2383546169,
      "id": 1809737214,
      "node_id": "PRRC_kwDOABII585r3mX-",
      "diff_hunk": "@@ -847,7 +847,14 @@ class CTxMemPool\n         friend class CTxMemPool;\n     };\n \n-    std::unique_ptr<CTxMemPoolChangeSet> GetChangeSet() EXCLUSIVE_LOCKS_REQUIRED(cs) { return std::make_unique<CTxMemPoolChangeSet>(this); }\n+    std::unique_ptr<CTxMemPoolChangeSet> GetChangeSet() EXCLUSIVE_LOCKS_REQUIRED(cs) {\n+        Assume(m_changeset == nullptr);\n+        auto ret = std::make_unique<CTxMemPoolChangeSet>(this);\n+        m_changeset = ret.get();\n+        return ret;\n+    }\n+\n+    CTxMemPoolChangeSet* m_changeset GUARDED_BY(cs){nullptr};",
      "path": "src/txmempool.h",
      "position": 114,
      "original_position": 21,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "1282bc0ac2820c1e7217c5c974c0d6756a48d820",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Question: why isn't this a `shared_ptr` / what's the purpose of the `unique_ptr`? I get that there should only ever be one changeset, but I'm confused by the fact that this carries a copy of the underlying raw pointer, as the `unique_ptr` then doesn't seem very unique.",
      "created_at": "2024-10-22T01:53:37Z",
      "updated_at": "2024-10-22T02:04:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1809737214",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809737214"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": 840,
      "original_start_line": 852,
      "start_side": "RIGHT",
      "line": 845,
      "original_line": 845,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809741165",
      "pull_request_review_id": 2383546169,
      "id": 1809741165,
      "node_id": "PRRC_kwDOABII585r3nVt",
      "diff_hunk": "@@ -1295,36 +1295,41 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     return true;\n }\n \n-bool MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args, std::vector<Workspace>& workspaces)\n+void MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n-    const CTransaction& tx = *workspaces.front().m_ptx;\n-    const uint256& hash = workspaces.front().m_hash;\n-    TxValidationState& state = workspaces.front().m_state;\n-    const bool bypass_limits = args.m_bypass_limits;\n \n     if (!m_subpackage.m_all_conflicts.empty()) Assume(args.m_allow_replacement);\n     // Remove conflicting transactions from the mempool\n     for (CTxMemPool::txiter it : m_subpackage.m_all_conflicts)\n     {\n-        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). \",\n                 it->GetTx().GetHash().ToString(),\n                 it->GetTx().GetWitnessHash().ToString(),\n                 it->GetFee(),\n-                it->GetTxSize(),\n-                hash.ToString(),\n-                tx.GetWitnessHash().ToString(),\n-                workspaces[0].m_tx_handle->GetFee(),\n-                workspaces[0].m_tx_handle->GetTxSize());\n+                it->GetTxSize());\n+        FeeFrac feerate = m_subpackage.m_changeset->GetAggregateFeeRate();",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You could use `m_subpackage.m_total_modified_fees, m_subpackage.m_total_vsize` here? Unless you feel that `CTxMemPoolChangeSet::GetAggregateFeeRate` will be useful in the future.",
      "created_at": "2024-10-22T02:00:17Z",
      "updated_at": "2024-10-22T02:04:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1809741165",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1809741165"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1312,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1810686447",
      "pull_request_review_id": 2385138219,
      "id": 1810686447,
      "node_id": "PRRC_kwDOABII585r7OHv",
      "diff_hunk": "@@ -1295,36 +1295,41 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     return true;\n }\n \n-bool MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args, std::vector<Workspace>& workspaces)\n+void MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n-    const CTransaction& tx = *workspaces.front().m_ptx;\n-    const uint256& hash = workspaces.front().m_hash;\n-    TxValidationState& state = workspaces.front().m_state;\n-    const bool bypass_limits = args.m_bypass_limits;\n \n     if (!m_subpackage.m_all_conflicts.empty()) Assume(args.m_allow_replacement);\n     // Remove conflicting transactions from the mempool\n     for (CTxMemPool::txiter it : m_subpackage.m_all_conflicts)\n     {\n-        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). \",\n                 it->GetTx().GetHash().ToString(),\n                 it->GetTx().GetWitnessHash().ToString(),\n                 it->GetFee(),\n-                it->GetTxSize(),\n-                hash.ToString(),\n-                tx.GetWitnessHash().ToString(),\n-                workspaces[0].m_tx_handle->GetFee(),\n-                workspaces[0].m_tx_handle->GetTxSize());\n+                it->GetTxSize());\n+        FeeFrac feerate = m_subpackage.m_changeset->GetAggregateFeeRate();\n+        if (m_subpackage.m_changeset->GetTxCount() == 1) {\n+            const CTransaction& tx = m_subpackage.m_changeset->GetTx(0);\n+            LogDebug(BCLog::MEMPOOL, \"New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+                    tx.GetHash().ToString(),\n+                    tx.GetWitnessHash().ToString(),\n+                    feerate.fee, feerate.size);\n+        } else {\n+            LogDebug(BCLog::MEMPOOL, \"New package with %lu txs, fees=%s, vsize=%s\\n\",\n+                    m_subpackage.m_changeset->GetTxCount(),\n+                    feerate.fee,\n+                    feerate.size);\n+        }",
      "path": "src/validation.cpp",
      "position": 168,
      "original_position": 50,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "in_reply_to_id": null,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should this be just logged once; i.e after replacing the transactions.",
      "created_at": "2024-10-22T13:02:25Z",
      "updated_at": "2024-10-22T13:02:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1810686447",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1810686447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": 1312,
      "original_start_line": 1313,
      "start_side": "RIGHT",
      "line": 1323,
      "original_line": 1323,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1810694092",
      "pull_request_review_id": 2385150906,
      "id": 1810694092,
      "node_id": "PRRC_kwDOABII585r7P_M",
      "diff_hunk": "@@ -1295,36 +1295,41 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     return true;\n }\n \n-bool MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args, std::vector<Workspace>& workspaces)\n+void MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n-    const CTransaction& tx = *workspaces.front().m_ptx;\n-    const uint256& hash = workspaces.front().m_hash;\n-    TxValidationState& state = workspaces.front().m_state;\n-    const bool bypass_limits = args.m_bypass_limits;\n \n     if (!m_subpackage.m_all_conflicts.empty()) Assume(args.m_allow_replacement);\n     // Remove conflicting transactions from the mempool\n     for (CTxMemPool::txiter it : m_subpackage.m_all_conflicts)\n     {\n-        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). \",\n                 it->GetTx().GetHash().ToString(),\n                 it->GetTx().GetWitnessHash().ToString(),\n                 it->GetFee(),\n-                it->GetTxSize(),\n-                hash.ToString(),\n-                tx.GetWitnessHash().ToString(),\n-                workspaces[0].m_tx_handle->GetFee(),\n-                workspaces[0].m_tx_handle->GetTxSize());\n+                it->GetTxSize());\n+        FeeFrac feerate = m_subpackage.m_changeset->GetAggregateFeeRate();\n+        if (m_subpackage.m_changeset->GetTxCount() == 1) {\n+            const CTransaction& tx = m_subpackage.m_changeset->GetTx(0);\n+            LogDebug(BCLog::MEMPOOL, \"New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+                    tx.GetHash().ToString(),\n+                    tx.GetWitnessHash().ToString(),\n+                    feerate.fee, feerate.size);\n+        } else {\n+            LogDebug(BCLog::MEMPOOL, \"New package with %lu txs, fees=%s, vsize=%s\\n\",\n+                    m_subpackage.m_changeset->GetTxCount(),\n+                    feerate.fee,\n+                    feerate.size);\n+        }\n         TRACE7(mempool, replaced,\n                 it->GetTx().GetHash().data(),\n                 it->GetTxSize(),\n                 it->GetFee(),\n                 std::chrono::duration_cast<std::chrono::duration<std::uint64_t>>(it->GetTime()).count(),\n-                hash.data(),\n-                workspaces[0].m_tx_handle->GetTxSize(),\n-                workspaces[0].m_tx_handle->GetFee()\n+                m_subpackage.m_changeset->GetTx(0).GetHash().data(),",
      "path": "src/validation.cpp",
      "position": 177,
      "original_position": 59,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "in_reply_to_id": null,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why are we only tracing the first tx in the package",
      "created_at": "2024-10-22T13:07:08Z",
      "updated_at": "2024-10-22T13:07:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1810694092",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1810694092"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1329,
      "original_line": 1329,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811061628",
      "pull_request_review_id": 2385759109,
      "id": 1811061628,
      "node_id": "PRRC_kwDOABII585r8pt8",
      "diff_hunk": "@@ -847,7 +847,14 @@ class CTxMemPool\n         friend class CTxMemPool;\n     };\n \n-    std::unique_ptr<CTxMemPoolChangeSet> GetChangeSet() EXCLUSIVE_LOCKS_REQUIRED(cs) { return std::make_unique<CTxMemPoolChangeSet>(this); }\n+    std::unique_ptr<CTxMemPoolChangeSet> GetChangeSet() EXCLUSIVE_LOCKS_REQUIRED(cs) {\n+        Assume(m_changeset == nullptr);\n+        auto ret = std::make_unique<CTxMemPoolChangeSet>(this);\n+        m_changeset = ret.get();\n+        return ret;\n+    }\n+\n+    CTxMemPoolChangeSet* m_changeset GUARDED_BY(cs){nullptr};",
      "path": "src/txmempool.h",
      "position": 114,
      "original_position": 21,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "1282bc0ac2820c1e7217c5c974c0d6756a48d820",
      "in_reply_to_id": 1809737214,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This only exists for sanity checking that we don't have more than one changeset at a time.  We could just as easily replace this with a `bool`; I made it a pointer mostly for debugging purposes, if the `Assume()` were ever hit.\r\n\r\nThe idea behind the `unique_ptr` is that I wanted all the state in the ChangeSet to magically go away whenever the object goes out of scope, so that I didn't have to explicitly clean up state everywhere that a transaction might fail validation (which seems like a lot of places).  In this PR, there's not a ton of state, but I expect that when we implement cluster mempool that we'll be creating similar staging data structures within the `TxGraph` layer that will exist one level below the mempool (for computing clusters and feerate diagrams for candidate transactions), and I thought this mechanism of ending a staging when the changeset goes out of scope would be an easy way to manage things at that layer as well.  So in the future you could imagine that in the `CTxMemPoolChangeSet` constructor, we might initiate a staging in the underlying `TxGraph`; in the mempool `Apply()` function we might also apply the staging to the `TxGraph`; and in the `CTxMemPoolChangeSet` destructor we might abort a staging in the underlying `TxGraph`.\r\n\r\nThe paradigm I'm looking for is that you can have at most one changeset at a time, and when there's a changeset outstanding that serves as a lock on the mempool so that you can't otherwise add/remove things (except via the changeset) until the changes are either applied or aborted, and the changeset is the destroyed.  However if there's a better way to implement that than what I tried here, I'm certainly open to suggestions.",
      "created_at": "2024-10-22T16:39:56Z",
      "updated_at": "2024-10-22T16:39:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1811061628",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811061628"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": 840,
      "original_start_line": 852,
      "start_side": "RIGHT",
      "line": 845,
      "original_line": 845,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811072822",
      "pull_request_review_id": 2385780065,
      "id": 1811072822,
      "node_id": "PRRC_kwDOABII585r8sc2",
      "diff_hunk": "@@ -1295,36 +1295,41 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     return true;\n }\n \n-bool MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args, std::vector<Workspace>& workspaces)\n+void MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n-    const CTransaction& tx = *workspaces.front().m_ptx;\n-    const uint256& hash = workspaces.front().m_hash;\n-    TxValidationState& state = workspaces.front().m_state;\n-    const bool bypass_limits = args.m_bypass_limits;\n \n     if (!m_subpackage.m_all_conflicts.empty()) Assume(args.m_allow_replacement);\n     // Remove conflicting transactions from the mempool\n     for (CTxMemPool::txiter it : m_subpackage.m_all_conflicts)\n     {\n-        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). \",\n                 it->GetTx().GetHash().ToString(),\n                 it->GetTx().GetWitnessHash().ToString(),\n                 it->GetFee(),\n-                it->GetTxSize(),\n-                hash.ToString(),\n-                tx.GetWitnessHash().ToString(),\n-                workspaces[0].m_tx_handle->GetFee(),\n-                workspaces[0].m_tx_handle->GetTxSize());\n+                it->GetTxSize());\n+        FeeFrac feerate = m_subpackage.m_changeset->GetAggregateFeeRate();\n+        if (m_subpackage.m_changeset->GetTxCount() == 1) {\n+            const CTransaction& tx = m_subpackage.m_changeset->GetTx(0);\n+            LogDebug(BCLog::MEMPOOL, \"New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+                    tx.GetHash().ToString(),\n+                    tx.GetWitnessHash().ToString(),\n+                    feerate.fee, feerate.size);\n+        } else {\n+            LogDebug(BCLog::MEMPOOL, \"New package with %lu txs, fees=%s, vsize=%s\\n\",\n+                    m_subpackage.m_changeset->GetTxCount(),\n+                    feerate.fee,\n+                    feerate.size);\n+        }",
      "path": "src/validation.cpp",
      "position": 168,
      "original_position": 50,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "in_reply_to_id": 1810686447,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I tried to make this code analogous to the old code, which repeated information for each transaction.  I'm open to changing the logging but I am always a little afraid of breaking user's scripts or habits if people are used to grepping for a transaction ID and seeing more information? (Though I guess this PR already is breaking the logging for package RBF... so maybe not a big concern.)",
      "created_at": "2024-10-22T16:48:25Z",
      "updated_at": "2024-10-22T16:48:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1811072822",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811072822"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": 1312,
      "original_start_line": 1313,
      "start_side": "RIGHT",
      "line": 1323,
      "original_line": 1323,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811074008",
      "pull_request_review_id": 2385781647,
      "id": 1811074008,
      "node_id": "PRRC_kwDOABII585r8svY",
      "diff_hunk": "@@ -1295,36 +1295,41 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     return true;\n }\n \n-bool MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args, std::vector<Workspace>& workspaces)\n+void MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n-    const CTransaction& tx = *workspaces.front().m_ptx;\n-    const uint256& hash = workspaces.front().m_hash;\n-    TxValidationState& state = workspaces.front().m_state;\n-    const bool bypass_limits = args.m_bypass_limits;\n \n     if (!m_subpackage.m_all_conflicts.empty()) Assume(args.m_allow_replacement);\n     // Remove conflicting transactions from the mempool\n     for (CTxMemPool::txiter it : m_subpackage.m_all_conflicts)\n     {\n-        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). \",\n                 it->GetTx().GetHash().ToString(),\n                 it->GetTx().GetWitnessHash().ToString(),\n                 it->GetFee(),\n-                it->GetTxSize(),\n-                hash.ToString(),\n-                tx.GetWitnessHash().ToString(),\n-                workspaces[0].m_tx_handle->GetFee(),\n-                workspaces[0].m_tx_handle->GetTxSize());\n+                it->GetTxSize());\n+        FeeFrac feerate = m_subpackage.m_changeset->GetAggregateFeeRate();\n+        if (m_subpackage.m_changeset->GetTxCount() == 1) {\n+            const CTransaction& tx = m_subpackage.m_changeset->GetTx(0);\n+            LogDebug(BCLog::MEMPOOL, \"New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+                    tx.GetHash().ToString(),\n+                    tx.GetWitnessHash().ToString(),\n+                    feerate.fee, feerate.size);\n+        } else {\n+            LogDebug(BCLog::MEMPOOL, \"New package with %lu txs, fees=%s, vsize=%s\\n\",\n+                    m_subpackage.m_changeset->GetTxCount(),\n+                    feerate.fee,\n+                    feerate.size);\n+        }\n         TRACE7(mempool, replaced,\n                 it->GetTx().GetHash().data(),\n                 it->GetTxSize(),\n                 it->GetFee(),\n                 std::chrono::duration_cast<std::chrono::duration<std::uint64_t>>(it->GetTime()).count(),\n-                hash.data(),\n-                workspaces[0].m_tx_handle->GetTxSize(),\n-                workspaces[0].m_tx_handle->GetFee()\n+                m_subpackage.m_changeset->GetTx(0).GetHash().data(),",
      "path": "src/validation.cpp",
      "position": 177,
      "original_position": 59,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "in_reply_to_id": 1810694092,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not sure if the tracing API is well-specified for package based replacement.  I'm open to doing something different than what I propose here though, suggestions?",
      "created_at": "2024-10-22T16:49:14Z",
      "updated_at": "2024-10-22T16:49:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1811074008",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811074008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1329,
      "original_line": 1329,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811083143",
      "pull_request_review_id": 2385796227,
      "id": 1811083143,
      "node_id": "PRRC_kwDOABII585r8u-H",
      "diff_hunk": "@@ -816,6 +816,40 @@ class CTxMemPool\n         assert(m_epoch.guarded()); // verify guard even when it==nullopt\n         return !it || visited(*it);\n     }\n+\n+    class CTxMemPoolChangeSet {\n+    public:\n+        explicit CTxMemPoolChangeSet(CTxMemPool* pool) : m_pool(pool) {}\n+        ~CTxMemPoolChangeSet() = default;\n+\n+        CTxMemPoolChangeSet(const CTxMemPoolChangeSet&) = delete;\n+        CTxMemPoolChangeSet& operator=(const CTxMemPoolChangeSet&) = delete;\n+\n+        using TxHandle = CTxMemPool::txiter;\n+\n+        TxHandle AddTx(const CTransactionRef& tx, const CAmount fee, int64_t time, unsigned int entry_height, uint64_t entry_sequence, bool spends_coinbase, int64_t sigops_cost, LockPoints lp);\n+        void RemoveTx(CTxMemPool::txiter it) { m_all_conflicts.insert(it); }",
      "path": "src/txmempool.h",
      "position": null,
      "original_position": 16,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "fc03c77f8b9a50459076bce3000d18e687f52820",
      "in_reply_to_id": 1809704580,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agreed, done.",
      "created_at": "2024-10-22T16:55:51Z",
      "updated_at": "2024-10-22T16:55:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1811083143",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811083143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": 830,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 831,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811083287",
      "pull_request_review_id": 2385796501,
      "id": 1811083287,
      "node_id": "PRRC_kwDOABII585r8vAX",
      "diff_hunk": "@@ -816,6 +816,40 @@ class CTxMemPool\n         assert(m_epoch.guarded()); // verify guard even when it==nullopt\n         return !it || visited(*it);\n     }\n+\n+    class CTxMemPoolChangeSet {\n+    public:\n+        explicit CTxMemPoolChangeSet(CTxMemPool* pool) : m_pool(pool) {}\n+        ~CTxMemPoolChangeSet() = default;\n+\n+        CTxMemPoolChangeSet(const CTxMemPoolChangeSet&) = delete;\n+        CTxMemPoolChangeSet& operator=(const CTxMemPoolChangeSet&) = delete;\n+\n+        using TxHandle = CTxMemPool::txiter;\n+\n+        TxHandle AddTx(const CTransactionRef& tx, const CAmount fee, int64_t time, unsigned int entry_height, uint64_t entry_sequence, bool spends_coinbase, int64_t sigops_cost, LockPoints lp);\n+        void RemoveTx(CTxMemPool::txiter it) { m_all_conflicts.insert(it); }\n+\n+        util::Result<CTxMemPool::setEntries> CalculateMemPoolAncestors(TxHandle tx, const Limits& limits) {\n+            LOCK(m_pool->cs);\n+            auto ret = m_pool->CalculateMemPoolAncestors(*tx, limits);\n+            if (ret) m_ancestors.insert({tx, *ret});\n+            else m_ancestors.erase(tx);\n+            return ret;\n+        }\n+\n+        void Apply() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    private:\n+        CTxMemPool* m_pool;\n+        CTxMemPool::indexed_transaction_set m_stage_tx;\n+        std::vector<CTxMemPool::txiter> m_entry_vec; // track the added transactions' insertion order\n+        // map from the stage_tx index to the ancestors for the transaction\n+        std::map<CTxMemPool::txiter, CTxMemPool::setEntries, CompareIteratorByHash> m_ancestors;\n+        CTxMemPool::setEntries m_all_conflicts;",
      "path": "src/txmempool.h",
      "position": null,
      "original_position": 34,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "fc03c77f8b9a50459076bce3000d18e687f52820",
      "in_reply_to_id": 1809735446,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agreed, done.",
      "created_at": "2024-10-22T16:56:00Z",
      "updated_at": "2024-10-22T16:56:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1811083287",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811083287"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": 845,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 849,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811084319",
      "pull_request_review_id": 2385798008,
      "id": 1811084319,
      "node_id": "PRRC_kwDOABII585r8vQf",
      "diff_hunk": "@@ -1295,36 +1295,41 @@ bool MemPoolAccept::ConsensusScriptChecks(const ATMPArgs& args, Workspace& ws)\n     return true;\n }\n \n-bool MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args, std::vector<Workspace>& workspaces)\n+void MemPoolAccept::FinalizeSubpackage(const ATMPArgs& args)\n {\n     AssertLockHeld(cs_main);\n     AssertLockHeld(m_pool.cs);\n-    const CTransaction& tx = *workspaces.front().m_ptx;\n-    const uint256& hash = workspaces.front().m_hash;\n-    TxValidationState& state = workspaces.front().m_state;\n-    const bool bypass_limits = args.m_bypass_limits;\n \n     if (!m_subpackage.m_all_conflicts.empty()) Assume(args.m_allow_replacement);\n     // Remove conflicting transactions from the mempool\n     for (CTxMemPool::txiter it : m_subpackage.m_all_conflicts)\n     {\n-        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). New tx %s (wtxid=%s, fees=%s, vsize=%s)\\n\",\n+        LogDebug(BCLog::MEMPOOL, \"replacing mempool tx %s (wtxid=%s, fees=%s, vsize=%s). \",\n                 it->GetTx().GetHash().ToString(),\n                 it->GetTx().GetWitnessHash().ToString(),\n                 it->GetFee(),\n-                it->GetTxSize(),\n-                hash.ToString(),\n-                tx.GetWitnessHash().ToString(),\n-                workspaces[0].m_tx_handle->GetFee(),\n-                workspaces[0].m_tx_handle->GetTxSize());\n+                it->GetTxSize());\n+        FeeFrac feerate = m_subpackage.m_changeset->GetAggregateFeeRate();",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "32ac5cd59b1fc4819de26ce52b439317149ca5de",
      "original_commit_id": "a8d3118d0cf39e0e49e54814c7a75150b7db2b44",
      "in_reply_to_id": 1809741165,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks that is much better; the only reason I had introduced `GetAggregateFeeRate()` was for access in this one place, so now that is gone.",
      "created_at": "2024-10-22T16:56:43Z",
      "updated_at": "2024-10-22T16:56:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31122#discussion_r1811084319",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1811084319"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31122"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1312,
      "side": "RIGHT"
    }
  ]
}