{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28007",
    "id": 1413875269,
    "node_id": "PR_kwDOABII585URgZF",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/28007",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/28007.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/28007.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28007",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28007/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28007/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28007/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0cf727382d67e6a84029373fef96e212bfb7b808",
    "number": 28007,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "fix: delay in TimeOffset applied to AdjustedTime caused by send/receiâ€¦",
    "user": {
      "login": "techy2",
      "id": 72998170,
      "node_id": "MDQ6VXNlcjcyOTk4MTcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/72998170?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/techy2",
      "html_url": "https://github.com/techy2",
      "followers_url": "https://api.github.com/users/techy2/followers",
      "following_url": "https://api.github.com/users/techy2/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/techy2/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/techy2/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/techy2/subscriptions",
      "organizations_url": "https://api.github.com/users/techy2/orgs",
      "repos_url": "https://api.github.com/users/techy2/repos",
      "events_url": "https://api.github.com/users/techy2/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/techy2/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "On busy VPS and shared host with limited resources, the time between when a messages is sent to the tcpip send or receive \r\nqueue and when it is sent in the case of send queue, or when it is processed (ProcessMessage) can be in excess of 30 seconds. \r\nThis delay introduces a skew in AdjustedTime.\r\n\r\nFor the receive queue, the post processing uses the receive time prior to entering the queue to calculate TimeOffset rather than Now()  which currently includes the delay in the queue.\r\n\r\nFor the send queue, the queued message is altered to update the nTime of the message to the actual time it is being sent rather than the time at which it was queued\r\n\r\nWas tested on an hp 370 G6 24 core 3ghz 192gb host with the daemon launched with -par=2 to restrict the resources of the \r\ndaemon. Logging was added pre-patch to document the delay through the queue and was observed for both send and receive to be occasionally > 30 seconds when the daemon was busy following the tip or during reorgs when the cup utilization for the assigned core  approached 100%.  Significant queue delay occurs most often in the receive queue (several times a minute) and infrequently in the send queue ( 1 observation in several hours of testing ).\r\n\r\n## Checklist:\r\n  _Go over all the following points, and put an `x` in all the boxes that apply._\r\n- [X ] I have performed a self-review of my own code\r\n- [X ] I have commented my code, particularly in hard-to-understand areas\r\n- [ ] I have added or updated relevant unit/integration/functional/e2e tests\r\n- [ ] I have made corresponding changes to the documentation\r\n- [ ] I have assigned this pull request to a milestone _(for repository code-owners and collaborators only)_\r\n",
    "labels": [
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2023-06-29T20:02:40Z",
    "updated_at": "2023-06-29T23:53:34Z",
    "closed_at": "2023-06-29T23:53:34Z",
    "mergeable_state": "unknown",
    "merge_commit_sha": "f8fc45058dc3e2e83ca5fe4f521773d8db60cddf",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "techupgrades:timeoffset",
      "ref": "timeoffset",
      "sha": "0cf727382d67e6a84029373fef96e212bfb7b808",
      "user": {
        "login": "techupgrades",
        "id": 138039520,
        "node_id": "O_kgDOCDpQ4A",
        "avatar_url": "https://avatars.githubusercontent.com/u/138039520?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/techupgrades",
        "html_url": "https://github.com/techupgrades",
        "followers_url": "https://api.github.com/users/techupgrades/followers",
        "following_url": "https://api.github.com/users/techupgrades/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/techupgrades/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/techupgrades/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/techupgrades/subscriptions",
        "organizations_url": "https://api.github.com/users/techupgrades/orgs",
        "repos_url": "https://api.github.com/users/techupgrades/repos",
        "events_url": "https://api.github.com/users/techupgrades/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/techupgrades/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 660310113,
        "node_id": "R_kgDOJ1uIYQ",
        "name": "bitcoin",
        "full_name": "techupgrades/bitcoin",
        "owner": {
          "login": "techupgrades",
          "id": 138039520,
          "node_id": "O_kgDOCDpQ4A",
          "avatar_url": "https://avatars.githubusercontent.com/u/138039520?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/techupgrades",
          "html_url": "https://github.com/techupgrades",
          "followers_url": "https://api.github.com/users/techupgrades/followers",
          "following_url": "https://api.github.com/users/techupgrades/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/techupgrades/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/techupgrades/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/techupgrades/subscriptions",
          "organizations_url": "https://api.github.com/users/techupgrades/orgs",
          "repos_url": "https://api.github.com/users/techupgrades/repos",
          "events_url": "https://api.github.com/users/techupgrades/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/techupgrades/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/techupgrades/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/techupgrades/bitcoin",
        "archive_url": "https://api.github.com/repos/techupgrades/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/techupgrades/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/techupgrades/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/techupgrades/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/techupgrades/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/techupgrades/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/techupgrades/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/techupgrades/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/techupgrades/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/techupgrades/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/techupgrades/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/techupgrades/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/techupgrades/bitcoin/events",
        "forks_url": "https://api.github.com/repos/techupgrades/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/techupgrades/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/techupgrades/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/techupgrades/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/techupgrades/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/techupgrades/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/techupgrades/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/techupgrades/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/techupgrades/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/techupgrades/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/techupgrades/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/techupgrades/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/techupgrades/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/techupgrades/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/techupgrades/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/techupgrades/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:techupgrades/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/techupgrades/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/techupgrades/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/techupgrades/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/techupgrades/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/techupgrades/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/techupgrades/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/techupgrades/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/techupgrades/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/techupgrades/bitcoin/hooks",
        "svn_url": "https://github.com/techupgrades/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 197016,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-30T00:17:45Z",
        "created_at": "2023-06-29T18:08:48Z",
        "updated_at": "2023-06-29T18:10:39Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "c6287faae4c0e705a9258a340dfcf548906f12af",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35476,
        "stargazers_count": 70608,
        "watchers_count": 70608,
        "size": 236222,
        "default_branch": "master",
        "open_issues_count": 673,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-08-03T00:03:27Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-08-02T18:21:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28007"
      }
    },
    "author_association": "NONE",
    "draft": false,
    "additions": 67,
    "deletions": 3,
    "changed_files": 2,
    "commits": 1,
    "review_comments": 0,
    "comments": 4
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBjZjcyNzM4MmQ2N2U2YTg0MDI5MzczZmVmOTZlMjEyYmZiN2I4MDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0cf727382d67e6a84029373fef96e212bfb7b808",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0cf727382d67e6a84029373fef96e212bfb7b808",
      "tree": {
        "sha": "a9c92d76aa8b64a30edd3aac17067585b0b33bbc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a9c92d76aa8b64a30edd3aac17067585b0b33bbc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c6287faae4c0e705a9258a340dfcf548906f12af",
          "sha": "c6287faae4c0e705a9258a340dfcf548906f12af",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c6287faae4c0e705a9258a340dfcf548906f12af"
        }
      ],
      "message": "fix: delay in TimeOffset applied to AdjustedTime caused by send/receive message queues",
      "committer": {
        "name": "techy2",
        "email": "techy2@bizsystems.com",
        "date": "2023-06-29T19:54:44Z"
      },
      "author": {
        "name": "techy2",
        "email": "techy2@bizsystems.com",
        "date": "2023-06-29T19:54:44Z"
      },
      "sha": "0cf727382d67e6a84029373fef96e212bfb7b808"
    },
    {
      "event": "commented",
      "id": 1613738462,
      "node_id": "IC_kwDOABII585gL7He",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1613738462",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T20:02:43Z",
      "updated_at": "2023-06-29T21:51:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27509](https://github.com/bitcoin/bitcoin/pull/27509) (Relay own transactions only via short-lived Tor or I2P connections by vasild)\n* [#27407](https://github.com/bitcoin/bitcoin/pull/27407) (net, refactor: Privatise CNode send queue by dergoegge)\n* [#26621](https://github.com/bitcoin/bitcoin/pull/26621) (refactor: Continue moving application data from CNode to Peer by dergoegge)\n* [#25390](https://github.com/bitcoin/bitcoin/pull/25390) (sync: introduce a thread-safe generic container and use it to remove a bunch of \"GlobalMutex\"es by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28007#issuecomment-1613738462",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28007"
    },
    {
      "event": "commented",
      "id": 1613756862,
      "node_id": "IC_kwDOABII585gL_m-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1613756862",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T20:16:35Z",
      "updated_at": "2023-06-29T20:16:35Z",
      "author_association": "MEMBER",
      "body": "Duplicate of https://github.com/bitcoin/bitcoin/pull/6642?",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28007#issuecomment-1613756862",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28007"
    },
    {
      "event": "commented",
      "id": 1613758123,
      "node_id": "IC_kwDOABII585gL_6r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1613758123",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T20:17:41Z",
      "updated_at": "2023-06-29T20:17:41Z",
      "author_association": "MEMBER",
      "body": "See also #25908",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28007#issuecomment-1613758123",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28007"
    },
    {
      "event": "labeled",
      "id": 9682374212,
      "node_id": "LE_lADOABII585qLmGuzwAAAAJBHU5E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9682374212",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T23:13:09Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unsubscribed",
      "id": 9682404653,
      "node_id": "UE_lADOABII585qLmGuzwAAAAJBHcUt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9682404653",
      "actor": {
        "login": "joostjager",
        "id": 4638168,
        "node_id": "MDQ6VXNlcjQ2MzgxNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4638168?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/joostjager",
        "html_url": "https://github.com/joostjager",
        "followers_url": "https://api.github.com/users/joostjager/followers",
        "following_url": "https://api.github.com/users/joostjager/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/joostjager/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/joostjager/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/joostjager/subscriptions",
        "organizations_url": "https://api.github.com/users/joostjager/orgs",
        "repos_url": "https://api.github.com/users/joostjager/repos",
        "events_url": "https://api.github.com/users/joostjager/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/joostjager/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T23:20:29Z"
    },
    {
      "event": "commented",
      "id": 1613931101,
      "node_id": "IC_kwDOABII585gMqJd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1613931101",
      "actor": {
        "login": "techy2",
        "id": 72998170,
        "node_id": "MDQ6VXNlcjcyOTk4MTcw",
        "avatar_url": "https://avatars.githubusercontent.com/u/72998170?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/techy2",
        "html_url": "https://github.com/techy2",
        "followers_url": "https://api.github.com/users/techy2/followers",
        "following_url": "https://api.github.com/users/techy2/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/techy2/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/techy2/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/techy2/subscriptions",
        "organizations_url": "https://api.github.com/users/techy2/orgs",
        "repos_url": "https://api.github.com/users/techy2/repos",
        "events_url": "https://api.github.com/users/techy2/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/techy2/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T23:53:34Z",
      "updated_at": "2023-06-29T23:53:34Z",
      "author_association": "NONE",
      "body": "Pointer offset error not flagged in my build. Will close this pull and open a new one with issue resolved.\r\nTesting solution now.",
      "user": {
        "login": "techy2",
        "id": 72998170,
        "node_id": "MDQ6VXNlcjcyOTk4MTcw",
        "avatar_url": "https://avatars.githubusercontent.com/u/72998170?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/techy2",
        "html_url": "https://github.com/techy2",
        "followers_url": "https://api.github.com/users/techy2/followers",
        "following_url": "https://api.github.com/users/techy2/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/techy2/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/techy2/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/techy2/subscriptions",
        "organizations_url": "https://api.github.com/users/techy2/orgs",
        "repos_url": "https://api.github.com/users/techy2/repos",
        "events_url": "https://api.github.com/users/techy2/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/techy2/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28007#issuecomment-1613931101",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28007"
    },
    {
      "event": "closed",
      "id": 9682518186,
      "node_id": "CE_lADOABII585qLmGuzwAAAAJBH4Cq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9682518186",
      "actor": {
        "login": "techy2",
        "id": 72998170,
        "node_id": "MDQ6VXNlcjcyOTk4MTcw",
        "avatar_url": "https://avatars.githubusercontent.com/u/72998170?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/techy2",
        "html_url": "https://github.com/techy2",
        "followers_url": "https://api.github.com/users/techy2/followers",
        "following_url": "https://api.github.com/users/techy2/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/techy2/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/techy2/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/techy2/subscriptions",
        "organizations_url": "https://api.github.com/users/techy2/orgs",
        "repos_url": "https://api.github.com/users/techy2/repos",
        "events_url": "https://api.github.com/users/techy2/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/techy2/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T23:53:34Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T01:02:50Z",
      "updated_at": "2023-06-30T01:02:50Z",
      "source": {
        "issue": {
          "id": 1678541218,
          "node_id": "PR_kwDOABII585O3QRm",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27509",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27509/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27509/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27509/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27509",
          "number": 27509,
          "state": "open",
          "state_reason": null,
          "title": "Relay own transactions only via short-lived Tor or I2P connections",
          "body": "To improve privacy, relay locally submitted transactions (from the wallet or via RPC) to the P2P network only via Tor or I2P short-lived connections.\r\n\r\n* Introduce a new connection type for relaying sensitive data (our own transactions) with the following properties:\r\n  * started whenever there are local unbroadcast transactions to be sent\r\n  * only opened to Tor or I2P peers\r\n  * opened regardless of max connections limits\r\n  * after handshake is completed one local transaction is pushed to the peer and the connection is closed\r\n  * ignore all incoming messages after handshake is completed\r\n\r\n* Relay locally submitted transactions (from the wallet or via RPC) using this new mechanism, to a few Tor or I2P peers.\r\n\r\n* Hide those transactions from `GETDATA` and `MEMPOOL` requests, as if we don't have them.\r\n\r\n* Once we get an `INV` from somebody, request the transaction with `GETDATA`, as if we didn't have it before.\r\n\r\n* After we receive the full transaction as a `TX` message, in reply to our `GETDATA` request, only then consider the transaction has propagated through the network and remove it from the unbroadcast list.\r\n\r\n* `INV` it to others as a result of the `TX` message we get, like what we do with transactions that are not ours.\r\n\r\nThe messages exchange should look like this:\r\n\r\n```\r\ntx-sender >--- connect -------> tx-recipient\r\ntx-sender >--- VERSION -------> tx-recipient\r\ntx-sender <--- VERSION -------< tx-recipient\r\ntx-sender <--- WTXIDRELAY ----< tx-recipient (maybe) \r\ntx-sender <--- SENDADDRV2 ----< tx-recipient (maybe) \r\ntx-sender <--- SENDTXRCNCL ---< tx-recipient (maybe) \r\ntx-sender <--- VERACK --------< tx-recipient\r\ntx-sender >--- VERACK --------> tx-recipient\r\ntx-sender >--- TX ------------> tx-recipient\r\ntx-sender >--- PING ----------> tx-recipient\r\ntx-sender <--- PONG ----------< tx-recipient\r\ntx-sender disconnects\r\n```\r\n\r\nWhenever a new local transaction is received (from the wallet or RPC), the node will send it to 5 (`SENSITIVE_RELAY_NUM_BROADCAST_PER_TX`) recipients right away. If after 10-15 mins we still have not heard anything about the transaction from the network, then it will be sent to 5 more peers (see `PeerManagerImpl::ReattemptInitialBroadcast()`).\r\n\r\nA few considerations:\r\n* The short-lived sensitive relay connections are very cheap and fast wrt network traffic. It is expected that some of those peers will blackhole the transaction. Just one honest/proper peer is enough for successful propagation.\r\n* The peers that receive the transaction could deduce that this is initial transaction broadcast from the transaction originator. This is ok, they can't identify the sender.\r\n\r\nTODO:\r\n* [x] Disable if `-connect` is used or Tor and I2P are not reachable.\r\n* [x] Use I2P transient connections even if listening on I2P.\r\n* [x] Do something with the user-agent string (could reveal identity if it has been personalized) and make sure no identifying information in the `VERSION` message. Done: took the [suggestion below](https://github.com/bitcoin/bitcoin/pull/27509#issuecomment-1517896418).\r\n* [x] Improve the condition when we consider the transaction seen by the network: right now a single INV from somebody suffices (this is still an improvement over `master` which is ok right after pushing the tx to a peer). We could wait for more than one INV, from peers that we have selected (outbound) and that are specifically not the ones we broadcasted to (via short-lived connection). Edit: One `INV` should be enough because after that we broadcast the transaction to everybody we are connected to (like if it is not ours).\r\n* [ ] Idea: start with one connection per transaction (not 5 as it is now), optimistically assuming it will be sufficient. (numbers are examples) After 1 minute, if still not received from the network, try 2 connections, after a few minutes try more. If still unsuccessful after 10 minutes, then fall back to the old mechanism.\r\n\r\nThis is supposed to address:\r\nhttps://github.com/bitcoin/bitcoin/issues/3828\r\nhttps://github.com/bitcoin/bitcoin/issues/14692\r\nhttps://github.com/bitcoin/bitcoin/issues/19042\r\nhttps://github.com/bitcoin/bitcoin/issues/24557\r\nhttps://github.com/bitcoin/bitcoin/issues/25450\r\n",
          "user": {
            "login": "vasild",
            "id": 266751,
            "node_id": "MDQ6VXNlcjI2Njc1MQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/vasild",
            "html_url": "https://github.com/vasild",
            "followers_url": "https://api.github.com/users/vasild/followers",
            "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
            "organizations_url": "https://api.github.com/users/vasild/orgs",
            "repos_url": "https://api.github.com/users/vasild/repos",
            "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/vasild/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64584,
              "node_id": "MDU6TGFiZWw2NDU4NA==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
              "name": "Brainstorming",
              "color": "ebd775",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 52,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27509",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27509",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27509.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27509.patch"
          },
          "created_at": "2023-04-21T13:39:19Z",
          "updated_at": "2023-08-02T20:57:20Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T01:30:00Z",
      "updated_at": "2023-06-30T01:30:00Z",
      "source": {
        "issue": {
          "id": 1652089479,
          "node_id": "PR_kwDOABII585Nfb4D",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27407",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27407/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27407/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27407/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27407",
          "number": 27407,
          "state": "open",
          "state_reason": null,
          "title": "net, refactor: Privatise CNode send queue",
          "body": "The send queue members on `CNode` should not be part of the public interface. This PR makes all of them private and creates a clear interface for the send queue.\r\n\r\nThe interface after this PR consists of:\r\n* `CNode::PushMessage` for appending a message onto the send queue\r\n* `CNode::SocketSendData` for pushing as many messages from the send queue as possible onto the wire\r\n* `CNode::IsSendQueueEmpty` for checking if the send queue is empty\r\n* (`CNode::TestOnlyClearSendQueue` a test-only utility for clearing the send queue)",
          "user": {
            "login": "dergoegge",
            "id": 8077169,
            "node_id": "MDQ6VXNlcjgwNzcxNjk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dergoegge",
            "html_url": "https://github.com/dergoegge",
            "followers_url": "https://api.github.com/users/dergoegge/followers",
            "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
            "organizations_url": "https://api.github.com/users/dergoegge/orgs",
            "repos_url": "https://api.github.com/users/dergoegge/repos",
            "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/dergoegge/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27407",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27407",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27407.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27407.patch"
          },
          "created_at": "2023-04-03T13:36:50Z",
          "updated_at": "2023-08-02T11:34:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T03:11:36Z",
      "updated_at": "2023-06-30T03:11:36Z",
      "source": {
        "issue": {
          "id": 1471685707,
          "node_id": "PR_kwDOABII585EFGFt",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26621",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26621/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26621/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26621/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26621",
          "number": 26621,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Continue moving application data from CNode to Peer",
          "body": "This PR picks up a subset of changes from #24970 and additionally moves `m_bip152_highbandwith{to,from}`, `nTimeOffset`, `nVersion`, `m_greates_common_version`.",
          "user": {
            "login": "dergoegge",
            "id": 8077169,
            "node_id": "MDQ6VXNlcjgwNzcxNjk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dergoegge",
            "html_url": "https://github.com/dergoegge",
            "followers_url": "https://api.github.com/users/dergoegge/followers",
            "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
            "organizations_url": "https://api.github.com/users/dergoegge/orgs",
            "repos_url": "https://api.github.com/users/dergoegge/repos",
            "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/dergoegge/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 16,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26621",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26621",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26621.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26621.patch"
          },
          "created_at": "2022-12-01T17:26:32Z",
          "updated_at": "2023-08-02T13:36:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T04:41:01Z",
      "updated_at": "2023-06-30T04:41:01Z",
      "source": {
        "issue": {
          "id": 1273517561,
          "node_id": "PR_kwDOABII5845xiLt",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25390",
          "number": 25390,
          "state": "open",
          "state_reason": null,
          "title": "sync: introduce a thread-safe generic container and use it to remove a bunch of \"GlobalMutex\"es",
          "body": "Introduce a generic container that provides a thread-safe access to any object by using a mutex which is acquired every time the object accessed.\r\n\r\nFor example:\r\n\r\n```cpp\r\nSynced<std::unordered_map<int, int>> m{{3, 9}, {4, 16}};\r\n\r\n{\r\n    SYNCED_LOCK(m, m_locked);\r\n\r\n    // m_locked represents the internal object, i.e. std::unordered_map,\r\n    // while m_locked is in scope the internal mutex is locked.\r\n\r\n    auto it = m_locked->find(3);\r\n    if (it != m_locked->end()) {\r\n        std::cout << it->second << std::endl;\r\n    }\r\n\r\n    for (auto& [k, v] : *m_locked) {\r\n        std::cout << k << \", \" << v << std::endl;\r\n    }\r\n}\r\n\r\nWITH_SYNCED_LOCK(m, p, p->emplace(5, 25));\r\n```\r\n\r\nRemove the global mutexes `g_maplocalhost_mutex`, `g_deadline_timers_mutex`, `cs_dir_locks`, `g_loading_wallet_mutex`, `g_wallet_release_mutex` and use `Synced<T>` instead.\r\n\r\n## Benefits\r\n\r\n_copied from a [comment below](https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1169788319):_\r\n\r\nThe `Synced<T>` abstraction is similar to what is suggested in [this comment](https://github.com/bitcoin/bitcoin/pull/24931#discussion_r890636987) but it does so in a generic way to avoid code repetition. Its benefit is:\r\n\r\n1. It avoids code repetition at the implementation sites. See [PR#26151](https://github.com/bitcoin/bitcoin/pull/26151) for a live example. Namely this:\r\n\r\n<details>\r\n<summary>Lots of repetitions (92 lines)</summary>\r\n\r\n```cpp\r\nclass Foo\r\n{\r\npublic:\r\n    void PushBack(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.push_back(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Foo::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::vector<int> m_data;\r\n};\r\n\r\nclass Bar\r\n{\r\npublic:\r\n    void PushBack(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.push_back(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Bar::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::vector<std::string> m_data;\r\n};\r\n\r\nclass Baz\r\n{\r\npublic:\r\n    void Insert(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.insert(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Baz::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::set<std::string> m_data;\r\n};\r\n```\r\n</details>\r\n\r\nbecomes this:\r\n\r\n<details>\r\n<summary>Short (3 lines)</summary>\r\n\r\n```cpp\r\nSynced<std::vector<int>> Foo;\r\nSynced<std::vector<std::string>> Bar;\r\nSynced<std::set<std::string>> Baz;\r\n```\r\n</details>\r\n\r\n2. The mutex is properly encapsulated. With a global mutex and a global variable annotated with `GUARDED_BY()` it is indeed not possible to add new code that accesses the variable without protection (if using Clang and `-Wthread-safety-analysis` and `-Werror`), but it is possible to abuse the mutex and start using it to protect some more, possibly unrelated stuff (we already have this in the current code).\r\n",
          "user": {
            "login": "vasild",
            "id": 266751,
            "node_id": "MDQ6VXNlcjI2Njc1MQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/vasild",
            "html_url": "https://github.com/vasild",
            "followers_url": "https://api.github.com/users/vasild/followers",
            "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
            "organizations_url": "https://api.github.com/users/vasild/orgs",
            "repos_url": "https://api.github.com/users/vasild/repos",
            "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/vasild/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 25,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25390",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25390.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25390.patch"
          },
          "created_at": "2022-06-16T12:46:53Z",
          "updated_at": "2023-07-22T14:06:27Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T05:59:12Z",
      "updated_at": "2023-06-30T05:59:12Z",
      "source": {
        "issue": {
          "id": 1781695863,
          "node_id": "PR_kwDOABII585USa24",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28010",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28010/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28010/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28010/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28010",
          "number": 28010,
          "state": "closed",
          "state_reason": null,
          "title": "fix: delay in TimeOffset applied to AdjustedTime caused by send/receive message queues, correct pointer alignment issue",
          "body": "On busy VPS and shared host with limited resources, the time between when a messages is sent to the tcpip send or receive \r\nqueue and when it is sent in the case of send queue, or when it is processed (ProcessMessage) can be in excess of 30 seconds. \r\nThis delay introduces a skew in AdjustedTime.\r\n\r\nFor the receive queue, the post processing uses the receive time prior to entering the queue to calculate TimeOffset rather than Now()  which currently includes the delay in the queue.\r\n\r\nFor the send queue, the queued message is altered to update the nTime of the message to the actual time it is being sent rather than the time at which it was queued\r\n\r\nWas tested on an hp 370 G6 24 core 3ghz 192gb host with the daemon launched with -par=2 to restrict the resources of the \r\ndaemon. Logging was added pre-patch to document the delay through the queue and was observed for both send and receive to be occasionally > 30 seconds when the daemon was busy following the tip or during reorgs when the cup utilization for the assigned core  approached 100%.  Significant queue delay occurs most often in the receive queue (several times a minute) and infrequently in the send queue ( 1 observation in several hours of testing ).\r\n\r\n## Checklist:\r\n  _Go over all the following points, and put an `x` in all the boxes that apply._\r\n- [X ] I have performed a self-review of my own code\r\n- [X ] I have commented my code, particularly in hard-to-understand areas\r\n- [na ] I have added or updated relevant unit/integration/functional/e2e tests\r\n- [na ] I have made corresponding changes to the documentation\r\n- [na ] I have assigned this pull request to a milestone _(for repository code-owners and collaborators only)_",
          "user": {
            "login": "techy2",
            "id": 72998170,
            "node_id": "MDQ6VXNlcjcyOTk4MTcw",
            "avatar_url": "https://avatars.githubusercontent.com/u/72998170?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/techy2",
            "html_url": "https://github.com/techy2",
            "followers_url": "https://api.github.com/users/techy2/followers",
            "following_url": "https://api.github.com/users/techy2/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/techy2/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/techy2/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/techy2/subscriptions",
            "organizations_url": "https://api.github.com/users/techy2/orgs",
            "repos_url": "https://api.github.com/users/techy2/repos",
            "events_url": "https://api.github.com/users/techy2/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/techy2/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "NONE",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28010",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28010",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28010.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28010.patch"
          },
          "closed_at": "2023-06-30T05:59:12Z",
          "created_at": "2023-06-30T01:12:45Z",
          "updated_at": "2023-07-09T21:48:18Z"
        },
        "type": "issue"
      }
    }
  ],
  "comments": []
}