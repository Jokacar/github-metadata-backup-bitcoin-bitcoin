{
  "type": "issue",
  "issue": {
    "id": 1026357375,
    "node_id": "I_kwDOABII5849LPh_",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/23279",
    "number": 23279,
    "state": "open",
    "state_reason": null,
    "title": "Add unit tests for Taproot code in src/script/interpreter.cpp",
    "body": "The Taproot code in `src/script/interpreter.cpp` is covered by our functional tests (`test/functional/feature_taproot.py` and `test/functional/wallet_taproot.py`), but we don't have any unit test coverage for this code.\r\n\r\nUnit test coverage for `src/script/interpreter.cpp` can be found here:\r\n* https://marcofalke.github.io/btc_cov/test_bitcoin.coverage/src/script/interpreter.cpp.gcov.html\r\n\r\nThese functions in `src/script/interpreter.cpp` are currently not covered by our unit tests:\r\n* `EvalChecksigTapscript`\r\n* `HandleMissingData`\r\n* `SignatureHashSchnorr`\r\n* `GenericTransactionSignatureChecker<T>::VerifySchnorrSignature`\r\n* `GenericTransactionSignatureChecker<T>::CheckSchnorrSignature`\r\n* `ComputeTaprootMerkleRoot`\r\n* `SigVersion::TAPSCRIPT` code paths in `ExecuteWitnessScript`\r\n* Taproot code paths in `VerifyWitnessProgram`\r\n\r\nIt would be nice to have C++ unit tests covering this code in addition to the Python functional tests.",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 4,
    "created_at": "2021-10-14T12:48:27Z",
    "updated_at": "2022-05-03T02:05:46Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 5463597125,
      "node_id": "LE_lADOABII5849LPh_zwAAAAFFp-BF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5463597125",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-14T12:49:35Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 943327032,
      "node_id": "IC_kwDOABII5844Ogc4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/943327032",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-14T12:53:03Z",
      "updated_at": "2021-10-14T12:53:03Z",
      "author_association": "MEMBER",
      "body": "Related: https://github.com/bitcoin/bips/pull/1191",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/23279#issuecomment-943327032",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279"
    },
    {
      "event": "commented",
      "id": 1095228629,
      "node_id": "IC_kwDOABII585BR9zV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1095228629",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-11T15:47:33Z",
      "updated_at": "2022-04-11T15:47:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm working on this ... updates shortly.",
      "user": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/23279#issuecomment-1095228629",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279"
    },
    {
      "event": "commented",
      "id": 1095233258,
      "node_id": "IC_kwDOABII585BR-7q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1095233258",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-11T15:51:27Z",
      "updated_at": "2022-04-11T15:51:27Z",
      "author_association": "MEMBER",
      "body": "Part of this is covered by https://github.com/bitcoin/bitcoin/pull/23394",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/23279#issuecomment-1095233258",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279"
    },
    {
      "event": "commented",
      "id": 1115546623,
      "node_id": "IC_kwDOABII585CfeP_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1115546623",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-03T02:05:46Z",
      "updated_at": "2022-05-03T02:05:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "... still working on this ... PR shortly ...",
      "user": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/23279#issuecomment-1115546623",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23279"
    },
    {
      "event": "referenced",
      "id": 6550835459,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGGddED",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6550835459",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5807b4c1b3e751f72bca673adf913608f7ff5db5",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/5807b4c1b3e751f72bca673adf913608f7ff5db5",
      "created_at": "2022-05-04T18:32:22Z"
    },
    {
      "event": "referenced",
      "id": 6574215135,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGH2o_f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6574215135",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d34cbcef50023c2ee22a295b8332331608f8c20f",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/d34cbcef50023c2ee22a295b8332331608f8c20f",
      "created_at": "2022-05-09T15:30:49Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-09T16:17:57Z",
      "updated_at": "2022-05-09T16:17:57Z",
      "source": {
        "issue": {
          "id": 1229958480,
          "node_id": "PR_kwDOABII5843g-VF",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25097",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25097/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25097/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25097/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25097",
          "number": 25097,
          "state": "closed",
          "state_reason": null,
          "title": "test: Unit tests for taproot/tapscript coverage in `interpreter.cpp`",
          "body": "[Unit tests are not complete to resolve #23279 - _yet_.  But those additional tests - see this space for future developments! - will not change the code presented here.]\r\n\r\nThis PR provides unit tests for Taproot functionality in `script/interpreter.cpp`, #23279.\r\n\r\nGoal is to show correctness vs specifications in BIPs 341/342, and to improve code coverage in Taproot functionality there.\r\n\r\nIntent is to unit test completely without changing `interpreter.cpp` itself to provide visibility into static functions/private methods.  Thus some of the tests must be \"indirect\", testing the unit-under-test by probing a visible caller.  This makes those specific tests somewhat fragile as they depend on code paths in the caller, which may change in the future.  However, such tests are written so they will fail if the unit-under-test isn't actually called.  This is noted in the code of those specific tests.\r\n\r\nNo changes to Bitcoin Core are made - just unit tests added.  The Boost Test framework file `boost/test/execution_monitor.hpp` was added to the lint whitelist - this is acceptable because it is a documented public header of the Boost Test framework, which is already part of the project.\r\n\r\n- [x] `EvalChecksigTapscript`\r\n- [x] `HandleMissingData`\r\n- [x] `SignatureHashSchnorr` - now with full _path_ coverage\r\n- [x] `GenericTransactionSignatureChecker<T>::VerifySchnorrSignature`\r\n- [x] `GenericTransactionSignatureChecker<T>::CheckSchnorrSignature`\r\n- [x] `ComputeTaprootMerkleRoot`\r\n- [ ] `SigVersion::TAPSCRIPT` code paths in `ExecuteWitnessScript`\r\n- [x] Taproot code paths in `VerifyWitnessProgram`\r\n- [ ] Tapscript code paths in `VerifyWitnessProgram`\r\n\r\n**TODO:** Full Tapscript (BIP-342) unit tests yet to be completed.\r\n**TODO:** Does anything need to be done with `libconsensus`? Please advise!\r\n\r\n2 commits:\r\n\r\n1. Add new utility functions to `src/test/util` that are not only used in these tests but may also be useful for future unit tests.  Also, refactor some existing utility functions from current tests (mainly, `script_tests.cpp`) into `src/test/util` so they can be more widely used too.  All of these new test utility functions have unit tests themselves, in `src/test/test_utils_tests.cpp`.\r\n1. All the tests for Taproot/Tapscript functionality requested by #23279 in a new file `src/test/script_tapscript_tests.cpp`.  Code coverage runs show 100% coverage of lines and near 100% coverage of branches.\r\n\r\n**DEATH TRAP AHEAD!:** These unit tests include \"death tests\" (name comes from Googletest framework): Tests that check that an `assert` actually fails.  These are handled with a Boost `execution_monitor` (mentioned above) _but_ the asserts _still issue messages_ even when correctly trapped by the Boost Test framework.  You'll see the following in the logs:\r\n\r\n```\r\ngitpod /workspace/bitcoin/src/test (23279-taproot-unit-tests) $ ./test_bitcoin \r\nRunning 527 test cases...\r\ntest_bitcoin: script/interpreter.cpp:1495: bool SignatureHashSchnorr(uint256 &, ScriptExecutionData &, const T &, uint32_t, uint8_t, SigVersion, const PrecomputedTransactionData &, MissingDataBehavior) [T = CMutableTransaction]: Assertion `false' failed.\r\ntest_bitcoin: script/interpreter.cpp:1497: bool SignatureHashSchnorr(uint256 &, ScriptExecutionData &, const T &, uint32_t, uint8_t, SigVersion, const PrecomputedTransactionData &, MissingDataBehavior) [T = CMutableTransaction]: Assertion `in_pos < tx_to.vin.size()' failed.\r\ntest_bitcoin: script/interpreter.cpp:1528: bool SignatureHashSchnorr(uint256 &, ScriptExecutionData &, const T &, uint32_t, uint8_t, SigVersion, const PrecomputedTransactionData &, MissingDataBehavior) [T = CMutableTransaction]: Assertion `execdata.m_annex_init' failed.\r\ntest_bitcoin: script/interpreter.cpp:1556: bool SignatureHashSchnorr(uint256 &, ScriptExecutionData &, const T &, uint32_t, uint8_t, SigVersion, const PrecomputedTransactionData &, MissingDataBehavior) [T = CMutableTransaction]: Assertion `execdata.m_tapleaf_hash_init' failed.\r\ntest_bitcoin: script/interpreter.cpp:1559: bool SignatureHashSchnorr(uint256 &, ScriptExecutionData &, const T &, uint32_t, uint8_t, SigVersion, const PrecomputedTransactionData &, MissingDataBehavior) [T = CMutableTransaction]: Assertion `execdata.m_codeseparator_pos_init' failed.\r\ntest_bitcoin: script/interpreter.cpp:1469: bool HandleMissingData(MissingDataBehavior): Assertion `!\"Missing data\"' failed.\r\ntest_bitcoin: script/interpreter.cpp:1474: bool HandleMissingData(MissingDataBehavior): Assertion `!\"Unknown MissingDataBehavior value\"' failed.\r\n\r\n*** No errors detected\r\ngitpod /workspace/bitcoin/src/test (23279-taproot-unit-tests) $ \r\n```\r\n\r\nThese specific `Assertion ... failed` messages are _expected_.  The tests triggering them properly _pass_ iff the `assert` (and no other) is _triggered_.\r\n\r\n-----\r\n\r\nCoverage results 2022-06-05 showing Taproot coverage (Tapscript tests not yet complete) when _only running_ `script_tapscript_tests.cpp`:\r\n\r\n|  |   |\r\n|--:|:--|\r\n|`EvalChecksigTapscript`|<img alt=\"EvalChecksigTapscript\" align=\"left\" width=\"550\" src=\"https://user-images.githubusercontent.com/4162948/172067379-4815fd13-1eca-4fdc-afb3-ab321f644ca6.png\">|\r\n|`HandleMissingData`|<img alt=\"HandleMissingData coverage\" align=\"left\" width=\"550\" src=\"https://user-images.githubusercontent.com/4162948/172066800-7ad85065-448c-4300-8f5f-bbdaeb5bc885.png\">|\r\n|`SignatureHashSchnorr`|<img alt=\"SignatureHashSchnorr coverage\" align=\"left\" width=\"550\" src=\"https://user-images.githubusercontent.com/4162948/172067034-c8d65908-bf41-4420-8a5d-5c023f85824a.png\">|\r\n|`GenericTransaction-`<br>`SignatureChecker<T>::`<br>`CheckSchnorrSignature`|<img alt=\"CheckSchnorrSignature\" align=\"left\" width=\"550\" src=\"https://user-images.githubusercontent.com/4162948/172067232-b58ea75a-9df7-4f02-b291-c1adda4792e8.png\">|\r\n|`ComputeTaprootMerkleRoot`|<img alt=\"ComputeTaprootMerkleRoot\" align=\"left\" width=\"550\" src=\"https://user-images.githubusercontent.com/4162948/172067270-d15ac048-6001-4a8f-b0a7-f62b76cf584b.png\">|\r\n|`VerifyWitnessProgram`<br>(Taproot only)|<img alt=\"VerifyWitnessProgram\" align=\"left\" width=\"550\" src=\"https://user-images.githubusercontent.com/4162948/172067308-c23ccaaa-dbee-43ea-b2df-cbee9ba375ed.png\">|\r\n\r\n",
          "user": {
            "login": "david-bakin",
            "id": 4162948,
            "node_id": "MDQ6VXNlcjQxNjI5NDg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/david-bakin",
            "html_url": "https://github.com/david-bakin",
            "followers_url": "https://api.github.com/users/david-bakin/followers",
            "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
            "organizations_url": "https://api.github.com/users/david-bakin/orgs",
            "repos_url": "https://api.github.com/users/david-bakin/repos",
            "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/david-bakin/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 19,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25097",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25097",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25097.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25097.patch"
          },
          "closed_at": "2022-11-10T17:16:20Z",
          "created_at": "2022-05-09T16:17:57Z",
          "updated_at": "2022-11-10T21:27:41Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 6654477484,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGMo0Ss",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6654477484",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d692ae7b317abda208432f9195ecb03850044223",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/d692ae7b317abda208432f9195ecb03850044223",
      "created_at": "2022-05-21T04:29:57Z"
    },
    {
      "event": "referenced",
      "id": 6672101771,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGNsDGL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6672101771",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "fedc037dbab7bdc87c603d94a3d97a0f3e4f02ce",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/fedc037dbab7bdc87c603d94a3d97a0f3e4f02ce",
      "created_at": "2022-05-24T20:19:20Z"
    },
    {
      "event": "referenced",
      "id": 6742679982,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGR5SGu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6742679982",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5d6148b4e4013a0085574b087762abc363078b85",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/5d6148b4e4013a0085574b087762abc363078b85",
      "created_at": "2022-06-05T02:56:42Z"
    },
    {
      "event": "referenced",
      "id": 6742716655,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGR5bDv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6742716655",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "376afb4b606e757153e191936a6af225cc8fccad",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/376afb4b606e757153e191936a6af225cc8fccad",
      "created_at": "2022-06-05T03:50:39Z"
    },
    {
      "event": "referenced",
      "id": 6742725346,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGR5dLi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6742725346",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "047a9f07742cec323418a47c0a78d884fcc23f0f",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/047a9f07742cec323418a47c0a78d884fcc23f0f",
      "created_at": "2022-06-05T04:04:09Z"
    },
    {
      "event": "referenced",
      "id": 6742854615,
      "node_id": "REFE_lADOABII5849LPh_zwAAAAGR58vX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6742854615",
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "eeefec343592c6de85048e3b055ba49755cfb072",
      "commit_url": "https://api.github.com/repos/david-bakin/bitcoin/commits/eeefec343592c6de85048e3b055ba49755cfb072",
      "created_at": "2022-06-05T05:04:47Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "david-bakin",
        "id": 4162948,
        "node_id": "MDQ6VXNlcjQxNjI5NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4162948?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/david-bakin",
        "html_url": "https://github.com/david-bakin",
        "followers_url": "https://api.github.com/users/david-bakin/followers",
        "following_url": "https://api.github.com/users/david-bakin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/david-bakin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/david-bakin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/david-bakin/subscriptions",
        "organizations_url": "https://api.github.com/users/david-bakin/orgs",
        "repos_url": "https://api.github.com/users/david-bakin/repos",
        "events_url": "https://api.github.com/users/david-bakin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/david-bakin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-06T03:22:26Z",
      "updated_at": "2022-06-06T03:22:26Z",
      "source": {
        "issue": {
          "id": 978453946,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NzE5MDM4MDky",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22793",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22793/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22793/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22793/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/22793",
          "number": 22793,
          "state": "closed",
          "state_reason": null,
          "title": "Simplify BaseSignatureChecker virtual functions and GenericTransactionSignatureChecker constructors",
          "body": "`BaseSignatureChecker` has virtual functions which are overridden by its child classes. These virtual functions have a default implementation. However because of the default implementation, bugs can be introduced by failing to implement one of them (e.g. #21151). To avoid this, those functions are made into pure virtual functions so that child classes must implement those functions. There are a few places where a `BaseSignatureChecker` was being created; these instances have been replaced with the `DUMMY_CHECKER`.\r\n\r\n`GenericTransactionSignatureChecker` has two constructors, one which takes a `PrecomputedTransactionData` and one which does not. It can be difficult to understand which one to use, and whether a particular `GenericTransactionSignatureChecker` has a `PrecomputedTransactionData`. This has lead to some bugs as well (e.g. #22784). Looking through the codebase, the only place where `PrecomputedTransactionData` does not need to be provided is in the unit tests. As such, this PR changes `GenericTransactionSignatureChecker` to have only one constructor which requires `PrecomputedTransactionData` to be provided. This has a side effect of requiring the same for `MutableTransactionSignatureCreator`, which also had two constructors, and the one that did not require `PrecomputedTransactionData` was only used in tests.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22793",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/22793",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/22793.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/22793.patch"
          },
          "closed_at": "2022-10-12T18:37:53Z",
          "created_at": "2021-08-24T20:22:27Z",
          "updated_at": "2022-10-12T18:37:53Z"
        },
        "type": "issue"
      }
    }
  ]
}