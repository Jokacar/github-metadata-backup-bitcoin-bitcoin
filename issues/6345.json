{
  "type": "issue",
  "issue": {
    "id": 91432004,
    "node_id": "MDU6SXNzdWU5MTQzMjAwNA==",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6345",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6345/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6345/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6345/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/6345",
    "number": 6345,
    "state": "closed",
    "state_reason": "completed",
    "title": "fresh prune with out-of-sync wallet can fail (but shouldn't)",
    "body": "If you restart a non pruned full node with `-prune=550` (to enable pruning), while having a wallet which is not in sync (maybe you copied it), the node will first prune, than complain about a impossible rescan (see below).\nIMO before pruning all old blocks, the node should firs try to sync the wallet.\n\n```\nPrune: UnlinkPrunedFiles deleted blk/rev (00263)\nPrune: UnlinkPrunedFiles deleted blk/rev (00264)\nPrune: UnlinkPrunedFiles deleted blk/rev (00265)\nPrune: UnlinkPrunedFiles deleted blk/rev (00266)\nPrune: UnlinkPrunedFiles deleted blk/rev (00267)\nPrune: UnlinkPrunedFiles deleted blk/rev (00268)\nPrune: UnlinkPrunedFiles deleted blk/rev (00269)\nPrune: UnlinkPrunedFiles deleted blk/rev (00270)\nPrune: UnlinkPrunedFiles deleted blk/rev (00271)\nPrune: UnlinkPrunedFiles deleted blk/rev (00272)\nPrune: UnlinkPrunedFiles deleted blk/rev (00273)\nPrune: UnlinkPrunedFiles deleted blk/rev (00274)\nPrune: UnlinkPrunedFiles deleted blk/rev (00275)\nPrune: UnlinkPrunedFiles deleted blk/rev (00276)\nPrune: UnlinkPrunedFiles deleted blk/rev (00277)\nPrune: UnlinkPrunedFiles deleted blk/rev (00278)\nPrune: UnlinkPrunedFiles deleted blk/rev (00279)\nPrune: UnlinkPrunedFiles deleted blk/rev (00280)\nPrune: UnlinkPrunedFiles deleted blk/rev (00281)\nPrune: UnlinkPrunedFiles deleted blk/rev (00282)\nPrune: UnlinkPrunedFiles deleted blk/rev (00283)\nPrune: UnlinkPrunedFiles deleted blk/rev (00284)\nPrune: UnlinkPrunedFiles deleted blk/rev (00285)\ninit message: Loading wallet...\nnFileVersion = 119900\nKeys: 102 plaintext, 0 encrypted, 102 w/ metadata, 102 total\n wallet                  772ms\nError: Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\nError: Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\n```\n",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 1,
    "closed_at": "2015-08-03T17:34:58Z",
    "created_at": "2015-06-27T08:17:56Z",
    "updated_at": "2021-09-08T12:48:22Z"
  },
  "events": [
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ajweiss",
        "id": 430315,
        "node_id": "MDQ6VXNlcjQzMDMxNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/430315?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajweiss",
        "html_url": "https://github.com/ajweiss",
        "followers_url": "https://api.github.com/users/ajweiss/followers",
        "following_url": "https://api.github.com/users/ajweiss/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajweiss/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajweiss/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajweiss/subscriptions",
        "organizations_url": "https://api.github.com/users/ajweiss/orgs",
        "repos_url": "https://api.github.com/users/ajweiss/repos",
        "events_url": "https://api.github.com/users/ajweiss/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajweiss/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-06-30T19:35:57Z",
      "updated_at": "2015-06-30T19:35:57Z",
      "source": {
        "issue": {
          "id": 92180510,
          "node_id": "MDExOlB1bGxSZXF1ZXN0Mzg5MTU3MjM=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6356",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6356/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6356/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6356/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/6356",
          "number": 6356,
          "state": "closed",
          "state_reason": null,
          "title": "Delay initial pruning until after wallet init",
          "body": "Don't prune until any wallet rescanning has taken place to avoid\npotentially pruning blocks that the wallet rescan may need.\n\nFixes #6345 \n",
          "user": {
            "login": "ajweiss",
            "id": 430315,
            "node_id": "MDQ6VXNlcjQzMDMxNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/430315?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ajweiss",
            "html_url": "https://github.com/ajweiss",
            "followers_url": "https://api.github.com/users/ajweiss/followers",
            "following_url": "https://api.github.com/users/ajweiss/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ajweiss/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ajweiss/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ajweiss/subscriptions",
            "organizations_url": "https://api.github.com/users/ajweiss/orgs",
            "repos_url": "https://api.github.com/users/ajweiss/repos",
            "events_url": "https://api.github.com/users/ajweiss/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ajweiss/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/6356",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/6356",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/6356.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/6356.patch"
          },
          "closed_at": "2015-08-03T17:34:59Z",
          "created_at": "2015-06-30T19:35:57Z",
          "updated_at": "2021-09-08T10:55:16Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 117315632,
      "node_id": "MDEyOklzc3VlQ29tbWVudDExNzMxNTYzMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/117315632",
      "actor": {
        "login": "ajweiss",
        "id": 430315,
        "node_id": "MDQ6VXNlcjQzMDMxNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/430315?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajweiss",
        "html_url": "https://github.com/ajweiss",
        "followers_url": "https://api.github.com/users/ajweiss/followers",
        "following_url": "https://api.github.com/users/ajweiss/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajweiss/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajweiss/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajweiss/subscriptions",
        "organizations_url": "https://api.github.com/users/ajweiss/orgs",
        "repos_url": "https://api.github.com/users/ajweiss/repos",
        "events_url": "https://api.github.com/users/ajweiss/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajweiss/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-06-30T19:37:24Z",
      "updated_at": "2015-06-30T19:37:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "Fix pushed.  It's a bit of an edge case, but I imagine it's really annoying.\n",
      "user": {
        "login": "ajweiss",
        "id": 430315,
        "node_id": "MDQ6VXNlcjQzMDMxNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/430315?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajweiss",
        "html_url": "https://github.com/ajweiss",
        "followers_url": "https://api.github.com/users/ajweiss/followers",
        "following_url": "https://api.github.com/users/ajweiss/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajweiss/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajweiss/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajweiss/subscriptions",
        "organizations_url": "https://api.github.com/users/ajweiss/orgs",
        "repos_url": "https://api.github.com/users/ajweiss/repos",
        "events_url": "https://api.github.com/users/ajweiss/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajweiss/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/6345#issuecomment-117315632",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6345"
    },
    {
      "event": "labeled",
      "id": 368072381,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDM2ODA3MjM4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/368072381",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-07-29T07:57:11Z",
      "label": {
        "name": "Wallet",
        "color": "02d7e1"
      }
    },
    {
      "event": "closed",
      "id": 372237595,
      "node_id": "MDExOkNsb3NlZEV2ZW50MzcyMjM3NTk1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/372237595",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-08-03T17:34:59Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-02-10T01:48:06Z",
      "updated_at": "2016-02-10T01:48:06Z",
      "source": {
        "issue": {
          "id": 132587553,
          "node_id": "MDU6SXNzdWUxMzI1ODc1NTM=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7494",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7494/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7494/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7494/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/7494",
          "number": 7494,
          "state": "closed",
          "state_reason": "completed",
          "title": "\"last wallet synchronisation goes beyond pruned data\" on totally new pruned node",
          "body": "Coping from: https://bitcointalk.org/index.php?topic=1347286.msg13832507#msg13832507\n\n\"I've been testing out 0.12.0rc3 in pruned mode, and have run into the following error message when restarting Bitcoin Core: \"last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\"\n\nTo reproduce:\n0.) Start from scratch, deleting the entire Bitcoin data directory if it exists (leaving no wallet file or blockchain data).\n1.) Install Bitcoin Core\n2.) Create Bitcoin data directory if it doesn't exist, create bitcoin.conf, set \"prune=550\" without quotes\n3.) Run Bitcoin Core\n4.) After you've verified, say, 100,000 blocks, close Bitcoin Core. Wait until the warning window to not shutdown/restart computer completely closes.\n5.) Run Bitcoin Core again, let it verify some more, close it again.\n6.) Rinse and repeat step 5...\n\nAt some point, I get the above error message on starting Bitcoin Core.\n\nI don't know what exactly is causing this, but if you're like me and you've verified a large amount of blocks and then you're told that you have to start completely over, you'll probably be pissed.\n\nThis error message is not new, as a related fix for this kind of error, when converting non-pruned nodes to pruned nodes was made here: https://github.com/bitcoin/bitcoin/issues/6345\n\nWhile it's obviously easy to reproduce this error _if_ you try plopping an _already existing_ wallet.dat file into a pruned node data directory and then running Core -- that's not what I've been experiencing. I've been seeing this error with a brand new wallet.dat that was created from scratch _alongside_ a fresh, pruned node.\"\n",
          "user": {
            "login": "gmaxwell",
            "id": 858454,
            "node_id": "MDQ6VXNlcjg1ODQ1NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/gmaxwell",
            "html_url": "https://github.com/gmaxwell",
            "followers_url": "https://api.github.com/users/gmaxwell/followers",
            "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
            "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
            "repos_url": "https://api.github.com/users/gmaxwell/repos",
            "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 10,
          "closed_at": "2016-02-11T07:58:08Z",
          "created_at": "2016-02-10T01:48:06Z",
          "updated_at": "2021-09-08T12:23:42Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "locked",
      "id": 5272089582,
      "node_id": "LOE_lADOABII584FcyREzwAAAAE6PbPu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272089582",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:48:22Z",
      "lock_reason": "resolved"
    }
  ]
}