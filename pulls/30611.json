{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611",
    "id": 2011069202,
    "node_id": "PR_kwDOABII58533nsS",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30611",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30611.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30611.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
    "number": 30611,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "validation: write chainstate to disk every hour",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Since #28233, periodically writing the chainstate to disk every 24 hours does not clear the dbcache. Since #28280, periodically writing the chainstate to disk is proportional only to the amount of dirty entries in the cache. Due to these changes, it is no longer beneficial to only write the chainstate to disk every 24 hours. The periodic flush interval was necessary because every write of the chainstate would clear the dbcache. Now, we can get rid of the periodic flush interval and simply write the chainstate along with blocks and block index at least every hour.\r\n\r\nTwo benefits of doing this:\r\n1. For IBD or reindex-chainstate with a combination of large dbcache setting, slow CPU, slow internet speed/unreliable peers, it could be up to 24 hours until the chainstate is persisted to disk. A power outage or crash could potentially lose up to 24 hours of progress, causing https://github.com/bitcoin/bitcoin/issues/11600. By syncing every hour in unison with the block index we avoid this problem entirely. For IBD with lower dbcache settings, faster CPU, or better internet speed/reliable peers, chainstate writes are already triggered more often than every hour so this change will have no effect on IBD.\r\n2. Based on discussion in #28280, writing only once every 24 hours during long running operation of a node causes IO spikes. Writing smaller chainstate changes every hour like we do with blocks and block index will reduce IO spikes.\r\n\r\nInspired by [this comment](https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-2121088705).\r\n\r\nResolves https://github.com/bitcoin/bitcoin/issues/11600",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "created_at": "2024-08-08T18:21:05Z",
    "updated_at": "2024-09-02T16:58:12Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "ef0cdfdbb3e3d37be6cf0296acb04eb57b70a154",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:write-chainstate-every-hour",
      "ref": "write-chainstate-every-hour",
      "sha": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 247292,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-02T16:41:46Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a74bdeea1b8e27b2335f0f7da78006e87ecfb235",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35814,
        "stargazers_count": 77774,
        "watchers_count": 77774,
        "size": 267511,
        "default_branch": "master",
        "open_issues_count": 666,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-02T14:14:58Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-02T16:57:35Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 97,
    "deletions": 46,
    "changed_files": 4,
    "commits": 4,
    "review_comments": 22,
    "comments": 15
  },
  "events": [
    {
      "event": "commented",
      "id": 2276408912,
      "node_id": "IC_kwDOABII586Hrz5Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2276408912",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T18:21:08Z",
      "updated_at": "2024-09-01T15:19:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30611).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30610](https://github.com/bitcoin/bitcoin/pull/30610) (validation: do not wipe utxo cache for stats/scans/snapshots by sipa)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2276408912",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "labeled",
      "id": 13810695676,
      "node_id": "LE_lADOABII586SaWKgzwAAAAM3Ln38",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13810695676",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T18:21:10Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13810731181,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAAM3Lwit",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13810731181",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T18:24:53Z"
    },
    {
      "event": "commented",
      "id": 2276630980,
      "node_id": "IC_kwDOABII586HsqHE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2276630980",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T20:51:14Z",
      "updated_at": "2024-08-08T20:53:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Before someone suggests that it should do this every block,  a reason to not do this too much is that delaying writes prevents many writes from ever happening at all because many outputs are quickly spent.\r\n\r\nI don't see a particular problem for this, there will be some write traffic increase but I don't expect it will be enough to meaningfully reduce the life time of flash on cheap devices (and if that were a concern the default level of logging is probably more of an issue).  It's the sort of thing someone could test, however.\r\n\r\nSomeone might also want to test the latency impact (e.g. on block template creation) of the traversal.\r\n\r\nThough long term it would be preferable to introduce a data structure to track pending writes and keep a constantly flushing going which always lags the tip by N blocks, both avoiding the latency spikes and preventing unnecessary writes of entries that are just going to be spent in the next couple blocks.\r\n",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2276630980",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "reviewed",
      "id": 2230536256,
      "node_id": "PRR_kwDOABII586E80hA",
      "url": null,
      "actor": null,
      "commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Did you check if this would slow down IBD noticeably when running with a large dbcache?\r\nIf i understand it right, coins that are created and destroyed more than 1 hour of syncing apart would not have been written to disk before, but will be written and deleted after this PR - though presumably this is not a frequent event, so there wouldn't be much of an impact?!",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2230536256",
      "submitted_at": "2024-08-09T15:49:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "commented",
      "id": 2278349582,
      "node_id": "IC_kwDOABII586HzNsO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2278349582",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T16:47:34Z",
      "updated_at": "2024-08-09T16:47:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Before someone suggests that it should do this every block, a reason to not do this too much is that delaying writes prevents many writes from ever happening at all because many outputs are quickly spent.\r\n\r\n> If i understand it right, coins that are created and destroyed more than 1 hour of syncing apart would not have been written to disk before, but will be written and deleted after this PR\r\n\r\nCorrect, there will be significantly less utxo cut through with this PR.\r\n\r\n> I don't see a particular problem for this, there will be some write traffic increase but I don't expect it will be enough to meaningfully reduce the life time of flash on cheap devices (and if that were a concern the default level of logging is probably more of an issue). It's the sort of thing someone could test, however.\r\n\r\n> though presumably this is not a frequent event, so there wouldn't be much of an impact?!\r\n\r\nFor normal operation, this would mean writing 10s of MB every hour, vs 100s of MB every 24 hours. I don't think that we should be concerned about that increase in disk IO? Seems negligible to me.\r\n\r\n> Did you check if this would slow down IBD noticeably when running with a large dbcache?\r\n\r\nNot yet. I will run a reindex-chainstate benchmark with max dbcache and see what the impact is.\r\n\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2278349582",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2278726067,
      "node_id": "IC_kwDOABII586H0pmz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2278726067",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T20:40:11Z",
      "updated_at": "2024-08-09T20:41:50Z",
      "author_association": "MEMBER",
      "body": "It would be good to know what impact it has on IBD, as it's necessarily going to make things slower (more syncs means more disk writes, and more memory/cpu to remember UTXOs which must be marked spent on disk), for the benefit of reducing losses in case of crashes. The question is how much time & I/O it adds.\r\n\r\nRegarding doing it for every block (during steady state), the trade-off there is different but still exists. On the pro side there is a reduction of latency spikes instead of reducing crash losses (as these are inherently less relevant in steady state). On the con side there is an increase in frequency of writes (and the latency spikes they bring, albeit smaller ones) instead of a sync speed slowdown.\r\n\r\nWe don't necessarily need to use the same sync frequency during IBD and during steady state, but the effects during steady state seem harder to measure, so it's hard to say what is acceptable there.\r\n\r\nOne related idea: maybe we should randomize the sync event times a bit (say, uniformly random intervals between 50 and 70 minutes) to prevent a situation where the network over time settles into a few cohorts of synchronized syncers (think like communicating metronomes: they start randomly, but have synchronized events (blocks arriving) that slightly delay sync events if they were to coincide).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2278726067",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2278793149,
      "node_id": "IC_kwDOABII586H05-9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2278793149",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T21:44:31Z",
      "updated_at": "2024-08-09T21:44:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It would be good to know what impact it has on IBD, as it's necessarily going to make things slower\n\nNote that it is only necessarily slower when running with very high dbcache settings. For default settings the cache fills up and is flushed far more often than every hour, so this will have no effect.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2278793149",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2281899749,
      "node_id": "IC_kwDOABII586IAwbl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2281899749",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-10T13:54:13Z",
      "updated_at": "2024-08-10T13:54:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "This change didn't appear to have any speed impact for a reindex-chainstate using max dbcache. Ran the following benchmark:\r\n```\r\nnohup hyperfine \\\r\n--export-markdown ~/bench.md \\\r\n--show-output \\\r\n--parameter-list commit 81508954f1f89f95b6fdca10c3c471cdb6566c80,27a770b34b8f1dbb84760f442edb3e23a0c2420b \\\r\n--prepare 'git checkout {commit} && \\\r\nmake -j$(nproc) src/bitcoind; \\\r\nsync; sudo /sbin/sysctl vm.drop_caches=3;' \\\r\n-M 2 \\\r\n'echo '{commit}' && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000' &\r\n```\r\n\r\nResults are the same:\r\n\r\n```\r\nBenchmark 1: echo 81508954f1f89f95b6fdca10c3c471cdb6566c80 && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000\r\n\r\n81508954f1f89f95b6fdca10c3c471cdb6566c80\r\n  Time (mean ± σ):     12239.620 s ±  3.156 s    [User: 12366.988 s, System: 562.121 s]\r\n  Range (min … max):   12237.388 s … 12241.851 s    2 runs\r\n \r\nBenchmark 2: echo 27a770b34b8f1dbb84760f442edb3e23a0c2420b && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000\r\n\r\n27a770b34b8f1dbb84760f442edb3e23a0c2420b\r\n  Time (mean ± σ):     12243.072 s ±  6.588 s    [User: 12382.386 s, System: 559.349 s]\r\n  Range (min … max):   12238.413 s … 12247.730 s    2 runs\r\n \r\nSummary\r\n  'echo 81508954f1f89f95b6fdca10c3c471cdb6566c80 && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000' ran\r\n    1.00 ± 0.00 times faster than 'echo 27a770b34b8f1dbb84760f442edb3e23a0c2420b && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000'\r\n```\r\n\r\nSo, I would say this PR is strictly beneficial for IBD/reindex-chainstate. It is the same speed, but protects against data loss.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2281899749",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2282238485,
      "node_id": "IC_kwDOABII586ICDIV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2282238485",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-10T18:32:49Z",
      "updated_at": "2024-08-10T18:32:49Z",
      "author_association": "CONTRIBUTOR",
      "body": "I didn't comment on IBD because I figured a hit per hour isn't that significant in the context of IBD and likely pays for itself in improving crash robustness.  I'm a little surprised that the effect is quite so small, but it does probably improve performance too by making writes a little more concurrent.\r\n\r\nSipa: good point on the injection locking, I've previously wondered if the the 24 hour behavior could sync up.",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2282238485",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2290369678,
      "node_id": "IC_kwDOABII586IhESO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2290369678",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-15T02:14:10Z",
      "updated_at": "2024-08-15T02:58:49Z",
      "author_association": "CONTRIBUTOR",
      "body": ">  I'm a little surprised that the effect is quite so small\r\n\r\n@gmaxwell I was as well, so I ran the same benchmark with `-reindex` as well and it gave me similar results:\r\n\r\n\r\n| Command | Mean [s] | Min [s] | Max [s] | Relative |\r\n|:---|---:|---:|---:|---:|\r\n| `echo 81508954f1f89f95b6fdca10c3c471cdb6566c80 && ./src/bitcoind -datadir=/home/user/.bitcoin -reindex -dbcache=16384 -printtoconsole=0 -connect=0 -stopatheight=820000` | 40765.075 ± 132.452 | 40671.417 | 40858.733 | 1.01 ± 0.00 |\r\n| `echo 27a770b34b8f1dbb84760f442edb3e23a0c2420b && ./src/bitcoind -datadir=/home/user/.bitcoin -reindex -dbcache=16384 -printtoconsole=0 -connect=0 -stopatheight=820000` | 40536.484 ± 46.379 | 40503.689 | 40569.279 | 1.00 |\r\n\r\n\r\nWill get some measurements for total chainstate bytes written and total time writing chainstate before and after this change during steady state. But, this will take a few weeks to get meaningful data. Even then there will be a lot of variance depending on how many utxos are being eagerly spent within 24 hours vs 1 hour at the time I am measuring.\r\n\r\n> Someone might also want to test the latency impact (e.g. on block template creation) of the traversal.\r\n\r\nI'm not sure I understand what you are suggesting to measure here, or what you mean by traversal. We can measure the total time writing chainstate to disk with `-debug=bench`, which would be the latency impact if that's what you mean.\r\n\r\n> Though long term it would be preferable to introduce a data structure to track pending writes and keep a constantly flushing going which always lags the tip by N blocks, both avoiding the latency spikes and preventing unnecessary writes of entries that are just going to be spent in the next couple blocks.\r\n\r\nYou mentioned a similar idea a while ago [here](https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457792904). I agree with you there that it is a much bigger project. If this change is accepted and merged, would there really be a benefit anymore of adding something like that?",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2290369678",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "mentioned",
      "id": 13890066178,
      "node_id": "MEE_lADOABII586SaWKgzwAAAAM76ZcC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13890066178",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-15T02:14:11Z"
    },
    {
      "event": "subscribed",
      "id": 13890066189,
      "node_id": "SE_lADOABII586SaWKgzwAAAAM76ZcN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13890066189",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-15T02:14:11Z"
    },
    {
      "event": "commented",
      "id": 2296577863,
      "node_id": "IC_kwDOABII586I4v9H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2296577863",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T13:26:54Z",
      "updated_at": "2024-08-19T13:26:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'll review this in more detail later, but I have a question first:\r\nWhenever a production change is made without corresponding test changes (yet the build passes), it suggests to me that there might be a gap in our coverage.\r\nDo you think it would make sense to add a test that reproduces some aspect of the old behavior before making the change—one that would need to be updated in the commit that introduces the change?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2296577863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2296587174,
      "node_id": "IC_kwDOABII586I4yOm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2296587174",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T13:31:03Z",
      "updated_at": "2024-08-19T13:31:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "> it would make sense to add a test that reproduces some aspect of the old behavior before making the change—one that would need to be updated in the commit that introduces the change?\r\n\r\nGood point, I can add a test that that expects flush every 24 hours, then reduce it to 1 hour after this change.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2296587174",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "reviewed",
      "id": 2245573919,
      "node_id": "PRR_kwDOABII586F2L0f",
      "url": null,
      "actor": null,
      "commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2245573919",
      "submitted_at": "2024-08-19T13:37:04Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "subscribed",
      "id": 14034224085,
      "node_id": "SE_lADOABII586SaWKgzwAAAANEgUPV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14034224085",
      "actor": {
        "login": "eragmus",
        "id": 11140618,
        "node_id": "MDQ6VXNlcjExMTQwNjE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/11140618?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eragmus",
        "html_url": "https://github.com/eragmus",
        "followers_url": "https://api.github.com/users/eragmus/followers",
        "following_url": "https://api.github.com/users/eragmus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eragmus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eragmus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eragmus/subscriptions",
        "organizations_url": "https://api.github.com/users/eragmus/orgs",
        "repos_url": "https://api.github.com/users/eragmus/repos",
        "events_url": "https://api.github.com/users/eragmus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eragmus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-27T20:05:42Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092316217,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANH9645",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092316217",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:43:35Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092323836,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANH98v8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092323836",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:47:20Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092348373,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANH-CvV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092348373",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:58:59Z"
    },
    {
      "event": "labeled",
      "id": 14092348455,
      "node_id": "LE_lADOABII586SaWKgzwAAAANH-Cwn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092348455",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:59:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2322994750,
      "node_id": "IC_kwDOABII586KdhY-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2322994750",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:59:04Z",
      "updated_at": "2024-08-31T17:59:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/29514781087</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2322994750",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "unlabeled",
      "id": 14092510957,
      "node_id": "UNLE_lADOABII586SaWKgzwAAAANH-qbt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092510957",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T19:28:30Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2274461800,
      "node_id": "PRR_kwDOABII586HkYho",
      "url": null,
      "actor": null,
      "commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2274461800",
      "submitted_at": "2024-09-01T17:40:03Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "commented",
      "id": 2323622796,
      "node_id": "IC_kwDOABII586Kf6uM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2323622796",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T01:50:30Z",
      "updated_at": "2024-09-02T01:50:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "I got some stats for running in steady state for this branch and master.\r\nI ran 4 nodes for 11 days and 18 hours using identical aws t2-small instances backed by 20GB EBS volumes all connected to another node in the same VPC.\r\n\r\n|  Branch | Total time writing chainstate | Total bytes written |\r\n|-----------:|----------:|----------:|\r\n| master 1 | 26372ms |497 MiB |\r\n| master 2 | 28188ms | 497 MiB |\r\n| branch 1 | 32496ms | 760 MiB |\r\n| branch 2 | 32566ms | 760 MiB |\r\n\r\nBy writing every hour, we write about 50% more data, but we are only spending 20% more time writing.\r\nOn master we write about 42 MiB every 24 hours which locks the main thread for 2.3 seconds.\r\nOn this branch we write about 2.7 MiB every hour which locks the main thread for 115 milliseconds.\r\n\r\nHere are the write operations charts for the time period. You can see the write operations are more evenly spaced out by writing every hour.\r\n![Master 1](https://github.com/user-attachments/assets/8770d491-4783-4503-9c26-f0dabce6af84)\r\n![Master 2](https://github.com/user-attachments/assets/776a21f1-3a1f-4cd5-b3b6-d5f39345cb14)\r\n![Branch 2](https://github.com/user-attachments/assets/6c2f25c9-2ab8-4aeb-bb01-9fb53247e91d)\r\n![Branch 1](https://github.com/user-attachments/assets/95ce7896-d483-4dc3-a106-17d75e7973c4)\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2323622796",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14096668820,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANIOhiU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096668820",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:23:57Z"
    },
    {
      "event": "commented",
      "id": 2323654975,
      "node_id": "IC_kwDOABII586KgCk_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2323654975",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:46Z",
      "updated_at": "2024-09-02T02:26:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "@gmaxwell @l0rinc @mzumsande @sipa thank you all for your reviews! I've updated the PR to have a random window for periodic flushes of between 50 and 70 minutes. I've also added a unit test that checks for a flush in this window. That unit test can be cherry-picked to master and verified that it does not pass.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2323654975",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "mentioned",
      "id": 14096683053,
      "node_id": "MEE_lADOABII586SaWKgzwAAAANIOlAt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683053",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "subscribed",
      "id": 14096683058,
      "node_id": "SE_lADOABII586SaWKgzwAAAANIOlAy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683058",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "mentioned",
      "id": 14096683064,
      "node_id": "MEE_lADOABII586SaWKgzwAAAANIOlA4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683064",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "subscribed",
      "id": 14096683068,
      "node_id": "SE_lADOABII586SaWKgzwAAAANIOlA8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683068",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "mentioned",
      "id": 14096683074,
      "node_id": "MEE_lADOABII586SaWKgzwAAAANIOlBC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683074",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "subscribed",
      "id": 14096683078,
      "node_id": "SE_lADOABII586SaWKgzwAAAANIOlBG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683078",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "mentioned",
      "id": 14096683083,
      "node_id": "MEE_lADOABII586SaWKgzwAAAANIOlBL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683083",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "subscribed",
      "id": 14096683086,
      "node_id": "SE_lADOABII586SaWKgzwAAAANIOlBO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14096683086",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T02:26:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14097202202,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANIQjwa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14097202202",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T04:12:33Z"
    },
    {
      "event": "commented",
      "id": 2324700313,
      "node_id": "IC_kwDOABII586KkByZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2324700313",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T12:57:04Z",
      "updated_at": "2024-09-02T12:57:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "The test runs unreliably for some reason, we need to fix that first.\r\n\r\nNACK 5cad9d16dd07859a76c6637789695bf1b4f36e1c\r\n\r\n> On this branch [...] main thread for 115 milliseconds.\r\n\r\nThis sounds awesome!\r\n\r\n> Good point, I can add a test that that expects flush every 24 hours, then reduce it to 1 hour after this change.\r\n\r\nDo you think we could still do something like this, i.e. add a test as a very first commit, which reproduces the old behavior first?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2324700313",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "reviewed",
      "id": 2275381925,
      "node_id": "PRR_kwDOABII586Hn5Kl",
      "url": null,
      "actor": null,
      "commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2275381925",
      "submitted_at": "2024-09-02T12:57:23Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14104308029,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANIrqk9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14104308029",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T14:15:33Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14104447003,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANIsMgb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14104447003",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T14:26:28Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14104705306,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANItLka",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14104705306",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T14:47:57Z"
    },
    {
      "event": "commented",
      "id": 2324918318,
      "node_id": "IC_kwDOABII586Kk3Au",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2324918318",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T14:48:43Z",
      "updated_at": "2024-09-02T14:48:43Z",
      "author_association": "CONTRIBUTOR",
      "body": "> add a test as a very first commit, which reproduces the old behavior first?\r\n\r\nYeah, I realize the test commit can't be cherry-picked cleanly to master. Updated to have the test commit first, and update the test for each change.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2324918318",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14105073703,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANIulgn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14105073703",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T15:20:26Z"
    },
    {
      "event": "reviewed",
      "id": 2275958237,
      "node_id": "PRR_kwDOABII586HqF3d",
      "url": null,
      "actor": null,
      "commit_id": "1d50f72d16bf8a07540b6e53015deff4598c9ea3",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2275958237",
      "submitted_at": "2024-09-02T16:17:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "reviewed",
      "id": 2275960774,
      "node_id": "PRR_kwDOABII586HqGfG",
      "url": null,
      "actor": null,
      "commit_id": "1d50f72d16bf8a07540b6e53015deff4598c9ea3",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2275960774",
      "submitted_at": "2024-09-02T16:19:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhhYWJkZmE2NjFiMzhmOTMyNzUwYzljODVmMTdlMzk4ODViMzY4MDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8aabdfa661b38f932750c9c85f17e39885b36808",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8aabdfa661b38f932750c9c85f17e39885b36808",
      "tree": {
        "sha": "57bbe72f0c03df4e3d59dec36ed492f2470a8670",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/57bbe72f0c03df4e3d59dec36ed492f2470a8670"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 57bbe72f0c03df4e3d59dec36ed492f2470a8670\nparent b52d54736168bed82775e3c9e66c6320c7b83626\nauthor Andrew Toth <andrewstoth@gmail.com> 1725126111 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725295284 -0400\n\ntest: chainstate write test for periodic chainstate flush\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbV6rUACgkQYAB6/Ik4\nsBjvmA//erKGJCqvvklD30U9dqxY7y9yWJ+jstZLCiLUlsyDIiYcOQqh6G+SqGOn\nYxAg/HWYpn/fxeqMvbDHRQlPbEIU0Adn50X+d8Pu7/WCriVO65t2p6R7bd18RQqg\nBNSj6WJTcexELUy/t4z5uzzKtKWHlCe/BIppXoSoS67/cC/1Z4SwlErusWrxN2qL\nLNCiYfUvS8q78k58WVkdpq4/Fb80C0EOQMeUHB98eRl52HTmlmNJxXCrWdy2td/9\n/1T9mgkVXQesv7v6ph0cWTdwv6wpIig4UwVLQP3Y8fjam6U41HQKpDW+Pzthk/JF\nEQwZn6ypnk8wTciRoxiqx9ipjw5K/dIlB/a+mJ1N2rS/XKFDNWQiu0YEabKBbIRo\nWS/+XiUEA+8SyY8XnFBX6jnEGRYZ37O5LrJ+QUaijEgjvuCNVuj4unijpZExhqLx\nMksmbCdtv3NJx5q8g3AzdS3imanN7JqjGKoCqwxtErqET5DGLz0UoDDa5Tap6e9C\nztqMvKfVQ0lQiOg2qfzIoOvofaqmik8p5nr0NRwcu8EDGlzRUgYk+fACBs69G4iN\nPp/5m7rC4uqmZ3a5vTPZysW+8AqC9p7nEtdFvm5S98U3lgG1iTgDbxdx3CeALhct\nAN4FF0F6HC25/8VX7nd/UElP3sdNHVGMttK+hHT/VXmMkrDOUi4=\n=8L1D\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b52d54736168bed82775e3c9e66c6320c7b83626",
          "sha": "b52d54736168bed82775e3c9e66c6320c7b83626",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b52d54736168bed82775e3c9e66c6320c7b83626"
        }
      ],
      "message": "test: chainstate write test for periodic chainstate flush",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-09-02T16:41:24Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:41:51Z"
      },
      "sha": "8aabdfa661b38f932750c9c85f17e39885b36808"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgxZTlkOTdiODZlYjc2MTkxZjE2ZTI2YTQ0NTc5NzQxNTFjYTVmNjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/81e9d97b86eb76191f16e26a4457974151ca5f62",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/81e9d97b86eb76191f16e26a4457974151ca5f62",
      "tree": {
        "sha": "e17d5a4683d3318e118ca146c624009879dce100",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e17d5a4683d3318e118ca146c624009879dce100"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e17d5a4683d3318e118ca146c624009879dce100\nparent 8aabdfa661b38f932750c9c85f17e39885b36808\nauthor Andrew Toth <andrewstoth@gmail.com> 1725117191 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725295302 -0400\n\nvalidation: write chainstate to disk every hour\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbV6sYACgkQYAB6/Ik4\nsBjpTg//e86yhkoWgC1Rw5Pgx/6woIMUV/J5NyuFMWDrE3VdL9RTDP5rh/ExRIdU\nWmeP9i0hdXJQ4YYIHuVcvC4P3q0Ku+R4c89cDoayPBTIrQPIH12/iYYZyxLNIYVH\n0Ot1vG2/YcD/3l9qrd+QX5P7kaZ8Luuc4pTAcg3IOwIud2PnRAX/TyVBVozrwzdp\ns82vpsxAGPgeg8VexpiIApBi1br+raZgYodlLWzzyBr0jTDQcZ0GK0nL0efMmucj\nWUrr0ahKoWOIEEtFD07KAhyZ8C27kumarqTBVjYmOVVvVSXHn4dx7ZMmZnE0ZZ3H\n/2qaJevrWiOt37+6tYZWCJ5nr2hmHjnzsqN1utZrBhpTYV7nH3x4q+mAJU4blAsW\nKbrInPepHKaQgPF4tRwx2aw7gnAjHbp9R25lvt2x7h9pG7tAQvXaQuuKgNbq8NuW\nQTW2sZ3NlqXfUcNoxBd6baKDzZKhJmG36vyVDEXAkkOYiYtVlUV33ux2DwHi0scA\nWE9xPuT9Y83HERT/5erZONDIg0FeFNG6ZhG2KxOeiLBW0fpJZp6ty9H2aUinC3bU\nGSnQUNOYFF6jLhyfqaj9Q0ghZ9Kuz8D5bI18tJBHa7Lt97RgUCZAkouwIrQpsDNJ\nXTuI2V6x3bSKMh5Fc+Wx9UfrtKJZWqCN/J2GphoNU+/uOcEOBwY=\n=oiIz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8aabdfa661b38f932750c9c85f17e39885b36808",
          "sha": "8aabdfa661b38f932750c9c85f17e39885b36808",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8aabdfa661b38f932750c9c85f17e39885b36808"
        }
      ],
      "message": "validation: write chainstate to disk every hour",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-09-02T16:41:42Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:13:11Z"
      },
      "sha": "81e9d97b86eb76191f16e26a4457974151ca5f62"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM1YjY4MmI4NzgwYjJkZjk3M2ViYjJlY2Q5NDM2M2MxZDQyYzg2MzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35b682b8780b2df973ebb2ecd94363c1d42c8635",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/35b682b8780b2df973ebb2ecd94363c1d42c8635",
      "tree": {
        "sha": "dcf509a2fbca23b21d5b7c6a2c94bd6a16bd746b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dcf509a2fbca23b21d5b7c6a2c94bd6a16bd746b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree dcf509a2fbca23b21d5b7c6a2c94bd6a16bd746b\nparent 81e9d97b86eb76191f16e26a4457974151ca5f62\nauthor Andrew Toth <andrewstoth@gmail.com> 1725117258 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725295302 -0400\n\nrefactor: remove early declaration of fDoFullFlush\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbV6sYACgkQYAB6/Ik4\nsBjlpxAAo7FHdE1eQfUmannf46ICSeTr7Yp8OxUWGeff5ikdTcl7TsscNYGegWkT\nFAXMTNxXj3n9SdAqos/+p9Jbs5MEOANYje2wS32PYVsNRa4Vy5kb1BBHJI+03Spv\nfjejarluuJ8WYEGoO3PLiN9QkwGkKT3TruskuqmphwDvNzbXtsZsA1GKagdPsNNF\nXXJYqC/uiidS2e8VG3AgxCMtAZTM10kP11akHD5jCeumdKKI1gf6VDgcMwP7vnJQ\nAuwWNSS32wm70d0QV4XyL2xxG9K3eqawjEw/J7A+rRt2aQx8qt8qQWspV3Em7Phk\nFsfaM4o4bmA7oArhvITegNHrhiToxaQ2puVjt/le+dSZVvDONz3kCycBsfTxA3qH\nUdDBWXfcDQoK+7KAZwEjNfMhURxiWojBsGTng5CzhQYyEuG15ledDzuqU971a1cO\n3fKSVMbDzM4kTQ7RRtI93VVpqx+UVoUTwDbnwQeP9gW2rfKH/EykYlZTK0Psc04m\nifRUI4XBcQmr9GsgF2HiIQvVyUMOTeu/cL+3vVG91cn/G3oIaMHcuNW4RA9wroXM\njvACI9vWlBiP+j/H9fjSh8admQF8CEu22EjRokPQ+pPUA6Iy2g+YiFV1IwcCCZ8c\ndQWNiq5IbdPLRzY1EU2DA1ZxeKfTEz3EYPe+KT4TiNSpKawvplg=\n=IWQv\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/81e9d97b86eb76191f16e26a4457974151ca5f62",
          "sha": "81e9d97b86eb76191f16e26a4457974151ca5f62",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/81e9d97b86eb76191f16e26a4457974151ca5f62"
        }
      ],
      "message": "refactor: remove early declaration of fDoFullFlush",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-09-02T16:41:42Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:14:18Z"
      },
      "sha": "35b682b8780b2df973ebb2ecd94363c1d42c8635"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEyZThmN2RmMWNhOTRjNjYyMTgzNzAyYWQzZjQxMjI4YzVlZDdkMTc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "tree": {
        "sha": "e9c6518f02b2b37321c913a0d83df255c08edc94",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e9c6518f02b2b37321c913a0d83df255c08edc94"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e9c6518f02b2b37321c913a0d83df255c08edc94\nparent 35b682b8780b2df973ebb2ecd94363c1d42c8635\nauthor Andrew Toth <andrewstoth@gmail.com> 1725118246 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725295302 -0400\n\nvalidation: add randomness to periodic write interval\n\nCo-Authored-By: Pieter Wuille <pieter@wuille.net>\nCo-Authored-By: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbV6sYACgkQYAB6/Ik4\nsBip3g//eJnicbBqSgO1O+w3NUG6Zf9mVfzQKLhwEqhC5ry1u5/mwoeeoSimWxAG\nswbgET4ORhX7ob0A1B+hsPZHk2Icm0ezlSoFSTeqAWa8+OKZ1pPmqPPomknYA9bb\no4UGWZe+llVJHxvwFkvbJx6L4AJmXm1v70OeUmzu+VHl7+9ks2TXFFPXBnl6oTQu\nDyV8jPFLXyaxNE+vZwhcZPDbFm6oFe23V8i9T0N0Dmp5Kqr9NfDgeQv/DBQPWvJv\nhwADnpvoelTaFbzddyiJ45gDuV11BbTc3px/7QullSpSa2V98csiU8XeQtWsEYTs\nvRO0pTbNb/Kxz8MpbDyWgdcFhtPJFjjdCuIfBaOQHqas8bUwcQPi7/pWu8dsFt1T\nUnTvHpx6ZopMoL5T7QsPIzxlAvpVkvzH1od0U7t4w8X1DwGegbnwH1InmhawY8jm\nlCIN4gRzYzLgTywEXqkGEdDfGuMtDTh14uwHJuQL/OqPZ+6XHa/n6Nv9MbYscSnP\nEZDqnhQNt/TRv8AjMUQNO4/K/hhyoi84rv3QR9ZICM1Kj+jctKx9oD1amE6IlQvm\n6HFvLrxAAyvcixJCllx6LTMOALFHOfmsYS0LbcVbpiFIq4e7N4btfTGR9cfPmRNt\nSMzgx4xJqW8bVGyhEN3p3MOme/tE/IStLBQMJLUjhBo0S+n41TE=\n=r1Vb\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35b682b8780b2df973ebb2ecd94363c1d42c8635",
          "sha": "35b682b8780b2df973ebb2ecd94363c1d42c8635",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/35b682b8780b2df973ebb2ecd94363c1d42c8635"
        }
      ],
      "message": "validation: add randomness to periodic write interval\n\nCo-Authored-By: Pieter Wuille <pieter@wuille.net>\nCo-Authored-By: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-09-02T16:41:42Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:30:46Z"
      },
      "sha": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14105786185,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANIxTdJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14105786185",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T16:41:47Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721803828",
      "pull_request_review_id": 2245573919,
      "id": 1721803828,
      "node_id": "PRRC_kwDOABII585moKQ0",
      "diff_hunk": "@@ -2842,21 +2839,16 @@ bool Chainstate::FlushStateToDisk(\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n         }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n-        }\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\n         // The cache is over the limit, we have to write now.\n         bool fCacheCritical = mode == FlushStateMode::IF_NEEDED && cache_state >= CoinsCacheSizeState::CRITICAL;\n-        // It's been a while since we wrote the block index to disk. Do this frequently, so we don't need to redownload after a crash.\n+        // It's been a while since we wrote the block index and chainstate to disk. Do this frequently, so we don't need to redownload and reindex after a crash.\n         bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow > m_last_write + DATABASE_WRITE_INTERVAL;\n-        // It's been very long since we flushed the cache. Do this infrequently, to optimize cache usage.\n-        bool fPeriodicFlush = mode == FlushStateMode::PERIODIC && nNow > m_last_flush + DATABASE_FLUSH_INTERVAL;\n         // Combine all conditions that result in a full cache flush.\n-        fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicFlush || fFlushForPrune;\n+        bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;",
      "path": "src/validation.cpp",
      "position": 67,
      "original_position": 38,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "To simplify review, could you please separate the concerns - having low-risk changes (e.g. moves, renames, inlines, rewording) in separate commits from high risk ones?",
      "created_at": "2024-08-19T13:37:04Z",
      "updated_at": "2024-08-19T13:37:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1721803828",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721803828"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2860,
      "original_line": 2860,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739870290",
      "pull_request_review_id": 2274071126,
      "id": 1739870290,
      "node_id": "PRRC_kwDOABII585ntFBS",
      "diff_hunk": "@@ -2842,21 +2839,16 @@ bool Chainstate::FlushStateToDisk(\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n         }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n-        }\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\n         // The cache is over the limit, we have to write now.\n         bool fCacheCritical = mode == FlushStateMode::IF_NEEDED && cache_state >= CoinsCacheSizeState::CRITICAL;\n-        // It's been a while since we wrote the block index to disk. Do this frequently, so we don't need to redownload after a crash.\n+        // It's been a while since we wrote the block index and chainstate to disk. Do this frequently, so we don't need to redownload and reindex after a crash.\n         bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow > m_last_write + DATABASE_WRITE_INTERVAL;\n-        // It's been very long since we flushed the cache. Do this infrequently, to optimize cache usage.\n-        bool fPeriodicFlush = mode == FlushStateMode::PERIODIC && nNow > m_last_flush + DATABASE_FLUSH_INTERVAL;\n         // Combine all conditions that result in a full cache flush.\n-        fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicFlush || fFlushForPrune;\n+        bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;",
      "path": "src/validation.cpp",
      "position": 67,
      "original_position": 38,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "in_reply_to_id": 1721803828,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There really isn't much I am doing here that can be split up. I added a second commit for moving the declaration of `fDoFullFlush` here.",
      "created_at": "2024-08-31T17:44:32Z",
      "updated_at": "2024-08-31T17:44:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1739870290",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739870290"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2860,
      "original_line": 2860,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740167716",
      "pull_request_review_id": 2274461800,
      "id": 1740167716,
      "node_id": "PRRC_kwDOABII585nuNok",
      "diff_hunk": "@@ -2837,26 +2836,22 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n-        }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n+            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It'd be a bit cleaner (and more granular) to have:\r\n\r\n```c++\r\nstatic constexpr auto DATABASE_WRITE_INTERVAL_MIN{50min};\r\nstatic constexpr auto DATABASE_WRITE_INTERVAL_MAX{70min};\r\n...\r\nm_random_write_delay = DATABASE_WRITE_INTERVAL_MIN +\r\n    FastRandomContext().rand_uniform_duration<NodeClock>(DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);`\r\n```\r\n",
      "created_at": "2024-09-01T17:40:03Z",
      "updated_at": "2024-09-01T17:40:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740167716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740167716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740188239",
      "pull_request_review_id": 2274481459,
      "id": 1740188239,
      "node_id": "PRRC_kwDOABII585nuSpP",
      "diff_hunk": "@@ -2837,26 +2836,22 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n-        }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n+            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "in_reply_to_id": 1740167716,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "given that this delay is written multiple times, would that be more verbose?\r\nAlternatively maybe we could add an `m_next_write` next to `m_last_write`, like:\r\n```patch\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex b54446be4e..e2c7272531 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -86,10 +86,9 @@ using node::CBlockIndexHeightOnlyComparator;\r\n using node::CBlockIndexWorkComparator;\r\n using node::SnapshotMetadata;\r\n \r\n-/** Time to wait between writing blocks/block index and chainstate to disk. */\r\n-static constexpr std::chrono::minutes DATABASE_WRITE_INTERVAL{50};\r\n-/** Range of random delay to add to DATABASE_WRITE_INTERVAL */\r\n-static constexpr uint32_t DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE{20};\r\n+/** Minimum and maximum time to wait between writing blocks/block index and chainstate to disk. */\r\n+static constexpr auto DATABASE_WRITE_INTERVAL_MIN{50min};\r\n+static constexpr auto DATABASE_WRITE_INTERVAL_MAX{70min};\r\n /** Maximum age of our tip for us to be considered current for fee estimation */\r\n static constexpr std::chrono::hours MAX_FEE_ESTIMATION_TIP_AGE{3};\r\n const std::vector<std::string> CHECKLEVEL_DOC {\r\n@@ -2776,6 +2775,11 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\r\n     return CoinsCacheSizeState::OK;\r\n }\r\n \r\n+NodeClock::time_point Chainstate::CalculateNextWrite(NodeClock::time_point after) const\r\n+{\r\n+    return FastRandomContext().rand_uniform_delay(after + DATABASE_WRITE_INTERVAL_MIN, DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);\r\n+}\r\n+\r\n bool Chainstate::FlushStateToDisk(\r\n     BlockValidationState &state,\r\n     FlushStateMode mode,\r\n@@ -2840,14 +2844,14 @@ bool Chainstate::FlushStateToDisk(\r\n         // Avoid writing/flushing immediately after startup.\r\n         if (m_last_write == decltype(m_last_write){}) {\r\n             m_last_write = nNow;\r\n-            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};\r\n+            m_next_write = CalculateNextWrite(m_last_write);\r\n         }\r\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\r\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\r\n         // The cache is over the limit, we have to write now.\r\n         bool fCacheCritical = mode == FlushStateMode::IF_NEEDED && cache_state >= CoinsCacheSizeState::CRITICAL;\r\n         // It's been a while since we wrote the block index to disk. Do this frequently, so we don't need to redownload after a crash.\r\n-        bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow > m_last_write + DATABASE_WRITE_INTERVAL + m_random_write_delay;\r\n+        bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow >= m_next_write;\r\n         // Combine all conditions that result in a full cache flush.\r\n         bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;\r\n         // Write blocks, block index and best chain related state to disk.\r\n@@ -2882,7 +2886,7 @@ bool Chainstate::FlushStateToDisk(\r\n                 m_blockman.UnlinkPrunedFiles(setFilesToPrune);\r\n             }\r\n             m_last_write = nNow;\r\n-            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};\r\n+            m_next_write = CalculateNextWrite(m_last_write);\r\n \r\n             if (!CoinsTip().GetBestBlock().IsNull()) {\r\n                 LOG_TIME_MILLIS_WITH_CATEGORY(strprintf(\"write coins cache to disk (%d coins, %.2fkB)\",\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex dfe33b8e29..953793bdf7 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -810,7 +810,9 @@ private:\r\n         EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n \r\n     NodeClock::time_point m_last_write{};\r\n-    std::chrono::minutes m_random_write_delay{};\r\n+    NodeClock::time_point m_next_write{};\r\n+\r\n+    NodeClock::time_point CalculateNextWrite(NodeClock::time_point after) const;\r\n \r\n     /**\r\n      * In case of an invalid snapshot, rename the coins leveldb directory so\r\n```\r\n\r\nnote: this way it should probably be `nNow >= m_next_write` instead of `nNow > m_next_write` to be consistent with the naming.",
      "created_at": "2024-09-01T20:19:51Z",
      "updated_at": "2024-09-01T20:19:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740188239",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740188239"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740263238",
      "pull_request_review_id": 2274581511,
      "id": 1740263238,
      "node_id": "PRRC_kwDOABII585nuk9G",
      "diff_hunk": "@@ -2837,26 +2836,22 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n-        }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n+            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "in_reply_to_id": 1740167716,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks for the suggestions! I could not get @sipa's to compile, so went with @l0rinc's.",
      "created_at": "2024-09-02T02:25:06Z",
      "updated_at": "2024-09-02T02:25:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740263238",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740263238"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740758502",
      "pull_request_review_id": 2275381925,
      "id": 1740758502,
      "node_id": "PRRC_kwDOABII585nwd3m",
      "diff_hunk": "@@ -2774,6 +2775,11 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     return CoinsCacheSizeState::OK;\n }\n \n+SteadyClock::time_point CalculateNextWrite(SteadyClock::time_point after)\n+{\n+    return FastRandomContext().rand_uniform_delay(after + DATABASE_WRITE_INTERVAL_MIN, DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);\n+}",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "c529a595dc90be213c265b201ccb0e7bb7278245",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was a bit hasty yesterday - the MIN/MAX naming indicates that the interval is closed (i.e. can actually reach the values), so we should add 1 minute to the range:\r\n```suggestion\r\nNodeClock::time_point CalculateNextWrite(const NodeClock::time_point after)\r\n{\r\n    const auto time{after + DATABASE_WRITE_INTERVAL_MIN};\r\n    constexpr auto range{DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN + 1min};\r\n    return FastRandomContext().rand_uniform_delay(time, range);\r\n}\r\n```\r\n\r\nSee:\r\n```C++\r\nBOOST_AUTO_TEST_CASE(CalculateNextWrite_interval)\r\n{\r\n    NodeClock::time_point after = NodeClock::now();\r\n    std::set<int64_t> results;\r\n    for (int i = 0; i < 100; ++i) {\r\n        auto next = CalculateNextWrite(after);\r\n        auto diff = (next - after) / std::chrono::minutes(1);\r\n        results.insert(diff);\r\n    }\r\n    BOOST_CHECK_EQUAL(results.size(), 21);\r\n}\r\n```",
      "created_at": "2024-09-02T11:27:37Z",
      "updated_at": "2024-09-02T12:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740758502",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740758502"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": 2778,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2786,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740812194",
      "pull_request_review_id": 2275381925,
      "id": 1740812194,
      "node_id": "PRRC_kwDOABII585nwq-i",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n+{\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+    Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Time window to periodically flush is between 50 and 70 minutes\n+    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 40,
      "original_position": 35,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The initial run should never flush, right?\r\n`SetMockTime(GetTime<std::chrono::minutes>() + 55min);` passes also, so we should likely update the test\r\n.\r\nActually, sometimes it passes, other times it fails - this is the reason for my NACK\r\n```\r\n% build/src/test/test_bitcoin --run_test=chainstate_write_tests/chainstate_write_interval        \r\nRunning 1 test case...\r\nsrc/test/chainstate_write_tests.cpp:35: error: in \"chainstate_write_tests/chainstate_write_interval\": check !sub->m_did_flush has failed\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n% build/src/test/test_bitcoin --run_test=chainstate_write_tests/chainstate_write_interval        \r\nRunning 1 test case...\r\n\r\n*** No errors detected\r\n% build/src/test/test_bitcoin --run_test=chainstate_write_tests/chainstate_write_interval\r\nRunning 1 test case...\r\n\r\n*** No errors detected\r\n% build/src/test/test_bitcoin --run_test=chainstate_write_tests/chainstate_write_interval\r\nRunning 1 test case...\r\n\r\n*** No errors detected\r\n% build/src/test/test_bitcoin --run_test=chainstate_write_tests/chainstate_write_interval\r\nRunning 1 test case...\r\n\r\n*** No errors detected\r\n% build/src/test/test_bitcoin --run_test=chainstate_write_tests/chainstate_write_interval\r\nRunning 1 test case...\r\nsrc/test/chainstate_write_tests.cpp:35: error: in \"chainstate_write_tests/chainstate_write_interval\": check !sub->m_did_flush has failed\r\n\r\n*** 1 failure is detected in the test module \"Bitcoin Core Test Suite\"\r\n```",
      "created_at": "2024-09-02T12:11:02Z",
      "updated_at": "2024-09-02T12:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740812194",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740812194"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 40,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740868062",
      "pull_request_review_id": 2275381925,
      "id": 1740868062,
      "node_id": "PRRC_kwDOABII585nw4ne",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Besides the stability and the initial run, I think we should test the valid values as well inside the range, e.g.\r\n```C++\r\nBOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\r\n{\r\n    auto DATABASE_WRITE_INTERVAL_MIN{50min};\r\n    auto DATABASE_WRITE_INTERVAL_MAX{70min};\r\n    auto now = GetTime<std::chrono::minutes>();\r\n    auto sub{std::make_shared<TestSubscriber>()};\r\n    m_node.validation_signals->RegisterSharedValidationInterface(sub);\r\n    auto test_flush = [&](std::chrono::minutes offset) {\r\n        assert(!sub->m_did_flush);\r\n        Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\r\n        BlockValidationState state_dummy{};\r\n\r\n        SetMockTime(now + offset);\r\n        chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\r\n        m_node.validation_signals->SyncWithValidationInterfaceQueue();\r\n        return sub->m_did_flush;\r\n    };\r\n\r\n    // Initial run shouldn't flush\r\n    BOOST_CHECK_EQUAL(test_flush(DATABASE_WRITE_INTERVAL_MIN + 5min), false);\r\n\r\n    // Test all values (+1) in the interval\r\n    BOOST_CHECK_EQUAL(test_flush(DATABASE_WRITE_INTERVAL_MIN - 1min), false);\r\n    for (auto m = DATABASE_WRITE_INTERVAL_MIN; m <= DATABASE_WRITE_INTERVAL_MAX + 1min; m += 1min) {\r\n        BOOST_CHECK_EQUAL(test_flush(m), true);\r\n    }\r\n}\r\n```",
      "created_at": "2024-09-02T12:41:21Z",
      "updated_at": "2024-09-02T12:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740868062",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740868062"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740870587",
      "pull_request_review_id": 2275381925,
      "id": 1740870587,
      "node_id": "PRRC_kwDOABII585nw5O7",
      "diff_hunk": "@@ -86,10 +86,9 @@ using node::CBlockIndexHeightOnlyComparator;\n using node::CBlockIndexWorkComparator;\n using node::SnapshotMetadata;\n \n-/** Time to wait between writing blocks/block index to disk. */\n-static constexpr std::chrono::hours DATABASE_WRITE_INTERVAL{1};\n-/** Time to wait between flushing chainstate to disk. */\n-static constexpr std::chrono::hours DATABASE_FLUSH_INTERVAL{24};\n+/** Time window to wait between writing blocks/block index and chainstate to disk. */",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "can we add @sipa's reasoning here for why it's not a fixed value?",
      "created_at": "2024-09-02T12:43:25Z",
      "updated_at": "2024-09-02T12:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740870587",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740870587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740880618",
      "pull_request_review_id": 2275381925,
      "id": 1740880618,
      "node_id": "PRRC_kwDOABII585nw7rq",
      "diff_hunk": "@@ -2837,26 +2840,21 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.",
      "path": "src/validation.cpp",
      "position": 45,
      "original_position": 40,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If my understanding is correct:\r\n* at startup we never want to flush, but the initial value of `m_next_write` would trigger one, so we have to set the next write value in that case quickly to prevent one\r\n* when we do flush, we want to set the next flush's time again\r\n\r\nI think we can deduplicate setting this value twice (which also enables us to inline `CalculateNextWrite`):\r\n* setting m_next_write to max, which won't trigger `fDoFullFlush` since it's `>> nNow`\r\n* add another boolean where we check for initial run i.e. `m_next_write == NodeClock::time_point::max()` (or we can inline this, it's only used once)\r\n* set the next flush time when `fInitialRun || fDoFullFlush`, independently from the ` if (fDoFullFlush) {` block\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 6b401799bb..33fcc30806 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -2775,11 +2775,6 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\r\n     return CoinsCacheSizeState::OK;\r\n }\r\n \r\n-NodeClock::time_point CalculateNextWrite(NodeClock::time_point after)\r\n-{\r\n-    return FastRandomContext().rand_uniform_delay(after + DATABASE_WRITE_INTERVAL_MIN, DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);\r\n-}\r\n-\r\n bool Chainstate::FlushStateToDisk(\r\n     BlockValidationState &state,\r\n     FlushStateMode mode,\r\n@@ -2841,10 +2836,6 @@ bool Chainstate::FlushStateToDisk(\r\n             }\r\n         }\r\n         const auto nNow{NodeClock::now()};\r\n-        // Avoid writing/flushing immediately after startup.\r\n-        if (m_next_write == decltype(m_next_write){}) {\r\n-            m_next_write = CalculateNextWrite(nNow);\r\n-        }\r\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\r\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\r\n         // The cache is over the limit, we have to write now.\r\n@@ -2853,6 +2844,15 @@ bool Chainstate::FlushStateToDisk(\r\n         bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow >= m_next_write;\r\n         // Combine all conditions that result in a full cache flush.\r\n         bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;\r\n+        // Avoid writing/flushing immediately after startup\r\n+        bool fInitialRun = m_next_write == NodeClock::time_point::max();\r\n+\r\n+        if (fInitialRun || fDoFullFlush) {\r\n+            const auto time{nNow + DATABASE_WRITE_INTERVAL_MIN};\r\n+            constexpr auto range{DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN + 1min};\r\n+            m_next_write = FastRandomContext().rand_uniform_delay(time, range);\r\n+        }\r\n+\r\n         // Write blocks, block index and best chain related state to disk.\r\n         if (fDoFullFlush) {\r\n             // Ensure we can write block index\r\n@@ -2884,7 +2884,6 @@ bool Chainstate::FlushStateToDisk(\r\n \r\n                 m_blockman.UnlinkPrunedFiles(setFilesToPrune);\r\n             }\r\n-            m_next_write = CalculateNextWrite(nNow);\r\n \r\n             if (!CoinsTip().GetBestBlock().IsNull()) {\r\n                 LOG_TIME_MILLIS_WITH_CATEGORY(strprintf(\"write coins cache to disk (%d coins, %.2fkB)\",\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex 1c2fd0bd3c..ea737a9c4c 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -808,7 +808,7 @@ private:\r\n     void UpdateTip(const CBlockIndex* pindexNew)\r\n         EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n \r\n-    NodeClock::time_point m_next_write{};\r\n+    NodeClock::time_point m_next_write{NodeClock::time_point::max()};\r\n \r\n     /**\r\n      * In case of an invalid snapshot, rename the coins leveldb directory so\r\n```",
      "created_at": "2024-09-02T12:51:25Z",
      "updated_at": "2024-09-02T12:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740880618",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740880618"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2849,
      "original_line": 2849,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740962468",
      "pull_request_review_id": 2275726379,
      "id": 1740962468,
      "node_id": "PRRC_kwDOABII585nxPqk",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n+{\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+    Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Time window to periodically flush is between 50 and 70 minutes\n+    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 40,
      "original_position": 35,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740812194,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Well, changing the test to periodically flush after 55 minutes makes it a different test. That would mean the first flush is in the window and could randomly trigger a flush or not.\r\nWas the failure after changing to `55min`?",
      "created_at": "2024-09-02T13:55:52Z",
      "updated_at": "2024-09-02T13:55:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740962468",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740962468"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 40,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740966394",
      "pull_request_review_id": 2275732464,
      "id": 1740966394,
      "node_id": "PRRC_kwDOABII585nxQn6",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740868062,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why would we need to test every  value in the window? Testing the edges of the window accomplishes the same thing, no?",
      "created_at": "2024-09-02T13:59:00Z",
      "updated_at": "2024-09-02T13:59:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740966394",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740966394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740969969",
      "pull_request_review_id": 2275738211,
      "id": 1740969969,
      "node_id": "PRRC_kwDOABII585nxRfx",
      "diff_hunk": "@@ -2837,26 +2840,21 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.",
      "path": "src/validation.cpp",
      "position": 45,
      "original_position": 40,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740880618,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not sure this is an improvement. We would be adding a new variable, instead of calling a function twice. Seems like a wash to me.",
      "created_at": "2024-09-02T14:01:50Z",
      "updated_at": "2024-09-02T14:01:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740969969",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740969969"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2849,
      "original_line": 2849,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740986718",
      "pull_request_review_id": 2275766119,
      "id": 1740986718,
      "node_id": "PRRC_kwDOABII585nxVle",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n+{\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+    Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Time window to periodically flush is between 50 and 70 minutes\n+    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 40,
      "original_position": 35,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740812194,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ahh, I see what you mean. We need to trigger an initial flush to set `m_next_write` first before testing the periodic flush window. Fixed.",
      "created_at": "2024-09-02T14:16:18Z",
      "updated_at": "2024-09-02T14:16:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740986718",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740986718"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 40,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740999482",
      "pull_request_review_id": 2275788354,
      "id": 1740999482,
      "node_id": "PRRC_kwDOABII585nxYs6",
      "diff_hunk": "@@ -2774,6 +2775,11 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\n     return CoinsCacheSizeState::OK;\n }\n \n+SteadyClock::time_point CalculateNextWrite(SteadyClock::time_point after)\n+{\n+    return FastRandomContext().rand_uniform_delay(after + DATABASE_WRITE_INTERVAL_MIN, DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);\n+}",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "c529a595dc90be213c265b201ccb0e7bb7278245",
      "in_reply_to_id": 1740758502,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-02T14:27:06Z",
      "updated_at": "2024-09-02T14:27:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740999482",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740999482"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": 2778,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2786,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740999675",
      "pull_request_review_id": 2275788661,
      "id": 1740999675,
      "node_id": "PRRC_kwDOABII585nxYv7",
      "diff_hunk": "@@ -86,10 +86,9 @@ using node::CBlockIndexHeightOnlyComparator;\n using node::CBlockIndexWorkComparator;\n using node::SnapshotMetadata;\n \n-/** Time to wait between writing blocks/block index to disk. */\n-static constexpr std::chrono::hours DATABASE_WRITE_INTERVAL{1};\n-/** Time to wait between flushing chainstate to disk. */\n-static constexpr std::chrono::hours DATABASE_FLUSH_INTERVAL{24};\n+/** Time window to wait between writing blocks/block index and chainstate to disk. */",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740870587,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-02T14:27:14Z",
      "updated_at": "2024-09-02T14:27:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740999675",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740999675"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741091951",
      "pull_request_review_id": 2275932444,
      "id": 1741091951,
      "node_id": "PRRC_kwDOABII585nxvRv",
      "diff_hunk": "@@ -2837,26 +2840,21 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.",
      "path": "src/validation.cpp",
      "position": 45,
      "original_position": 40,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740880618,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "we don't have to add a variable, we can just inline it to:\r\n```C++\r\nif (fDoFullFlush || m_next_write == NodeClock::time_point::max()) {\r\n```\r\n\r\nWhich would simplify a few places (logically, making it obvious when we're queuing the next run, and also codewise, reducing duplication), removing the helper method and explanatory comments and multiple assignments (i.e. business logic being spread around).",
      "created_at": "2024-09-02T15:53:39Z",
      "updated_at": "2024-09-02T16:21:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741091951",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741091951"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2849,
      "original_line": 2849,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741092396",
      "pull_request_review_id": 2275933037,
      "id": 1741092396,
      "node_id": "PRRC_kwDOABII585nxvYs",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740868062,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Mostly because I ran it and it behaved in a weird way (sometimes passing) so I have a hard time trusting it now. It never passed for ALL of these values, so at least they're more reliable.",
      "created_at": "2024-09-02T15:54:10Z",
      "updated_at": "2024-09-02T15:54:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741092396",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741092396"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741107409",
      "pull_request_review_id": 2275955713,
      "id": 1741107409,
      "node_id": "PRRC_kwDOABII585nxzDR",
      "diff_hunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "5cad9d16dd07859a76c6637789695bf1b4f36e1c",
      "in_reply_to_id": 1740868062,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "~Using SteadyClock in https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741105265 seems to have stabilized the tests.~\r\n\r\nEdit: it seems the addition of the `first periodic flush` stabilized the test.\r\n\r\nApproach ACK",
      "created_at": "2024-09-02T16:14:21Z",
      "updated_at": "2024-09-02T16:57:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741107409",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741107409"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741109081",
      "pull_request_review_id": 2275958237,
      "id": 1741109081,
      "node_id": "PRRC_kwDOABII585nxzdZ",
      "diff_hunk": "@@ -0,0 +1,48 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n+{\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+    Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // The first periodic flush sets m_last_write and does not flush\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);\n+\n+    // Time to periodically flush is between 50 and 70 minutes",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 36,
      "original_position": 36,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "1d50f72d16bf8a07540b6e53015deff4598c9ea3",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if you decide to keep this structure instead of the exhaustive one:\r\n```suggestion\r\n    // Time to periodically flush is between 50 and 70 minutes (inclusive)\r\n```",
      "created_at": "2024-09-02T16:17:10Z",
      "updated_at": "2024-09-02T16:17:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741109081",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741109081"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 36,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741110745",
      "pull_request_review_id": 2275960774,
      "id": 1741110745,
      "node_id": "PRRC_kwDOABII585nxz3Z",
      "diff_hunk": "@@ -0,0 +1,48 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n+{\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+    Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // The first periodic flush sets m_last_write and does not flush\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);\n+\n+    // Time to periodically flush is between 50 and 70 minutes\n+    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 40,
      "original_position": 40,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "1d50f72d16bf8a07540b6e53015deff4598c9ea3",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if you decide to keep this structure, please add boundary test for `50min` turning `m_did_flush` to true.\r\nWould also cover `+ 71min` for the same reason.",
      "created_at": "2024-09-02T16:19:57Z",
      "updated_at": "2024-09-02T16:19:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741110745",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741110745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 40,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741111508",
      "pull_request_review_id": 2275961957,
      "id": 1741111508,
      "node_id": "PRRC_kwDOABII585nx0DU",
      "diff_hunk": "@@ -0,0 +1,48 @@\n+// Copyright (c) 2024- The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/util/setup_common.h>\n+#include <validation.h>\n+#include <validationinterface.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\n+\n+struct TestSubscriber final : public CValidationInterface {\n+    bool m_did_flush{false};\n+\n+    TestSubscriber() = default;\n+\n+    void ChainStateFlushed(ChainstateRole role, const CBlockLocator& locator) override\n+    {\n+        m_did_flush = true;\n+    }\n+};\n+\n+BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n+{\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+    Chainstate& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // The first periodic flush sets m_last_write and does not flush\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);\n+\n+    // Time to periodically flush is between 50 and 70 minutes\n+    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(!sub->m_did_flush);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 40,
      "original_position": 40,
      "commit_id": "a2e8f7df1ca94c662183702ad3f41228c5ed7d17",
      "original_commit_id": "1d50f72d16bf8a07540b6e53015deff4598c9ea3",
      "in_reply_to_id": 1741110745,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think it would, because it's random.",
      "created_at": "2024-09-02T16:21:15Z",
      "updated_at": "2024-09-02T16:21:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1741111508",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1741111508"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 40,
      "original_line": 40,
      "side": "RIGHT"
    }
  ]
}