{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409",
    "id": 1958283427,
    "node_id": "PR_kwDOABII5850uQij",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30409",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30409.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30409.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/e8ec39784dac1a564db4a962a75994e5bb832bc9",
    "number": 30409,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange, drop CRPCSignals & g_best_block",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This continues the work in #30200 so that a future Stratum v2 Template Provider (see #29432) can avoid accessing node internals. It needs to know when a new block arrives in order to push new templates to connected clients.\r\n\r\n`waitTipChanged()` uses a new kernel notification `notifications().m_tip_block_mutex`, which this PR also introduces (a previous version used `g_best_block`).\r\n\r\nIn order to ensure the new method works as intended, the `waitfornewblock`, `waitforblock` and `waitforblockheight` RPC methods are refactored to use it. This allows removing `RPCNotifyBlockChange`.\r\n\r\nThere's a commit to add (direct) tests for the methods that are about to be refactored:\r\n- `waitfornewblock` was already implicitly tested by `feature_shutdown.py`.\r\n- `waitforblockheight` by `feature_coinstatsindex.py` and `example_test.py`\r\n\r\nThis PR renames `getTipHash()` to `getTip()` and returns a `BlockRef` (renamed from `BlockKey`) so that callers can use either the height or hash.\r\n\r\nThe later commits make trivial improvements to the `waitfor*` RPC calls (not needed for this PR).\r\n\r\nThe `waitTipChanged()` method could probably also be used for the longpoll functionality in `getblocktemplate`, but I'm a bit reluctant to touch that.\r\n\r\n`RPCServer::OnStarted` no longer does anything and `RPCServer::OnStopped` merely prints a log statement. They were added in #5711 as a refactor. This PR drops them entirely.\r\n\r\nFinally `g_best_block` is also dropped.",
    "labels": [],
    "created_at": "2024-07-08T17:11:21Z",
    "updated_at": "2024-09-01T16:29:41Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "013502caaf8b4fac1dbfd3a56057c37bc96c383e",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "Sjors:2024/07/wait-tip-changed",
      "ref": "2024/07/wait-tip-changed",
      "sha": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 92390696,
        "node_id": "MDEwOlJlcG9zaXRvcnk5MjM5MDY5Ng==",
        "name": "bitcoin",
        "full_name": "Sjors/bitcoin",
        "owner": {
          "login": "Sjors",
          "id": 10217,
          "node_id": "MDQ6VXNlcjEwMjE3",
          "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/Sjors",
          "html_url": "https://github.com/Sjors",
          "followers_url": "https://api.github.com/users/Sjors/followers",
          "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
          "organizations_url": "https://api.github.com/users/Sjors/orgs",
          "repos_url": "https://api.github.com/users/Sjors/repos",
          "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/Sjors/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/Sjors/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/Sjors/bitcoin",
        "archive_url": "https://api.github.com/repos/Sjors/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/Sjors/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/Sjors/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/Sjors/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/Sjors/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/Sjors/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/Sjors/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/Sjors/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/Sjors/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/Sjors/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/Sjors/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/Sjors/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/Sjors/bitcoin/events",
        "forks_url": "https://api.github.com/repos/Sjors/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/Sjors/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/Sjors/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/Sjors/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/Sjors/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/Sjors/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/Sjors/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/Sjors/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/Sjors/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/Sjors/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/Sjors/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/Sjors/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/Sjors/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/Sjors/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/Sjors/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/Sjors/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:Sjors/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/Sjors/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/Sjors/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/Sjors/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/Sjors/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/Sjors/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/Sjors/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/Sjors/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/Sjors/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/Sjors/bitcoin/hooks",
        "svn_url": "https://github.com/Sjors/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 247146,
        "default_branch": "sv2",
        "open_issues_count": 16,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": false,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-29T14:23:28Z",
        "created_at": "2017-05-25T10:05:54Z",
        "updated_at": "2024-08-13T18:57:28Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5c7d4b9dec7977ee697c64c290c96f69d53d0884",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35811,
        "stargazers_count": 77769,
        "watchers_count": 77769,
        "size": 267430,
        "default_branch": "master",
        "open_issues_count": 668,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-01T08:53:28Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-01T16:59:09Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 203,
    "deletions": 164,
    "changed_files": 22,
    "commits": 12,
    "review_comments": 48,
    "comments": 13
  },
  "events": [
    {
      "event": "commented",
      "id": 2214741306,
      "node_id": "IC_kwDOABII586EAkU6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2214741306",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-08T17:11:23Z",
      "updated_at": "2024-09-01T16:29:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30409).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2245698982) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30750](https://github.com/bitcoin/bitcoin/pull/30750) (scripted-diff: LogPrint -> LogDebug by maflcko)\n* [#30713](https://github.com/bitcoin/bitcoin/pull/30713) (rpc: add `revelant_blocks` to `scanblocks status` by tdb3)\n* [#30635](https://github.com/bitcoin/bitcoin/pull/30635) (rpc: add optional blockhash to waitfornewblock by Sjors)\n* [#30546](https://github.com/bitcoin/bitcoin/pull/30546) (util: Use consteval checked format string in FatalErrorf by maflcko)\n* [#30509](https://github.com/bitcoin/bitcoin/pull/30509) (multiprocess: Add -ipcbind option to bitcoin-node by ryanofsky)\n* [#30440](https://github.com/bitcoin/bitcoin/pull/30440) (Have createNewBlock() return a BlockTemplate interface by Sjors)\n* [#30437](https://github.com/bitcoin/bitcoin/pull/30437) (multiprocess: add bitcoin-mine test program by ryanofsky)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n* [#29553](https://github.com/bitcoin/bitcoin/pull/29553) (assumeutxo: Add dumptxoutset height param, remove shell scripts by fjahr)\n* [#29432](https://github.com/bitcoin/bitcoin/pull/29432) (Stratum v2 Template Provider (take 3) by Sjors)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n* [#24230](https://github.com/bitcoin/bitcoin/pull/24230) (indexes: Stop using node internal types and locking cs_main, improve sync logic by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2214741306",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "labeled",
      "id": 13429199017,
      "node_id": "LE_lADOABII586O0lCbzwAAAAMgcVCp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13429199017",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-08T20:08:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13434478291,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMgwd7T",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13434478291",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T06:47:46Z"
    },
    {
      "event": "renamed",
      "id": 13435375497,
      "node_id": "RTE_lADOABII586O0lCbzwAAAAMgz4-J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13435375497",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T07:54:36Z",
      "rename": {
        "from": "Introduce waitTipChanged() mining interface and replace RPCNotifyBlockChange",
        "to": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange and drop CRPCSignals"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13435377512,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMgz5do",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13435377512",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T07:54:44Z"
    },
    {
      "event": "commented",
      "id": 2216910420,
      "node_id": "IC_kwDOABII586EI15U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2216910420",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:17:59Z",
      "updated_at": "2024-07-09T08:19:05Z",
      "author_association": "MEMBER",
      "body": "Some of the functional tests that use the refactored RPC calls still fail under TSAN, so keeping this draft until that's resolved.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2216910420",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13436202713,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMg3C7Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13436202713",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:51:18Z"
    },
    {
      "event": "commented",
      "id": 2217017610,
      "node_id": "IC_kwDOABII586EJQEK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2217017610",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:56:22Z",
      "updated_at": "2024-07-09T09:01:08Z",
      "author_association": "MEMBER",
      "body": "Fixed the deadlock. I ran into the same issue before when working on #29432: `UpdateTip` requires holding `cs_main`. It then takes `g_best_block_mutex` in order to announces the new block. So then lines after `g_best_block_cv.wait_until` should release `g_best_block_mutex` before trying to lock `cs_main`.\r\n\r\nThat's not a problem here; I just had to break out of the while loop instead of returning from it.\r\n\r\nBack in the other PR this led to a deadlock if we simultaneously submitted a block and received it via p2p from the pool, which can happen in Stratum v2, see https://github.com/bitcoin/bitcoin/pull/29432#issuecomment-1948355393",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2217017610",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "ready_for_review",
      "id": 13436288936,
      "node_id": "RFRE_lADOABII586O0lCbzwAAAAMg3X-o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13436288936",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:56:50Z"
    },
    {
      "event": "unlabeled",
      "id": 13437400179,
      "node_id": "UNLE_lADOABII586O0lCbzwAAAAMg7nRz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13437400179",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T10:09:40Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13470614601,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMi6URJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13470614601",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T11:55:30Z"
    },
    {
      "event": "reviewed",
      "id": 2171768079,
      "node_id": "PRR_kwDOABII586Bco0P",
      "url": null,
      "actor": null,
      "commit_id": "482a5fd48d494f44f48209956c77ec1bdb5663f5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2171768079",
      "submitted_at": "2024-07-11T12:35:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "referenced",
      "id": 13525713995,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMmMgRL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13525713995",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4e1a4342f3b2a857e3211587cd14e36704197483",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/4e1a4342f3b2a857e3211587cd14e36704197483",
      "created_at": "2024-07-16T18:51:15Z"
    },
    {
      "event": "referenced",
      "id": 13538820465,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMm-gFx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13538820465",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e1ae38f4bbcdb1b3fa5e1eab1abfa9cf2232798c",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/e1ae38f4bbcdb1b3fa5e1eab1abfa9cf2232798c",
      "created_at": "2024-07-17T15:38:57Z"
    },
    {
      "event": "referenced",
      "id": 13539015189,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMm_PoV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539015189",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e1fa475a5becca0083f59d7cafac9bc67c2f4f1c",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/e1fa475a5becca0083f59d7cafac9bc67c2f4f1c",
      "created_at": "2024-07-17T15:53:00Z"
    },
    {
      "event": "referenced",
      "id": 13539417192,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMnAxxo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539417192",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5126ac430f3bc94b727044dc2497acebb73a9f3f",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/5126ac430f3bc94b727044dc2497acebb73a9f3f",
      "created_at": "2024-07-17T16:24:13Z"
    },
    {
      "event": "referenced",
      "id": 13539417260,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMnAxys",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539417260",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "bdd68d5bca483071ca0729e6f0d2d71706ad21e7",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/bdd68d5bca483071ca0729e6f0d2d71706ad21e7",
      "created_at": "2024-07-17T16:24:14Z"
    },
    {
      "event": "referenced",
      "id": 13539756843,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMnCEsr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539756843",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "173580b1237e5bd7d63564aea555ca8914715f75",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/173580b1237e5bd7d63564aea555ca8914715f75",
      "created_at": "2024-07-17T16:56:26Z"
    },
    {
      "event": "referenced",
      "id": 13555095824,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMn8lkQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13555095824",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7967d78d737472c25b6420a1f26c8df25ac21a67",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/7967d78d737472c25b6420a1f26c8df25ac21a67",
      "created_at": "2024-07-18T12:45:55Z"
    },
    {
      "event": "referenced",
      "id": 13555701087,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMn-5Vf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13555701087",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "79336c95faa1af966042f06ad9bc86a5333f18f3",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/79336c95faa1af966042f06ad9bc86a5333f18f3",
      "created_at": "2024-07-18T13:17:31Z"
    },
    {
      "event": "labeled",
      "id": 13559817468,
      "node_id": "LE_lADOABII586O0lCbzwAAAAMoOmT8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13559817468",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T16:57:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13559846043,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMoOtSb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13559846043",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T16:59:48Z"
    },
    {
      "event": "commented",
      "id": 2237085603,
      "node_id": "IC_kwDOABII586FVzej",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2237085603",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T16:59:51Z",
      "updated_at": "2024-07-18T16:59:51Z",
      "author_association": "MEMBER",
      "body": "Rebased after #30356 (`#include` order).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2237085603",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "unlabeled",
      "id": 13561659992,
      "node_id": "UNLE_lADOABII586O0lCbzwAAAAMoVoJY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13561659992",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T19:10:27Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 13562870527,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPr_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870527",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8a814d5f9319cb357498e2c0a8669659a3cc4823",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/8a814d5f9319cb357498e2c0a8669659a3cc4823",
      "created_at": "2024-07-18T20:40:46Z"
    },
    {
      "event": "referenced",
      "id": 13562870564,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPsk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870564",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "fba04d7756c77ed9371c5dc90d3bebc9aa767f4b",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/fba04d7756c77ed9371c5dc90d3bebc9aa767f4b",
      "created_at": "2024-07-18T20:40:46Z"
    },
    {
      "event": "referenced",
      "id": 13562870801,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPwR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870801",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0b76ed6480bf498074423d5904b04ef9a2f5e624",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/0b76ed6480bf498074423d5904b04ef9a2f5e624",
      "created_at": "2024-07-18T20:40:47Z"
    },
    {
      "event": "referenced",
      "id": 13562870882,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPxi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870882",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b01bf642b7b663a7f4aa43e14085fca084b1248d",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/b01bf642b7b663a7f4aa43e14085fca084b1248d",
      "created_at": "2024-07-18T20:40:48Z"
    },
    {
      "event": "referenced",
      "id": 13571852146,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMo8gdy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13571852146",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "01bc77e8504e3059d780c00544466f3a04f01779",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/01bc77e8504e3059d780c00544466f3a04f01779",
      "created_at": "2024-07-19T09:46:04Z"
    },
    {
      "event": "referenced",
      "id": 13636881864,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k3I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636881864",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0fb50734c39919768ea68b86ca5aac9e363b77a4",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/0fb50734c39919768ea68b86ca5aac9e363b77a4",
      "created_at": "2024-07-24T22:12:22Z"
    },
    {
      "event": "referenced",
      "id": 13636881892,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k3k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636881892",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ec5f45b9186184cac9c64ed08b8b8cc596e301a3",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/ec5f45b9186184cac9c64ed08b8b8cc596e301a3",
      "created_at": "2024-07-24T22:12:22Z"
    },
    {
      "event": "referenced",
      "id": 13636882043,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k57",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636882043",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "257cc06e875845322caf9fb3738c202b2ce18284",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/257cc06e875845322caf9fb3738c202b2ce18284",
      "created_at": "2024-07-24T22:12:23Z"
    },
    {
      "event": "referenced",
      "id": 13636882079,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k6f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636882079",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "35b80d22602ca7346c21fe52509b1aabc31041c8",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/35b80d22602ca7346c21fe52509b1aabc31041c8",
      "created_at": "2024-07-24T22:12:23Z"
    },
    {
      "event": "reviewed",
      "id": 2199367930,
      "node_id": "PRR_kwDOABII586DF7D6",
      "url": null,
      "actor": null,
      "commit_id": "e367258c9b37f0494bdc9d36a6a48adb62f9c94f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review e367258c9b37f0494bdc9d36a6a48adb62f9c94f. This is a nice change, but I didn't ack because I think it would be a regression to not signal g_best_block_cv on shutdown. I posted other suggestions to consider too but they are not critical.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2199367930",
      "submitted_at": "2024-07-25T14:47:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13846147350,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5S3EW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13846147350",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T10:46:04Z"
    },
    {
      "event": "commented",
      "id": 2283641349,
      "node_id": "IC_kwDOABII586IHZoF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2283641349",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T10:47:33Z",
      "updated_at": "2024-08-12T10:47:33Z",
      "author_association": "MEMBER",
      "body": "Rebased and restored signalling `g_best_block_cv` on shutdown.\r\n\r\nI created `interfaces/types.h`, moved `BlockKey` there and renamed it to `BlockRef`. I then renamed `getTipHash()` to `getTip()` instead of adding `getTipHeight()`. `waitTipChanged` also returns a `BlockKey`.\r\n\r\nAddressed inline comments, except that I still need to look into the tests.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2283641349",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "commented",
      "id": 2283747278,
      "node_id": "IC_kwDOABII586IHzfO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2283747278",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T11:43:21Z",
      "updated_at": "2024-08-12T11:43:21Z",
      "author_association": "MEMBER",
      "body": "As for race conditions with RPC calls that rely on `waitForBlock()`: \r\n\r\n* `waitforblock [hash]`: the while loop breaks if `block.hash == hash`, which together with the early return inside `waitTipChanged` should prevent any blockage\r\n* `waitforblockheight`: similar to `waitforblock`, the while loop checks `block.height >= height`  \r\n* `waitfornewblock`: I opened a draft PR to add an optional `blockhash` argument #30635",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2283747278",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13849171089,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5eZSR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849171089",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:34:00Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13849201317,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5egql",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849201317",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:35:35Z"
    },
    {
      "event": "commented",
      "id": 2284019673,
      "node_id": "IC_kwDOABII586II1_Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2284019673",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:37:37Z",
      "updated_at": "2024-08-12T13:37:37Z",
      "author_association": "MEMBER",
      "body": "I simplified the `waitforblock` and `waitfornewblock` tests.\r\n\r\nThey're not very thorough at the moment, because `reconsiderblock` is either atomic or too fast. A better way to test the asynchronous behaviour would be to spin up a second node, and feed it blocks through `add_p2p_connection`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2284019673",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13849606085,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5gDfF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849606085",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:57:22Z"
    },
    {
      "event": "commented",
      "id": 2284064523,
      "node_id": "IC_kwDOABII586IJA8L",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2284064523",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:57:27Z",
      "updated_at": "2024-08-12T13:57:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/28654787886</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2284064523",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "labeled",
      "id": 13849607248,
      "node_id": "LE_lADOABII586O0lCbzwAAAAM5gDxQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849607248",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:57:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2233198217,
      "node_id": "PRR_kwDOABII586FG-aJ",
      "url": null,
      "actor": null,
      "commit_id": "dcf984b055a367facf7704eb8055619d6fe64a55",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review dcf984b055a367facf7704eb8055619d6fe64a55. I think there might be an infinite loop bug if waitfornewblock is called with timeout of 0, and it looks like there are some other quirks. Left a few suggestions below.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2233198217",
      "submitted_at": "2024-08-12T16:02:04Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "unlabeled",
      "id": 13851639694,
      "node_id": "UNLE_lADOABII586O0lCbzwAAAAM5nz-O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13851639694",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T16:11:00Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13860840000,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM6K6JA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13860840000",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-13T09:52:49Z"
    },
    {
      "event": "commented",
      "id": 2285847403,
      "node_id": "IC_kwDOABII586IP0Nr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2285847403",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-13T09:53:38Z",
      "updated_at": "2024-08-13T09:53:38Z",
      "author_association": "MEMBER",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713879417\r\n\r\n> it looks like this will wait 1000ms+1000ms instead of 1000ms+500ms\r\n\r\nIndeed it seems to pick the wrong wait time after the first inner loop. If fixed that and the overflow, though in a slightly different way than the AI overlord suggested.\r\n\r\nI also added a `g_best_block == uint256()` check because it starts 0 until the first `UpdateTip()`.  \r\n\r\nChanged current_tip argument to `uint256` instead of `BlockRef`.\r\n\r\nI also added a commit to recommend `-rpcclienttimeout=0` for these three calls.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2285847403",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "referenced",
      "id": 13863885729,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6Whuh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13863885729",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2cff4416949931f384e8096b83366eaf3246ed65",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/2cff4416949931f384e8096b83366eaf3246ed65",
      "created_at": "2024-08-13T13:48:11Z"
    },
    {
      "event": "referenced",
      "id": 13866738365,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6haK9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13866738365",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0fc045978ea671fc2b9b48c4bc3f20a206372b40",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/0fc045978ea671fc2b9b48c4bc3f20a206372b40",
      "created_at": "2024-08-13T17:16:33Z"
    },
    {
      "event": "referenced",
      "id": 13866827551,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6hv8f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13866827551",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1758b5d2b4665b6229fa5e90eefa8850b15c39ca",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/1758b5d2b4665b6229fa5e90eefa8850b15c39ca",
      "created_at": "2024-08-13T17:24:30Z"
    },
    {
      "event": "referenced",
      "id": 13867417207,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6j_53",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13867417207",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "27630ec52409b4088bb5c57631fd5f8dddabe531",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/27630ec52409b4088bb5c57631fd5f8dddabe531",
      "created_at": "2024-08-13T18:17:35Z"
    },
    {
      "event": "reviewed",
      "id": 2242860642,
      "node_id": "PRR_kwDOABII586Fr1Zi",
      "url": null,
      "actor": null,
      "commit_id": "9ba60b3a2c22dcd1c9e7b4880f0adb678e4e8d63",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 9ba60b3a2c22dcd1c9e7b4880f0adb678e4e8d63. Just fixed a few bugs to make waiting more reliable since last review and changed test logging. I like the new change to check for overflows generally in waitTipChanged, instead of just checking specifically for the max timeout value. That was better than the suggestion.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2242860642",
      "submitted_at": "2024-08-16T15:28:41Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13926000264,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM-DeaI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13926000264",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T07:27:31Z"
    },
    {
      "event": "reviewed",
      "id": 2245487748,
      "node_id": "PRR_kwDOABII586F12yE",
      "url": null,
      "actor": null,
      "commit_id": "d880419cb65fd9d446057ea05384dad55da0f292",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK d880419cb65fd9d446057ea05384dad55da0f292. Only changes since list review are documentation improvements and a small code simplification.\r\n\r\nOverall this PR makes nice improvements to the waitfor* RPCs and simplifies the code getting rid of boost signals and a global variable.\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2245487748",
      "submitted_at": "2024-08-19T13:08:42Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13931210441,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM-XWbJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13931210441",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T14:15:43Z"
    },
    {
      "event": "reviewed",
      "id": 2245698982,
      "node_id": "PRR_kwDOABII586F2qWm",
      "url": null,
      "actor": null,
      "commit_id": "e8176694bb5508b2b488a8c79a6001d2fa625302",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK e8176694bb5508b2b488a8c79a6001d2fa625302, just reduced a variable scope since last review.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2245698982",
      "submitted_at": "2024-08-19T14:27:51Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "reviewed",
      "id": 2254595107,
      "node_id": "PRR_kwDOABII586GYmQj",
      "url": null,
      "actor": null,
      "commit_id": "e8176694bb5508b2b488a8c79a6001d2fa625302",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2254595107",
      "submitted_at": "2024-08-22T13:58:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14010839011,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANDHG_j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14010839011",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T09:39:09Z"
    },
    {
      "event": "commented",
      "id": 2309786222,
      "node_id": "IC_kwDOABII586JrIpu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2309786222",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T09:39:12Z",
      "updated_at": "2024-08-26T09:39:12Z",
      "author_association": "MEMBER",
      "body": "I incorporated https://github.com/TheCharlatan/bitcoin/commit/3c665065f132fd80ea3b1733785b98e45c8b371e so the `waitTipChanged()` implementation uses the kernel signal instead of `g_best_block`. Also rebased.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2309786222",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14010935562,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANDHekK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14010935562",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T09:46:55Z"
    },
    {
      "event": "reviewed",
      "id": 2260994997,
      "node_id": "PRR_kwDOABII586GxAu1",
      "url": null,
      "actor": null,
      "commit_id": "93176016322687f3ad9ade8f32c1ff1392ee6470",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review 93176016322687f3ad9ade8f32c1ff1392ee6470, but I'm concerned code is failing to signal m_tip_block_cv on shutdown so it could make shutdown slower. Suggested a fix below. It also seems like it would be easy to eliminate g_best_block completely, so suggested a way to do that too.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2260994997",
      "submitted_at": "2024-08-26T15:46:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14016648290,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANDdRRi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14016648290",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T17:26:56Z"
    },
    {
      "event": "commented",
      "id": 2310705314,
      "node_id": "IC_kwDOABII586JupCi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2310705314",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T17:26:57Z",
      "updated_at": "2024-08-26T17:26:57Z",
      "author_association": "MEMBER",
      "body": "Alright then, dropping `g_best_block` as well!\r\n\r\nSome tests failed with `EnsureAnyNodeContext(context).notifications`, so I fixed that (relative to the above patches). In `init.cpp` the RPC server starts at step 4a, but the notifications are added at step 7. This case is hit by several functional tests that shut the node down early.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2310705314",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "renamed",
      "id": 14016653544,
      "node_id": "RTE_lADOABII586O0lCbzwAAAANDdSjo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14016653544",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T17:27:22Z",
      "rename": {
        "from": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange and drop CRPCSignals",
        "to": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange, drop CRPCSignals & g_best_block"
      }
    },
    {
      "event": "commented",
      "id": 2317500958,
      "node_id": "IC_kwDOABII586KIkIe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2317500958",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T12:22:40Z",
      "updated_at": "2024-08-29T12:22:40Z",
      "author_association": "MEMBER",
      "body": "Rebased to ensure it still works with CMake. This PR only adds a header file (`interfaces/types.h`) which don't need to be added to `CMakeLists.txt`. If #30664 lands before this PR, I'll have to drop the addition to `src/Makefile.am`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2317500958",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14060893725,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANGGDYd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14060893725",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T12:22:40Z"
    },
    {
      "event": "reviewed",
      "id": 2265548046,
      "node_id": "PRR_kwDOABII586HCYUO",
      "url": null,
      "actor": null,
      "commit_id": "d66a680c7f9e3accb16f8c10fef1a98596b21369",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2265548046",
      "submitted_at": "2024-08-29T12:44:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14062161284,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANGK42E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14062161284",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T13:41:17Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAyMjcyNzE2ZGNlMjkyNjE4NDUzZDA0MDc5ODgxMThiYzVmMDcxNDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02272716dce292618453d0407988118bc5f07140",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/02272716dce292618453d0407988118bc5f07140",
      "tree": {
        "sha": "4594f89a438d868c4e29eaebddc564e69b23a7a7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4594f89a438d868c4e29eaebddc564e69b23a7a7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4594f89a438d868c4e29eaebddc564e69b23a7a7\nparent 5c7d4b9dec7977ee697c64c290c96f69d53d0884\nauthor Sjors Provoost <sjors@sprovoost.nl> 1723453739 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941328 +0200\n\nrefactor: rename BlockKey to BlockRef\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBEACgkQV/+b28ww\nEAnVOBAArAT+34EOsdwYV6b+BaC6ynh1iPSdcHfpZYYMbQdEiOT+3B/+88rxQJX5\na7FxjXm2SIv1iq4i15xy/psrpGSHeP7JDOKUJ6n164XJ+0T74qBnjtya2yjPgyrf\nfPdAxkBWDuMtZH8meWhPp4GfbfdzW8kRNEfsKi5YGyI0mUKaKGm3hme86tEzHzK0\nTzs+eva2VHqGo/LrjECqyOfp1zHNIh2dTh96FW8MANrf6Dc/febDebVTFwgrRrb8\nPPVn9dXgBUCHOI5tpXxOAwyUFwQpsaB/D7luOdsyZy0LPMsZdUSYG5B81eFCUcTC\nXDvLAebSVmdUwmYJLKq3V6d+xWPJjuDXJR/oz0c7HJwccomsJe744y/f13GUvq0d\ny2dswDvx0lJwtLk9P1fqO2qeusgjUUa/rAjtBkkiG4BRNlvwtpude+7Oq9ZGRVw2\ntil3gdhKzzNTqq/C89vrcf/5iFH7jSqZVeKnKofrxi6Q/77cZA72PvQHk2SypYY+\nIlfd628vocu45YCiDiSDTMRGDA0U740L8iRmxO3V1TY/iJzeGPLAIyCZYg9l3cMn\nikeK27h1d1h3JOZS+kuahA7bG08qM3ejO02xVjBalfW1wxmi/03Y+8zA9fGbah5e\nMMEogiF0J96c/LZ2eRNETEDx0Xc035IwLPBuo/e9nLNpXCQPGo0=\n=zaVs\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c7d4b9dec7977ee697c64c290c96f69d53d0884",
          "sha": "5c7d4b9dec7977ee697c64c290c96f69d53d0884",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5c7d4b9dec7977ee697c64c290c96f69d53d0884"
        }
      ],
      "message": "refactor: rename BlockKey to BlockRef",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:08Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-12T09:08:59Z"
      },
      "sha": "02272716dce292618453d0407988118bc5f07140"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdhMjY1ZTVjNmNlY2UwNzA3NjE3MWQ4NmFhZDM0Mjg1NTBhZTM0OWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a265e5c6cece07076171d86aad3428550ae349d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7a265e5c6cece07076171d86aad3428550ae349d",
      "tree": {
        "sha": "43fb7ba3c9a52e03f1267935f686d5fc0dad23f1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/43fb7ba3c9a52e03f1267935f686d5fc0dad23f1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 43fb7ba3c9a52e03f1267935f686d5fc0dad23f1\nparent 02272716dce292618453d0407988118bc5f07140\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720458491 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941329 +0200\n\nRename getTipHash() to getTip() and return BlockRef\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBEACgkQV/+b28ww\nEAk4zRAAw122x0n5NBwnfdXO9Kw1dBhetlLoHO2Q2NIq9qmAbUFHjUdV0lr2eLEl\nS0qlGFuQ1C1xB9XnBPcxqz4z9OwBIdm0k7IacL+elQudIUB0CuoaBSMw5Y+7pdef\npOZssvhhZH2n2TGPrUEi0UD49rwjkX9LaB2Ils4/GZnrTte6QjOmsEg+tGmHnTDz\nPrZD+lAZdYB2yO6ttKbfNkYZ8ygpRRuNj+P+cZ7joRk51o/gHDLm4ZIxsmeT1IXo\nN7K+qyUiKHVztfa7uElPhn3KNJ9H/UfwwtjNDD0emA+f/1CYeYEURfiErdEwwI8t\ntzFryWwzFzSRc+6Mk+wQ/SZG0Byj2Q+U3kZBrM7uT2PCGREtaGA6RI2mRsqJn/Lz\nY72d3KvWGF++Plac0a8mjnNHbdJ30M090h25CGirfKTxGMztPmFDBL9So6tIXoJA\nNfsXEFQxxLVg1NpTAgk4dfd8MlhDHxzOYNt6Hn86nwKcf8jTCZvL/e+jrMpkcFxM\n67Xb79yp87B2Nn5gAjQeCdNVjPnH7YrtbvODoMuw0q09K3KOUKllRp6qSYce16Wm\nIStXIBtuQjgeWNnETcHnwGRVkI03+8gqqmEE+/lYx6/P6nO7g7XzZtmVgma8fwBe\nMJdllf8sFNN50EnL46n3EPGrQkICMDBVkCVg1eXJMm94Axe/u3M=\n=jkHw\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02272716dce292618453d0407988118bc5f07140",
          "sha": "02272716dce292618453d0407988118bc5f07140",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/02272716dce292618453d0407988118bc5f07140"
        }
      ],
      "message": "Rename getTipHash() to getTip() and return BlockRef",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:09Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T17:08:11Z"
      },
      "sha": "7a265e5c6cece07076171d86aad3428550ae349d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYyMzJlYjkyNWQyOWM5ZWIyYTc3NjIxNTAyYTFiODhlMTMyOGRhNzM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f232eb925d29c9eb2a77621502a1b88e1328da73",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f232eb925d29c9eb2a77621502a1b88e1328da73",
      "tree": {
        "sha": "40406359dcdeb3b760bcde883b804ce05ea91db8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/40406359dcdeb3b760bcde883b804ce05ea91db8"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 40406359dcdeb3b760bcde883b804ce05ea91db8\nparent 7a265e5c6cece07076171d86aad3428550ae349d\nauthor Sjors Provoost <sjors@sprovoost.nl> 1724688968 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941329 +0200\n\nnode: Track last block that received a blockTip notification\n\nAlso signal m_tip_block_cv when StopRPC is called, for\nconsistency with g_best_block_cv. This is handled in\nStopRPC instead of OnRPCStopped() because the latter\nis deleted in a later commit.\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBEACgkQV/+b28ww\nEAl2dBAAo3ynuiPXofr4lskSOXB0+I5v/Lpg6N3nrQFOuxYH9gN6M2uHTWrvlvLZ\nwffVymuHs2b99BitZlVOwO/+G9nLZmAFtzGkKDfgxleLUfZ0B7D3JzJmeABEDvQ+\nICEzojKW/rWmWQTmFpLKvSO01dx7NJdWxFbQSGAIgGohzjrfJgeiPqG+AhaKc6oH\nLisfXus6gj2sOms2O9AURiM3mpphguxQrvJ1bqCw+fUKtKhq/GP834Y5Q4vjC6PN\nrKFzWwHbruucK9z6fo4/PJECq32G3NkivYPR21l87SfLvLfP3Er3F8D6f8TZpVF6\nTr0nzMUhbCd82ynY8e2eimnkXrw5qKboVB2oF0RhXv3+NUmcXubDwCscqqRDMXV9\ntQzeXUcpFlF86ZlHoI9Bdcjg15vIpWsr4J4meuj5LBSLZqGvtNKS8cWkHBdcp+YJ\nZ+xkb3yLXYqQ2q0Fte7mYN5aK5mUT6FH4eW1EyEXBmGdJt/A3PUxrCzbusWA4BRG\nKq0xEDltrhv/JCcxqYZY/G9Bov57jlSZzDp0RrtrtZAPwaQfUuKf8YfzdN0ZrNdl\nm4Mame4CbJ7gnnDNyLh3+rDYqtxoNMNFzu6/NiXULpWEFF6vevqXzSLlHitrGS5I\nI/YuoexSVapplMtrBDzhrciPlMQaTZwLVlpNPHSJRQmmWWo9iio=\n=gO8z\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a265e5c6cece07076171d86aad3428550ae349d",
          "sha": "7a265e5c6cece07076171d86aad3428550ae349d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7a265e5c6cece07076171d86aad3428550ae349d"
        }
      ],
      "message": "node: Track last block that received a blockTip notification\n\nAlso signal m_tip_block_cv when StopRPC is called, for\nconsistency with g_best_block_cv. This is handled in\nStopRPC instead of OnRPCStopped() because the latter\nis deleted in a later commit.\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:09Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T16:16:08Z"
      },
      "sha": "f232eb925d29c9eb2a77621502a1b88e1328da73"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk0YzIxMDRkODk3NWZiOWE4OWUwNzBiZmQwMDdlMDA0MGI4ZGJjNzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/94c2104d8975fb9a89e070bfd007e0040b8dbc76",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/94c2104d8975fb9a89e070bfd007e0040b8dbc76",
      "tree": {
        "sha": "c1065950471aeaac0eec47495fda709d182c155b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c1065950471aeaac0eec47495fda709d182c155b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c1065950471aeaac0eec47495fda709d182c155b\nparent f232eb925d29c9eb2a77621502a1b88e1328da73\nauthor Sjors Provoost <sjors@sprovoost.nl> 1724664624 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941329 +0200\n\nAdd waitTipChanged to Mining interface\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBEACgkQV/+b28ww\nEAmy5hAAhltN7dBdBMg3RtimT2WKhTeqG3b876p5ItqaSxaA0RrmB2qJE6DxiXl4\nEMG6KiRESo/UzExM2Xozhv/YnCiltKObie9IYJGR0LvjPOdCYZ9hWdrmw5hISSSu\nHOcFdOehraifCDFxpLYuAr9oxNfhw0sCfCUTtwkpFVGBkCYvyPmbHC+RMFj7lV+Z\nnUwJmDAXGWDJ4mnfv53+8wyI398ImqLXTRBUgwgkpUcLhraBnTQFmfZhhD1OsmXt\nSjxEg5pw13UK0wXRikw1CMzkoZVundzzd1F7oWT3ecLButfKRYy4h+02MQigrUYi\nSNag7HSK9TTskl58upnouCLuOFrkPIm2ZECtKH8ufl4kc1l6ugzyabMMvqBzX4WX\nSP43YrUM1arFXMMDsMtlfD2QvdjKgfOEUTINbBpgE+9UJZmyMj7Dgzc4xTJ0bwh5\naSP8jRYI85AR08Iz165/CxouwFTgGCCMhJAYSDxmqxLsJv5ggxsDmHqs8rjoxgeP\nnWVkCT2hjr4l9iwyaxs/Q1RF1jNHlnRZy1fdk9o9HQCJumX7U/Jz7o8T2RqqWbvA\ntQEnpEb08h4t4nsYjTwGQIcOOe01YgKAqa97oGKGJiVwEne+R+wzufC6EPGMBiur\n1r40Gf00c3cTOfMAd2Pht/FZOKV/1AREB99YbN9wEYBv9Q0saDE=\n=pkGD\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f232eb925d29c9eb2a77621502a1b88e1328da73",
          "sha": "f232eb925d29c9eb2a77621502a1b88e1328da73",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f232eb925d29c9eb2a77621502a1b88e1328da73"
        }
      ],
      "message": "Add waitTipChanged to Mining interface\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:09Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T09:30:24Z"
      },
      "sha": "94c2104d8975fb9a89e070bfd007e0040b8dbc76"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZkNmM4NzY2MDBjYjhiMjE1NzM1MjRiYzQyODkxM2I3YjIzNTZiMjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fd6c876600cb8b21573524bc428913b7b2356b25",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fd6c876600cb8b21573524bc428913b7b2356b25",
      "tree": {
        "sha": "0c284af48ea7ea37f989a10c41bd5d063935774e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0c284af48ea7ea37f989a10c41bd5d063935774e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0c284af48ea7ea37f989a10c41bd5d063935774e\nparent 94c2104d8975fb9a89e070bfd007e0040b8dbc76\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720456321 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941329 +0200\n\nrpc: add test for waitforblock and waitfornewblock\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBEACgkQV/+b28ww\nEAksLA/9HbM5x46BatABRnKThG/KYpA0Twutc0HdydSGpq3Mjg+Yyy77yJ4kuCXv\nPIUlOKoZ6G4YEP9r0YfrR4fnAYgeo0FUUQJA6vOhWBRuDwSsqL0pqhLqH2whyHSg\nyyBZPpEd3r7D5IaRuqrvyfjnj3b6ingbpyTDoL1ADbbOG/6UX99K96J01hduOK38\nYn0s0GPdiwYzmuJbM5QUO04G8q775OqroDZMhK0Blj1L4X/rzGRuoLkBUYnww5OO\n88oRGRAB4yYEgI8LzbXuHGM20i4sBbCHxBHf5jVRL9seSHGS8OamW7RkZKzD6aaz\nePCX5i537WjzoAFVVy5FtjKRr88yk3oqJMztn1Jvh4q/6qJz7o86b3Lu5uUauKC+\nVkmMVphZ/o6lP6VkyJnJUWxyRutecz9GCTv6lbXYwMfLrenlebZySikUfEUMOTBX\nQBYLwcB5diZ6a5hd+9EFvKnGg49m4g0j8W4eNKdt1V9EvSKN4VixzdX0vxbQ2Lrf\nbI7WGpYzOd1/mbZYm7Vf8upbi9ZvHiW3HCN+5B6H5nTNtJbn7ViuEsi94shuk3nE\ny2kqrJPKWo1uZSUybIMWdH9qZnoOESTQfxCO6FITNJE+ctAyeknYDuQhUAlS3Zg/\nJwvMnHzD7bH1qEzVwKTat1G8mHmXRgzLXSAiXwfBcZ9yE12Yru8=\n=nrQ8\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/94c2104d8975fb9a89e070bfd007e0040b8dbc76",
          "sha": "94c2104d8975fb9a89e070bfd007e0040b8dbc76",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/94c2104d8975fb9a89e070bfd007e0040b8dbc76"
        }
      ],
      "message": "rpc: add test for waitforblock and waitfornewblock",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:09Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T16:32:01Z"
      },
      "sha": "fd6c876600cb8b21573524bc428913b7b2356b25"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk3MTIwY2IyNzhkOWNjODg3YmYyZGEwM2JlMmEwYmUxNzQzMzRlZWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/97120cb278d9cc887bf2da03be2a0be174334eec",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/97120cb278d9cc887bf2da03be2a0be174334eec",
      "tree": {
        "sha": "cc411be9b64127f3935a01bdaace187f95eba1a8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cc411be9b64127f3935a01bdaace187f95eba1a8"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cc411be9b64127f3935a01bdaace187f95eba1a8\nparent fd6c876600cb8b21573524bc428913b7b2356b25\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720456659 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941329 +0200\n\nrpc: fix waitfornewblock description\n\nThe waitforblock RPC method takes a hash argument and waits for that specific block.  The waitfornewblock waits for any new block. This commit fixes the documentation.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBEACgkQV/+b28ww\nEAkViRAAre8jTKLlsihqLQWJQzQLi/pMqKfnVuWO7AmK7+ygc05weBrm9oBHkNrZ\ndFHtZzX97VDwvyyu/HbSHH5CABw/RQD+mhtH/rSUWV6/9aPS0yOttcmZptYRJynd\nQiQCV5NkIXlwfmwtdnpAGoMQit2BjrWLfkJGdDmnsfoWMP0eH58MU2lhkh2HrCfE\nwJN+7vKVT30dR4l2odUcDAiU7wkmYwPJygR/7lP1yOhCK8tEeD2HjlFPIdzoiS6S\n4rt7SLjBZVAXQ+g/Qs3kSxF2Rvb+yjjLQgc2xp3N+MzmliFG4S8rHdpu7jTy4kql\nPEruxm/h53gXtTaV1g9lxW0XcB5duPmAd6n7UIRGTSuNfmLtKKpMVj/GJawtgVbj\nLkYTkYhU4RF+q//MtwoPbO8xnlcWOl6/rR0ojSIwXc/5di9Wr0CY4fIvg6CqMMQT\njrALy5T97/kfIkziFy1XyTbZpymQkYORl2D5MSDzUuZofaArO/zwCzNGYOJiNJFj\nfkdxurECj+rDWlsuNPr+rVk+FJBjaal9IebC6tgTRmHLwKiR8ETqPoMq685pJq+E\nQC74MRGM4q0TTWqT0mXM/Rq4Jo8CU2t0jos6ZLYJZb8fT7bJC1YceFrh9qjkbTSc\nk1HZla3c3JVYWiFRwtdusBK5aDX+Q5aT2lqPgDh2b52+ZkImE3U=\n=WluI\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fd6c876600cb8b21573524bc428913b7b2356b25",
          "sha": "fd6c876600cb8b21573524bc428913b7b2356b25",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fd6c876600cb8b21573524bc428913b7b2356b25"
        }
      ],
      "message": "rpc: fix waitfornewblock description\n\nThe waitforblock RPC method takes a hash argument and waits for that specific block.  The waitfornewblock waits for any new block. This commit fixes the documentation.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:09Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T16:37:39Z"
      },
      "sha": "97120cb278d9cc887bf2da03be2a0be174334eec"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI5MGJkMzIwNDc5MTliNzJmMjNlMjEwNThlODJhNzRiNzVmYmYxMDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/290bd32047919b72f23e21058e82a74b75fbf104",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/290bd32047919b72f23e21058e82a74b75fbf104",
      "tree": {
        "sha": "57fd6dbc8b6aa7757d705ea4ec231087becfc23f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/57fd6dbc8b6aa7757d705ea4ec231087becfc23f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 57fd6dbc8b6aa7757d705ea4ec231087becfc23f\nparent 97120cb278d9cc887bf2da03be2a0be174334eec\nauthor Sjors Provoost <sjors@sprovoost.nl> 1723542686 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941330 +0200\n\nrpc: recommend -rpcclienttimeout=0 for waitfor*\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBIACgkQV/+b28ww\nEAn07hAAiCS/GlLL1XLzvlH/DjdgrrqlHhGiH9Q6IYK+RINkysvKwQKnLXbg6xFM\nNpSLLJPFCXMZ/Bcga3W0EPQNZCf663zPE6ZA7DtR6wecvVuhKBc03ou3ljq+pUGW\nKGO2y94+Bg+4jkRiVJw+99eZxTJvrq21Gv1pxNJI1kfhBEgqeVk5JhO/kHVtxlDy\n7ffg7mCvmxr96sBqzN1dISrw2YnBJC2T3oqEOzZ1jQ+oZaRg36ewO2uVVCM9BZIa\npjVkXgUBLDhcsDb0NrnrsLfjVTeQbrCbWkAY9Y8ckUCF9tWvh/yeAUA54A4N9Cr6\nGfKDqqhDjX9rctwiusC99uynHNIfVHWDHuwidCU225vrX8UC1khGGToMqdZHJKwt\nG6tds2Z3c9ErfFdg2FZJBrmwhjz9L1fzsHs2ZnP9x8RwfrVeEhwTQXbfg4DJpVkM\ntnEO0klWnrf8tDH/QttnDxwgvfZOQeNyBjyLJFjNei4Z7iEk4LMde9Ru+VxAp8sg\n8HFBddwPzD6x6nABK5H8QS/0WrzJT/ga7YAVjjC5SbUpw5F1hZuUiDL7Ku/WmQ1I\nlsq9xAG5NYZuD8m1/21HISokY2Yu34y675HLBu2YB46OF2CV1ThF8ABvZCYeQ81+\n6lBeBxtmJAFvfLLwkis+nwVzdiHYHxgl06YcfvMVH4m7v/+QreQ=\n=H0nG\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/97120cb278d9cc887bf2da03be2a0be174334eec",
          "sha": "97120cb278d9cc887bf2da03be2a0be174334eec",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/97120cb278d9cc887bf2da03be2a0be174334eec"
        }
      ],
      "message": "rpc: recommend -rpcclienttimeout=0 for waitfor*",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:10Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-13T09:51:26Z"
      },
      "sha": "290bd32047919b72f23e21058e82a74b75fbf104"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNhNzZmYzk3MDI0NDI0NDdhZWU2ODYwNzAyNTI0YTlkMWVmZGE4NTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a76fc9702442447aee6860702524a9d1efda855",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3a76fc9702442447aee6860702524a9d1efda855",
      "tree": {
        "sha": "7b364410edb5376d32524a00a867d3911fe16118",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7b364410edb5376d32524a00a867d3911fe16118"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7b364410edb5376d32524a00a867d3911fe16118\nparent 290bd32047919b72f23e21058e82a74b75fbf104\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720456771 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941330 +0200\n\nrpc: check for negative timeout arg in waitfor*\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBIACgkQV/+b28ww\nEAlseRAAmd0lhdfGlxqKZpvdlb7bPylz9Mj2jfue2La+kiIbaqFQ1T8BZv4W34ji\n2+ZOZ3QQzp/RhfpFRDJFRv382nEITwRVdnKIoDSVHYxRj8suS1jEC+BFetB7FNDw\nNARyUnPxvYwmH5aLjurM4TLo9GXAHVo+tPMO89o9U1lAaNh/QN5+boU3AvmliowV\nqC9shjbfbCCI71/Us09j+GLZkr8N/jY0P0v/Jjd3uwitbzA3Np0ig5GTYjaxr/OV\nIwQw77mgbZDjPqroQ4bEgUAnuIaMrGpZW9a8tFvEUMBXoOkRoK+qxVzlp6tVHkbA\nkCYf2gXLCty36BxSFeV/ioIPuvnGvV8IfkUc2YlFx4CADzyhgyBq4igBv22peRqo\nCBVEP+Vg966ZtVJYXgXPNuc8mW8J48FH+uOOM2Ivo7ZsTjmjU2bX7hikGEcSDlQu\nT0GbZqlFsJqUyW5zWP4Ggg1wriQwgplAssbcsuJ98d6rriikRCI9v8BvYaR1B1BO\nm2uSOTaY55k+zXIAe9ARZ/inBzEkouK7dLhUfm21PfJU+xb1CfG8vSYI7GqVCslu\nWTtszjdp4D0aSS4BeWZX9NbVTYoDoJOAU4GWSO31nzvn2zFWSuMIhkzh6LwVnkI0\n/Ilr3lMgeDIKbx5Pxmp2yaIJIoN/ZRgdQEfmtCvLbjKBSGbISXE=\n=aphc\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/290bd32047919b72f23e21058e82a74b75fbf104",
          "sha": "290bd32047919b72f23e21058e82a74b75fbf104",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/290bd32047919b72f23e21058e82a74b75fbf104"
        }
      ],
      "message": "rpc: check for negative timeout arg in waitfor*",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:10Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T16:39:31Z"
      },
      "sha": "3a76fc9702442447aee6860702524a9d1efda855"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU0ODg4ZTlhMWM4NWUzNDFlZWM2YzlkM2I4YjkyODYwYTBkZTI5NjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/54888e9a1c85e341eec6c9d3b8b92860a0de2963",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/54888e9a1c85e341eec6c9d3b8b92860a0de2963",
      "tree": {
        "sha": "77520892a264265a30cc340e421cacf5010d92ed",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/77520892a264265a30cc340e421cacf5010d92ed"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 77520892a264265a30cc340e421cacf5010d92ed\nparent 3a76fc9702442447aee6860702524a9d1efda855\nauthor Sjors Provoost <sjors@sprovoost.nl> 1723459009 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941330 +0200\n\nReplace RPCNotifyBlockChange with waitTipChanged()\n\nThis refactoring commit uses the newly introduced waitTipChanged mining interface method to replace the RPCNotifyBlockChange mechanism.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBIACgkQV/+b28ww\nEAmTyQ/9EYlGADWT3otSdDuTZhev0U6/tHg7Lv12fYTU8HtiwH3/9z00QyigXk2x\n4UZZb/OTDsbBZVtPWAr0LdBQlGBnCdYBz8TXMkpFKwPeOrT5+wNi2syGGcX95QRq\nlo3zXJNFHmzGZPVWaHCRM0kRiwff2cqVLYBwHhpa2Zzb/WfQ3B+14X9QUylxk1Fl\ngZ7LY2fficZk1WUgQk2TGwQkOHM5/p4eNgM/dJKxSskIafaBqlnFJGjKdqJ5o4uw\ni/bhKPp5cV4svVtLSEKHlKOsrWespvbZ0EXMEYYU42OBLozwVcr3ACIXh3adE6yI\nI2dOvkRXjbd/LroE/pnPM8u/EnrrssnlFAoGuPLteYV86EvXXoC64Q8BfJ6Bs2wt\nDFsjmfYOrcgYdgqYQPnvJDI9ubl05nQnCP/Q2P8KNGcKa1xnU1E0wlxFCF18mwux\nnMtuhw7I9GHBiZSZQEr2LshpSfTuxMGpNlltL3ZfDiLHkQxtg/AKwAMyZgbn9x+G\nLe7EHOu8recQMwHsBsIy83Dmm7E4Za1cA4Cc56OSKXp49mUjte50twT/Ioym+cIb\nFnT2dCnei0rvXS2Hz7lrchBt1qDUp1KHU3ejmwbluUW0wgSO1ZjEwNCDAvdTWQFx\np7qNhAiyaX3Av7AyTdhypAscijiGpDSDCBirdzlh7GgGHwiG54I=\n=gpqi\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a76fc9702442447aee6860702524a9d1efda855",
          "sha": "3a76fc9702442447aee6860702524a9d1efda855",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3a76fc9702442447aee6860702524a9d1efda855"
        }
      ],
      "message": "Replace RPCNotifyBlockChange with waitTipChanged()\n\nThis refactoring commit uses the newly introduced waitTipChanged mining interface method to replace the RPCNotifyBlockChange mechanism.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:10Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-12T10:36:49Z"
      },
      "sha": "54888e9a1c85e341eec6c9d3b8b92860a0de2963"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY2YWFjNmEzODViMGIyODBhYTQzYjI1MjQzZWUxNDY4NzI2ZTM0MTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/66aac6a385b0b280aa43b25243ee1468726e3410",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/66aac6a385b0b280aa43b25243ee1468726e3410",
      "tree": {
        "sha": "68e9134abedf2be028af625debc9c066eefd05d4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/68e9134abedf2be028af625debc9c066eefd05d4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 68e9134abedf2be028af625debc9c066eefd05d4\nparent 54888e9a1c85e341eec6c9d3b8b92860a0de2963\nauthor Sjors Provoost <sjors@sprovoost.nl> 1724689555 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941330 +0200\n\nRemove unused CRPCSignals\n\nThey are no longer used for anything since RPCNotifyBlockChange was replaced with waitTipChanged() from the mining interface.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBIACgkQV/+b28ww\nEAlZyw//XgDVLLjmAVEMU7X7XlOkvW1+CrQp8fsDGkCE26pTllPShg67CCi/yIW3\nJQCeunqCDO3PkPZ3vQhc2aXZCdI2g16n1RXUayUp9+oM0sAcz0pTX453F/ghcGr1\nDFi0Pf9hvJuxrAunvgCZOlO++8LpCSuNWKCgBPv0BY0GbYgbv0wq+z8O6WOftFbQ\nuwNA3MRiV9VzxXnukGM5UG6Sz3N/s12/qqTOnB24Kcg/PT7pL6KOHFO6MS96xD87\nL5apMFusjNnEjmGOSstlGtL5240fRddoUharuMaOX6fZfX3rv6cJ5pqLLQMYpmI4\n7v08/EYXrwKFf2WWxA2Nm/twadT03ihsriE33v9L9xPbD2AdSfs2qdkB9eaeHVdW\ne2ESu4TIaTkloDKJAyfEroQP7+R65Pq4ufxmHEbDhj5DeHGUrlFqyPFbW/oWjkKd\n0RfNXCX76/J2CO6irrHQAL8asgm5E8ExuQLlMn/y/qC0Hgd/uv4ebnAZCImaaswc\nqiKPwPGeMtWI9frTeIqUA180V3xlyuLuFLozXBAS4wFGAuXTo3Tnf2bFzMS71ssl\nPcVyKgsxl9vVf1op9dhTg4ptV0HBgmnG9YCyVY5KRKsB4PUeYURDdztM12QAmIBx\n020XiWK1wb/a3HJf+Eq3Vu3jzOf47ZP1Y17K0p/NmDDb7DuJETw=\n=bOwQ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/54888e9a1c85e341eec6c9d3b8b92860a0de2963",
          "sha": "54888e9a1c85e341eec6c9d3b8b92860a0de2963",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/54888e9a1c85e341eec6c9d3b8b92860a0de2963"
        }
      ],
      "message": "Remove unused CRPCSignals\n\nThey are no longer used for anything since RPCNotifyBlockChange was replaced with waitTipChanged() from the mining interface.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:10Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T16:25:55Z"
      },
      "sha": "66aac6a385b0b280aa43b25243ee1468726e3410"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE5NjAyNTUxMTg4MDAwNzlkZDZiZDUzMmEyODRhM2Q0ZGZiYzY2Mzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a960255118800079dd6bd532a284a3d4dfbc6639",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a960255118800079dd6bd532a284a3d4dfbc6639",
      "tree": {
        "sha": "f663ea729e626380dbaa2de98c7ed690ae1777ec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f663ea729e626380dbaa2de98c7ed690ae1777ec"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f663ea729e626380dbaa2de98c7ed690ae1777ec\nparent 66aac6a385b0b280aa43b25243ee1468726e3410\nauthor Ryan Ofsky <ryan@ofsky.org> 1724690116 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941330 +0200\n\nrpc: use waitTipChanged for longpoll\n\nThis removes the last remaining use of g_best_block by the RPC.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBIACgkQV/+b28ww\nEAmJOQ//TElLnDBqD/8ZCUSi1fHDs1IfKR/mhDY71Jv1GiFUADWVTERRqV5Ywgqg\n9H48dISHbPlcd2o7x6Qe79KXPBQIeH2Wj6/LKL1yurHLkaQXCq8oNI39ySnC5wo+\npZMoX2vvJ5n7Fgf82WUbrG3yxNzOLVL/tA6smvyZQUtolS2brANyPtBpiXuL/oMv\nlp44xg7t7ndZrE5nZVPY5m06KKDIP/+FSEr6+/zEOCOstw9ACsXSKOfSaCJ5tCiC\n2XoVFBMKngHvOv1rUOrrm/J1opkkFWVumRe7IQzIMhTsPIwr8WajN60rzjTqctqP\n33RNF22ormvhk5q12mPMfrZ7kTlaPce/IpwRh4Cz/bG9iwVKS325vacEGr8eHF2g\nQQ/fuGCe2C0JQqVQyJYOKniBKqAHcAG6BK8A0MrhfojWNULrz2zKyDL7qxPsQv45\nXF2OEF+TFSRexz1B7I2JIFKCnSOI39SS0uZbZt/e8mUDIL1x0BYnsUn9nvYA0M71\nsZc5qCFseQW/iGzBagYW2LYLbDVo3Y3Fdml0rCT3BftMoNuUKI+Wm7lW423ikfWn\nJKjtqjarYg0RcA0aaw/NRPnIp8lFeBNozl2hEnsyWtLco4lZKBWP5cqHIE9+vdF8\nIpMDiesYANaWk+Ff1/f6O5poKB9WERQIEV26/QG74dyj583xCE4=\n=LGXk\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/66aac6a385b0b280aa43b25243ee1468726e3410",
          "sha": "66aac6a385b0b280aa43b25243ee1468726e3410",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/66aac6a385b0b280aa43b25243ee1468726e3410"
        }
      ],
      "message": "rpc: use waitTipChanged for longpoll\n\nThis removes the last remaining use of g_best_block by the RPC.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:10Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-08-26T16:35:16Z"
      },
      "sha": "a960255118800079dd6bd532a284a3d4dfbc6639"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU4ZWMzOTc4NGRhYzFhNTY0ZGI0YTk2MmE3NTk5NGU1YmI4MzJiYzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "tree": {
        "sha": "4a2fbef26856ee713e79f13fe5427d2d8c86f959",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4a2fbef26856ee713e79f13fe5427d2d8c86f959"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4a2fbef26856ee713e79f13fe5427d2d8c86f959\nparent a960255118800079dd6bd532a284a3d4dfbc6639\nauthor Ryan Ofsky <ryan@ofsky.org> 1724689687 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724941330 +0200\n\nRemove unused g_best_block\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbQhBMACgkQV/+b28ww\nEAkUMw//YkZ9Xr2YrA6jlHGEUf3srtl8fVfAFWF5cX3auIf6othuXcJh4alXoJd2\np7FHUw0scNNW73stigRMLsUKBclahKk4s3vSJgAlDtm7eICDYM9zWW4LypxvfQ6i\ndbB6cCacaQAii2mC9wJqjDAAUK27pqK7jQg17sQK+JrS+8egHHrkf9HcjHZY0i6T\nVzghfCgADt+a76PniPgqIBkO8b6uSxLTmxisq5uBmv9gTN0WjtB2DD9R2tnCWJKm\nsxoZ+HWXgOYOfyNa87+RU8/XK75EKxlFpx9uw/biplGLeQpofmQBiSsJ5wK/iZ2M\nWg+UmQ7GqV52PU6qFJuuGLYnZtQxkGq0iq25q6Tud6uYZNsFrMwL8EA9TsAeEh1F\nn0tI11ncmjbICluGvMsZyXtiZ2aowOpaxBNJT/jUFBeWbkhojF+7mWkiBN2f/ixk\n4Fk3//tkbUMWC40baxtbpPDXfa34fbohyV3QKA3lNRK0XGfMJnMbIQIQ39xP0Vxu\n6EwsGwuAgLLX68Uy88IwbXXoaXtt1JVtS9LVzvRN6M5zoQPp/9smVrJr3pOcQGQ9\nnToioSKXBhmlacVqBqQBeHB6Kfhe48DNjOw/W/gX5u4df7R05pxzq8zB1cv2Jkq7\ntBUi6vQbUsVkCQ1rXUeVk2LmDtVKbh74r/Rw2HR/uP7fFq8rXrk=\n=Xjdd\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a960255118800079dd6bd532a284a3d4dfbc6639",
          "sha": "a960255118800079dd6bd532a284a3d4dfbc6639",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a960255118800079dd6bd532a284a3d4dfbc6639"
        }
      ],
      "message": "Remove unused g_best_block",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-29T14:22:10Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-08-26T16:28:07Z"
      },
      "sha": "e8ec39784dac1a564db4a962a75994e5bb832bc9"
    },
    {
      "event": "commented",
      "id": 2317861428,
      "node_id": "IC_kwDOABII586KJ8I0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2317861428",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T14:23:30Z",
      "updated_at": "2024-08-29T14:24:04Z",
      "author_association": "MEMBER",
      "body": "Based on IRC discussion today it appears there was no need to keep `src/Makefile.am`, so I dropped that: 1b2cdef410abb7fa900c52809ebca249cdaa099c -> 02272716dce292618453d0407988118bc5f07140.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2317861428",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14063327362,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANGPViC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14063327362",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T14:23:30Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1673937990",
      "pull_request_review_id": 2171768079,
      "id": 1673937990,
      "node_id": "PRRC_kwDOABII585jxkRG",
      "diff_hunk": "@@ -860,6 +860,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "482a5fd48d494f44f48209956c77ec1bdb5663f5",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I changed this in the last push, previously it would always wait for one second each interrupt \"round\" even if the requested `timeout` was shorter.",
      "created_at": "2024-07-11T12:35:15Z",
      "updated_at": "2024-07-11T12:36:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1673937990",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1673937990"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 879,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691480674",
      "pull_request_review_id": 2199367930,
      "id": 1691480674,
      "node_id": "PRRC_kwDOABII585k0fJi",
      "diff_hunk": "@@ -39,6 +40,15 @@ class Mining\n     //! Returns the hash for the tip of this chain\n     virtual std::optional<uint256> getTipHash() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 19,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (4554b3b1adf678e17d479d72738f4f2089971c4a)\r\n\r\nNot important, but it could be good to return [`BlockKey`](https://github.com/bitcoin/bitcoin/blob/5d280130446d57d653c749005a2e363265d87686/src/interfaces/chain.h#L44-L48) struct here instead of std::pair. Could also be good to provide a more consistent interface instead of separate getTipHash() and getTipHeight() functions:\r\n\r\n```c++\r\nvirtual BlockKey getTip() = 0;\r\nvirtual BlockKey waitTipChanged(MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;\r\n```\r\n\r\nIf you do use `BlockKey` here would suggest moving it from `interfaces/chain.h` to `interfaces/types.h`. Also I think I a name like `BlockId` or `BlockRef` would be better than `BlockKey` in this context, given other implications ofthe word \"key\". But feel free to move/rename/reuse BlockKey from chain.h here, or not.",
      "created_at": "2024-07-25T13:49:46Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691480674",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691480674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691492745",
      "pull_request_review_id": 2199367930,
      "id": 1691492745,
      "node_id": "PRRC_kwDOABII585k0iGJ",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (4554b3b1adf678e17d479d72738f4f2089971c4a)\r\n\r\nI think caller should be required to pass in the previous hash to avoid race conditions. Otherwise, the caller could initiate a `waitTipChanged` call waiting for the tip to change, and then it could change before this line is executed, and then the `previous_hash` variable will contain the new tip hash, and the function won't return until the tip changes a second time. This problem wouldn't happen if the caller were required to pass in the block hash that they think is the current one.",
      "created_at": "2024-07-25T13:57:02Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691492745",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691492745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 866,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691499856",
      "pull_request_review_id": 2199367930,
      "id": 1691499856,
      "node_id": "PRRC_kwDOABII585k0j1Q",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));\n+                g_best_block_cv.wait_until(lock, check_time);\n+                if (g_best_block != previous_hash) break;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (4554b3b1adf678e17d479d72738f4f2089971c4a)\r\n\r\nIf you adopt suggestion above for caller to pass in the previous_hash value, you will want to delete this line and add `g_best_block == previous_hash &&` to the while loop condition so this function does not block if the hash is already different when it is called.",
      "created_at": "2024-07-25T14:01:37Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691499856",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691499856"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691546813",
      "pull_request_review_id": 2199367930,
      "id": 1691546813,
      "node_id": "PRRC_kwDOABII585k0vS9",
      "diff_hunk": "@@ -505,6 +513,56 @@ def _test_stopatheight(self):\n         self.start_node(0)\n         assert_equal(self.nodes[0].getblockcount(), HEIGHT + 7)\n \n+    def _test_waitfornewblock(self):\n+        self.log.info(\"Test waitfornewblock\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PInterface())\n+\n+        current_height = node.getblock(node.getbestblockhash())['height']\n+        current_hash = node.getblock(node.getbestblockhash())['hash']\n+\n+        # Create a fork somewhere below our current height, invalidate and\n+        # then reconsider the longest chain.\n+        #\n+        fork_height = current_height - 100 # choose something vaguely near our tip\n+        fork_hash = node.getblockhash(fork_height)\n+        fork_block = node.getblock(fork_hash)\n+\n+        b1 = self.solve_and_send_block(peer, int(fork_hash, 16), fork_height+1, fork_block['time'] + 1)\n+        b2 = self.solve_and_send_block(peer, b1.sha256, fork_height+2, b1.nTime + 1)\n+\n+        node.invalidateblock(b2.hash)\n+        node.reconsiderblock(b2.hash)\n+\n+        assert_equal(\n+            node.waitfornewblock(timeout=2)['hash'],\n+            current_hash)",
      "path": "test/functional/rpc_blockchain.py",
      "position": null,
      "original_position": 49,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "a18cb7adf192bae481c879fe865f1c159b2b8622",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add test for waitforblock and waitfornewblock\" (a18cb7adf192bae481c879fe865f1c159b2b8622)\r\n\r\nI don't think I understand what this test is checking for. Maybe there could be a comment that describes what the test setup is doing what a failed result might look like. It seems like it is just creating a small fork and then invalidating the fork tip, so it shouldn't affect the most work tip or current chain. I would expect to see wait_until call after the invalidateblock call which verifies it has the intended effect. Also the 2 millisecond timeout seems small so if this is supposed to wait for something it doesn't seem like it waiting very long.\r\n\r\nSame comments also apply to the  _test_waitforblock test below, and maybe it would be good to dedupe the test setup shared by these functions, moving it into a helper method they both could call.",
      "created_at": "2024-07-25T14:25:46Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691546813",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691546813"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 537,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 539,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691555861",
      "pull_request_review_id": 2199367930,
      "id": 1691555861,
      "node_id": "PRRC_kwDOABII585k0xgV",
      "diff_hunk": "@@ -255,7 +255,7 @@ void RPCNotifyBlockChange(const CBlockIndex* pindex)\n static RPCHelpMan waitfornewblock()\n {\n     return RPCHelpMan{\"waitfornewblock\",\n-                \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+                \"\\nWaits for any new block and returns useful info about it.\\n\"",
      "path": "src/rpc/blockchain.cpp",
      "position": 50,
      "original_position": 5,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "e2a1347db07933d1c6e40ab45f2ca4c56c691fed",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: fix waitfornewblock description\" (e2a1347db07933d1c6e40ab45f2ca4c56c691fed)\r\n\r\nThis is a good documentation fix, but as described previously this waitfornewblock interface is inherently racy. Ideally it would accept an `current_block` option or argument, and return as soon as the tip is not not pointing to that block. This could be something to add in a followup PR, though, because it is not directly relevant to this one.\r\n",
      "created_at": "2024-07-25T14:30:54Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691555861",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691555861"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 241,
      "original_line": 241,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691559189",
      "pull_request_review_id": 2199367930,
      "id": 1691559189,
      "node_id": "PRRC_kwDOABII585k0yUV",
      "diff_hunk": "@@ -427,17 +427,12 @@ static void registerSignalHandler(int signal, void(*handler)(int))\n }\n #endif\n \n-static boost::signals2::connection rpc_notify_block_change_connection;\n static void OnRPCStarted()\n {\n-    rpc_notify_block_change_connection = uiInterface.NotifyBlockTip_connect(std::bind(RPCNotifyBlockChange, std::placeholders::_2));\n }\n \n static void OnRPCStopped()\n {\n-    rpc_notify_block_change_connection.disconnect();\n-    RPCNotifyBlockChange(nullptr);\n-    g_best_block_cv.notify_all();",
      "path": "src/init.cpp",
      "position": 23,
      "original_position": 14,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (9d3b07526110a842c9592425b89785e688a8f46c)\r\n\r\ng_best_block_cv still exists, so I don't think you should delete this line\r\n\r\nCan move it to the place this function is called when this function is deleted in the next commit.",
      "created_at": "2024-07-25T14:32:51Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691559189",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691559189"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 440,
      "original_line": 440,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691564281",
      "pull_request_review_id": 2199367930,
      "id": 1691564281,
      "node_id": "PRRC_kwDOABII585k0zj5",
      "diff_hunk": "@@ -324,14 +314,19 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n     CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    block.hash = CHECK_NONFATAL(miner.getTipHash()).value();\n+    block.height = CHECK_NONFATAL(miner.getTipHeight()).value();\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        auto res = timeout ? miner.waitTipChanged(std::chrono::milliseconds(timeout)) : miner.waitTipChanged();",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (9d3b07526110a842c9592425b89785e688a8f46c)\r\n\r\nShould pass `block.hash` as `waitTipChanged` argument here to avoid race condition (see earlier suggestion)",
      "created_at": "2024-07-25T14:35:43Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691564281",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691564281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527845",
      "pull_request_review_id": 2232637802,
      "id": 1713527845,
      "node_id": "PRRC_kwDOABII585mIlwl",
      "diff_hunk": "@@ -39,6 +40,15 @@ class Mining\n     //! Returns the hash for the tip of this chain\n     virtual std::optional<uint256> getTipHash() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 19,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": 1691480674,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`getTip()` and `waitTipChanged()` now both return `BlockRef`.",
      "created_at": "2024-08-12T10:47:41Z",
      "updated_at": "2024-08-12T10:47:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713527845",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527845"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527921",
      "pull_request_review_id": 2232637936,
      "id": 1713527921,
      "node_id": "PRRC_kwDOABII585mIlxx",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": 1691492745,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. I also simplified the `waitfornewblock` (etc) RPC call to just call getTip() and then pass that into `waitTipChanged`. That gets rid of `struct CUpdatedBlock`.",
      "created_at": "2024-08-12T10:47:45Z",
      "updated_at": "2024-08-12T10:47:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713527921",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527921"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 866,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527986",
      "pull_request_review_id": 2232638042,
      "id": 1713527986,
      "node_id": "PRRC_kwDOABII585mIlyy",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));\n+                g_best_block_cv.wait_until(lock, check_time);\n+                if (g_best_block != previous_hash) break;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": 1691499856,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-12T10:47:48Z",
      "updated_at": "2024-08-12T10:47:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713527986",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527986"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528130",
      "pull_request_review_id": 2232638308,
      "id": 1713528130,
      "node_id": "PRRC_kwDOABII585mIl1C",
      "diff_hunk": "@@ -505,6 +513,56 @@ def _test_stopatheight(self):\n         self.start_node(0)\n         assert_equal(self.nodes[0].getblockcount(), HEIGHT + 7)\n \n+    def _test_waitfornewblock(self):\n+        self.log.info(\"Test waitfornewblock\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PInterface())\n+\n+        current_height = node.getblock(node.getbestblockhash())['height']\n+        current_hash = node.getblock(node.getbestblockhash())['hash']\n+\n+        # Create a fork somewhere below our current height, invalidate and\n+        # then reconsider the longest chain.\n+        #\n+        fork_height = current_height - 100 # choose something vaguely near our tip\n+        fork_hash = node.getblockhash(fork_height)\n+        fork_block = node.getblock(fork_hash)\n+\n+        b1 = self.solve_and_send_block(peer, int(fork_hash, 16), fork_height+1, fork_block['time'] + 1)\n+        b2 = self.solve_and_send_block(peer, b1.sha256, fork_height+2, b1.nTime + 1)\n+\n+        node.invalidateblock(b2.hash)\n+        node.reconsiderblock(b2.hash)\n+\n+        assert_equal(\n+            node.waitfornewblock(timeout=2)['hash'],\n+            current_hash)",
      "path": "test/functional/rpc_blockchain.py",
      "position": null,
      "original_position": 49,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "a18cb7adf192bae481c879fe865f1c159b2b8622",
      "in_reply_to_id": 1691546813,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't fully understand the original test either. Will look into it later.",
      "created_at": "2024-08-12T10:47:57Z",
      "updated_at": "2024-08-12T10:47:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713528130",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528130"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 537,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 539,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528797",
      "pull_request_review_id": 2232639285,
      "id": 1713528797,
      "node_id": "PRRC_kwDOABII585mIl_d",
      "diff_hunk": "@@ -255,7 +255,7 @@ void RPCNotifyBlockChange(const CBlockIndex* pindex)\n static RPCHelpMan waitfornewblock()\n {\n     return RPCHelpMan{\"waitfornewblock\",\n-                \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+                \"\\nWaits for any new block and returns useful info about it.\\n\"",
      "path": "src/rpc/blockchain.cpp",
      "position": 50,
      "original_position": 5,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "e2a1347db07933d1c6e40ab45f2ca4c56c691fed",
      "in_reply_to_id": 1691555861,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I made a note to either add that argument in this PR or make a followup. ",
      "created_at": "2024-08-12T10:48:28Z",
      "updated_at": "2024-08-12T10:48:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713528797",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 241,
      "original_line": 241,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528958",
      "pull_request_review_id": 2232639529,
      "id": 1713528958,
      "node_id": "PRRC_kwDOABII585mImB-",
      "diff_hunk": "@@ -427,17 +427,12 @@ static void registerSignalHandler(int signal, void(*handler)(int))\n }\n #endif\n \n-static boost::signals2::connection rpc_notify_block_change_connection;\n static void OnRPCStarted()\n {\n-    rpc_notify_block_change_connection = uiInterface.NotifyBlockTip_connect(std::bind(RPCNotifyBlockChange, std::placeholders::_2));\n }\n \n static void OnRPCStopped()\n {\n-    rpc_notify_block_change_connection.disconnect();\n-    RPCNotifyBlockChange(nullptr);\n-    g_best_block_cv.notify_all();",
      "path": "src/init.cpp",
      "position": 23,
      "original_position": 14,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": 1691559189,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I moved it to `StopRPC()`.",
      "created_at": "2024-08-12T10:48:36Z",
      "updated_at": "2024-08-12T10:48:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713528958",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528958"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 440,
      "original_line": 440,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713529075",
      "pull_request_review_id": 2232639723,
      "id": 1713529075,
      "node_id": "PRRC_kwDOABII585mImDz",
      "diff_hunk": "@@ -324,14 +314,19 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n     CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    block.hash = CHECK_NONFATAL(miner.getTipHash()).value();\n+    block.height = CHECK_NONFATAL(miner.getTipHeight()).value();\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        auto res = timeout ? miner.waitTipChanged(std::chrono::milliseconds(timeout)) : miner.waitTipChanged();",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": 1691564281,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-12T10:48:42Z",
      "updated_at": "2024-08-12T10:48:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713529075",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713529075"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713879417",
      "pull_request_review_id": 2233198217,
      "id": 1713879417,
      "node_id": "PRRC_kwDOABII585mJ7l5",
      "diff_hunk": "@@ -860,6 +860,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "482a5fd48d494f44f48209956c77ec1bdb5663f5",
      "in_reply_to_id": 1673937990,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (3435d7dd430559abffc964c163a2ae73febd99d1)\r\n\r\n> I changed this in the last push, previously it would always wait for one second each interrupt \"round\" even if the requested `timeout` was shorter.\r\n\r\nThis doesn't seem right. If timeout is 1500ms and the block never changes, it looks like this will wait 1000ms+1000ms instead of 1000ms+500ms. I'm also concerned about the `deadline = now() + timeout` assignment above because it seems like that will be an overflowed value when timeout is `MillisecondsDouble::max()` so the while loop condition might be invalid. I fed this to chatgpt and it suggested the following which seems a bit cleaner & safer:\r\n\r\n\r\n```c++\r\nauto deadline = (timeout != std::chrono::duration::max()) \r\n    ? std::make_optional(std::chrono::steady_clock::now() + timeout)\r\n    : std::nullopt;\r\n\r\nWAIT_LOCK(g_best_block_mutex, lock);\r\nwhile (g_best_block == current_tip.hash && !chainman().m_interrupt) {\r\n    auto now = std::chrono::steady_clock::now();\r\n    auto check_time = now + MillisecondsDouble(1000);\r\n    if (deadline) {\r\n        if (now >= *deadline) {\r\n            break;\r\n        }\r\n        check_time = std::min(*deadline, check_time);\r\n    }\r\n    g_best_block_cv.wait_until(lock, check_time);\r\n}\r\n\r\n```\r\n",
      "created_at": "2024-08-12T14:24:12Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713879417",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713879417"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 879,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713960772",
      "pull_request_review_id": 2233198217,
      "id": 1713960772,
      "node_id": "PRRC_kwDOABII585mKPdE",
      "diff_hunk": "@@ -36,8 +38,18 @@ class Mining\n     //! Returns whether IBD is still in progress.\n     virtual bool isInitialBlockDownload() = 0;\n \n-    //! Returns the hash for the tip of this chain\n-    virtual std::optional<uint256> getTipHash() = 0;\n+    //! Returns the hash and height for the tip of this chain\n+    virtual std::optional<BlockRef> getTip() = 0;\n+\n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual BlockRef waitTipChanged(BlockRef current_tip, MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 28,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "dcf984b055a367facf7704eb8055619d6fe64a55",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (3435d7dd430559abffc964c163a2ae73febd99d1)\r\n\r\nI think it would be slightly better for `current_tip` to just be a block hash, rather than hash and height, because the height value is unused, and a accepting height might create misleading impression that this method could be called to wait for a height to be reached.",
      "created_at": "2024-08-12T15:08:04Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713960772",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713960772"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713965000",
      "pull_request_review_id": 2233198217,
      "id": 1713965000,
      "node_id": "PRRC_kwDOABII585mKQfI",
      "diff_hunk": "@@ -277,16 +259,16 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);\n     }",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (d919a230563bd2efee1fccb83194b43f436781ef)\r\n\r\nIt seems like the implementation of the this loop always waits for the timeout to be reached, and doesn't exit early if the tip did change. So if timeout is 0 it will just infinite loop.\r\n\r\nI think if it can be simplified to just:\r\n\r\n```c++\r\n    if (IsRPCRunning()) {\r\n        block = timeout \r\n            ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout))\r\n            : miner.waitTipChanged(block);\r\n    }\r\n```\r\n\r\nAnd you could get rid of the deadline variable.\r\n\r\n\r\n",
      "created_at": "2024-08-12T15:10:47Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713965000",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713965000"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 268,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 270,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713997278",
      "pull_request_review_id": 2233198217,
      "id": 1713997278,
      "node_id": "PRRC_kwDOABII585mKYXe",
      "diff_hunk": "@@ -324,14 +306,14 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (d919a230563bd2efee1fccb83194b43f436781ef)\r\n\r\nPassing timeout parameter doesn't seem right, because it could wait too long. For example if timeout is 10 seconds, and tip changed after 8 seconds but did not match expected block hash, the next wait call will wait 10 seconds instead of 2 seconds.\r\n\r\nMight be better to replace with:\r\n\r\n```c++\r\nwhile (IsRPCRunning()) {\r\n    auto now = timeout ? std::chrono::steady_clock::now() : std::chrono::steady_clock::time_point::min();\r\n    if (block.hash == hash || now > deadline) break;\r\n    block = timeout ? miner.waitTipChanged(block, deadline - now) : miner.waitTipChanged(block);\r\n}\r\n```",
      "created_at": "2024-08-12T15:31:09Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713997278",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713997278"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714002168",
      "pull_request_review_id": 2233198217,
      "id": 1714002168,
      "node_id": "PRRC_kwDOABII585mKZj4",
      "diff_hunk": "@@ -372,15 +354,16 @@ static RPCHelpMan waitforblockheight()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.height >= height) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (d919a230563bd2efee1fccb83194b43f436781ef)\r\n\r\nSeems like this has same problem as waitforblock where waitTipChanged could wait too long because it is called with wrong timeout value. Might be better as:\r\n\r\n```c++\r\nwhile (IsRPCRunning()) {\r\n    auto now = timeout ? std::chrono::steady_clock::now() : std::chrono::steady_clock::time_point::min();\r\n    if (block.height >= height || now > deadline) break;\r\n    block = timeout ? miner.waitTipChanged(block, deadline - now) : miner.waitTipChanged(block);\r\n}\r\n```",
      "created_at": "2024-08-12T15:34:07Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1714002168",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714002168"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 364,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714902269",
      "pull_request_review_id": 2234901100,
      "id": 1714902269,
      "node_id": "PRRC_kwDOABII585mN1T9",
      "diff_hunk": "@@ -277,16 +259,16 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);\n     }",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": 1713965000,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, this should not have been a while loop. I reproduced the infinite loop here.",
      "created_at": "2024-08-13T08:39:25Z",
      "updated_at": "2024-08-13T08:39:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1714902269",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714902269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 268,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 270,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013521",
      "pull_request_review_id": 2235089228,
      "id": 1715013521,
      "node_id": "PRRC_kwDOABII585mOQeR",
      "diff_hunk": "@@ -372,15 +354,16 @@ static RPCHelpMan waitforblockheight()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.height >= height) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": 1714002168,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed (in the same way as `waitforblock`)",
      "created_at": "2024-08-13T09:52:54Z",
      "updated_at": "2024-08-13T09:52:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1715013521",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013521"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 364,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013631",
      "pull_request_review_id": 2235089426,
      "id": 1715013631,
      "node_id": "PRRC_kwDOABII585mOQf_",
      "diff_hunk": "@@ -324,14 +306,14 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": 1713997278,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed, though in a slightly different way.",
      "created_at": "2024-08-13T09:52:59Z",
      "updated_at": "2024-08-13T09:52:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1715013631",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013631"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013711",
      "pull_request_review_id": 2235089541,
      "id": 1715013711,
      "node_id": "PRRC_kwDOABII585mOQhP",
      "diff_hunk": "@@ -36,8 +38,18 @@ class Mining\n     //! Returns whether IBD is still in progress.\n     virtual bool isInitialBlockDownload() = 0;\n \n-    //! Returns the hash for the tip of this chain\n-    virtual std::optional<uint256> getTipHash() = 0;\n+    //! Returns the hash and height for the tip of this chain\n+    virtual std::optional<BlockRef> getTip() = 0;\n+\n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual BlockRef waitTipChanged(BlockRef current_tip, MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 28,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "dcf984b055a367facf7704eb8055619d6fe64a55",
      "in_reply_to_id": 1713960772,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-13T09:53:02Z",
      "updated_at": "2024-08-13T09:53:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1715013711",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013711"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719929110",
      "pull_request_review_id": 2242860642,
      "id": 1719929110,
      "node_id": "PRRC_kwDOABII585mhAkW",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 15,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nNot sure \"in case of race condition\" actually explains this. Would suggest changing this to:\r\n\r\n- `current_tip` - block hash compared against the current chain tip. Function waits for the chain tip to change if this matches, otherwise it returns right away.",
      "created_at": "2024-08-16T14:32:47Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719929110",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719929110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719939574",
      "pull_request_review_id": 2242860642,
      "id": 1719939574,
      "node_id": "PRRC_kwDOABII585mhDH2",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 18,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nThink it would  be simpler to say \"returns hash and height of the current chain tip after this call.\"\r\n\r\nIt seems potentially misleading to refer to a \"previous\" tip here because that sounds like this could sometimes return an old block hash. And it's a little confusing to refer to a \"new \"tip in the case where this function just returns immediately and there no interruption or wait or timeout.",
      "created_at": "2024-08-16T14:39:18Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719939574",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719939574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 49,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719963458",
      "pull_request_review_id": 2242860642,
      "id": 1719963458,
      "node_id": "PRRC_kwDOABII585mhI9C",
      "diff_hunk": "@@ -870,6 +870,30 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while ((g_best_block == uint256() || g_best_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                const MillisecondsDouble remaining{deadline - now};\n+                const auto interval{std::min(remaining, tick)};\n+                g_best_block_cv.wait_until(lock, now + interval);\n+                // Obtaining the height here using chainman().ActiveChain().Tip()->nHeight\n+                // would result in a deadlock, because UpdateTip requires holding cs_main.",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nI think this comment is only warning about a small part of a bigger danger. It's not just unsafe to obtain the height here but unsafe to acquire cs_main anywhere in this code block, even after the while loop.\r\n\r\nWould suggest dropping this comment and instead adding a simpler comment above LOCK(::cs_main) that says \r\n\"Must release g_best_block_mutex before locking cs_main, to avoid deadlocks.\"\r\n\r\nA comment like that seems more likely to prevent deadlocks generally in this function.",
      "created_at": "2024-08-16T14:57:42Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719963458",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719963458"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 889,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719972779",
      "pull_request_review_id": 2242860642,
      "id": 1719972779,
      "node_id": "PRRC_kwDOABII585mhLOr",
      "diff_hunk": "@@ -870,6 +870,30 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while ((g_best_block == uint256() || g_best_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                const MillisecondsDouble remaining{deadline - now};\n+                const auto interval{std::min(remaining, tick)};\n+                g_best_block_cv.wait_until(lock, now + interval);",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nNot important but I think it would be clearer to condense these 3 lines to just:\r\n\r\n```c++\r\ng_best_block_cv.wait_until(lock, std::min(deadline, now + tick));\r\n```\r\n\r\nI don't think it helps to introduce 2 extra variables and subtract `now` then add `now` back.",
      "created_at": "2024-08-16T15:06:01Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719972779",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719972779"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 886,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317181",
      "pull_request_review_id": 2244781268,
      "id": 1721317181,
      "node_id": "PRRC_kwDOABII585mmTc9",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 15,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": 1719929110,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Taken (mostly).",
      "created_at": "2024-08-19T07:18:39Z",
      "updated_at": "2024-08-19T07:18:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721317181",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317181"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317268",
      "pull_request_review_id": 2244781413,
      "id": 1721317268,
      "node_id": "PRRC_kwDOABII585mmTeU",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 18,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": 1719939574,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-19T07:18:44Z",
      "updated_at": "2024-08-19T07:18:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721317268",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317268"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 49,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721324596",
      "pull_request_review_id": 2244793244,
      "id": 1721324596,
      "node_id": "PRRC_kwDOABII585mmVQ0",
      "diff_hunk": "@@ -870,6 +870,30 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while ((g_best_block == uint256() || g_best_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                const MillisecondsDouble remaining{deadline - now};\n+                const auto interval{std::min(remaining, tick)};\n+                g_best_block_cv.wait_until(lock, now + interval);",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": 1719972779,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed that's nicer.",
      "created_at": "2024-08-19T07:25:38Z",
      "updated_at": "2024-08-19T07:25:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721324596",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721324596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 886,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721752519",
      "pull_request_review_id": 2245487748,
      "id": 1721752519,
      "node_id": "PRRC_kwDOABII585mn9vH",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        auto now{std::chrono::steady_clock::now()};",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "bf3377f4bf988f2477944ca54c4dee33b9b45b6e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (bf3377f4bf988f2477944ca54c4dee33b9b45b6e)\r\n\r\n`now` variable is unused if timeout is zero, so this line could be moved inside the `if (timeout)` block below.",
      "created_at": "2024-08-19T13:01:01Z",
      "updated_at": "2024-08-19T13:08:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721752519",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721752519"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 315,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721865864",
      "pull_request_review_id": 2245675379,
      "id": 1721865864,
      "node_id": "PRRC_kwDOABII585moZaI",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        auto now{std::chrono::steady_clock::now()};",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "bf3377f4bf988f2477944ca54c4dee33b9b45b6e",
      "in_reply_to_id": 1721752519,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done here and in `waitforblockheight`.",
      "created_at": "2024-08-19T14:15:44Z",
      "updated_at": "2024-08-19T14:15:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721865864",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721865864"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 315,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721880533",
      "pull_request_review_id": 2245698982,
      "id": 1721880533,
      "node_id": "PRRC_kwDOABII585moc_V",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        if (block.hash == hash) break;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (b4d37fa70506129ba4a4d218bc49ce8ca9d8380c)\r\n\r\nNot important, but could simplify these two lines to `while (IsRPCRunning() && block.hash != hash)`\r\n\r\nSimilarly, could simplify to `while (IsRPCRunning() && block.height < height)` in waitforblockheight below.",
      "created_at": "2024-08-19T14:24:54Z",
      "updated_at": "2024-08-19T14:27:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721880533",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721880533"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 314,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721929753",
      "pull_request_review_id": 2245780008,
      "id": 1721929753,
      "node_id": "PRRC_kwDOABII585mopAZ",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        if (block.hash == hash) break;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1721880533,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, will do if I have to retouch.",
      "created_at": "2024-08-19T14:56:20Z",
      "updated_at": "2024-08-19T14:56:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721929753",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721929753"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 314,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727105521",
      "pull_request_review_id": 2254595107,
      "id": 1727105521,
      "node_id": "PRRC_kwDOABII585m8Ynx",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit b4d37fa70506129ba4a4d218bc49ce8ca9d8380c\r\n\r\nI think there is a significant change in behaviour here between `waitTipChanged`, or rather `g_best_block`, and the rpc notification through `blockTip`. AFAICT the `blockTip` notification reports on completed operations in `ActivateBestChain` and `InvalidatedBlock`, while `g_best_block` is updated through the lower-level `ConnectTip` and `DisconnectTip`, which may respectively be called iteratively by `ActivateBestChain` and `InvalidateBlock`. So for operations involving multiple blocks this might yield different results here. I'm not sure if these RPCs should report on these more ephemeral state changes rather than the results of the respective operations.\r\n\r\nI have not actually tested this, so I might be mistaken here, in which case I think it would still be good to have a note in the commit message comparing the two methods.",
      "created_at": "2024-08-22T13:52:41Z",
      "updated_at": "2024-08-22T13:58:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727105521",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727105521"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727346780",
      "pull_request_review_id": 2254946626,
      "id": 1727346780,
      "node_id": "PRRC_kwDOABII585m9Thc",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`g_best_block_cv.notify_all();` is called by `Chainstate::UpdateTip()`, which indeed is called by `ConnectTip` and `DisconnectTip()`. Still wrapping my head around what the previous approach was. I doubt these RPC's were used outside of tests, but it would make sense to document the different.",
      "created_at": "2024-08-22T15:27:24Z",
      "updated_at": "2024-08-22T15:27:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727346780",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727346780"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727474250",
      "pull_request_review_id": 2255139063,
      "id": 1727474250,
      "node_id": "PRRC_kwDOABII585m9ypK",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727105521\r\n\r\nThis is a good catch, but I\"m not sure there is a observable change of behavior in `ActivateBestChain` because cs_main is held the whole time `blockTip` / `uiInterface.NotifyBlockTip` / `RPCNotifyBlockChange` is called and while the old `latestblock` global (now replaced by `g_best_block`) was updated:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5ce2285b8739e12eebd1d53358038ec2277c662b/src/validation.cpp#L3552\r\n\r\nSo I don't think `waitTipChanged` will actually return during any intermediate tip changes, because it can't return until it locks `cs_main`, so it should just report the latest block as before.\r\n\r\nHowever, `InvalidBlock` seems like a different story because it is releasing cs_main between disconnecting blocks:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5ce2285b8739e12eebd1d53358038ec2277c662b/src/validation.cpp#L3701\r\n\r\nbut it would previously only notify about a tip change and update `latestblock` at the end:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5ce2285b8739e12eebd1d53358038ec2277c662b/src/validation.cpp#L3783\r\n\r\nNow it will update `g_best_block` and release `cs_main` while it is disconnecting blocks. This seems like something worth documenting, but probably not likely to cause real problems.\r\n",
      "created_at": "2024-08-22T16:35:45Z",
      "updated_at": "2024-08-22T16:36:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727474250",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727474250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727777786",
      "pull_request_review_id": 2255602043,
      "id": 1727777786,
      "node_id": "PRRC_kwDOABII585m-8v6",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Couple of months ago I was thinking how to get rid of `g_best_block` and its friends entirely in the context of the kernel library. We already have two interfaces for notifying if something changed during validation, having a third one, that is also globally mutable and potentially dangerous if multiple chainstate managers are used is not ideal. I did not make progress then, but looking at it again now, I think this might be the opportunity to get rid of it.\r\n\r\nHow about duplicating the best block logic into the kernel notifications like I've done here https://github.com/TheCharlatan/bitcoin/commit/3c665065f132fd80ea3b1733785b98e45c8b371e (our locking conventions still puzzle me a bit, maybe there is a better way to do it)? This would avoid any change in behavior altogether and mostly make this a refactor. In a follow-up the remaining users of `g_best_block` could then be migrated and the global deleted.\r\n\r\nI think the current user of `g_best_block` (getblocktemplate() in mining.cpp), could be migrated to this interface as well. I don't really see the downside of not being notified on these interim states, since it is undesirable to build work on top of them.",
      "created_at": "2024-08-22T20:33:40Z",
      "updated_at": "2024-08-22T20:33:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727777786",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727777786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730914174",
      "pull_request_review_id": 2260145571,
      "id": 1730914174,
      "node_id": "PRRC_kwDOABII585nK6d-",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@TheCharlatan do you want to make a separate PR for the kernel notification changes, or should I just include them here?",
      "created_at": "2024-08-26T08:44:39Z",
      "updated_at": "2024-08-26T08:44:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1730914174",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730914174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730917837",
      "pull_request_review_id": 2260151370,
      "id": 1730917837,
      "node_id": "PRRC_kwDOABII585nK7XN",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it would be good to integrate them here, and I'll try and follow up with removing the `m_best_header` global from validation.",
      "created_at": "2024-08-26T08:47:24Z",
      "updated_at": "2024-08-26T08:47:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1730917837",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730917837"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730997386",
      "pull_request_review_id": 2260278015,
      "id": 1730997386,
      "node_id": "PRRC_kwDOABII585nLOyK",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        if (block.hash == hash) break;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1721880533,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-26T09:46:58Z",
      "updated_at": "2024-08-26T09:46:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1730997386",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730997386"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 314,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731432419",
      "pull_request_review_id": 2260994997,
      "id": 1731432419,
      "node_id": "PRRC_kwDOABII585nM4_j",
      "diff_hunk": "@@ -870,6 +871,27 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(notifications().m_tip_block_mutex, lock);\n+            while ((notifications().m_tip_block == uint256() || notifications().m_tip_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                notifications().m_tip_block_cv.wait_until(lock, std::min(deadline, now + tick));",
      "path": "src/node/interfaces.cpp",
      "position": 60,
      "original_position": 25,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "078fc60f198eb7a3bcccb557416fe1d4498f26e7",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (078fc60f198eb7a3bcccb557416fe1d4498f26e7)\r\n\r\nOne problem with switching from g_best_block_cv to m_tip_block_cv is that this m_tip_block_cv is not signaled when StopRPC is called, which could mean shutdown hangs for a second instead of being instantaneous. I believe this could be fixed in earlier commit 8400d49ffec47add2dc27267ae13ede5d2fabeea with:\r\n\r\n```diff\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -282,7 +282,7 @@ void Shutdown(NodeContext& node)\r\n \r\n     StopHTTPRPC();\r\n     StopREST();\r\n-    StopRPC();\r\n+    StopRPC(&node);\r\n     StopHTTPServer();\r\n     for (const auto& client : node.chain_clients) {\r\n         client->flush();\r\n--- a/src/node/interfaces.cpp\r\n+++ b/src/node/interfaces.cpp\r\n@@ -139,7 +139,7 @@ public:\r\n         // Stop RPC for clean shutdown if any of waitfor* commands is executed.\r\n         if (args().GetBoolArg(\"-server\", false)) {\r\n             InterruptRPC();\r\n-            StopRPC();\r\n+            StopRPC(m_context);\r\n         }\r\n     }\r\n     bool shutdownRequested() override { return ShutdownRequested(*Assert(m_context)); };\r\n--- a/src/rpc/server.cpp\r\n+++ b/src/rpc/server.cpp\r\n@@ -11,6 +11,7 @@\r\n #include <common/system.h>\r\n #include <logging.h>\r\n #include <node/context.h>\r\n+#include <node/kernel_notifications.h>\r\n #include <rpc/server_util.h>\r\n #include <rpc/util.h>\r\n #include <sync.h>\r\n@@ -293,16 +294,17 @@ void InterruptRPC()\r\n     });\r\n }\r\n \r\n-void StopRPC()\r\n+void StopRPC(const std::any& context)\r\n {\r\n     static std::once_flag g_rpc_stop_flag;\r\n     // This function could be called twice if the GUI has been started with -server=1.\r\n     assert(!g_rpc_running);\r\n-    std::call_once(g_rpc_stop_flag, []() {\r\n+    std::call_once(g_rpc_stop_flag, [&]() {\r\n         LogPrint(BCLog::RPC, \"Stopping RPC\\n\");\r\n         WITH_LOCK(g_deadline_timers_mutex, deadlineTimers.clear());\r\n         DeleteAuthCookie();\r\n         g_best_block_cv.notify_all();\r\n+        Assert(EnsureAnyNodeContext(context).notifications)->m_tip_block_cv.notify_all();\r\n         LogPrint(BCLog::RPC, \"RPC stopped.\\n\");\r\n     });\r\n }\r\n--- a/src/rpc/server.h\r\n+++ b/src/rpc/server.h\r\n@@ -9,6 +9,7 @@\r\n #include <rpc/request.h>\r\n #include <rpc/util.h>\r\n \r\n+#include <any>\r\n #include <functional>\r\n #include <map>\r\n #include <stdint.h>\r\n@@ -172,7 +173,7 @@ extern CRPCTable tableRPC;\r\n \r\n void StartRPC();\r\n void InterruptRPC();\r\n-void StopRPC();\r\n+void StopRPC(const std::any& context);\r\n UniValue JSONRPCExec(const JSONRPCRequest& jreq, bool catch_errors);\r\n \r\n #endif // BITCOIN_RPC_SERVER_H\r\n```",
      "created_at": "2024-08-26T15:35:34Z",
      "updated_at": "2024-08-26T15:46:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731432419",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731432419"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 905,
      "original_line": 905,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731440200",
      "pull_request_review_id": 2260994997,
      "id": 1731440200,
      "node_id": "PRRC_kwDOABII585nM65I",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If we are going to add a new `m_tip_block` variable to replace `g_best_block` seems like it would be good to make replacement complete and eliminate `g_best_block`. I think following could work (compiles but untested):\r\n\r\n```diff\r\n--- a/src/rpc/mining.cpp\r\n+++ b/src/rpc/mining.cpp\r\n@@ -739,7 +739,6 @@ static RPCHelpMan getblocktemplate()\r\n     {\r\n         // Wait to respond until either the best block changes, OR a minute has passed and there are more transactions\r\n         uint256 hashWatchedChain;\r\n-        std::chrono::steady_clock::time_point checktxtime;\r\n         unsigned int nTransactionsUpdatedLastLP;\r\n \r\n         if (lpval.isStr())\r\n@@ -760,19 +759,14 @@ static RPCHelpMan getblocktemplate()\r\n         // Release lock while waiting\r\n         LEAVE_CRITICAL_SECTION(cs_main);\r\n         {\r\n-            checktxtime = std::chrono::steady_clock::now() + std::chrono::minutes(1);\r\n-\r\n-            WAIT_LOCK(g_best_block_mutex, lock);\r\n-            while (g_best_block == hashWatchedChain && IsRPCRunning())\r\n-            {\r\n-                if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\r\n-                {\r\n-                    // Timeout: Check transactions for update\r\n-                    // without holding the mempool lock to avoid deadlocks\r\n-                    if (miner.getTransactionsUpdated() != nTransactionsUpdatedLastLP)\r\n-                        break;\r\n-                    checktxtime += std::chrono::seconds(10);\r\n-                }\r\n+            MillisecondsDouble checktxtime{std::chrono::minutes(1)};\r\n+            while (tip == hashWatchedChain && IsRPCRunning()) {\r\n+                tip = miner.waitTipChanged(hashWatchedChain, checktxtime).hash;\r\n+                // Timeout: Check transactions for update\r\n+                // without holding the mempool lock to avoid deadlocks\r\n+                if (miner.getTransactionsUpdated() != nTransactionsUpdatedLastLP)\r\n+                    break;\r\n+                checktxtime = std::chrono::seconds(10);\r\n             }\r\n         }\r\n         ENTER_CRITICAL_SECTION(cs_main);\r\n--- a/src/rpc/server.cpp\r\n+++ b/src/rpc/server.cpp\r\n@@ -303,7 +303,6 @@ void StopRPC(const std::any& context)\r\n         LogPrint(BCLog::RPC, \"Stopping RPC\\n\");\r\n         WITH_LOCK(g_deadline_timers_mutex, deadlineTimers.clear());\r\n         DeleteAuthCookie();\r\n-        g_best_block_cv.notify_all();\r\n         Assert(EnsureAnyNodeContext(context).notifications)->m_tip_block_cv.notify_all();\r\n         LogPrint(BCLog::RPC, \"RPC stopped.\\n\");\r\n     });\r\n--- a/src/test/validation_chainstate_tests.cpp\r\n+++ b/src/test/validation_chainstate_tests.cpp\r\n@@ -4,6 +4,7 @@\r\n //\r\n #include <chainparams.h>\r\n #include <consensus/validation.h>\r\n+#include <node/kernel_notifications.h>\r\n #include <random.h>\r\n #include <rpc/blockchain.h>\r\n #include <sync.h>\r\n@@ -69,14 +70,14 @@ BOOST_AUTO_TEST_CASE(validation_chainstate_resize_caches)\r\n BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n {\r\n     ChainstateManager& chainman = *Assert(m_node.chainman);\r\n-    uint256 curr_tip = ::g_best_block;\r\n+    uint256 curr_tip = m_node.notifications->m_tip_block;\r\n \r\n     // Mine 10 more blocks, putting at us height 110 where a valid assumeutxo value can\r\n     // be found.\r\n     mineBlocks(10);\r\n \r\n     // After adding some blocks to the tip, best block should have changed.\r\n-    BOOST_CHECK(::g_best_block != curr_tip);\r\n+    BOOST_CHECK(m_node.notifications->m_tip_block != curr_tip);\r\n \r\n     // Grab block 1 from disk; we'll add it to the background chain later.\r\n     std::shared_ptr<CBlock> pblockone = std::make_shared<CBlock>();\r\n@@ -91,15 +92,15 @@ BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n     // Ensure our active chain is the snapshot chainstate.\r\n     BOOST_CHECK(WITH_LOCK(::cs_main, return chainman.IsSnapshotActive()));\r\n \r\n-    curr_tip = ::g_best_block;\r\n+    curr_tip = m_node.notifications->m_tip_block;\r\n \r\n     // Mine a new block on top of the activated snapshot chainstate.\r\n     mineBlocks(1);  // Defined in TestChain100Setup.\r\n \r\n     // After adding some blocks to the snapshot tip, best block should have changed.\r\n-    BOOST_CHECK(::g_best_block != curr_tip);\r\n+    BOOST_CHECK(m_node.notifications->m_tip_block != curr_tip);\r\n \r\n-    curr_tip = ::g_best_block;\r\n+    curr_tip = m_node.notifications->m_tip_block;\r\n \r\n     BOOST_CHECK_EQUAL(chainman.GetAll().size(), 2);\r\n \r\n@@ -138,7 +139,7 @@ BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n     // g_best_block should be unchanged after adding a block to the background\r\n     // validation chain.\r\n     BOOST_CHECK(block_added);\r\n-    BOOST_CHECK_EQUAL(curr_tip, ::g_best_block);\r\n+    BOOST_CHECK_EQUAL(curr_tip, m_node.notifications->m_tip_block);\r\n }\r\n \r\n BOOST_AUTO_TEST_SUITE_END()\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -107,10 +107,6 @@ const std::vector<std::string> CHECKLEVEL_DOC {\r\n  * */\r\n static constexpr int PRUNE_LOCK_BUFFER{10};\r\n \r\n-GlobalMutex g_best_block_mutex;\r\n-std::condition_variable g_best_block_cv;\r\n-uint256 g_best_block;\r\n-\r\n const CBlockIndex* Chainstate::FindForkInGlobalIndex(const CBlockLocator& locator) const\r\n {\r\n     AssertLockHeld(cs_main);\r\n@@ -2987,12 +2983,6 @@ void Chainstate::UpdateTip(const CBlockIndex* pindexNew)\r\n         m_mempool->AddTransactionsUpdated(1);\r\n     }\r\n \r\n-    {\r\n-        LOCK(g_best_block_mutex);\r\n-        g_best_block = pindexNew->GetBlockHash();\r\n-        g_best_block_cv.notify_all();\r\n-    }\r\n-\r\n     std::vector<bilingual_str> warning_messages;\r\n     if (!m_chainman.IsInitialBlockDownload()) {\r\n         const CBlockIndex* pindex = pindexNew;\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -85,11 +85,6 @@ enum class SynchronizationState {\r\n     POST_INIT\r\n };\r\n \r\n-extern GlobalMutex g_best_block_mutex;\r\n-extern std::condition_variable g_best_block_cv;\r\n-/** Used to notify getblocktemplate RPC of new tips. */\r\n-extern uint256 g_best_block;\r\n-\r\n /** Documentation for argument 'checklevel'. */\r\n extern const std::vector<std::string> CHECKLEVEL_DOC;\r\n \r\n```\r\n",
      "created_at": "2024-08-26T15:41:24Z",
      "updated_at": "2024-08-26T15:46:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731440200",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731440200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731519643",
      "pull_request_review_id": 2261136712,
      "id": 1731519643,
      "node_id": "PRRC_kwDOABII585nNOSb",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nice! I split the changes to `rpc/mining.cpp` into its own commit, that looks correct.\r\n\r\nRunning and debugging some failing tests before pushing...",
      "created_at": "2024-08-26T16:49:25Z",
      "updated_at": "2024-08-26T16:51:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731519643",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731519643"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731725112",
      "pull_request_review_id": 2261470893,
      "id": 1731725112,
      "node_id": "PRRC_kwDOABII585nOAc4",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks ryanofsky, that is exactly what I had in mind for a potential followup - happy to have this in one go. I still need to think through the trade-offs for the block template rpc, but I think this might actually be better.",
      "created_at": "2024-08-26T19:35:55Z",
      "updated_at": "2024-08-26T19:35:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731725112",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731725112"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1734235283",
      "pull_request_review_id": 2265548046,
      "id": 1734235283,
      "node_id": "PRRC_kwDOABII585nXlST",
      "diff_hunk": "@@ -50,6 +50,12 @@ namespace node {\n \n kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n {\n+    {\n+        LOCK(m_tip_block_mutex);\n+        m_tip_block= index.GetBlockHash();",
      "path": "src/node/kernel_notifications.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "eb56e9a819a2ab8193f96218bdcd029f473ae222",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Self-Nit: I missed the space here.",
      "created_at": "2024-08-28T08:33:03Z",
      "updated_at": "2024-08-29T12:44:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1734235283",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1734235283"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1736237919",
      "pull_request_review_id": 2268803901,
      "id": 1736237919,
      "node_id": "PRRC_kwDOABII585nfONf",
      "diff_hunk": "@@ -50,6 +50,12 @@ namespace node {\n \n kernel::InterruptResult KernelNotifications::blockTip(SynchronizationState state, CBlockIndex& index)\n {\n+    {\n+        LOCK(m_tip_block_mutex);\n+        m_tip_block= index.GetBlockHash();",
      "path": "src/node/kernel_notifications.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "e8ec39784dac1a564db4a962a75994e5bb832bc9",
      "original_commit_id": "eb56e9a819a2ab8193f96218bdcd029f473ae222",
      "in_reply_to_id": 1734235283,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed",
      "created_at": "2024-08-29T13:41:21Z",
      "updated_at": "2024-08-29T13:41:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1736237919",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1736237919"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 55,
      "side": "RIGHT"
    }
  ]
}