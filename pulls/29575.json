{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575",
    "id": 1758860103,
    "node_id": "PR_kwDOABII585o1hNH",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29575",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29575.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29575.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
    "number": 29575,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "net_processing: make any misbehavior trigger immediate discouragement",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "So far, discouragement of peers triggers when their misbehavior score exceeds 100 points. Most types of misbehavior increment the score by 100, triggering immediate discouragement, but some types do not. This PR makes all increments equal to either 100 (meaning any misbehavior will immediately cause disconnection and discouragement) or 0 (making the behavior effectively unconditionally allowed), and then removes the logic for score accumulation.\r\n\r\nThis simplifies the code a bit, but also makes protocol expectations clearer: if a peer misbehaves, they get disconnected. There is no good reason why certain types of protocol violations should be permitted 4 times (howmuch=20) or 9 times (howmuch=10), while many others are never allowed. Furthermore, the distinction between these looks arbitrary.\r\n\r\nTo assess whether this does not unduly affect existing other software on the network, I've been running this with an additional patch (see https://github.com/sipa/bitcoin/commits/202403_nomisbehave_log) that adds logging whenever behavior is detected whose misbehavior increment is changed to 100 by this PR. Over the past day I have not seen any instances on my well-connected node (~150 incoming connections), but will continue to monitor.\r\n\r\nThe specific types of misbehavior that are changed to 100 are:\r\n* Sending us a `block` which does not connect to our header tree (which necessarily must have been unsollicited). [used to be score 10]\r\n* Sending us a `headers` with a non-continuous headers sequence. [used to be score 20]\r\n* Sending us more than 1000 addresses in a single `addr` or `addrv2` message [used to be score 20]\r\n* Sending us more than 50000 invs in a single `inv` message [used to be score 20]\r\n* Sending us more than 2000 headers in a single `headers` message [used to be score 20]\r\n\r\nThe specific types of misbehavior that are changed to 0 are:\r\n* Sending us 10 (*) separate BIP130 headers announcements that do not connect to our block tree [used to be score 20]\r\n* Sending us more than 8 headers in a single `headers` message (which thus does not get treated as a BIP130 announcement) that does not connect to our block tree. [used to be score 10]\r\n\r\nI believe that none of these behaviors are unavoidable, except for the one marked (*) which can in theory happen still due to interaction between BIP130 and variations in system clocks (the max 2 hour in the future rule). This one has been removed entirely. In order to remove the impact of the bug it was designed to deal with, without relying on misbehavior, a separate improvement is included that makes `getheaders`-tracking more accurate.\r\n\r\nIn another unrelated improvement, this also gets rid of the 8 header limit heuristic to determine whether an incoming non-connecting `headers` is a potential BIP130 announcement, as this rule is no longer needed to prevent spurious Misbehavior. Instead, any non-connecting `headers` is now treated as a potential announcement.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2024-03-06T12:54:56Z",
    "updated_at": "2024-03-12T19:20:17Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "020f074a3fd5cb578db4228667c8d7a74af545d7",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "sipa:202403_nomisbehave",
      "ref": "202403_nomisbehave",
      "sha": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 1458655,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDU4NjU1",
        "name": "bitcoin",
        "full_name": "sipa/bitcoin",
        "owner": {
          "login": "sipa",
          "id": 548488,
          "node_id": "MDQ6VXNlcjU0ODQ4OA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sipa",
          "html_url": "https://github.com/sipa",
          "followers_url": "https://api.github.com/users/sipa/followers",
          "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
          "organizations_url": "https://api.github.com/users/sipa/orgs",
          "repos_url": "https://api.github.com/users/sipa/repos",
          "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sipa/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/sipa/bitcoin",
        "description": "Bitcoin integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sipa/bitcoin",
        "archive_url": "https://api.github.com/repos/sipa/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sipa/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sipa/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sipa/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sipa/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sipa/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sipa/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sipa/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sipa/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sipa/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sipa/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sipa/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sipa/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sipa/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sipa/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sipa/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sipa/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sipa/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sipa/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sipa/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sipa/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sipa/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sipa/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sipa/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sipa/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sipa/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sipa/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sipa/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sipa/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sipa/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sipa/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sipa/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sipa/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sipa/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sipa/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sipa/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sipa/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sipa/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sipa/bitcoin/hooks",
        "svn_url": "https://github.com/sipa/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "TypeScript",
        "forks_count": 23,
        "stargazers_count": 84,
        "watchers_count": 84,
        "size": 233945,
        "default_branch": "lows",
        "open_issues_count": 16,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-03-12T19:09:03Z",
        "created_at": "2011-03-09T10:46:59Z",
        "updated_at": "2023-10-20T10:27:50Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "1105aa46dd1008c556b8c435f1efcb9be09a1644",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34807,
        "stargazers_count": 74719,
        "watchers_count": 74719,
        "size": 253108,
        "default_branch": "master",
        "open_issues_count": 696,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-03-12T19:34:55Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-03-12T19:54:21Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 83,
    "deletions": 142,
    "changed_files": 10,
    "commits": 5,
    "review_comments": 29,
    "comments": 10
  },
  "events": [
    {
      "event": "commented",
      "id": 1980808115,
      "node_id": "IC_kwDOABII5852ELuz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1980808115",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-06T12:54:59Z",
      "updated_at": "2024-03-12T15:54:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29575).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1919982697), [1440000bytes](https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981551759), [brunoerg](https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981893004), [mzumsande](https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1923216992), [sr-gi](https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1928739577) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29538](https://github.com/bitcoin/bitcoin/pull/29538) (refactor: Improve naming of CBlock::GetHash() -> GetHeaderHash() by fjahr)\n* [#29530](https://github.com/bitcoin/bitcoin/pull/29530) (rpc/net: Adds misbehaving_score to getpeerinfo by sr-gi)\n* [#29415](https://github.com/bitcoin/bitcoin/pull/29415) (Broadcast own transactions only via short-lived Tor or I2P connections by vasild)\n* [#29318](https://github.com/bitcoin/bitcoin/pull/29318) (test: Check object hashes in wait_for_getheaders by BrandonOdiwuor)\n* [#25832](https://github.com/bitcoin/bitcoin/pull/25832) (tracing: network connection tracepoints by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1980808115",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "labeled",
      "id": 12027898579,
      "node_id": "LE_lADOABII586BbZV3zwAAAALM6yrT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12027898579",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-06T13:24:00Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "reviewed",
      "id": 1919982697,
      "node_id": "PRR_kwDOABII585ycJxp",
      "url": null,
      "actor": null,
      "commit_id": "bdc5776295ee78bc12de5b1c950afc80569a4f3e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "concept ACK\r\n\r\ngoing to run on a listening node with logging to test\r\n\r\n",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1919982697",
      "submitted_at": "2024-03-06T15:26:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-06T16:01:43Z",
      "updated_at": "2024-03-06T16:01:43Z",
      "source": {
        "issue": {
          "id": 2164235683,
          "node_id": "PR_kwDOABII585odEz0",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29530",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29530/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29530/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29530/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29530",
          "number": 29530,
          "state": "closed",
          "state_reason": null,
          "title": "rpc/net: Adds misbehaving_score to getpeerinfo",
          "body": "This is motivated by the discussions in #29412 (https://github.com/bitcoin/bitcoin/pull/29412#discussion_r1484773525) and #29524(https://github.com/bitcoin/bitcoin/pull/29524#discussion_r1508895425).\r\n\r\nCurrently, we are asserting logs to check that certain misbehavior has been accounted for, which is far from an ideal interface. Being able to check that the `misbehavior_score` of a peer has increased as expected seems a better approach.\r\n\r\nFrom an end-user perspective, being able to check whether a peer has been misbehaving also seems useful.\r\n\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
          "user": {
            "login": "sr-gi",
            "id": 6665628,
            "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sr-gi",
            "html_url": "https://github.com/sr-gi",
            "followers_url": "https://api.github.com/users/sr-gi/followers",
            "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
            "organizations_url": "https://api.github.com/users/sr-gi/orgs",
            "repos_url": "https://api.github.com/users/sr-gi/repos",
            "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sr-gi/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 19,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29530",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29530",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29530.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29530.patch"
          },
          "closed_at": "2024-03-12T16:10:30Z",
          "created_at": "2024-03-01T21:46:22Z",
          "updated_at": "2024-03-12T16:10:30Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1981551759,
      "node_id": "IC_kwDOABII5852HBSP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1981551759",
      "actor": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-06T18:42:27Z",
      "updated_at": "2024-03-06T18:42:27Z",
      "author_association": "NONE",
      "body": "Concept ACK ",
      "user": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981551759",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "commented",
      "id": 1981893004,
      "node_id": "IC_kwDOABII5852IUmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1981893004",
      "actor": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-06T22:09:58Z",
      "updated_at": "2024-03-06T22:09:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1981893004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T00:38:31Z",
      "updated_at": "2024-03-07T00:38:31Z",
      "source": {
        "issue": {
          "id": 2164982107,
          "node_id": "PR_kwDOABII585ofgIV",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29538",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29538/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29538/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29538/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29538",
          "number": 29538,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Improve naming of CBlock::GetHash() -> GetHeaderHash()",
          "body": "dergoegge noted [here](https://github.com/bitcoin/bitcoin/pull/29412/commits/49257c0304828a185c273fcb99742c54bbef0c8e) that `CBlock::GetHash()` is a footgun since it only calculates the hash of the header and not the full block. I agree with that sentiment and think it would be beneficial to make this explicit by renaming the inherited function.\r\n\r\nThe same goes for `ConstructBlockHash()`.",
          "user": {
            "login": "fjahr",
            "id": 1322187,
            "node_id": "MDQ6VXNlcjEzMjIxODc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fjahr",
            "html_url": "https://github.com/fjahr",
            "followers_url": "https://api.github.com/users/fjahr/followers",
            "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
            "organizations_url": "https://api.github.com/users/fjahr/orgs",
            "repos_url": "https://api.github.com/users/fjahr/repos",
            "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/fjahr/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29538",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29538",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29538.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29538.patch"
          },
          "created_at": "2024-03-02T21:18:08Z",
          "updated_at": "2024-03-12T15:56:09Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T01:45:43Z",
      "updated_at": "2024-03-07T01:45:43Z",
      "source": {
        "issue": {
          "id": 2127176950,
          "node_id": "PR_kwDOABII585me8Nn",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29415",
          "number": 29415,
          "state": "open",
          "state_reason": null,
          "title": "Broadcast own transactions only via short-lived Tor or I2P connections",
          "body": "To improve privacy, broadcast locally submitted transactions (from the `sendrawtransaction` RPC) to the P2P network only via Tor or I2P short-lived connections.\r\n\r\n* Introduce a new connection type for private broadcast of transactions with the following properties:\r\n  * started whenever there are local transactions to be sent\r\n  * only opened to Tor or I2P peers\r\n  * opened regardless of max connections limits\r\n  * after handshake is completed one local transaction is pushed to the peer, `PING` is sent and after receiving `PONG` the connection is closed\r\n  * ignore all incoming messages after handshake is completed (except `PONG`)\r\n\r\n* Broadcast transactions submitted via `sendrawtransaction` using this new mechanism, to a few Tor or I2P peers. Keep doing this until we receive an `INV` about this transaction from one of our ordinary peers (this takes about 1 second on mainnet).\r\n\r\n* The transaction is stored in peerman and does not enter the mempool.\r\n\r\n* Once we get an `INV` from somebody, then the normal flow executes: we request the transaction with `GETDATA`, receive it with a `TX` message, put it in our mempool and broadcast it to all our existent connections (as if we see it for the first time).\r\n\r\n* After we receive the full transaction as a `TX` message, in reply to our `GETDATA` request, only then consider the transaction has propagated through the network and remove it from the storage in peerman, ending the private broadcast attempts.\r\n\r\nThe messages exchange should look like this:\r\n\r\n```\r\ntx-sender >--- connect -------> tx-recipient\r\ntx-sender >--- VERSION -------> tx-recipient (dummy VERSION with no revealing data)\r\ntx-sender <--- VERSION -------< tx-recipient\r\ntx-sender <--- WTXIDRELAY ----< tx-recipient (maybe)\r\ntx-sender <--- SENDADDRV2 ----< tx-recipient (maybe)\r\ntx-sender <--- SENDTXRCNCL ---< tx-recipient (maybe)\r\ntx-sender <--- VERACK --------< tx-recipient\r\ntx-sender >--- VERACK --------> tx-recipient\r\ntx-sender >--- TX ------------> tx-recipient\r\ntx-sender >--- PING ----------> tx-recipient\r\ntx-sender <--- PONG ----------< tx-recipient\r\ntx-sender disconnects\r\n```\r\n\r\nWhenever a new transaction is received from `sendrawtransaction` RPC, the node will send it to 5 (`NUM_PRIVATE_BROADCAST_PER_TX`) recipients right away. If after 10-15 mins we still have not heard anything about the transaction from the network, then it will be sent to 1 more peer (see `PeerManagerImpl::ReattemptPrivateBroadcast()`).\r\n\r\nA few considerations:\r\n* The short-lived private broadcast connections are very cheap and fast wrt network traffic. It is expected that some of those peers could blackhole the transaction. Just one honest/proper peer is enough for successful propagation.\r\n* The peers that receive the transaction could deduce that this is initial transaction broadcast from the transaction originator. This is ok, they can't identify the sender.\r\n\r\n---\r\n\r\nSome explanation of the commits:\r\n\r\n* Independent improvement (also opened as a standalone PR at https://github.com/bitcoin/bitcoin/pull/29419):\r\n  * `log: deduplicate category names and improve logging.cpp`\r\n\r\n* New logging category and config option to enable private broadcast\r\n  * `log: introduce a new category for private broadcast`\r\n  * `init: introduce a new option to enable/disable private broadcast`\r\n\r\n* Implement the private broadcast connection handling on the `CConnman` side:\r\n  * `net: introduce a new connection type for private broadcast`\r\n  * `net: move peers counting before grant acquisition in ThreadOpenConnections()`\r\n  * `net: implement opening PRIVATE_BROADCAST connections`\r\n\r\n* Prepare `BroadcastTransaction()` for private broadcast requests:\r\n  * `net_processing: rename RelayTransaction to better describe what it does`\r\n  * `node: change a tx-relay on/off flag to a tri-state`\r\n  * `net_processing: store transactions for private broadcast in PeerManager`\r\n\r\n* Implement the private broadcast connection handling on the `PeerManager` side:\r\n  * `net_processing: reorder the code that handles the VERSION message`\r\n  * `net_processing: handle ConnectionType::PRIVATE_BROADCAST connections`\r\n  * `net_processing: stop private broadcast of a transaction after round-trip`\r\n  * `net_processing: retry private broadcast`\r\n\r\n* Engage the new functionality from `sendrawtransaction`:\r\n  * `rpc: use private broadcast from sendrawtransaction RPC if -privatebroadcast is ON`\r\n\r\n* Independent test framework improvements (also opened as a standalone PR at https://github.com/bitcoin/bitcoin/pull/29420):\r\n  * `test: improve debug log message from P2PConnection::connection_made()`\r\n  * `test: extend the SOCKS5 Python proxy to actually connect to a destination`\r\n  * `test: support WTX INVs from P2PDataStore and fix a comment`\r\n  * `test: set P2PConnection::p2p_connected_to_node in peer_connect_helper()`\r\n\r\n* New functional test that exercies some of the new code:\r\n  * `test: add functional test for local tx relay`\r\n\r\n---\r\n\r\nThis addresses:\r\nhttps://github.com/bitcoin/bitcoin/issues/3828 Clients leak IPs if they are recipients of a transaction\r\nhttps://github.com/bitcoin/bitcoin/issues/14692 Can't configure bitocoind to only send tx via Tor but receive clearnet transactions\r\nhttps://github.com/bitcoin/bitcoin/issues/19042 Tor-only transaction broadcast onlynet=onion alternative\r\nhttps://github.com/bitcoin/bitcoin/issues/24557 Option for receive events with all networks, but send transactions and/or blocks only with anonymous network[s]?\r\nhttps://github.com/bitcoin/bitcoin/issues/25450 Ability to broadcast wallet transactions only via dedicated oneshot Tor connections\r\n\r\nRelated, but different:\r\nhttps://github.com/bitcoin/bitcoin/issues/21876 Broadcast a transaction to specific nodes\r\nhttps://github.com/bitcoin/bitcoin/issues/28636 new RPC: sendrawtransactiontopeer\r\n\r\n---\r\n\r\n_A previous incarnation of this can be found at https://github.com/bitcoin/bitcoin/pull/27509. It puts the transaction in the mempool and (tries to) hide it from the outside observers. This turned out to be too error prone or maybe even impossible._\r\n",
          "user": {
            "login": "vasild",
            "id": 266751,
            "node_id": "MDQ6VXNlcjI2Njc1MQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/vasild",
            "html_url": "https://github.com/vasild",
            "followers_url": "https://api.github.com/users/vasild/followers",
            "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
            "organizations_url": "https://api.github.com/users/vasild/orgs",
            "repos_url": "https://api.github.com/users/vasild/repos",
            "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/vasild/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29415",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29415.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29415.patch"
          },
          "created_at": "2024-02-09T13:39:10Z",
          "updated_at": "2024-03-12T18:06:20Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1921630992,
      "node_id": "PRR_kwDOABII585yicMQ",
      "url": null,
      "actor": null,
      "commit_id": "bdc5776295ee78bc12de5b1c950afc80569a4f3e",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "jess2505",
        "id": 139764499,
        "node_id": "U_kgDOCFSjEw",
        "avatar_url": "https://avatars.githubusercontent.com/u/139764499?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jess2505",
        "html_url": "https://github.com/jess2505",
        "followers_url": "https://api.github.com/users/jess2505/followers",
        "following_url": "https://api.github.com/users/jess2505/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jess2505/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jess2505/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jess2505/subscriptions",
        "organizations_url": "https://api.github.com/users/jess2505/orgs",
        "repos_url": "https://api.github.com/users/jess2505/repos",
        "events_url": "https://api.github.com/users/jess2505/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jess2505/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1921630992",
      "submitted_at": "2024-03-07T07:21:13Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
    },
    {
      "event": "reviewed",
      "id": 1921634940,
      "node_id": "PRR_kwDOABII585yidJ8",
      "url": null,
      "actor": null,
      "commit_id": "bdc5776295ee78bc12de5b1c950afc80569a4f3e",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "jess2505",
        "id": 139764499,
        "node_id": "U_kgDOCFSjEw",
        "avatar_url": "https://avatars.githubusercontent.com/u/139764499?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jess2505",
        "html_url": "https://github.com/jess2505",
        "followers_url": "https://api.github.com/users/jess2505/followers",
        "following_url": "https://api.github.com/users/jess2505/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jess2505/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jess2505/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jess2505/subscriptions",
        "organizations_url": "https://api.github.com/users/jess2505/orgs",
        "repos_url": "https://api.github.com/users/jess2505/repos",
        "events_url": "https://api.github.com/users/jess2505/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jess2505/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1921634940",
      "submitted_at": "2024-03-07T07:23:04Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T08:03:47Z",
      "updated_at": "2024-03-07T08:03:47Z",
      "source": {
        "issue": {
          "id": 1337499811,
          "node_id": "PR_kwDOABII5849G1u9",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25832",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25832/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25832/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25832/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25832",
          "number": 25832,
          "state": "open",
          "state_reason": null,
          "title": "tracing: network connection tracepoints",
          "body": "This adds five new tracepoints with documentation and tests for network connections:\r\n\r\n- established connections with `net:inbound_connection` and `net:outbound_connection`\r\n- closed connections (both closed by us or by the peer) with `net:closed_connnection`\r\n- inbound connections that we choose to evict with `net:evicted_inbound_connection`\r\n- connections that are misbehaving and punished with `net:misbehaving_connection`\r\n\r\nI've been using these tracepoints for a few months now to monitor connection lifetimes, re-connection frequency by IP and netgroup, misbehavior, peer discouragement, and eviction and more. Together with the two existing P2P message tracepoints they allow for a good overview of local P2P network activity. Also sort-of addresses https://github.com/bitcoin/bitcoin/pull/22006#discussion_r636775863. \r\n\r\nI've been back and forth on which arguments to include. For example, `net:evicted_connection` could also include some of the eviction metrics like e.g. `last_block_time`, `min_ping_time`, ... but I've left them out for now. If wanted, this can be added here or in a follow-up. I've tried to minimize a potential performance impact by measuring executed instructions with `gdb` where possible (method described [here](https://github.com/bitcoin/bitcoin/pull/23724#issuecomment-996919963)). I don't think a few hundred extra instructions are too crucial, as connection opens/closes aren't too frequent (compared to e.g. P2P messages).   Note: e.g. `CreateNodeFromAcceptedSocket()` usually executes between 80k and 90k instructions for each new inbound connection.\r\n\r\n| tracepoint                 \t| instructions                                           \t|\r\n|----------------------------\t|--------------------------------------------------------\t|\r\n| net:inbound_connection     \t| 390 ins                                                \t|\r\n| net:outbound_connection    \t| between 700 and 1000 ins                                     \t|\r\n| net:closed_connnection     \t| 473 ins                                                \t|\r\n| net:evicted_inbound_connection     \t| not measured; likely similar to net:closed_connnection \t|\r\n| net:misbehaving_connection | not measured                                           \t|\r\n\r\nAlso added a bpftrace (tested with v0.14.1) `log_p2p_connections.bt` example script that produces output similar to:\r\n```\r\nAttaching 6 probes...\r\nLogging opened, closed, misbehaving, and evicted P2P connections\r\nOUTBOUND conn to 127.0.0.1:15287: id=0, type=block-relay-only, network=0, total_out=1\r\nINBOUND conn from 127.0.0.1:45324: id=1, type=inbound, network=0, total_in=1\r\nMISBEHAVING conn id=1, score_before=0, score_increase=20, message='getdata message size = 50001', threshold_exceeded=false\r\nCLOSED conn to 127.0.0.1:15287: id=0, type=block-relay-only, network=0, established=1231006505\r\nEVICTED conn to 127.0.0.1:45324: id=1, type=inbound, network=0, established=1612312312\r\n```",
          "user": {
            "login": "0xB10C",
            "id": 19157360,
            "node_id": "MDQ6VXNlcjE5MTU3MzYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/0xB10C",
            "html_url": "https://github.com/0xB10C",
            "followers_url": "https://api.github.com/users/0xB10C/followers",
            "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
            "organizations_url": "https://api.github.com/users/0xB10C/orgs",
            "repos_url": "https://api.github.com/users/0xB10C/repos",
            "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/0xB10C/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 16,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25832",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25832",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25832.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25832.patch"
          },
          "created_at": "2022-08-12T17:18:21Z",
          "updated_at": "2024-03-12T04:57:21Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1983207221,
      "node_id": "IC_kwDOABII5852NVc1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983207221",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T10:27:26Z",
      "updated_at": "2024-03-07T10:27:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "I have been monitoring peer misbehavior with the misbehaving tracepoint from https://github.com/bitcoin/bitcoin/pull/25832. In the past weeks, I've seen the following misbehavior across 10 nodes:\r\n- `header with invalid proof of work` [100]: very frequent\r\n- `mutated block` [100]: these are frequent. I was running #29412 where we disconnect for each mutated block (compared to only disconnecting for mutated blocks we hadn't seen before)\r\n- `invalid header received` [10]: these are infrequent (\"Sending us more than 8 headers in a single headers message\")\r\n- `headers message size = X` [20]: only seen one occurrence (\"Sending us more than 2000 headers in a single headers message that does not connect to our block tree\")\r\n\r\nI've looked at a few of these `invalid header received` misbehaviors and they all came from the same IP address with a (fake?) v26.0 Bitcoin Core user agent and always claiming their start height to be 153681 (in the version msg). Seems ok to disconnect these?\r\n\r\nI'll keep an eye on further misbehavior.",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983207221",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "commented",
      "id": 1983273094,
      "node_id": "IC_kwDOABII5852NliG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983273094",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T11:04:07Z",
      "updated_at": "2024-03-07T13:54:40Z",
      "author_association": "MEMBER",
      "body": "> due to interaction between BIP130 and variations in system clocks (the max 2 hour in the future rule)\r\n\r\nPerhaps we can tolerate this if the block is less than 10 hours in the future and disconnect if it's more? It seems cheap enough to process slightly-too-far-in-the-future headers, and they are enormously expensive to produce.\r\n\r\n(for other reviewers, look for `MAX_NUM_UNCONNECTING_HEADERS_MSGS` to see where this is handled)\r\n\r\nThe peer might also be telling us about a reorg longer than `MAX_BLOCKS_TO_ANNOUNCE = 8`. In `UpdatedBlockTip` we:\r\n\r\n> limit announcements in case of a huge reorganization.\r\n> Rely on the peer's synchronization mechanism in that case.\r\n\r\nSo we should not disconnect the first time around.\r\n\r\nThe `HandleFewUnconnectingHeaders` documentation should probably mention this.\r\n\r\nhttps://github.com/Sjors/bitcoin/commit/fad8c5be6e05091e409186ea73e683a987e3b324 illustrates how we could limit this to just _once_ (`MAX_NUM_UNCONNECTING_HEADERS_MSGS = 2`), since > 8 block reorgs should be rare. If we were to immedidately disconnect (`MAX_NUM_UNCONNECTING_HEADERS_MSGS = 1` then step 5 of `p2p_sendheaders.py` fails). This doesn't account for the time difference issue. And in any case it can be done in a followup. And of course we wouldn't need an integer, but could instead call it `m_chicken_little`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983273094",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "commented",
      "id": 1983692133,
      "node_id": "IC_kwDOABII5852PL1l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983692133",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T15:00:29Z",
      "updated_at": "2024-03-07T19:04:49Z",
      "author_association": "MEMBER",
      "body": "https://github.com/Sjors/bitcoin/commit/00a7dccc1c6957ce5a6a00d5322a25f949956e6d is one approach of dealing with the time difference issue. If any of the headers are `> MAX_FUTURE_BLOCK_TIME * 10` in the future we disconnect with `time-too-new`. We could perhaps increase the number to allow for even more incorrect clocks, but I'm not sure how useful that is.\r\n\r\nSome of the comments in that commit may be spurious; I can't think of a useful attack where a peer (e.g. Bob) sends us headers, three hours in the future, with fake PoW. All Bob would achieve is that we ask ~another peer (Caroll)~ Bob for the missing headers, which ~Caroll either won't have, or she does we disconnect her~ he either sends, for which we disconnect. Or he doesn't send and tries again, at which point we disconnect him.\r\n\r\nI also don't know if if it's even worth checking if a header is in the far future, but at least it makes for more useful log entries? (it's nice to know the difference between a peer with a broken clock and a peer that falsely announces a large reorg)",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983692133",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12045080604,
      "node_id": "HRFPE_lADOABII586BbZV3zwAAAALN8Vgc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045080604",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:38:09Z"
    },
    {
      "event": "commented",
      "id": 1983969260,
      "node_id": "IC_kwDOABII5852QPfs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983969260",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:30Z",
      "updated_at": "2024-03-07T16:44:09Z",
      "author_association": "MEMBER",
      "body": "I discussed this with @sdaftuar, @mzumsande, @sr-gi in person, and decided to instead just drop the Misbehavior score for unconnecting headers. The rationale is that this misbehavior was originally intended to prevent bandwidth wastage due to very broken (but likely non-malicious) nodes actually observed on the network that respond to GETHEADERS with a response unrelated to the request, triggering a request cycle. This has however largely been addressed by #25454, which limits the number of (not responded to) GETHEADERS requests in flight to one, with a 2 minute timeout. With that, the specific misbehavior is largely irrelevant (for inbound peers, it is now mostly harmless; for outbound peers, the eviction logic will eventually kick them out if they're not keeping up with headers at all).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1983969260",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "mentioned",
      "id": 12045108987,
      "node_id": "MEE_lADOABII586BbZV3zwAAAALN8cb7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045108987",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:31Z"
    },
    {
      "event": "subscribed",
      "id": 12045109006,
      "node_id": "SE_lADOABII586BbZV3zwAAAALN8ccO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045109006",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:31Z"
    },
    {
      "event": "mentioned",
      "id": 12045109031,
      "node_id": "MEE_lADOABII586BbZV3zwAAAALN8ccn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045109031",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:31Z"
    },
    {
      "event": "subscribed",
      "id": 12045109040,
      "node_id": "SE_lADOABII586BbZV3zwAAAALN8ccw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045109040",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:31Z"
    },
    {
      "event": "mentioned",
      "id": 12045109050,
      "node_id": "MEE_lADOABII586BbZV3zwAAAALN8cc6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045109050",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:31Z"
    },
    {
      "event": "subscribed",
      "id": 12045109063,
      "node_id": "SE_lADOABII586BbZV3zwAAAALN8cdH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12045109063",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T16:40:31Z"
    },
    {
      "event": "reviewed",
      "id": 1922932806,
      "node_id": "PRR_kwDOABII585ynaBG",
      "url": null,
      "actor": null,
      "commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I looked at each of the limits in aee3b67d43eea083d7299840dd11a61d4cf797b9 to confirm they're plenty-old enough to just disconnect anyone that breaks them.\r\n\r\nWill look at the newly pushed commits later.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1922932806",
      "submitted_at": "2024-03-07T17:00:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
    },
    {
      "event": "commented",
      "id": 1984287276,
      "node_id": "IC_kwDOABII5852RdIs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984287276",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T19:36:01Z",
      "updated_at": "2024-03-07T19:37:23Z",
      "author_association": "MEMBER",
      "body": "Reviewed dee6ca279cac97e167c82b0b2a61d2d2f8df1d47\r\n\r\nI'll run the log commit for a while.\r\n\r\nI'm still a bit on the fence about a903bba4d65720265659c6d4dae6cd8d9ec89c0f.\r\n\r\n> With that, the specific misbehavior is largely irrelevant (for inbound peers, it is now mostly harmless; ...\r\n\r\nSome context here for other reviewers, when you look at `SelectNodeToEvict` one of the criteria that prevents eviction is if they sent us novel blocks. This means that peers that keep sending us useless headers, will probably not enjoy this protection and eventually get replaced. Unless they _also_ give use useful data, in which case they're ... useful - and we can just humor their headers shenaningans.\r\n\r\n> ...  for outbound peers, the eviction logic will eventually kick them out if they're not keeping up with headers at all).\r\n\r\nIIUC outbound peer eviction is handled in `PeerManagerImpl::ConsiderEviction`, which loses its patience after `CHAIN_SYNC_TIMEOUT + HEADERS_RESPONSE_TIME`. That seems a bit late though, if all our outbound peers are slow? Even if that's rare, it seems better to have as many \"fit\" outbound peers as possible.\r\n\r\n\r\nAlso... It might still be useful, even if not needed for security, to _know_ if a peer sent us disconnecting headers. Although the `NET` log still provides a log message `received header %s: missing prev block %s, sending getheaders (%d) to end (peer=%d)`, we don't know the outcome.\r\n\r\nTracking if the peer did this before, e.g. with something like `m_chicken_little`, would make this easier. But not sure if it's worth the complexity. It seems all this would do is reveal that someone tried an attack that we believe to be useless.\r\n\r\n",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1984287276",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "commented",
      "id": 1984388837,
      "node_id": "IC_kwDOABII5852R17l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984388837",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T20:39:03Z",
      "updated_at": "2024-03-07T21:00:53Z",
      "author_association": "MEMBER",
      "body": "@Sjors It's worth taking into account that despite its history as originally being a \"DoS score\", the discouragement logic isn't particularly good at preventing *intentional* abuse of resources; scoring systems are inherently easy to bypass: just do enough to keep the score acceptable, and be as wasteful otherwise (or even better, if many IP addresses are available, use several). The only real solution, in my opinion, for actual DoS protection is keeping track of how many resources (bandwidth, CPU, I/O, ...) we spend on behalf of every peer, and whenever those resources become a bottleneck for us, throttle the worst peers.\r\n\r\nSo the purpose for the discouragement logic as I see it is avoiding wasting resources on (unintentionally) *broken* peers. These are somewhat distinct from *useless* peers (which is what the outbound eviction logic is aimed to prevent). There is an infinite amount of potential broken behavior one can imagine, and clearly we cannot have code for all of it. \r\n\r\nAnother reason for the misbehavior detection is to help protocol implementers get a good idea for expectations around parts of the protocol that aren't formally specified (because it triggers disconnections, and possibly logging). And arguably, unconnecting headers isn't a protocol violation, at least in the context of BIP130 announcements, so disconnecting for something that's very rare but not impossible to trigger in what we'd consider a perfectly compliant protocol implementation would be confusing.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1984388837",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "mentioned",
      "id": 12047805733,
      "node_id": "MEE_lADOABII586BbZV3zwAAAALOGu0l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12047805733",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T20:39:04Z"
    },
    {
      "event": "subscribed",
      "id": 12047805746,
      "node_id": "SE_lADOABII586BbZV3zwAAAALOGu0y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12047805746",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-07T20:39:04Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-08T00:44:48Z",
      "updated_at": "2024-03-08T00:44:48Z",
      "source": {
        "issue": {
          "id": 2100661729,
          "node_id": "PR_kwDOABII585lFGl2",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29318",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29318/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29318/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29318/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29318",
          "number": 29318,
          "state": "open",
          "state_reason": null,
          "title": "test: Check object hashes in wait_for_getheaders",
          "body": "Fixes https://github.com/bitcoin/bitcoin/issues/18614\r\n\r\nPreviously, wait_for_getheaders only looked for the presence of a recent \"getheaders\" message. Additionally checking the hashstop inside the message should make tests involving wait_for_getheaders more robust.\r\n\r\nThis PR is progress towards closing issue: https://github.com/bitcoin/bitcoin/issues/18614  after PR: https://github.com/bitcoin/bitcoin/pull/18690 (merged) which introduced this check for wait_for_getdata ",
          "user": {
            "login": "BrandonOdiwuor",
            "id": 15610188,
            "node_id": "MDQ6VXNlcjE1NjEwMTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/15610188?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/BrandonOdiwuor",
            "html_url": "https://github.com/BrandonOdiwuor",
            "followers_url": "https://api.github.com/users/BrandonOdiwuor/followers",
            "following_url": "https://api.github.com/users/BrandonOdiwuor/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/BrandonOdiwuor/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/BrandonOdiwuor/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/BrandonOdiwuor/subscriptions",
            "organizations_url": "https://api.github.com/users/BrandonOdiwuor/orgs",
            "repos_url": "https://api.github.com/users/BrandonOdiwuor/repos",
            "events_url": "https://api.github.com/users/BrandonOdiwuor/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/BrandonOdiwuor/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29318",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29318",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29318.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29318.patch"
          },
          "created_at": "2024-01-25T15:41:55Z",
          "updated_at": "2024-03-08T00:44:48Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1923216992,
      "node_id": "PRR_kwDOABII585yofZg",
      "url": null,
      "actor": null,
      "commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, a few doc nits and one question below.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1923216992",
      "submitted_at": "2024-03-11T17:18:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T09:41:52Z",
      "updated_at": "2024-03-12T09:41:52Z",
      "source": {
        "issue": {
          "id": 2178805781,
          "node_id": "PR_kwDOABII585pOc2y",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29619",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29619/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29619/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29619/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29619",
          "number": 29619,
          "state": "open",
          "state_reason": null,
          "title": "refactor: consolidate MempoolAcceptResult processing",
          "body": "Every time we try to `ProcessTransaction` (i.e. submit a tx to mempool), we use the result to update a few net processing data structures. For example, after a failure, the {wtxid, txid, both, neither} (depending on reason) should be cached in `m_recent_rejects` so we don't try to download/validate it again.\r\n\r\nThere are 2 current places and at least 1 future place where we need to process `MempoolAcceptResult`:\r\n- In the `ProcessMessage` logic after receiving and validating a tx\r\n- In `ProcessOrphanTx` where we retry orphans\r\n- With #28970, after processing a package of transactions, we should do these updates for each tx in the package.\r\n\r\nConsolidate this code so it isn't repeated in 2 places and so we can reuse it in a future PR.",
          "user": {
            "login": "glozow",
            "id": 25183001,
            "node_id": "MDQ6VXNlcjI1MTgzMDAx",
            "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/glozow",
            "html_url": "https://github.com/glozow",
            "followers_url": "https://api.github.com/users/glozow/followers",
            "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
            "organizations_url": "https://api.github.com/users/glozow/orgs",
            "repos_url": "https://api.github.com/users/glozow/repos",
            "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/glozow/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29619",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29619",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29619.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29619.patch"
          },
          "created_at": "2024-03-11T10:43:39Z",
          "updated_at": "2024-03-12T16:09:24Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1928739577,
      "node_id": "PRR_kwDOABII585y9jr5",
      "url": null,
      "actor": null,
      "commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK. I left some comments inline, plus some general ones that may be addressable with the change of functionality:\r\n\r\n- Looks like `banmah.h` also needs updating, given there is no such thing as how much a peer misbehaves anymore:\r\n\r\n  ```\r\n  (line 37) // 2. Discouragement. If a peer misbehaves enough (see Misbehaving() in\r\n  // net_processing.cpp)\r\n  ```\r\n\r\n- `p2p_filter.py` and `p2p_invalid_messages.py` are asserting logs looking for `Misbehaving`. Shouldn't it be better know to just check that the peer was disconnected in those cases? e.g:\r\n\r\n  ```python\r\n  self.log.info('Check that too large filter is rejected')\r\n  with self.nodes[0].assert_debug_log(['Misbehaving']):\r\n      filter_peer.send_and_ping(msg_filterload(data=b'\\xbb'*(MAX_BLOOM_FILTER_SIZE+1)))\r\n  ```",
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#pullrequestreview-1928739577",
      "submitted_at": "2024-03-12T15:54:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNlMjM4ZGQ3OWJkM2ExMTkwYTIyMjlmYWM0NTAyZmE1NzQyZmM2ZTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ce238dd79bd3a1190a2229fac4502fa5742fc6e3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ce238dd79bd3a1190a2229fac4502fa5742fc6e3",
      "tree": {
        "sha": "1151b29bd819f0e43ec4f42f31b51715a8b6d145",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1151b29bd819f0e43ec4f42f31b51715a8b6d145"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bde3db40f6d5bd5ad499cd9b9c6e8352e713de55",
          "sha": "bde3db40f6d5bd5ad499cd9b9c6e8352e713de55",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bde3db40f6d5bd5ad499cd9b9c6e8352e713de55"
        }
      ],
      "message": "net_processing: do not treat non-connecting headers as response\n\nSince https://github.com/bitcoin/bitcoin/pull/25454 we keep track of the last\nGETHEADERS request that was sent and wasn't responded to. So far, every incoming\nHEADERS message is treated as a response to whatever GETHEADERS was last sent,\nregardless of its contents.\n\nThis commit makes this tracking more accurate, by only treating HEADERS messages\nwhich (1) are empty, (2) connect to our existing block header tree, or (3) are a\ncontinuation of a low-work headers sync as responses that clear the \"outstanding\nGETHEADERS\" state (m_last_getheaders_timestamp).\n\nThat means that HEADERS messages which do not satisfy any of the above criteria\nwill be ignored, not triggering a GETHEADERS, and potentially (for now, but see\nlater commit) increase misbehavior score.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-12T18:46:45Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-12T17:18:15Z"
      },
      "sha": "ce238dd79bd3a1190a2229fac4502fa5742fc6e3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc4NTE1ZTE4NTc1NWY1ZWJhOTUxOTE3YjhlMjMxNGVjNjk0NDZkN2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/78515e185755f5eba951917b8e2314ec69446d7d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/78515e185755f5eba951917b8e2314ec69446d7d",
      "tree": {
        "sha": "43ccd923bbac22ca1fe4afa8682f0c0d143601c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/43ccd923bbac22ca1fe4afa8682f0c0d143601c1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ce238dd79bd3a1190a2229fac4502fa5742fc6e3",
          "sha": "ce238dd79bd3a1190a2229fac4502fa5742fc6e3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ce238dd79bd3a1190a2229fac4502fa5742fc6e3"
        }
      ],
      "message": "net_processing: drop Misbehavior for unconnecting headers\n\nThis misbehavior was originally intended to prevent bandwidth wastage due to\nactually observed very broken (but likely non-malicious) nodes that respond\nto GETHEADERS with a response unrelated to the request, triggering a request\ncycle.\n\nThis has however largely been addressed by the previous commit, which causes\nnon-connecting HEADERS that are received while a GETHEADERS has not been\nresponded to, to be ignored, as long as they do not time out (2 minutes).\nWith that, the specific misbehavior is largely irrelevant (for inbound peers,\nit is now harmless; for outbound peers, the eviction logic will eventually\nkick them out if they're not keeping up with headers at all).",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-12T18:53:29Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-07T16:22:09Z"
      },
      "sha": "78515e185755f5eba951917b8e2314ec69446d7d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGExYWM2YjdmN2NlZWJlNWJhYjIzMWQxNGQwN2M0OWRhOTMxNTQ4OWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a1ac6b7f7ceebe5bab231d14d07c49da9315489a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a1ac6b7f7ceebe5bab231d14d07c49da9315489a",
      "tree": {
        "sha": "6c8116f537c450f5ec823bd5ec6f40b4c04c888e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6c8116f537c450f5ec823bd5ec6f40b4c04c888e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/78515e185755f5eba951917b8e2314ec69446d7d",
          "sha": "78515e185755f5eba951917b8e2314ec69446d7d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/78515e185755f5eba951917b8e2314ec69446d7d"
        }
      ],
      "message": "net_processing: drop 8 headers threshold for incoming BIP130\n\nWith the Misbehavior score gone for non-connecting headers (see previous\ncommit), there is no need to only treat headers messages with up to 8\nheaders as potential BIP130 announcements. BIP130 does not specify such\na limit; it was purely a heuristic.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-12T18:55:57Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-07T16:27:31Z"
      },
      "sha": "a1ac6b7f7ceebe5bab231d14d07c49da9315489a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNjYmYxZjNmOTk4N2Y0M2JlNGJkMzBiYWE0MjhiMDk0ZmFiYTQ5MTI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3cbf1f3f9987f43be4bd30baa428b094faba4912",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3cbf1f3f9987f43be4bd30baa428b094faba4912",
      "tree": {
        "sha": "dd933cf24541e4a5f124cec6b9109d1f5b0bcc33",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dd933cf24541e4a5f124cec6b9109d1f5b0bcc33"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a1ac6b7f7ceebe5bab231d14d07c49da9315489a",
          "sha": "a1ac6b7f7ceebe5bab231d14d07c49da9315489a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a1ac6b7f7ceebe5bab231d14d07c49da9315489a"
        }
      ],
      "message": "net_processing: make all Misbehaving increments = 100\n\nThis removes the need to actually track misbehavior score (see further commit), because any\nMisbehaving node will immediately hit the discouragement threshold.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-12T18:55:57Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-05T13:28:14Z"
      },
      "sha": "3cbf1f3f9987f43be4bd30baa428b094faba4912"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU3Y2NhYTAxZTRlMGVmNTAyZDU3MjczNjdiYWE1NGJjZGNmMWZiODM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "tree": {
        "sha": "45a2d304e1d2ca7723c33056ad0df1fc44d52341",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/45a2d304e1d2ca7723c33056ad0df1fc44d52341"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3cbf1f3f9987f43be4bd30baa428b094faba4912",
          "sha": "3cbf1f3f9987f43be4bd30baa428b094faba4912",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3cbf1f3f9987f43be4bd30baa428b094faba4912"
        }
      ],
      "message": "net_processing: remove Misbehavior score and increments\n\nThis is now all unused.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-12T19:02:21Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-03-05T13:46:03Z"
      },
      "sha": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12093865463,
      "node_id": "HRFPE_lADOABII586BbZV3zwAAAALQ2b33",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12093865463",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T19:09:04Z"
    },
    {
      "event": "commented",
      "id": 1992374122,
      "node_id": "IC_kwDOABII5852wTdq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992374122",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T19:20:15Z",
      "updated_at": "2024-03-12T19:20:15Z",
      "author_association": "MEMBER",
      "body": "Addressed most of the feedback I've gotten.\r\n\r\nAs pointed out by @mzumsande in  https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520116486, the protection I imagined existed against buggy clients causing a `getheaders`/`headers` cycle didn't actually exist. I've instead added that as a separate improvement, becoming the new first commit.\r\n\r\n@sr-gi I have not addressed the `p2p_filter.py and `p2p_invalid_messages.py` using misbehavior logging. These tests use whitelisting to prevent disconnection, and I think reworking that isn't necessarily an improvement.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#issuecomment-1992374122",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29575"
    },
    {
      "event": "mentioned",
      "id": 12093969294,
      "node_id": "MEE_lADOABII586BbZV3zwAAAALQ21OO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12093969294",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T19:20:17Z"
    },
    {
      "event": "subscribed",
      "id": 12093969309,
      "node_id": "SE_lADOABII586BbZV3zwAAAALQ21Od",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12093969309",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T19:20:17Z"
    },
    {
      "event": "mentioned",
      "id": 12093969322,
      "node_id": "MEE_lADOABII586BbZV3zwAAAALQ21Oq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12093969322",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T19:20:17Z"
    },
    {
      "event": "subscribed",
      "id": 12093969331,
      "node_id": "SE_lADOABII586BbZV3zwAAAALQ21Oz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12093969331",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T19:20:17Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1514624757",
      "pull_request_review_id": 1919982697,
      "id": 1514624757,
      "node_id": "PRRC_kwDOABII585aR1b1",
      "diff_hunk": "@@ -569,7 +569,7 @@ def test_nonnull_locators(self, test_node, inv_node):\n \n         # Now try to see how many unconnecting headers we can send\n         # before we get disconnected.  Should be 5*MAX_NUM_UNCONNECTING_HEADERS_MSGS",
      "path": "test/functional/p2p_sendheaders.py",
      "position": null,
      "original_position": 3,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "bdc5776295ee78bc12de5b1c950afc80569a4f3e",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        # Now try to see how many unconnecting headers we can send\r\n        # before we get disconnected.  Should be MAX_NUM_UNCONNECTING_HEADERS_MSGS\r\n```",
      "created_at": "2024-03-06T14:55:07Z",
      "updated_at": "2024-03-06T15:26:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1514624757",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1514624757"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": 570,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 571,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516462725",
      "pull_request_review_id": 1922932806,
      "id": 1516462725,
      "node_id": "PRRC_kwDOABII585aY2KF",
      "diff_hunk": "@@ -1833,8 +1833,7 @@ bool PeerManagerImpl::MaybePunishNodeForBlock(NodeId nodeid, const BlockValidati\n         return true;\n     // Conflicting (but not necessarily invalid) data or different policy:\n     case BlockValidationResult::BLOCK_MISSING_PREV:\n-        // TODO: Handle this much more gracefully (10 DoS points is super arbitrary)\n-        if (peer) Misbehaving(*peer, 10, message);\n+        if (peer) Misbehaving(*peer, 100, message);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "1b6cf1f456ccd250037ff4dbb7a6c0827bcbee26",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is only triggered by `AcceptBlockHeader`, which typically happens _after_ `if(!headers_connect_blockindex)` causes an early return in `ProcessHeadersMessage`.\r\n\r\nIn other words, disconnecting here does not get in the way of `HandleUnconnectingHeaders` processing.\r\n\r\nPresumably (I didn't check) this can be reached if we get an unsolicited BLOCK message. In which case it seems fine to disconnect.\r\n\r\nIt can also be reached when using the `submitblock(header)` RPC, but in that case there is no `peer`.",
      "created_at": "2024-03-07T16:23:31Z",
      "updated_at": "2024-03-07T17:00:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516462725",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516462725"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1836,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516479856",
      "pull_request_review_id": 1922932806,
      "id": 1516479856,
      "node_id": "PRRC_kwDOABII585aY6Vw",
      "diff_hunk": "@@ -2533,7 +2532,7 @@ bool PeerManagerImpl::CheckHeadersPoW(const std::vector<CBlockHeader>& headers,\n \n     // Are these headers connected to each other?\n     if (!CheckHeadersAreContinuous(headers)) {\n-        Misbehaving(peer, 20, \"non-continuous headers sequence\");\n+        Misbehaving(peer, 100, \"non-continuous headers sequence\");",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "1b6cf1f456ccd250037ff4dbb7a6c0827bcbee26",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't know why we ever tolerated this, but it's been that way since headers-first was added in #4468. Perhaps to avoid a network split in the case where headers-first had an implementation bug?\r\n\r\nNote that the `getheaders` message is older, see https://github.com/bitcoin/bitcoin/pull/4468/commits/341735eb8f42e898cf9d4d130709471e5d01abe2#r17027597",
      "created_at": "2024-03-07T16:32:05Z",
      "updated_at": "2024-03-07T17:00:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516479856",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516479856"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2535,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516497005",
      "pull_request_review_id": 1922990282,
      "id": 1516497005,
      "node_id": "PRRC_kwDOABII585aY-ht",
      "diff_hunk": "@@ -569,7 +569,7 @@ def test_nonnull_locators(self, test_node, inv_node):\n \n         # Now try to see how many unconnecting headers we can send\n         # before we get disconnected.  Should be 5*MAX_NUM_UNCONNECTING_HEADERS_MSGS",
      "path": "test/functional/p2p_sendheaders.py",
      "position": null,
      "original_position": 3,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "bdc5776295ee78bc12de5b1c950afc80569a4f3e",
      "in_reply_to_id": 1514624757,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed by deleting that code (and the corresponding test) entirely.",
      "created_at": "2024-03-07T16:44:34Z",
      "updated_at": "2024-03-07T16:44:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516497005",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516497005"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": 570,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 571,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516503890",
      "pull_request_review_id": 1922932806,
      "id": 1516503890,
      "node_id": "PRRC_kwDOABII585aZANS",
      "diff_hunk": "@@ -3782,7 +3781,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (vAddr.size() > MAX_ADDR_TO_SEND)\n         {\n-            Misbehaving(*peer, 20, strprintf(\"%s message size = %u\", msg_type, vAddr.size()));\n+            Misbehaving(*peer, 100, strprintf(\"%s message size = %u\", msg_type, vAddr.size()));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "aee3b67d43eea083d7299840dd11a61d4cf797b9",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I believe this limit was introduced a decade ago in #5419, at least on the sender side.",
      "created_at": "2024-03-07T16:48:54Z",
      "updated_at": "2024-03-07T17:00:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516503890",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516503890"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3784,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516512654",
      "pull_request_review_id": 1922932806,
      "id": 1516512654,
      "node_id": "PRRC_kwDOABII585aZCWO",
      "diff_hunk": "@@ -3864,7 +3863,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         vRecv >> vInv;\n         if (vInv.size() > MAX_INV_SZ)\n         {\n-            Misbehaving(*peer, 20, strprintf(\"inv message size = %u\", vInv.size()));\n+            Misbehaving(*peer, 100, strprintf(\"inv message size = %u\", vInv.size()));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 33,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "aee3b67d43eea083d7299840dd11a61d4cf797b9",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The maximum size of an `inv` message has be 50,000 bytes since Satoshi sneaked in that limit in e2c2648c14f4b87d331dbc30f0f2bd4aab9ce7e6.",
      "created_at": "2024-03-07T16:55:17Z",
      "updated_at": "2024-03-07T17:00:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516512654",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516512654"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3866,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516517837",
      "pull_request_review_id": 1922932806,
      "id": 1516517837,
      "node_id": "PRRC_kwDOABII585aZDnN",
      "diff_hunk": "@@ -4651,7 +4650,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         // Bypass the normal CBlock deserialization, as we don't want to risk deserializing 2000 full blocks.\n         unsigned int nCount = ReadCompactSize(vRecv);\n         if (nCount > MAX_HEADERS_RESULTS) {\n-            Misbehaving(*peer, 20, strprintf(\"headers message size = %u\", nCount));\n+            Misbehaving(*peer, 100, strprintf(\"headers message size = %u\", nCount));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "aee3b67d43eea083d7299840dd11a61d4cf797b9",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This limit has been in place since #4468",
      "created_at": "2024-03-07T16:59:09Z",
      "updated_at": "2024-03-07T17:00:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516517837",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516517837"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4653,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516578761",
      "pull_request_review_id": 1923131116,
      "id": 1516578761,
      "node_id": "PRRC_kwDOABII585aZSfJ",
      "diff_hunk": "@@ -1833,8 +1833,7 @@ bool PeerManagerImpl::MaybePunishNodeForBlock(NodeId nodeid, const BlockValidati\n         return true;\n     // Conflicting (but not necessarily invalid) data or different policy:\n     case BlockValidationResult::BLOCK_MISSING_PREV:\n-        // TODO: Handle this much more gracefully (10 DoS points is super arbitrary)\n-        if (peer) Misbehaving(*peer, 10, message);\n+        if (peer) Misbehaving(*peer, 100, message);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "1b6cf1f456ccd250037ff4dbb7a6c0827bcbee26",
      "in_reply_to_id": 1516462725,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This was my impression as well, that it can only be triggered by unsolicited `block` messages, not through headers logic.",
      "created_at": "2024-03-07T17:44:04Z",
      "updated_at": "2024-03-07T17:44:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516578761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516578761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1836,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516629050",
      "pull_request_review_id": 1923216992,
      "id": 1516629050,
      "node_id": "PRRC_kwDOABII585aZew6",
      "diff_hunk": "@@ -545,7 +543,7 @@ class PeerManagerImpl final : public PeerManager\n      * Increment peer's misbehavior score. If the new value >= DISCOURAGEMENT_THRESHOLD, mark the node",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Doc needs an update.",
      "created_at": "2024-03-07T18:26:19Z",
      "updated_at": "2024-03-11T17:18:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516629050",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516629050"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 543,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516633000",
      "pull_request_review_id": 1923216992,
      "id": 1516633000,
      "node_id": "PRRC_kwDOABII585aZfuo",
      "diff_hunk": "@@ -1765,25 +1761,16 @@ void PeerManagerImpl::AddToCompactExtraTransactions(const CTransactionRef& tx)\n     vExtraTxnForCompactIt = (vExtraTxnForCompactIt + 1) % m_opts.max_extra_txs;\n }\n \n-void PeerManagerImpl::Misbehaving(Peer& peer, int howmuch, const std::string& message)\n+void PeerManagerImpl::Misbehaving(Peer& peer, const std::string& message)\n {\n-    assert(howmuch > 0);\n-\n     LOCK(peer.m_misbehavior_mutex);\n-    const int score_before{peer.m_misbehavior_score};\n-    peer.m_misbehavior_score += howmuch;\n-    const int score_now{peer.m_misbehavior_score};\n \n     const std::string message_prefixed = message.empty() ? \"\" : (\": \" + message);\n-    std::string warning;\n \n-    if (score_now >= DISCOURAGEMENT_THRESHOLD && score_before < DISCOURAGEMENT_THRESHOLD) {\n-        warning = \" DISCOURAGE THRESHOLD EXCEEDED\";\n-        peer.m_should_discourage = true;\n-    }\n+    peer.m_should_discourage = true;\n \n-    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (%d -> %d)%s%s\\n\",\n-             peer.m_id, score_before, score_now, warning, message_prefixed);\n+    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (0 -> 100) DISCOURAGE THRESHOLD EXCEEDED%s\\n\",",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could be simplified to stop mentioning a \"threshold\" and a score that doesn't exist anymore.",
      "created_at": "2024-03-07T18:29:56Z",
      "updated_at": "2024-03-11T17:18:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1516633000",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1516633000"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1772,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520033359",
      "pull_request_review_id": 1923216992,
      "id": 1520033359,
      "node_id": "PRRC_kwDOABII585amd5P",
      "diff_hunk": "@@ -610,7 +610,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Deal with state tracking and headers sync for peers that send the\n      * occasional non-connecting header (this can happen due to BIP 130 headers",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 2,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "7712c5b2d7901fb3bebbb2f6dcf771b38fe44873",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "doc could be updated, the function now deals with non-connecting headers in general.",
      "created_at": "2024-03-11T16:33:05Z",
      "updated_at": "2024-03-11T17:18:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520033359",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520033359"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520116486",
      "pull_request_review_id": 1923216992,
      "id": 1520116486,
      "node_id": "PRRC_kwDOABII585amyMG",
      "diff_hunk": "@@ -129,8 +129,6 @@ static constexpr double BLOCK_DOWNLOAD_TIMEOUT_BASE = 1;\n static constexpr double BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 0.5;\n /** Maximum number of headers to announce when relaying blocks with headers message.*/\n static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n-/** Maximum number of unconnecting headers announcements before DoS score */\n-static const int MAX_NUM_UNCONNECTING_HEADERS_MSGS = 10;",
      "path": "src/net_processing.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "a903bba4d65720265659c6d4dae6cd8d9ec89c0f",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The commit message of a903bba4d65720265659c6d4dae6cd8d9ec89c0f says that https://github.com/bitcoin/bitcoin/pull/25454 has largely addressed the problem of a request cycle, but I don't understand why:\r\nIf we receive an unconnecting header, we send a `GetHeaders`. But if our peer is broken in a way that they ignore the contents of our locator and send us unconnecting headers again, we clear `m_last_getheaders_timestamp`, call `ProcessHeadersMessage` and immediately send a `GetHeaders` again (we wold only delay that if `m_last_getheaders_timestamp` hadn't been cleared)  - and after this PR we wouldn't discourage the peer anymore so that this could go on forever. How did #25454 address that?",
      "created_at": "2024-03-11T17:15:09Z",
      "updated_at": "2024-03-11T17:18:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520116486",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520116486"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 133,
      "original_line": 133,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520238242",
      "pull_request_review_id": 1928739577,
      "id": 1520238242,
      "node_id": "PRRC_kwDOABII585anP6i",
      "diff_hunk": "@@ -1765,25 +1761,16 @@ void PeerManagerImpl::AddToCompactExtraTransactions(const CTransactionRef& tx)\n     vExtraTxnForCompactIt = (vExtraTxnForCompactIt + 1) % m_opts.max_extra_txs;\n }\n \n-void PeerManagerImpl::Misbehaving(Peer& peer, int howmuch, const std::string& message)\n+void PeerManagerImpl::Misbehaving(Peer& peer, const std::string& message)\n {\n-    assert(howmuch > 0);\n-\n     LOCK(peer.m_misbehavior_mutex);\n-    const int score_before{peer.m_misbehavior_score};\n-    peer.m_misbehavior_score += howmuch;\n-    const int score_now{peer.m_misbehavior_score};\n \n     const std::string message_prefixed = message.empty() ? \"\" : (\": \" + message);\n-    std::string warning;\n \n-    if (score_now >= DISCOURAGEMENT_THRESHOLD && score_before < DISCOURAGEMENT_THRESHOLD) {\n-        warning = \" DISCOURAGE THRESHOLD EXCEEDED\";\n-        peer.m_should_discourage = true;\n-    }\n+    peer.m_should_discourage = true;\n \n-    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (%d -> %d)%s%s\\n\",\n-             peer.m_id, score_before, score_now, warning, message_prefixed);\n+    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (0 -> 100) DISCOURAGE THRESHOLD EXCEEDED%s\\n\",",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": 1516633000,
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Does 100 even have a meaning anymore?",
      "created_at": "2024-03-11T18:24:53Z",
      "updated_at": "2024-03-12T15:54:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520238242",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520238242"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1772,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520351086",
      "pull_request_review_id": 1929048352,
      "id": 1520351086,
      "node_id": "PRRC_kwDOABII585anrdu",
      "diff_hunk": "@@ -610,7 +610,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Deal with state tracking and headers sync for peers that send the\n      * occasional non-connecting header (this can happen due to BIP 130 headers",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 2,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "7712c5b2d7901fb3bebbb2f6dcf771b38fe44873",
      "in_reply_to_id": 1520033359,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the comment is still accurate? Happy to take suggestions for what to change in it, though.",
      "created_at": "2024-03-11T19:52:55Z",
      "updated_at": "2024-03-11T19:52:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520351086",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520351086"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520358548",
      "pull_request_review_id": 1929071432,
      "id": 1520358548,
      "node_id": "PRRC_kwDOABII585antSU",
      "diff_hunk": "@@ -129,8 +129,6 @@ static constexpr double BLOCK_DOWNLOAD_TIMEOUT_BASE = 1;\n static constexpr double BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 0.5;\n /** Maximum number of headers to announce when relaying blocks with headers message.*/\n static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n-/** Maximum number of unconnecting headers announcements before DoS score */\n-static const int MAX_NUM_UNCONNECTING_HEADERS_MSGS = 10;",
      "path": "src/net_processing.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "a903bba4d65720265659c6d4dae6cd8d9ec89c0f",
      "in_reply_to_id": 1520116486,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, I was under the mistaken assumption that `m_last_getheaders_timestamp` was only cleared when a connecting header was received. I think that's fine to change here: a response to a requested GETHEADERS will always be connecting.",
      "created_at": "2024-03-11T19:59:24Z",
      "updated_at": "2024-03-11T19:59:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520358548",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520358548"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 133,
      "original_line": 133,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520363411",
      "pull_request_review_id": 1929086807,
      "id": 1520363411,
      "node_id": "PRRC_kwDOABII585anueT",
      "diff_hunk": "@@ -610,7 +610,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Deal with state tracking and headers sync for peers that send the\n      * occasional non-connecting header (this can happen due to BIP 130 headers",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 2,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "7712c5b2d7901fb3bebbb2f6dcf771b38fe44873",
      "in_reply_to_id": 1520033359,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "maybe just drop the \"occasional\" (\"that send non-connecting headers\"), but no big deal either way.",
      "created_at": "2024-03-11T20:03:50Z",
      "updated_at": "2024-03-11T20:04:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520363411",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520363411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520367830",
      "pull_request_review_id": 1928739577,
      "id": 1520367830,
      "node_id": "PRRC_kwDOABII585anvjW",
      "diff_hunk": "@@ -4529,7 +4488,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 ReadStatus status = partialBlock.InitData(cmpctblock, vExtraTxnForCompact);\n                 if (status == READ_STATUS_INVALID) {\n                     RemoveBlockRequest(pindex->GetBlockHash(), pfrom.GetId()); // Reset in-flight state in case Misbehaving does not result in a disconnect",
      "path": "src/net_processing.cpp",
      "position": 325,
      "original_position": 288,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": null,
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is this required anymore? Flagging as misbehaving will result in disconnecting now",
      "created_at": "2024-03-11T20:08:08Z",
      "updated_at": "2024-03-12T15:54:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520367830",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520367830"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4517,
      "original_line": 4517,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520369892",
      "pull_request_review_id": 1928739577,
      "id": 1520369892,
      "node_id": "PRRC_kwDOABII585anwDk",
      "diff_hunk": "@@ -352,15 +352,14 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n     peerLogic->InitializeNode(*nodes[1], NODE_NETWORK);\n     nodes[1]->fSuccessfullyConnected = true;\n     connman->AddTestNode(*nodes[1]);\n-    peerLogic->UnitTestMisbehaving(nodes[1]->GetId(), DISCOURAGEMENT_THRESHOLD - 1);\n     BOOST_CHECK(peerLogic->SendMessages(nodes[1]));\n     // [0] is still discouraged/disconnected.\n     BOOST_CHECK(banman->IsDiscouraged(addr[0]));\n     BOOST_CHECK(nodes[0]->fDisconnect);\n     // [1] is not discouraged/disconnected yet.\n     BOOST_CHECK(!banman->IsDiscouraged(addr[1]));\n     BOOST_CHECK(!nodes[1]->fDisconnect);\n-    peerLogic->UnitTestMisbehaving(nodes[1]->GetId(), 1); // [1] reaches discouragement threshold\n+    peerLogic->UnitTestMisbehaving(nodes[1]->GetId()); // [1] reaches discouragement threshold",
      "path": "src/test/denialofservice_tests.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": null,
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Looks like this comment needs updating since there is no threshold anymore",
      "created_at": "2024-03-11T20:09:54Z",
      "updated_at": "2024-03-12T15:54:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520369892",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520369892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 362,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520394128",
      "pull_request_review_id": 1928739577,
      "id": 1520394128,
      "node_id": "PRRC_kwDOABII585an1-Q",
      "diff_hunk": "@@ -1828,8 +1828,7 @@ bool PeerManagerImpl::MaybePunishNodeForBlock(NodeId nodeid, const BlockValidati\n         return true;\n     // Conflicting (but not necessarily invalid) data or different policy:",
      "path": "src/net_processing.cpp",
      "position": 145,
      "original_position": 2,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "aee3b67d43eea083d7299840dd11a61d4cf797b9",
      "in_reply_to_id": null,
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is this comment accurate? I don't see how it applies ",
      "created_at": "2024-03-11T20:29:50Z",
      "updated_at": "2024-03-12T15:54:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520394128",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520394128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1833,
      "original_line": 1833,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520433771",
      "pull_request_review_id": 1928739577,
      "id": 1520433771,
      "node_id": "PRRC_kwDOABII585an_pr",
      "diff_hunk": "@@ -1848,7 +1835,7 @@ bool PeerManagerImpl::MaybePunishNodeForTx(NodeId nodeid, const TxValidationStat\n         break;\n     // The node is providing invalid data:\n     case TxValidationResult::TX_CONSENSUS:\n-        if (peer) Misbehaving(*peer, 100, \"\");\n+        if (peer) Misbehaving(*peer, \"\");",
      "path": "src/net_processing.cpp",
      "position": 158,
      "original_position": 119,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": null,
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is there a reason why we don't even signal this as a consensus discrepancy? Is it logged somewhere else?",
      "created_at": "2024-03-11T21:07:56Z",
      "updated_at": "2024-03-12T15:54:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1520433771",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1520433771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1855,
      "original_line": 1855,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521535754",
      "pull_request_review_id": 1928739577,
      "id": 1521535754,
      "node_id": "PRRC_kwDOABII585asMsK",
      "diff_hunk": "@@ -129,8 +129,6 @@ static constexpr double BLOCK_DOWNLOAD_TIMEOUT_BASE = 1;\n static constexpr double BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 0.5;\n /** Maximum number of headers to announce when relaying blocks with headers message.*/\n static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n-/** Maximum number of unconnecting headers announcements before DoS score */\n-static const int MAX_NUM_UNCONNECTING_HEADERS_MSGS = 10;",
      "path": "src/net_processing.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "a903bba4d65720265659c6d4dae6cd8d9ec89c0f",
      "in_reply_to_id": 1520116486,
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Does this mean `m_last_getheaders_timestamp` clearing should be moved under `ProcessHeadersMessage` conditionally to `headers_connect_blockindex` being true?",
      "created_at": "2024-03-12T14:07:37Z",
      "updated_at": "2024-03-12T15:54:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521535754",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521535754"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 133,
      "original_line": 133,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521784415",
      "pull_request_review_id": 1931580426,
      "id": 1521784415,
      "node_id": "PRRC_kwDOABII585atJZf",
      "diff_hunk": "@@ -4529,7 +4488,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 ReadStatus status = partialBlock.InitData(cmpctblock, vExtraTxnForCompact);\n                 if (status == READ_STATUS_INVALID) {\n                     RemoveBlockRequest(pindex->GetBlockHash(), pfrom.GetId()); // Reset in-flight state in case Misbehaving does not result in a disconnect",
      "path": "src/net_processing.cpp",
      "position": 325,
      "original_position": 288,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": 1520367830,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yes, because some peers (e.g. ones with special permissions) don't get disconnected.",
      "created_at": "2024-03-12T16:30:30Z",
      "updated_at": "2024-03-12T16:30:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521784415",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521784415"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4517,
      "original_line": 4517,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521988116",
      "pull_request_review_id": 1932112040,
      "id": 1521988116,
      "node_id": "PRRC_kwDOABII585at7IU",
      "diff_hunk": "@@ -1848,7 +1835,7 @@ bool PeerManagerImpl::MaybePunishNodeForTx(NodeId nodeid, const TxValidationStat\n         break;\n     // The node is providing invalid data:\n     case TxValidationResult::TX_CONSENSUS:\n-        if (peer) Misbehaving(*peer, 100, \"\");\n+        if (peer) Misbehaving(*peer, \"\");",
      "path": "src/net_processing.cpp",
      "position": 158,
      "original_position": 119,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": 1520433771,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is the network processing layer, which acts in response to validation failures (to the extent that it needs to punish peers for it). The actual validation failure should be logged through the validation code itself, see `ConnectTip()` there, which logs failures, and invokes the `BlockChecked` signal that is handled by net_processing.",
      "created_at": "2024-03-12T19:04:14Z",
      "updated_at": "2024-03-12T19:04:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521988116",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521988116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1855,
      "original_line": 1855,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521992484",
      "pull_request_review_id": 1932124904,
      "id": 1521992484,
      "node_id": "PRRC_kwDOABII585at8Mk",
      "diff_hunk": "@@ -1828,8 +1828,7 @@ bool PeerManagerImpl::MaybePunishNodeForBlock(NodeId nodeid, const BlockValidati\n         return true;\n     // Conflicting (but not necessarily invalid) data or different policy:",
      "path": "src/net_processing.cpp",
      "position": 145,
      "original_position": 2,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "aee3b67d43eea083d7299840dd11a61d4cf797b9",
      "in_reply_to_id": 1520394128,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Heh, this seems to be a leftover comment that hasn't applied in years. This code used to handle both block and transaction validation failures, but transactions were moved elsewhere. It seems unrelated to this PR, so I won't touch it here.",
      "created_at": "2024-03-12T19:08:27Z",
      "updated_at": "2024-03-12T19:08:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521992484",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521992484"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1833,
      "original_line": 1833,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521993399",
      "pull_request_review_id": 1932127592,
      "id": 1521993399,
      "node_id": "PRRC_kwDOABII585at8a3",
      "diff_hunk": "@@ -545,7 +543,7 @@ class PeerManagerImpl final : public PeerManager\n      * Increment peer's misbehavior score. If the new value >= DISCOURAGEMENT_THRESHOLD, mark the node",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": 1516629050,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-03-12T19:09:20Z",
      "updated_at": "2024-03-12T19:09:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521993399",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521993399"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 543,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521993511",
      "pull_request_review_id": 1932127924,
      "id": 1521993511,
      "node_id": "PRRC_kwDOABII585at8cn",
      "diff_hunk": "@@ -1765,25 +1761,16 @@ void PeerManagerImpl::AddToCompactExtraTransactions(const CTransactionRef& tx)\n     vExtraTxnForCompactIt = (vExtraTxnForCompactIt + 1) % m_opts.max_extra_txs;\n }\n \n-void PeerManagerImpl::Misbehaving(Peer& peer, int howmuch, const std::string& message)\n+void PeerManagerImpl::Misbehaving(Peer& peer, const std::string& message)\n {\n-    assert(howmuch > 0);\n-\n     LOCK(peer.m_misbehavior_mutex);\n-    const int score_before{peer.m_misbehavior_score};\n-    peer.m_misbehavior_score += howmuch;\n-    const int score_now{peer.m_misbehavior_score};\n \n     const std::string message_prefixed = message.empty() ? \"\" : (\": \" + message);\n-    std::string warning;\n \n-    if (score_now >= DISCOURAGEMENT_THRESHOLD && score_before < DISCOURAGEMENT_THRESHOLD) {\n-        warning = \" DISCOURAGE THRESHOLD EXCEEDED\";\n-        peer.m_should_discourage = true;\n-    }\n+    peer.m_should_discourage = true;\n \n-    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (%d -> %d)%s%s\\n\",\n-             peer.m_id, score_before, score_now, warning, message_prefixed);\n+    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (0 -> 100) DISCOURAGE THRESHOLD EXCEEDED%s\\n\",",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": 1516633000,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Gone.",
      "created_at": "2024-03-12T19:09:26Z",
      "updated_at": "2024-03-12T19:09:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521993511",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521993511"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1772,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521993625",
      "pull_request_review_id": 1932128270,
      "id": 1521993625,
      "node_id": "PRRC_kwDOABII585at8eZ",
      "diff_hunk": "@@ -610,7 +610,7 @@ class PeerManagerImpl final : public PeerManager\n     /** Deal with state tracking and headers sync for peers that send the\n      * occasional non-connecting header (this can happen due to BIP 130 headers",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 2,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "7712c5b2d7901fb3bebbb2f6dcf771b38fe44873",
      "in_reply_to_id": 1520033359,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-03-12T19:09:34Z",
      "updated_at": "2024-03-12T19:09:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521993625",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521993625"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521995683",
      "pull_request_review_id": 1932134425,
      "id": 1521995683,
      "node_id": "PRRC_kwDOABII585at8-j",
      "diff_hunk": "@@ -129,8 +129,6 @@ static constexpr double BLOCK_DOWNLOAD_TIMEOUT_BASE = 1;\n static constexpr double BLOCK_DOWNLOAD_TIMEOUT_PER_PEER = 0.5;\n /** Maximum number of headers to announce when relaying blocks with headers message.*/\n static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n-/** Maximum number of unconnecting headers announcements before DoS score */\n-static const int MAX_NUM_UNCONNECTING_HEADERS_MSGS = 10;",
      "path": "src/net_processing.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "a903bba4d65720265659c6d4dae6cd8d9ec89c0f",
      "in_reply_to_id": 1520116486,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done in a separate new first commit. It turned out to be somewhat more complicated as there are 3 distinct conditions that must be treated as responses:\r\n* empty headers messages (they don't announce anything, so they cannot be announcements)\r\n* continuations of low-work header syncs (they're a response to a GETHEADERS, but do not connect to header tree!).\r\n* valid headers messages that connect to our header tree\r\n",
      "created_at": "2024-03-12T19:11:33Z",
      "updated_at": "2024-03-12T19:11:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521995683",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521995683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 133,
      "original_line": 133,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521995889",
      "pull_request_review_id": 1932135054,
      "id": 1521995889,
      "node_id": "PRRC_kwDOABII585at9Bx",
      "diff_hunk": "@@ -352,15 +352,14 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n     peerLogic->InitializeNode(*nodes[1], NODE_NETWORK);\n     nodes[1]->fSuccessfullyConnected = true;\n     connman->AddTestNode(*nodes[1]);\n-    peerLogic->UnitTestMisbehaving(nodes[1]->GetId(), DISCOURAGEMENT_THRESHOLD - 1);\n     BOOST_CHECK(peerLogic->SendMessages(nodes[1]));\n     // [0] is still discouraged/disconnected.\n     BOOST_CHECK(banman->IsDiscouraged(addr[0]));\n     BOOST_CHECK(nodes[0]->fDisconnect);\n     // [1] is not discouraged/disconnected yet.\n     BOOST_CHECK(!banman->IsDiscouraged(addr[1]));\n     BOOST_CHECK(!nodes[1]->fDisconnect);\n-    peerLogic->UnitTestMisbehaving(nodes[1]->GetId(), 1); // [1] reaches discouragement threshold\n+    peerLogic->UnitTestMisbehaving(nodes[1]->GetId()); // [1] reaches discouragement threshold",
      "path": "src/test/denialofservice_tests.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "e7ccaa01e4e0ef502d5727367baa54bcdcf1fb83",
      "original_commit_id": "dee6ca279cac97e167c82b0b2a61d2d2f8df1d47",
      "in_reply_to_id": 1520369892,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2024-03-12T19:11:46Z",
      "updated_at": "2024-03-12T19:11:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29575#discussion_r1521995889",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521995889"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29575"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 362,
      "side": "RIGHT"
    }
  ]
}