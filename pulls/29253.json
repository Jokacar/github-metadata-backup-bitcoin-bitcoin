{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253",
    "id": 1679974105,
    "node_id": "PR_kwDOABII585kIl7Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29253",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29253.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29253.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29253",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29253/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d4ebac8381801d024b69d5f1f5a13246c61edbe4",
    "number": 29253,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: guard against dangling to-be-reverted db transactions",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Discovered while was reviewing #29112, specifically https://github.com/bitcoin/bitcoin/pull/29112#pullrequestreview-1821862931.\r\n\r\nIf the db handler that initiated the database transaction is destroyed,\r\nthe ongoing transaction cannot be left dangling when the db txn fails\r\nto abort. It must be forcefully reverted; otherwise, any subsequent\r\ndb handler executing a write operation will dump the dangling,\r\nto-be-reverted transaction data to disk.\r\n\r\nThis not only breaks the isolation property but also results in the\r\nimproper storage of incomplete information on disk, impacting\r\nthe wallet consistency.\r\n\r\nThis PR fixes the issue by resetting the db connection, automatically\r\nrolling back the transaction (per https://www.sqlite.org/c3ref/close.html)\r\nwhen the handler object is being destroyed and the txn abortion failed.\r\n\r\nTesting Notes\r\nCan verify the failure by reverting the fix e5217fea and running the test.\r\nIt will fail without e5217fea and pass with it.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/61",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61/labels",
      "id": 9334188,
      "node_id": "MI_kwDOABII584Ajm2s",
      "number": 61,
      "state": "open",
      "title": "27.0",
      "description": "",
      "creator": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 9,
      "closed_issues": 31,
      "created_at": "2023-04-27T08:01:57Z",
      "updated_at": "2024-01-16T21:50:58Z"
    },
    "created_at": "2024-01-16T00:41:40Z",
    "updated_at": "2024-01-23T15:09:52Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "024ee04baaf2abfb7a88b45b17e10036d2188a15",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2024_wallet_db_dangling_txn",
      "ref": "2024_wallet_db_dangling_txn",
      "sha": "d4ebac8381801d024b69d5f1f5a13246c61edbe4",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 391396,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-01-23T13:25:40Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-08-30T13:12:58Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a3fb1f80ac38825ed840d29467b4411c02ee2d7f",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36572,
        "stargazers_count": 73496,
        "watchers_count": 73496,
        "size": 247679,
        "default_branch": "master",
        "open_issues_count": 696,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-01-23T15:43:58Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-01-23T15:58:28Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 122,
    "deletions": 8,
    "changed_files": 3,
    "commits": 5,
    "review_comments": 3,
    "comments": 2
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZkZjlmNjY5MDlhMzU0YTk1ZjRiN2M1ZjA5MmYwZTlmYmUxYmFhN2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c",
      "tree": {
        "sha": "8e93b59d21a004b2f7806464800cdf1014afc88c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8e93b59d21a004b2f7806464800cdf1014afc88c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8e93b59d21a004b2f7806464800cdf1014afc88c\nparent 05c4c5a4347018d6d0e81b8f12cf5bdcaa8b4a89\nauthor furszy <matiasfurszyfer@protonmail.com> 1703084833 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1705360162 -0300\n\ntest: wallet db, exercise deadlock after write failure\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWluyIACgkQXdI8zGhq\npiOfzw/6Az5/FcwvnrW5Zb9QTGZubQkEGERTDcqv4ZxykUUL76lKJ2FiV4waUKWP\nTQXFbzfZvwA8sVsg1sf7ve4rHr0YP1Kp92lUBMwjBQ9ikfeZQOt+91jSVQFW8TXr\nMnzV/maS/oimI/rPm0JUoOejBmvxYGN5ehRyrlJJY0iYsS+GUF9X7rgZy0Po7H8E\nQ6aaefWX3C2lTviIFylslUU1+x4pZA/a3sxm/y6LrrM/abBNL3gm1octxKAt28Xf\n61mAs8GWxhLY9qibk8/4hb1RtE7i5StFecaXxpgXN/ZzVUL4CQxSWwns2dcGwqpU\n3qyHq0M4aDtTqMYY3URfEm1K17Pq2rHBuPpy9Aa5MkS1cuVsKGdJnfyh5+xBK8hX\nWSaTRGUGrysQt7cKMbFeXRryF5AwwnuPihtARLahFoNcGpcSLLgR70Y3L/tt8SvQ\n/6anIpfYHFmloDgGeZtJbpodnHU5RuZmhltIa2IOordj2rKSni2p9hNBi2zC9N8H\nkVmiTdY7XUczIgsVL1WZ+Pj3nuMG1C1EDgdLJidD4ivlsFs5G4ByROjqwhfMCklS\nr+KBlvHr+IyAFIbCkmcLDVUItXsClKyL0u+681Pf5WkWo6lM6oKLhwi11GKEUvEH\nE+OVZvj5svE5InTBPpUalU5z4l3vFtslx42mF9vS/7dCjEZCLFs=\n=Xq7S\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/05c4c5a4347018d6d0e81b8f12cf5bdcaa8b4a89",
          "sha": "05c4c5a4347018d6d0e81b8f12cf5bdcaa8b4a89",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/05c4c5a4347018d6d0e81b8f12cf5bdcaa8b4a89"
        }
      ],
      "message": "test: wallet db, exercise deadlock after write failure",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-15T23:09:22Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-12-20T15:07:13Z"
      },
      "sha": "fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhMzlkODEyZTQ3NjY1NzVlMjU3MjEyOTZmYTJkNDNkZmU3ZWJhN2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca39d812e4766575e25721296fa2d43dfe7eba7e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ca39d812e4766575e25721296fa2d43dfe7eba7e",
      "tree": {
        "sha": "9502967a9025728b5aca61e8a0e9f0de76395156",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9502967a9025728b5aca61e8a0e9f0de76395156"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9502967a9025728b5aca61e8a0e9f0de76395156\nparent fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c\nauthor furszy <matiasfurszyfer@protonmail.com> 1704723505 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1705360423 -0300\n\nsqlite: add ability to interrupt statements\n\nBy encapsulating sqlite3_exec into its own standalone method\nand introducing the 'SQliteExecHandler' class, we enable the\nability to test db statements execution failures within the\nunit test framework.\n\nThis is used in the following-up commit to exercise a deadlock.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWlvCcACgkQXdI8zGhq\npiPEFQ//YgRlrcYoUaypV45YpzkA+H89SJt34IDBaKibCZJGTDFHzJ1+fLww+llE\nlREKAC04OApvMtnZT54wrLXxLqIiltyctOnT3qY9inEP1JF1Z8TkNKWCQ+mVAkTI\ncWp7bHOhNEQKxtEv/G0ZayscrEu3k8ZhnDTd5tkJF1GSnqwNXPnJm5kjIKjdffV0\nT3n48+nnTnfuEqIZKvslfyzbhXh2z99w4TBr63SJfnSwSrUKq7BydLCiMYVE4QaI\nUpv4z+5+N/tT0fKz3R6NWmaszQQ563nG1RYBLCG90PdE6w64kQsp2bKFQArf+j5b\nHVXVJaTJPaQ5SeWmc6pCzD6e8+vMtroHUlTGEqrbQpNJ4DAACEOW6MwAPBmkS1G8\nBhXWBzM8XL2JEo8ZPDw0vR3ufzYpVJCzWoGakvJp29uRqzZ9I9JZG7M2eFZp1c2c\nqiROtqpjFci820toz/m2p+5FDvNNYUwSTQ+JVKaOuCV2X6kd8882AvLrfoeO3Lcz\nhIrn0fxKQLOVXh0fD6eQ0OQGg3EtOiOhabm0oGQWkL3CfB9liJcW78C1RInlI5lY\nky6n1hUhaqiRprR87OkiuxQFaGJyufQ2TfvnFWx/Dj2BY0obHqeyZuA1j1zSCvQO\nh00EQfTbnJIj14SmZC0TfEN9pIcqhRpddDXWgmugCgsdhDK+pJ4=\n=KjPQ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c",
          "sha": "fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fdf9f66909a354a95f4b7c5f092f0e9fbe1baa7c"
        }
      ],
      "message": "sqlite: add ability to interrupt statements\n\nBy encapsulating sqlite3_exec into its own standalone method\nand introducing the 'SQliteExecHandler' class, we enable the\nability to test db statements execution failures within the\nunit test framework.\n\nThis is used in the following-up commit to exercise a deadlock.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-15T23:13:43Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-08T14:18:25Z"
      },
      "sha": "ca39d812e4766575e25721296fa2d43dfe7eba7e"
    },
    {
      "event": "commented",
      "id": 1892913940,
      "node_id": "IC_kwDOABII585w05MU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1892913940",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-16T00:41:43Z",
      "updated_at": "2024-01-23T15:09:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29253).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/29253#issuecomment-1906252904) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29112](https://github.com/bitcoin/bitcoin/pull/29112) (sqlite: Disallow writing from multiple `SQLiteBatch`s by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29253#issuecomment-1892913940",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29253"
    },
    {
      "event": "labeled",
      "id": 11493057640,
      "node_id": "LE_lADOABII5858JbUhzwAAAAKtCiRo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11493057640",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-16T00:41:45Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-16T00:55:53Z",
      "updated_at": "2024-01-16T00:55:53Z",
      "source": {
        "issue": {
          "id": 2047565192,
          "node_id": "PR_kwDOABII585iT-Q8",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29112",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29112/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29112/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29112/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29112",
          "number": 29112,
          "state": "open",
          "state_reason": null,
          "title": "sqlite: Disallow writing from multiple `SQLiteBatch`s",
          "body": "The way that we have configured SQLite to run means that only one database transaction can be open at a time. Typically, each individual read and write operation will be its own transaction that is opened and committed automatically by SQLite. However, sometimes we want these operations to be batched into a multi-statement transaction, so `SQLiteBatch::TxnBegin`, `SQLiteBatch::TxnCommit`, and `SQLiteBatch::TxnAbort` are used to manage the transaction of the database.\r\n\r\nHowever, once a db transaction is begun with one `SQLiteBatch`, any operations performed by another `SQLiteBatch` will also occur within the same transaction. Furthermore, those other `SQLiteBatch`s will not be expecting a transaction to be active, and will abort it once the `SQLiteBatch` is destructed. This is problematic as it will prevent some data from being written, and also cause the `SQLiteBatch` that opened the transaction in the first place to be in an unexpected state and throw an error.\r\n\r\nTo avoid this situation, we need to prevent the multiple batches from writing at the same time. Although SQLite does have facilities for doing that, they require the Write Ahead Log (WAL) mode, which is a feature that we explicitly chose to disable since it spread wallet data to multiple files. As such, we need to be handling the concurrency ourselves. To do so, I've implemented added a `CSemaphore` within `SQLiteDatabase` which will be used by any `SQLiteBatch` trying to do a write operation. `wait()` is called by `TxnBegin`, and at the beginning of `WriteKey`, `EraseKey`, and `ErasePrefix`. `post()` is called in `TxnCommit`, `TxnAbort` and at the end of `WriteKey`, `EraseKey`, and `ErasePrefix`. To avoid deadlocking on ` TxnBegin()` followed by a `WriteKey()`, `SQLiteBatch will now also track whether a transaction is in progress so that it knows whether to use the semaphore.\r\n\r\nThis issue is not a problem for BDB wallets since BDB uses WAL and provides transaction objects that must be used if an operation is to occur within a transaction. Specifically, we either pass a transaction pointer, or a nullptr, to all BDB operations, and this allows for concurrent transactions so it doesn't have this problem.\r\n\r\nFixes #29110",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "milestone": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61",
            "html_url": "https://github.com/bitcoin/bitcoin/milestone/61",
            "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61/labels",
            "id": 9334188,
            "node_id": "MI_kwDOABII584Ajm2s",
            "number": 61,
            "state": "open",
            "title": "27.0",
            "description": "",
            "creator": {
              "login": "sipa",
              "id": 548488,
              "node_id": "MDQ6VXNlcjU0ODQ4OA==",
              "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/sipa",
              "html_url": "https://github.com/sipa",
              "followers_url": "https://api.github.com/users/sipa/followers",
              "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
              "organizations_url": "https://api.github.com/users/sipa/orgs",
              "repos_url": "https://api.github.com/users/sipa/repos",
              "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/sipa/received_events",
              "type": "User",
              "site_admin": false
            },
            "open_issues": 9,
            "closed_issues": 31,
            "created_at": "2023-04-27T08:01:57Z",
            "updated_at": "2024-01-16T21:50:58Z"
          },
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29112",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29112",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29112.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29112.patch"
          },
          "created_at": "2023-12-18T22:27:10Z",
          "updated_at": "2024-01-17T23:42:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-16T06:37:20Z",
      "updated_at": "2024-01-16T06:37:20Z",
      "source": {
        "issue": {
          "id": 1958204865,
          "node_id": "PR_kwDOABII585dlfBo",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
          "number": 28710,
          "state": "open",
          "state_reason": null,
          "title": "Remove the legacy wallet and BDB dependency",
          "body": "The final step of #20160.\r\n\r\nA bare minimum of legacy wallet code is kept in order to perform wallet migration. Migration of legacy wallets uses the independent BDB parser and a minimal `LegacyDataSPKM` that allows the legacy data to be loaded so that the migration can be completed.\r\n\r\nAll tests which tested legacy wallet behavior have been removed. The `--descriptors` and `--legacy-wallet` options are removed from the functional tests.\r\n\r\nBDB has been removed as a dependency and documentation have been updated to reflect that.\r\n\r\nDepends on #26596",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28710",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28710.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28710.patch"
          },
          "created_at": "2023-10-23T23:36:07Z",
          "updated_at": "2024-01-17T16:50:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1824875743,
      "node_id": "PRR_kwDOABII585sxWTf",
      "url": null,
      "actor": null,
      "commit_id": "fb9e1b3074ff5911b11fcfe918a59a843a2dbd64",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29253#pullrequestreview-1824875743",
      "submitted_at": "2024-01-16T20:11:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU2NzBhMjFmNWVmMjg3NDhiNmI3MjQyYzAzYjgyZjM5ZGNiYzk4M2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5670a21f5ef28748b6b7242c03b82f39dcbc983f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5670a21f5ef28748b6b7242c03b82f39dcbc983f",
      "tree": {
        "sha": "687006c1053d5955a1eea827fd68439779206552",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/687006c1053d5955a1eea827fd68439779206552"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 687006c1053d5955a1eea827fd68439779206552\nparent ca39d812e4766575e25721296fa2d43dfe7eba7e\nauthor furszy <matiasfurszyfer@protonmail.com> 1705360714 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1705436279 -0300\n\nsqlite: introduce HasActiveTxn method\n\nUtil function to clean up code and let us\nverify, in the following-up commit, that dangling,\nto-be-reverted db transactions cannot occur anymore.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWm5HcACgkQXdI8zGhq\npiPT8A//dSBpQShz8Fc0//mhjMzepxUJmywk0egd+V1vBS1qQyLuJwUWUTW80R2O\nfsR3oQ5NQKqOdvWyTFXPeCK+Gp/rOv1haYTnbY5UkTTwpsYRvmsF5tceLxo9iU3w\n/SWg3iBYvxB2qBXf3sX5+VaYWaQEpKErRWi+1s+a7i5gQfcFNfsxkZW5IIV5Ht4O\nuBE0XHRDzzFRhZOSqOs8hq4eJmoFo5UWdXhO/gBq6G2NGe29XbUCxwPFntEN2KG9\nK2VoR2U5TrgPfGX9PzUfzU04tG1td75vk8LX2N4N4UJ3rK39PQxoYXYxadmQ4bRw\nVkg8fZb7uDQL9Q5sMjC8/znKha66puoZowwbij+lQpSmmqfleyMyCjFet4aFQ7x4\njuZVQFtfhneLzDJbjWjqozyp2xLzsWjAY7TvAk29Cqxmjm4KXLJNCs/IgKP82f6i\nnHVdUOfmXIcmHbg17b2svJVZOUZH660CW/gCQ3Lr+Gaj0S6hPHrBXuyTcSo/XbZV\newGSixhaanXTwqbxo91OEzd8Rd9chtHjEjFcfgnOuMWWi/lROMecHMKBSaTuPfNJ\nGVZHUxkeUgDep0bDYLuWM0QU4ATa2xi+e053AbDze3QcHsXCHAoQfYgdy2CK++Tm\nZSsAbTdqw5bT4mEY+hdB6uK7pNu2yjA05J79W8WsoFEaHqIqX2k=\n=i/HC\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca39d812e4766575e25721296fa2d43dfe7eba7e",
          "sha": "ca39d812e4766575e25721296fa2d43dfe7eba7e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ca39d812e4766575e25721296fa2d43dfe7eba7e"
        }
      ],
      "message": "sqlite: introduce HasActiveTxn method\n\nUtil function to clean up code and let us\nverify, in the following-up commit, that dangling,\nto-be-reverted db transactions cannot occur anymore.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-16T20:17:59Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-15T23:18:34Z"
      },
      "sha": "5670a21f5ef28748b6b7242c03b82f39dcbc983f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUwOGZkYTJmZGRmZWYwY2VmZWRkZTk3NzdjOTE0YWVjNzJhZGY3ZmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/508fda2fddfef0cefedde9777c914aec72adf7fb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/508fda2fddfef0cefedde9777c914aec72adf7fb",
      "tree": {
        "sha": "e8fa2b798e92efb69f56740ec0d8e17cc14ae1d7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e8fa2b798e92efb69f56740ec0d8e17cc14ae1d7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e8fa2b798e92efb69f56740ec0d8e17cc14ae1d7\nparent 5670a21f5ef28748b6b7242c03b82f39dcbc983f\nauthor furszy <matiasfurszyfer@protonmail.com> 1705362189 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1705436279 -0300\n\nsqlite: guard against dangling to-be-reverted db transactions\n\nIf the handler that initiated the database transaction is destroyed,\nthe ongoing transaction cannot be left dangling when the db txn fails\nto abort. It must be forcefully reversed; otherwise, any subsequent\ndb handler executing a write operation will dump the dangling,\nto-be-reverted transaction data to disk.\n\nThis not only breaks the database isolation property but also results\nin the improper storage of incomplete information on disk, impacting\nthe wallet consistency.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWm5HcACgkQXdI8zGhq\npiN3IBAAzBMbcfLDuQaPQZCGpirL8kR6ZdEtRRCG8lYOXEtzKUzZ8Lb3r5UfD2TV\nUG+eKB9pdE0t8oGEcuqepupzQ3iM25sezMcOicawvg3tHQSyJUnXLPWUrnJYQQTs\nn+cs+wz50VoYhm9o5VhLLg3OfQy9EZRPHmQER1NqTOuJl9ACWxFk0U+IefA1hUEc\n2qBOw+A4DyVJI+Lr7x2vqxl/5MzjaQ07q2XKa6Bd1TL/Q70hu0GOsgAQYZYZq/31\n7XiWVr7gF/SV0RILWaUd2FgchlHnuHH+Zs1YJy2sFIIt+AYENSEZgjAMSLlW4Tqu\n87vLpJ1KZh4MEeVlfDtpT47wbRIJhoml6HievYeOeEhVXDMjfI/SZUzZV3BnWC14\nx8frPkMAcxWlXnixKKmKkJP1FFaO4FNUZA4S1IzabUYJJXFWXN4yoYVLrWehs6mh\n8FkMNXpx0P+mm/Ngpko1oAGsBLEi7ahoukU0FXK7Hh8jAMgPwOzqsyyMjU2jJGwe\nQyYphcpriSaXshqh/6+WhUBbgoyUb44M0lr7gHT7vpLeXmlRFr6uYC5rrxUsp0Ya\ngOkWg45ppvw3kG2nyH4IF86hQpu3jgqh1IKLgxYHN9nPlDsXxgYKSr80+eS9oT82\nboZTrNMsS2LepoDHFItL8B2IiLcwarROVbr+pl8F7EwoEL0G0cA=\n=VUkB\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5670a21f5ef28748b6b7242c03b82f39dcbc983f",
          "sha": "5670a21f5ef28748b6b7242c03b82f39dcbc983f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5670a21f5ef28748b6b7242c03b82f39dcbc983f"
        }
      ],
      "message": "sqlite: guard against dangling to-be-reverted db transactions\n\nIf the handler that initiated the database transaction is destroyed,\nthe ongoing transaction cannot be left dangling when the db txn fails\nto abort. It must be forcefully reversed; otherwise, any subsequent\ndb handler executing a write operation will dump the dangling,\nto-be-reverted transaction data to disk.\n\nThis not only breaks the database isolation property but also results\nin the improper storage of incomplete information on disk, impacting\nthe wallet consistency.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-16T20:17:59Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-15T23:43:09Z"
      },
      "sha": "508fda2fddfef0cefedde9777c914aec72adf7fb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ0ZWJhYzgzODE4MDFkMDI0YjY5ZDVmMWY1YTEzMjQ2YzYxZWRiZTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d4ebac8381801d024b69d5f1f5a13246c61edbe4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d4ebac8381801d024b69d5f1f5a13246c61edbe4",
      "tree": {
        "sha": "d1c65463a3b3dbfe5bbaa91898d32f52d82e95f2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d1c65463a3b3dbfe5bbaa91898d32f52d82e95f2"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d1c65463a3b3dbfe5bbaa91898d32f52d82e95f2\nparent 508fda2fddfef0cefedde9777c914aec72adf7fb\nauthor furszy <matiasfurszyfer@protonmail.com> 1704723565 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1705436279 -0300\n\ntest: sqlite, add coverage for dangling to-be-reverted db txns\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWm5HcACgkQXdI8zGhq\npiNdbxAAiM9durlEPm/qesw105hr5lMjyTN57VRUecwPcEGJL288mhFoZHgrNWE4\nW2KDFHeUUL2y6d/ykSo848MS0xhDgd2O6zmn0I9NW0QhWfLSwHv0EH4RkNWU3p8L\nVgzjdQNlj77H57IdD8XMIuAeEDW8qEaIV1HIRIc26hEOvNxXPEm1WlZ5GVpF/B2n\nvpwrlp2e5h/OfNWxlW9ZsnkpoOkJY/81x+pB/yzOCYOKz5ZFLCFCOHrqsqPPmsnX\nyo8oJq4YKtdJprkOStRAUGZvH5ymsBkHM6qkmjtbrfvcDqEHLgsX7lsj9BmBRkOV\nDKn7VmLYQ26Yth104tdIQgMWbbs45acfMHvZ0DZjRQPnfpHrXUhN9Gjrxu5NP+Rf\nJhf9v1w99rWSeX2oKrhdow+hoEHh8f3bZit3wXYLbva068vOnKATZaBe1f4jkiBP\nzelVPhLqorXcERjYWMSjqcydAslHVXdrVHd/u7I0eHstEKwP4/SOYxy3hzPjVOtJ\nBVK3HlWZq9HpbrRitL9CSXgyhHyHNjqUWa7Lzgx2LBeUnDuRMjTFaAf4shaqryoK\np9auik62wi2VmKDWN0YIjWTojeRXi55BgsAfGS8kJPXn/OkcdpERlFh5rMs3RK1j\nxBUfHIZGYF3jqW3YY9570EYkWTP2sMnZcWgxR+ilKNHOGpSmFVw=\n=CwPy\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/508fda2fddfef0cefedde9777c914aec72adf7fb",
          "sha": "508fda2fddfef0cefedde9777c914aec72adf7fb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/508fda2fddfef0cefedde9777c914aec72adf7fb"
        }
      ],
      "message": "test: sqlite, add coverage for dangling to-be-reverted db txns",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-16T20:17:59Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-08T14:19:25Z"
      },
      "sha": "d4ebac8381801d024b69d5f1f5a13246c61edbe4"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11503442522,
      "node_id": "HRFPE_lADOABII5858JbUhzwAAAAKtqJpa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11503442522",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-16T20:19:20Z"
    },
    {
      "event": "milestoned",
      "id": 11504178197,
      "node_id": "MIE_lADOABII5858JbUhzwAAAAKts9QV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11504178197",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-16T21:50:58Z",
      "milestone": {
        "title": "27.0"
      }
    },
    {
      "event": "comment_deleted",
      "id": 11559368171,
      "node_id": "CDE_lADOABII5858JbUhzwAAAAKw_fXr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11559368171",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-22T16:47:06Z"
    },
    {
      "event": "commented",
      "id": 1906252904,
      "node_id": "IC_kwDOABII585xnxxo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1906252904",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-23T15:09:48Z",
      "updated_at": "2024-01-23T15:09:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm trying to understand this, but confused about why executing \"ROLLBACK TRANSACTION\" would be expected to fail in sqlite. It seems like the fix in e5217fea1516120643f4a7a55a474648e21e2269 is handling failure to roll back by trying to close and reopen the database. But I don't understand why rolling back a transaction would fail to begin with, unless there was some serious error like disk corruption. Probably to make the this fix clearer and safer it would be good to check the specific error code from the failed rollback instead of just checking res == SQLITE_OK. But I'm generally just confused.\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29253#issuecomment-1906252904",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29253"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1453968110",
      "pull_request_review_id": 1824875743,
      "id": 1453968110,
      "node_id": "PRRC_kwDOABII585Wqcru",
      "diff_hunk": "@@ -612,7 +617,7 @@ std::unique_ptr<DatabaseCursor> SQLiteBatch::GetNewPrefixCursor(Span<const std::\n \n bool SQLiteBatch::TxnBegin()\n {\n-    if (!m_database.m_db || sqlite3_get_autocommit(m_database.m_db) == 0) return false;\n+    if (!m_database.m_db || m_database.HasActiveTxn()) return false;",
      "path": "src/wallet/sqlite.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "d4ebac8381801d024b69d5f1f5a13246c61edbe4",
      "original_commit_id": "83c807a380b41787214806c6440236ea1a9dabd7",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 83c807a380b41787214806c6440236ea1a9dabd7 \"sqlite: introduce HasActiveTxn method\"\r\n\r\n`HasActiveTxn()` checks for `m_db` already, so no need to do check that here too.\r\n\r\nSame for `TxnCommit()` and `TxnAbort()`.",
      "created_at": "2024-01-16T20:10:05Z",
      "updated_at": "2024-01-16T20:11:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29253#discussion_r1453968110",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1453968110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 620,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1453982729",
      "pull_request_review_id": 1824891279,
      "id": 1453982729,
      "node_id": "PRRC_kwDOABII585WqgQJ",
      "diff_hunk": "@@ -612,7 +617,7 @@ std::unique_ptr<DatabaseCursor> SQLiteBatch::GetNewPrefixCursor(Span<const std::\n \n bool SQLiteBatch::TxnBegin()\n {\n-    if (!m_database.m_db || sqlite3_get_autocommit(m_database.m_db) == 0) return false;\n+    if (!m_database.m_db || m_database.HasActiveTxn()) return false;",
      "path": "src/wallet/sqlite.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "d4ebac8381801d024b69d5f1f5a13246c61edbe4",
      "original_commit_id": "83c807a380b41787214806c6440236ea1a9dabd7",
      "in_reply_to_id": 1453968110,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "upps done",
      "created_at": "2024-01-16T20:22:19Z",
      "updated_at": "2024-01-16T20:22:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29253#discussion_r1453982729",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1453982729"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 620,
      "side": "RIGHT"
    }
  ]
}