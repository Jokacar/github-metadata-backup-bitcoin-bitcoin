{
  "type": "issue",
  "issue": {
    "id": 857223388,
    "node_id": "MDU6SXNzdWU4NTcyMjMzODg=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/21670",
    "number": 21670,
    "state": "open",
    "state_reason": null,
    "title": "How to convert dumptxoutset rpc result to human readable JSON",
    "body": "As the rpc `dumptxoutset`  is new so there is a little help and samples about it, could any one kindly help me to convert `dumptxoutset` rpc result to human readable JSON?",
    "user": {
      "login": "Stonica",
      "id": 7851057,
      "node_id": "MDQ6VXNlcjc4NTEwNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7851057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Stonica",
      "html_url": "https://github.com/Stonica",
      "followers_url": "https://api.github.com/users/Stonica/followers",
      "following_url": "https://api.github.com/users/Stonica/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Stonica/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Stonica/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Stonica/subscriptions",
      "organizations_url": "https://api.github.com/users/Stonica/orgs",
      "repos_url": "https://api.github.com/users/Stonica/repos",
      "events_url": "https://api.github.com/users/Stonica/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Stonica/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 3,
    "created_at": "2021-04-13T18:36:53Z",
    "updated_at": "2023-03-09T20:37:08Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 818969784,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxODk2OTc4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818969784",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T18:41:29Z",
      "updated_at": "2021-04-13T18:41:29Z",
      "author_association": "MEMBER",
      "body": "#18689 ",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21670#issuecomment-818969784",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670"
    },
    {
      "event": "commented",
      "id": 820580055,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgyMDU4MDA1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820580055",
      "actor": {
        "login": "Stonica",
        "id": 7851057,
        "node_id": "MDQ6VXNlcjc4NTEwNTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7851057?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Stonica",
        "html_url": "https://github.com/Stonica",
        "followers_url": "https://api.github.com/users/Stonica/followers",
        "following_url": "https://api.github.com/users/Stonica/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Stonica/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Stonica/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Stonica/subscriptions",
        "organizations_url": "https://api.github.com/users/Stonica/orgs",
        "repos_url": "https://api.github.com/users/Stonica/repos",
        "events_url": "https://api.github.com/users/Stonica/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Stonica/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-15T16:51:31Z",
      "updated_at": "2021-04-15T16:51:46Z",
      "author_association": "NONE",
      "body": "> \r\n> \r\n> #18689\r\n\r\nI am using Windows and unfortunately `bitcoin-cli.exe` does not accept any argument except the output filename.",
      "user": {
        "login": "Stonica",
        "id": 7851057,
        "node_id": "MDQ6VXNlcjc4NTEwNTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7851057?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Stonica",
        "html_url": "https://github.com/Stonica",
        "followers_url": "https://api.github.com/users/Stonica/followers",
        "following_url": "https://api.github.com/users/Stonica/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Stonica/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Stonica/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Stonica/subscriptions",
        "organizations_url": "https://api.github.com/users/Stonica/orgs",
        "repos_url": "https://api.github.com/users/Stonica/repos",
        "events_url": "https://api.github.com/users/Stonica/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Stonica/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21670#issuecomment-820580055",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-21T17:23:00Z",
      "updated_at": "2022-03-21T17:23:00Z",
      "source": {
        "issue": {
          "id": 1175702554,
          "node_id": "I_kwDOABII585GE8wa",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24628",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24628/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24628/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24628/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/24628",
          "number": 24628,
          "state": "open",
          "state_reason": null,
          "title": "rpc: dumptxoutset as sqlite file",
          "body": "There has been at least 3 efforts to expand the `dumptxoutset` command to be able to export the data as CSV: \r\n* https://github.com/bitcoin/bitcoin/pull/18689\r\n* https://github.com/bitcoin/bitcoin/pull/24202\r\n* [luke-jr/bitcoin#rpc_dumptxoutset_hr](https://github.com/luke-jr/bitcoin/tree/rpc_dumptxoutset_hr)\r\n\r\nJSON export also has been requested: https://github.com/bitcoin/bitcoin/issues/21670\r\n\r\nLately [@theStack suggested](https://github.com/bitcoin/bitcoin/pull/24202#issuecomment-1064124278) that we can leverage the SQLite format for the export.\r\n\r\nI think this is the best approach since it is trivial to export both CSV and JSON from SQLite + you can access the file programatically via virtually any programming language:\r\n* `sqlite3 -header -csv foo.db \"select * from foo\" > foo.csv`\r\n* `sqlite3 -json foo.db \"select * from foo\" > foo.json`\r\n\r\n... and we already have SQLite as an optional dependency. Such format is also future proof (we can add new table columns if needed).",
          "user": {
            "login": "prusnak",
            "id": 42201,
            "node_id": "MDQ6VXNlcjQyMjAx",
            "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/prusnak",
            "html_url": "https://github.com/prusnak",
            "followers_url": "https://api.github.com/users/prusnak/followers",
            "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
            "organizations_url": "https://api.github.com/users/prusnak/orgs",
            "repos_url": "https://api.github.com/users/prusnak/repos",
            "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/prusnak/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 8,
          "created_at": "2022-03-21T17:23:00Z",
          "updated_at": "2022-05-29T20:49:46Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1462753761,
      "node_id": "IC_kwDOABII585XL9nh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1462753761",
      "actor": {
        "login": "adamjonas",
        "id": 755825,
        "node_id": "MDQ6VXNlcjc1NTgyNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/755825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjonas",
        "html_url": "https://github.com/adamjonas",
        "followers_url": "https://api.github.com/users/adamjonas/followers",
        "following_url": "https://api.github.com/users/adamjonas/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adamjonas/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adamjonas/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adamjonas/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjonas/orgs",
        "repos_url": "https://api.github.com/users/adamjonas/repos",
        "events_url": "https://api.github.com/users/adamjonas/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adamjonas/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-09T20:37:08Z",
      "updated_at": "2023-03-09T20:37:08Z",
      "author_association": "MEMBER",
      "body": "There doesn't seem to be a lot of interest for the feature based on this issue but https://github.com/bitcoin/bitcoin/pull/24202 was pretty close.",
      "user": {
        "login": "adamjonas",
        "id": 755825,
        "node_id": "MDQ6VXNlcjc1NTgyNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/755825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjonas",
        "html_url": "https://github.com/adamjonas",
        "followers_url": "https://api.github.com/users/adamjonas/followers",
        "following_url": "https://api.github.com/users/adamjonas/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adamjonas/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adamjonas/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adamjonas/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjonas/orgs",
        "repos_url": "https://api.github.com/users/adamjonas/repos",
        "events_url": "https://api.github.com/users/adamjonas/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adamjonas/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21670#issuecomment-1462753761",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21670"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-06T18:01:47Z",
      "updated_at": "2023-04-06T18:01:47Z",
      "source": {
        "issue": {
          "id": 1657835564,
          "node_id": "PR_kwDOABII585NyjW8",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27432",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27432/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27432/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27432/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27432",
          "number": 27432,
          "state": "open",
          "state_reason": null,
          "title": "contrib: add tool to convert compact-serialized UTXO set to SQLite database",
          "body": "## Problem description\r\n\r\nThere is demand from users to get the UTXO set in form of a SQLite database (#24628). Bitcoin Core currently only supports dumping the UTXO set in a binary _compact-serialized_ format, which was crafted specifically for AssumeUTXO snapshots (see PR #16899), with the primary goal of being as compact as possible. Previous PRs tried to extend the `dumptxoutset` RPC with new formats, either in human-readable form (e.g. #18689, #24202), or most recently, directly as SQLite database (#24952). Both are not optimal: due to the huge size of the ever-growing UTXO set with already more than 80 million entries on mainnet, human-readable formats are practically useless, and very likely one of the first steps would be to put them in some form of database anyway. Directly adding SQLite3 dumping support on the other hand introduces an additional dependency to the non-wallet part of bitcoind and the risk of increased maintenance burden (see e.g. https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1163551060, https://github.com/bitcoin/bitcoin/issues/24628#issuecomment-1108469715).\r\n\r\n## Proposed solution\r\n\r\nThis PR follows the \"external tooling\" route by adding a simple Python script for achieving the same goal in a two-step process (first create compact-serialized UTXO set via `dumptxoutset`, then convert it to SQLite via the new script). Executive summary:\r\n- single file, no extra dependencies (sqlite3 is included in Python's standard library [1])\r\n- ~150 LOC, mostly deserialization/decompression routines ported from the Core codebase and (probably the most difficult part) a little elliptic curve / finite field math to decompress pubkeys (essentialy solving the secp256k1 curve equation y^2 = x^3 + 7 for y given x, respecting the proper polarity as indicated by the compression tag)\r\n- creates a database with only one table `utxos` with the following schema:\r\n  ```(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT)```\r\n- the resulting file has roughly 2x the size of the compact-serialized UTXO set (this is mostly due to encoding txids and scriptpubkeys as hex-strings rather than bytes)\r\n\r\n[1] note that there are some rare cases of operating systems like FreeBSD though, where the sqlite3 module has to installed explicitly (see #26819)\r\n\r\nA functional test is also added that creates UTXO set entries with various output script types (standard and also non-standard, for e.g. large scripts) and verifies that the UTXO sets of both formats match by comparing corresponding MuHashes. One MuHash is supplied by the bitcoind instance via `gettxoutsetinfo muhash`, the other is calculated in the test by reading back the created SQLite database entries and hashing them with the test framework's `MuHash3072` module.\r\n\r\n## Manual test instructions\r\nI'd suggest to do manual tests also by comparing MuHashes. For that, I've written a go tool some time ago which would calculate the MuHash of a sqlite database in the created format (I've tried to do a similar tool in Python, but it's painfully slow).\r\n```\r\n$ [run bitcoind instance with -coinstatsindex]\r\n$ ./src/bitcoin-cli dumptxoutset ~/utxos.dat\r\n$ ./src/bitcoin-cli gettxoutsetinfo muhash <block height returned in previous call>\r\n(outputs MuHash calculated from node)\r\n\r\n$ ./contrib/utxo-tools/utxo_to_sqlite.py ~/utxos.dat ~/utxos.sqlite\r\n$ git clone https://github.com/theStack/utxo_dump_tools\r\n$ cd utxo_dump_tools/calc_utxo_hash\r\n$ go run calc_utxo_hash.go ~/utxos.sqlite\r\n(outputs MuHash calculated from the SQLite UTXO set)\r\n\r\n=> verify that both MuHashes are equal\r\n```\r\nFor a demonstration what can be done with the resulting database, see https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-956290477 for some example queries. Thanks go to LarryRuane who gave me to the idea of rewriting this script in Python and adding it to `contrib`.",
          "user": {
            "login": "theStack",
            "id": 91535,
            "node_id": "MDQ6VXNlcjkxNTM1",
            "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/theStack",
            "html_url": "https://github.com/theStack",
            "followers_url": "https://api.github.com/users/theStack/followers",
            "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
            "organizations_url": "https://api.github.com/users/theStack/orgs",
            "repos_url": "https://api.github.com/users/theStack/repos",
            "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/theStack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 231994551,
              "node_id": "MDU6TGFiZWwyMzE5OTQ1NTE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Scripts%20and%20tools",
              "name": "Scripts and tools",
              "color": "ffffee",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27432",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27432",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27432.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27432.patch"
          },
          "created_at": "2023-04-06T17:59:23Z",
          "updated_at": "2023-07-31T18:59:17Z"
        },
        "type": "issue"
      }
    }
  ]
}