{
  "type": "issue",
  "issue": {
    "id": 2631289516,
    "node_id": "I_kwDOABII586c1kqs",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31207",
    "number": 31207,
    "state": "open",
    "state_reason": null,
    "title": "guix: Linux and macOS builds are not cross-arch reproducible with powerpc64le build arch",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nThe Guix output hashes for Windows and the source tarball match between my powerpc64le build machine and the official binaries, but the hashes for macOS and Linux do not match.\r\n\r\nThis seems to be a partial regression from 27.1, where Windows, Linux, and the source tarball all matched for me. macOS did not even build without errors for 27.1 on powerpc64le (that is at least fixed in 28.0), so I have nothing to compare there.\r\n\r\nIt is not clear to me whether the root cause might be the same as the converse problem referenced in https://github.com/bitcoin/bitcoin/pull/27897 (powerpc64le hashes didn't match between x86_64 and aarch64 build machines).\r\n\r\n(Maybe I've done something stupid here, but I definitely can't tell what I would have done wrong, and the different behavior from 27.1 certainly *seems* like I've hit a real bug.)\n\n### Expected behaviour\n\nAll Guix output hashes should match between my powerpc64le build machine and the official binaries.\n\n### Steps to reproduce\n\n1. Build Bitcoin Core via `./contrib/guix/guix-build`\r\n2. Compare results against the `guix-sigs` repo (I used pinheadmz's Guix sigs as a reference).\n\n### Relevant log output\n\nHashes from my powerpc64le build machine:\r\n\r\n```\r\n3908cbe1339fc10a220e9634629b6937dba77de926bf8dd618283fd090c61f5e  bitcoin-28.0-aarch64-linux-gnu-debug.tar.gz\r\n1e58898a1b48296fd7e31ddf96c248a0a45c07709d980e3dadfd66ab9e5d2845  bitcoin-28.0-aarch64-linux-gnu.tar.gz\r\ndbbb90b05c2e390ba6130cac074135a52c83dcc762a28257de1abfe89d69675f  bitcoin-28.0-arm-linux-gnueabihf-debug.tar.gz\r\n54a30faa5a61f628d890f464c48def63858eca9b655873f1e60c4e220af41c2e  bitcoin-28.0-arm-linux-gnueabihf.tar.gz\r\nda85a7758d272ca5ea345a2b549147acfbbdf61c556c98dc4f49e8f7a27af30d  bitcoin-28.0-arm64-apple-darwin-unsigned.tar.gz\r\nc24ff655b0cbbdc116b19474fa621b1c803e3af25f3e540ea10d53a9ba9c4a2d  bitcoin-28.0-arm64-apple-darwin-unsigned.zip\r\n17033ff17cb91c09cf27fefb42801a584844385b2c6c50902ae63cebb7fc632e  bitcoin-28.0-arm64-apple-darwin.tar.gz\r\n700ae2d1e204602eb07f2779a6e6669893bc96c0dca290593f80ff8e102ff37f  bitcoin-28.0.tar.gz\r\na182b39beb4603c3cad55f9f45eaae730eaa1a8c5ee26718707a35554d28654a  bitcoin-28.0-powerpc64-linux-gnu-debug.tar.gz\r\n252a1e89b369ce1895a58ae4425c765e6c654214550e14245f6bdb84ec161c2b  bitcoin-28.0-powerpc64-linux-gnu.tar.gz\r\ncf4cbfa876142bfdb4c781271cd9a1a5410e6cb6e7f0e3996eb67bf08909d4ef  bitcoin-28.0-riscv64-linux-gnu-debug.tar.gz\r\nfd91dee4518444891549d41f995ef007ae81a426cc5914a4767f1d4410eb1103  bitcoin-28.0-riscv64-linux-gnu.tar.gz\r\na98b0fdddcd71fdc16d29d3c4cc95baf408cc2210e23aa96fa1b808267a25387  bitcoin-28.0-x86_64-apple-darwin-unsigned.tar.gz\r\n898f790d4941e106158ba2c38f8cb439a6e1e4f58cad8c9cd86dd0ddff08d117  bitcoin-28.0-x86_64-apple-darwin-unsigned.zip\r\nd2c74eebfa6ac1e7ce64b986cbbd28e4838bd8abf2de70493d971b373d559044  bitcoin-28.0-x86_64-apple-darwin.tar.gz\r\n3b5808f3070e88b5f6eee25678d80f4159827ea391abb0ee25ba96af2a598f75  bitcoin-28.0-x86_64-linux-gnu-debug.tar.gz\r\nffa78c8e87ea20f13780e780589351484fd22defdabb6aa3234d48f9518104a1  bitcoin-28.0-x86_64-linux-gnu.tar.gz\r\n8990def2e611323d4c7a8cf17187a138dca64f98fc0ecebda0a3e999dbdd083d  bitcoin-28.0-win64-debug.zip\r\nd8170c342ac049fab953f87841cbbba6c0e3f277703ddc29c678b6ab93dae966  bitcoin-28.0-win64-setup-unsigned.exe\r\n8ec39e7bf66ea419ea79e5f1b7bee1b03a28b51ddd1daa6e167bff6abac0a5d2  bitcoin-28.0-win64-unsigned.tar.gz\r\n85282f4ec1bcb0cfe8db0f195e8e0f6fb77cfbe89242a81fff2bc2e9292f7acf  bitcoin-28.0-win64.zip\r\n```\r\n\r\nFor comparison, see https://github.com/bitcoin-core/guix.sigs/blob/main/28.0/pinheadmz/noncodesigned.SHA256SUMS\r\n\r\nI would be happy to upload my binaries and/or run diffoscope on request. I would also be happy to run Guix builds of additional commits on my powerpc64le machine if there are commits that seem likely to be the culprit.\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nv28.0\n\n### Operating system and version\n\nDebian 12.7 running inside KVM; host is also Debian 12.7\n\n### Machine specifications\n\npowerpc64le; HDD; wired network on residential Internet connection.",
    "user": {
      "login": "JeremyRand",
      "id": 244188,
      "node_id": "MDQ6VXNlcjI0NDE4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244188?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeremyRand",
      "html_url": "https://github.com/JeremyRand",
      "followers_url": "https://api.github.com/users/JeremyRand/followers",
      "following_url": "https://api.github.com/users/JeremyRand/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/JeremyRand/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/JeremyRand/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/JeremyRand/subscriptions",
      "organizations_url": "https://api.github.com/users/JeremyRand/orgs",
      "repos_url": "https://api.github.com/users/JeremyRand/repos",
      "events_url": "https://api.github.com/users/JeremyRand/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/JeremyRand/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 61889416,
        "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
        "name": "Build system",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 3,
    "created_at": "2024-11-03T15:46:59Z",
    "updated_at": "2024-11-14T15:21:14Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2454024773,
      "node_id": "IC_kwDOABII586SRXJF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2454024773",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-04T07:52:35Z",
      "updated_at": "2024-11-04T07:52:35Z",
      "author_association": "MEMBER",
      "body": "> I would be happy to upload my binaries and/or run diffoscope on request. I would also be happy to run Guix builds of additional commits on my powerpc64le machine if there are commits that seem likely to be the culprit.\r\n\r\nI'd say all of that would be useful. You link to the GCC bump to 12, which seems one of the more significant changes to the Linux build, so testing commit e1ce5b8ae9124717c00dca71a5c5b43a7f5ad177 (and `e1ce5b8ae9124717c00dca71a5c5b43a7f5ad177~1`), or otherwise bisecting could be useful as well.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31207#issuecomment-2454024773",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207"
    },
    {
      "event": "labeled",
      "id": 15099403414,
      "node_id": "LE_lADOABII586c1kqszwAAAAOD_pyW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15099403414",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-04T07:52:43Z",
      "label": {
        "name": "Build system",
        "color": "5319e7"
      }
    },
    {
      "event": "commented",
      "id": 2476057139,
      "node_id": "IC_kwDOABII586TlaIz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2476057139",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-14T11:07:05Z",
      "updated_at": "2024-11-14T11:07:05Z",
      "author_association": "MEMBER",
      "body": "> I would be happy to upload my binaries\r\n\r\nYes, please do. i'm happy to try to help find the difference but i don't have access to a ppc64 system.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31207#issuecomment-2476057139",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207"
    },
    {
      "event": "commented",
      "id": 2476690702,
      "node_id": "IC_kwDOABII586Tn00O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2476690702",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-14T15:21:13Z",
      "updated_at": "2024-11-14T15:21:13Z",
      "author_association": "MEMBER",
      "body": "Last I was looking at this, if you guix built (master) for `powerpc64le-linux-gnu`, once on `x86_64` and once on `aarch64`, and compared the resulting binaries, you'd end up with (a small number) of differences where two instructions are swapped. For example:\r\n```diff\r\n--- a/x86_64.txt\r\n+++ b/aarch64.txt\r\n@@ -176,8 +176,8 @@\r\n    24ea8:      78 1b 77 7c     mr      r23,r3\r\n    24eac:      66 01 17 7c     mtfprd  f0,r23\r\n    24eb0:      14 f2 37 7d     add     r9,r23,r30\r\n-   24eb4:      d0 00 b8 3a     addi    r21,r24,208\r\n-   24eb8:      10 00 40 39     li      r10,16\r\n+   24eb4:      10 00 40 39     li      r10,16\r\n+   24eb8:      d0 00 b8 3a     addi    r21,r24,208\r\n    24ebc:      00 00 00 60     nop\r\n    24ec0:      10 8e 22 f9     std     r9,-29168(r2)\r\n    24ec4:      50 00 00 f0     xxspltd vs0,vs0,0\r\n```\r\n\r\nIn this case, in:\r\n```bash\r\n0000000000024bf0 <_GLOBAL__sub_I_descriptor.cpp>:\r\n   24bf0:\t4e 00 4c 3c \taddis   r2,r12,78\r\n   24bf4:\t10 32 42 38 \taddi    r2,r2,12816\r\n   24bf8:\ta6 02 08 7c \tmflr    r0\r\n<snip>\r\n   24eb0:\t14 f2 37 7d \tadd     r9,r23,r30\r\n   24eb4:\td0 00 b8 3a \taddi    r21,r24,208\r\n   24eb8:\t10 00 40 39 \tli      r10,16\r\n   24ebc:\t00 00 00 60 \tnop\r\n```",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31207#issuecomment-2476690702",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31207"
    }
  ]
}