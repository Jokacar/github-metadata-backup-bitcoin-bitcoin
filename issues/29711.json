{
  "type": "issue",
  "issue": {
    "id": 2203983562,
    "node_id": "I_kwDOABII586DXh7K",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29711",
    "number": 29711,
    "state": "open",
    "state_reason": null,
    "title": "Wallet: Nondescript error message for 502nd unconfirmed transaction",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nWhen creating a large number of unconfirmed transactions (e.g. 500+) with `bitcoin-cli` by spending/sending from a wallet, sending/spending the 502nd time results in a nondescript error message.  It may be the case that this is expected behavior (e.g. reaching a limit), and the error message could be made more descriptive/informative. \r\n\r\n```\r\nerror code: -1\r\nerror message:\r\nmap::at\r\n```\r\n\r\nThis was encountered when creating a test to populate the mempool with a high number of transactions for the v27.0 RC Testing Guide.  This behavior was observed both on v26.0 and v27.0 rc1.\r\n\r\nConfirming the transactions in a block allows the user to perform additional spending.\n\n### Expected behaviour\n\nA more descriptive error message would be provided to the user.  In this case, if a limit is being reached, the user could be informed and take appropriate action (e.g. wait until a block confirms transactions, etc.).\n\n### Steps to reproduce\n\nStart a node on regtest with its own datadir/bitcoin.conf:\r\n```bash\r\nexport DATA_DIR=/tmp/tmpdatadir\r\nmkdir $DATA_DIR\r\nexport BINARY_PATH=/path/to/dir/containing/bitcoind\r\nalias bitcoind-test=\"$BINARY_PATH/bitcoind -datadir=$DATA_DIR\"\r\nalias bcli=\"$BINARY_PATH/bitcoin-cli -datadir=$DATA_DIR\"\r\necho \"regtest=1\" > $DATA_DIR/bitcoin.conf\r\nbitcoind-test -daemon\r\n```\r\nCreate a wallet, fund it with coinbase outputs, and send 501 times:\r\n```bash\r\nbcli createwallet test\r\nexport ADDRESS=$(bcli -rpcwallet=test getnewaddress)\r\nbcli -rpcwallet=test -generate 701\r\nfor i in $(seq 1 499); do bcli -rpcwallet=test -named send outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10; done\r\nbcli -rpcwallet=test getmempoolinfo\r\nbcli -rpcwallet=test -named send outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10\r\nbcli -rpcwallet=test getmempoolinfo\r\nbcli -rpcwallet=test -named send outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10\r\nbcli -rpcwallet=test getmempoolinfo\r\n```\r\nInduce the error on the 502nd send:\r\n```bash\r\nbcli -rpcwallet=test -named send outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10\r\nerror code: -1\r\nerror message:\r\nmap::at\r\n```\r\nConfirm transactions, then add a new transaction:\r\n```bash\r\nbcli -rpcwallet=test -generate 1\r\nbcli -rpcwallet=test -named send outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10\r\nbcli -rpcwallet=test getmempoolinfo\r\n```\n\n### Relevant log output\n\nNothing relevant observed in debug.log at the time of the error received.\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv26.0.0\n\n### Operating system and version\n\nUbuntu 22.04 LTS\n\n### Machine specifications\n\namd64",
    "user": {
      "login": "tdb3",
      "id": 106488469,
      "node_id": "U_kgDOBljilQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdb3",
      "html_url": "https://github.com/tdb3",
      "followers_url": "https://api.github.com/users/tdb3/followers",
      "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
      "organizations_url": "https://api.github.com/users/tdb3/orgs",
      "repos_url": "https://api.github.com/users/tdb3/repos",
      "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/tdb3/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/61",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61/labels",
      "id": 9334188,
      "node_id": "MI_kwDOABII584Ajm2s",
      "number": 61,
      "state": "open",
      "title": "27.0",
      "description": "",
      "creator": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 7,
      "closed_issues": 63,
      "created_at": "2023-04-27T08:01:57Z",
      "updated_at": "2024-03-24T14:15:08Z"
    },
    "locked": false,
    "comments": 8,
    "created_at": "2024-03-23T17:58:53Z",
    "updated_at": "2024-03-26T02:10:11Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2016567004,
      "node_id": "IC_kwDOABII5854Ml7c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2016567004",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-23T18:19:16Z",
      "updated_at": "2024-03-23T18:19:42Z",
      "author_association": "MEMBER",
      "body": "It's hitting the 500 tx cluster limit in MiniMiner, which I think we should keep. The error message just needs to be better. The error is happening when the result of `CalculateIndividualBumpFees` is an empty map, but we try to get things from it, so the fix would be to return a proper error when that map is empty.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2016567004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "milestoned",
      "id": 12226721456,
      "node_id": "MIE_lADOABII586DXh7KzwAAAALYxPaw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12226721456",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-24T14:15:08Z",
      "milestone": {
        "title": "27.0"
      }
    },
    {
      "event": "labeled",
      "id": 12226721628,
      "node_id": "LE_lADOABII586DXh7KzwAAAALYxPdc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12226721628",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-24T14:15:14Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 2018862521,
      "node_id": "IC_kwDOABII5854VWW5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018862521",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T20:31:45Z",
      "updated_at": "2024-03-25T20:32:16Z",
      "author_association": "MEMBER",
      "body": "> It's hitting the 500 tx cluster limit in MiniMiner, which I think we should keep. The error message just needs to be better. The error is happening when the result of `CalculateIndividualBumpFees` is an empty map, but we try to get things from it, so the fix would be to return a proper error when that map is empty.\r\n\r\nI'm unsure whether a wallet containing a group of 500 independent unconfirmed transactions should block transaction creation until those transactions are confirmed. Would be good to obtain some usage metrics. Because this shouldn't present a DoS vector, and we could expand the limit to accept more standalone transactions while maintaining the current limit for clusters with more than one element. Thoughts?",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2018862521",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "commented",
      "id": 2018941759,
      "node_id": "IC_kwDOABII5854Vps_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018941759",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:22:38Z",
      "updated_at": "2024-03-25T21:47:46Z",
      "author_association": "MEMBER",
      "body": "I was able to reproduce same error on master with the steps from @tdb3  53f4607cc8c67366662f49cb312d2e4ff8b6523a\r\n\r\n```terminal\r\n......\r\n\r\nabubakarismail@Abubakars-MacBook-Pro bitcoin %  ./src/bitcoin-cli -regtest -named send  outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10\r\n\r\nerror code: -1\r\nerror message:\r\nmap::at:  key not found                                                                                          \r\n```\r\n\r\nA naive approach of simply preventing accessing returned value of `calculateIndividualBumpFees` when its empty solves the issue.\r\n\r\n<details>\r\n<summary>diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/wallet/spend.cpp b/src/wallet/spend.cpp\r\nindex 5d23ebd35a..12d320861f 100644\r\n--- a/src/wallet/spend.cpp\r\n+++ b/src/wallet/spend.cpp\r\n@@ -296,7 +296,9 @@ util::Result<PreSelectedInputs> FetchSelectedInputs(const CWallet& wallet, const\r\n \r\n         /* Set some defaults for depth, spendable, solvable, safe, time, and from_me as these don't matter for preset inputs since no selection is being done. */\r\n         COutput output(outpoint, txout, /*depth=*/ 0, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, coin_selection_params.m_effective_feerate);\r\n-        output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n+        if (!map_of_bump_fees.empty()) {\r\n+            output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n+        }\r\n         result.Insert(output, coin_selection_params.m_subtract_fee_outputs);\r\n     }\r\n     return result;\r\n@@ -455,10 +457,11 @@ CoinsResult AvailableCoins(const CWallet& wallet,\r\n \r\n     if (feerate.has_value()) {\r\n         std::map<COutPoint, CAmount> map_of_bump_fees = wallet.chain().calculateIndividualBumpF\r\nees(outpoints, feerate.value());\r\n-\r\n-        for (auto& [_, outputs] : result.coins) {\r\n-            for (auto& output : outputs) {\r\n-                output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n+        if (!map_of_bump_fees.empty()) {\r\n+            for (auto& [_, outputs] : result.coins) {\r\n+                for (auto& output : outputs) {\r\n+                    output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n+                }\r\n             }\r\n         }\r\n     }\r\n```\r\n</details>\r\n\r\nI can create more transactions\r\n```terminal\r\nabubakarismail@Abubakars-MacBook-Pro bitcoin % for i in $(seq 1 4); do ./src/bitcoin-cli -regtest -named send  outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10; done \r\n{\r\n  \"txid\": \"87c5c6564bf5c810be070c2fd5ee7b9e75cd93a6b0f3d0ea85163c5da088e857\",\r\n  \"complete\": true\r\n}\r\n{\r\n  \"txid\": \"fdc207674a7fa25ae16651ec69f5b7eb8f96b09c3b8c050648e6eb32db7e2532\",\r\n  \"complete\": true\r\n}\r\n{\r\n  \"txid\": \"375ad1485ad7f02221e9c79a81ca17ecbcaaf781165807ad23ef8198585e6fc9\",\r\n  \"complete\": true\r\n}\r\n{\r\n  \"txid\": \"30284d52762e9c2b4255a31fa851b8b745abd371bfa086e2c2f9edb00a707054\",\r\n  \"complete\": true\r\n}\r\n```\r\n\r\n\r\n---\r\n> The error message just needs to be better. The error is happening when the result of `CalculateIndividualBumpFees` is an empty map\r\n\r\nThe empty map could also be because bump fees have already been calculated, mini miner error message should also be more verbose for each case?",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2018941759",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "mentioned",
      "id": 12240975969,
      "node_id": "MEE_lADOABII586DXh7KzwAAAALZnnhh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12240975969",
      "actor": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:22:39Z"
    },
    {
      "event": "subscribed",
      "id": 12240975975,
      "node_id": "SE_lADOABII586DXh7KzwAAAALZnnhn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12240975975",
      "actor": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:22:39Z"
    },
    {
      "event": "commented",
      "id": 2018945624,
      "node_id": "IC_kwDOABII5854VqpY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018945624",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:25:23Z",
      "updated_at": "2024-03-25T21:25:23Z",
      "author_association": "MEMBER",
      "body": "> A naive approach of simply preventing accessing returned value of calculateIndividualBumpFees when its empty solves the issue.\r\n\r\nThat would fallback to the pre ancestors aware funding status. Which isn't desirable.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2018945624",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "commented",
      "id": 2018969940,
      "node_id": "IC_kwDOABII5854VwlU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018969940",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:42:51Z",
      "updated_at": "2024-03-25T21:42:51Z",
      "author_association": "MEMBER",
      "body": "Oh, thanks @furszy! I can update the return type of `AvailableCoins` to `util::Result<CoinsResult>` with a more descriptive error message for when the cluster limit is hit.\r\n\r\n<details>\r\n<summary>diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/wallet/spend.cpp b/src/wallet/spend.cpp\r\nindex 5d23ebd35a..646d93bcd7 100644\r\n--- a/src/wallet/spend.cpp\r\n+++ b/src/wallet/spend.cpp\r\n@@ -296,13 +296,16 @@ util::Result<PreSelectedInputs> FetchSelectedInputs(const CWallet& wallet, const\r\n \r\n         /* Set some defaults for depth, spendable, solvable, safe, time, and from_me as these don't matter for preset inputs since no selection is being done. */\r\n         COutput output(outpoint, txout, /*depth=*/ 0, input_bytes, /*spendable=*/ true, /*solvable=*/ true, /*safe=*/ true, /*time=*/ 0, /*from_me=*/ false, coin_selection_params.m_effective_feerate);\r\n+        if (map_of_bump_fees.empty()) {\r\n+            return util::Error{strprintf(_(\"Too many connected unconfirmed transactions, maximum cluster limit exceeded\"))};\r\n+        }\r\n         output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n         result.Insert(output, coin_selection_params.m_subtract_fee_outputs);\r\n     }\r\n     return result;\r\n }\r\n \r\n-CoinsResult AvailableCoins(const CWallet& wallet,\r\n+util::Result<CoinsResult> AvailableCoins(const CWallet& wallet,\r\n                            const CCoinControl* coinControl,\r\n                            std::optional<CFeeRate> feerate,\r\n                            const CoinFilterParams& params)\r\n@@ -456,9 +459,15 @@ CoinsResult AvailableCoins(const CWallet& wallet,\r\n     if (feerate.has_value()) {\r\n         std::map<COutPoint, CAmount> map_of_bump_fees = wallet.chain().calculateIndividualBumpF\r\nees(outpoints, feerate.value());\r\n \r\n-        for (auto& [_, outputs] : result.coins) {\r\n-            for (auto& output : outputs) {\r\n-                output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n+        if (map_of_bump_fees.empty()) {\r\n+            if  (!outpoints.empty()) {\r\n+                return util::Error{strprintf(_(\"Too many connected unconfirmed transactions, maximum cluster limit exceeded\"))};\r\n+            }\r\n+        } else {\r\n+            for (auto& [_, outputs] : result.coins) {\r\n+                for (auto& output : outputs) {\r\n+                    output.ApplyBumpFee(map_of_bump_fees.at(output.outpoint));\r\n+                }\r\n             }\r\n         }\r\n     }\r\ndiff --git a/src/wallet/spend.h b/src/wallet/spend.h\r\nindex 62a7b4e4c8..c387cb69bb 100644\r\n--- a/src/wallet/spend.h\r\n+++ b/src/wallet/spend.h\r\n@@ -83,7 +83,7 @@ struct CoinFilterParams {\r\n /**\r\n  * Populate the CoinsResult struct with vectors of available COutputs, organized by OutputType.\r\n  */\r\n-CoinsResult AvailableCoins(const CWallet& wallet,\r\n+util::Result<CoinsResult> AvailableCoins(const CWallet& wallet,\r\n                            const CCoinControl* coinControl = nullptr,\r\n                            std::optional<CFeeRate> feerate = std::nullopt,\r\n                            const CoinFilterParams& params = {}) EXCLUSIVE_LOCKS_REQUIRED(wallet\r\n.cs_wallet);\r\n(END)\r\n```\r\n</details>\r\n\r\n\r\nWould it be better to instead modify Mini Miner to return the error message?\r\n",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2018969940",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "mentioned",
      "id": 12241149298,
      "node_id": "MEE_lADOABII586DXh7KzwAAAALZoR1y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12241149298",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:42:52Z"
    },
    {
      "event": "subscribed",
      "id": 12241149303,
      "node_id": "SE_lADOABII586DXh7KzwAAAALZoR13",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12241149303",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:42:52Z"
    },
    {
      "event": "commented",
      "id": 2018986896,
      "node_id": "IC_kwDOABII5854V0uQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018986896",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-25T21:55:21Z",
      "updated_at": "2024-03-25T21:55:21Z",
      "author_association": "MEMBER",
      "body": "> Would it be better to instead modify Mini Miner to return the error message?\r\n\r\nYes. It will be better to bubble up the error message from MiniMiner. But, before getting into the implementation details, let's first try to finish discussing the issue. I left a comment above (https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2018862521) that would be nice to follow it up.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2018986896",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "commented",
      "id": 2019157978,
      "node_id": "IC_kwDOABII5854Wefa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2019157978",
      "actor": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-26T00:24:46Z",
      "updated_at": "2024-03-26T00:25:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I'm unsure whether a wallet containing a group of 500 independent unconfirmed transactions should block transaction creation until those transactions are confirmed. Would be good to obtain some usage metrics. Because this shouldn't present a DoS vector, and we could expand the limit to accept more standalone transactions while maintaining the current limit for clusters with more than one element. Thoughts?\r\n\r\nThis seems reasonable to me, but I'm unaware of the history of the 500 limit and the rationale for its implementation (or tradeoffs).  The existing \"steps to reproduce\" relies on the wallet's coin selection (so these transactions might not be independent depending on the selection algorithm).  I ran another test that explicitly spends only the mature coinbase outputs independently.  The error wasn't received.  All transactions were allowed, so it appears that in the existing implementation, independent unconfirmed transactions are not affected by the limit?\r\n\r\n```bash\r\nbcli createwallet test\r\nexport ADDRESS=$(bcli -rpcwallet=test getnewaddress)\r\nbcli -rpcwallet=test -generate 701\r\nbcli -rpcwallet=test listunspent | grep txid | awk '{print $2}' | sed 's/\"//g' | sed 's/,//g' | while read -r line; do bcli -rpcwallet=test -named send outputs=\"{\\\"$ADDRESS\\\": 1}\" fee_rate=10 inputs=[{\\\"txid\\\":\\ \\\"$line\\\"\\,\\ \\\"vout\\\":\\ 0\\,\\\"sequence\\\":\\ \\\"4294967295\\\"}]; done\r\nbcli -rpcwallet=test getmempoolinfo\r\n{\r\n  \"loaded\": true,\r\n  \"size\": 601,\r\n  \"bytes\": 84738,\r\n  \"usage\": 714096,\r\n  \"total_fee\": 0.00847410,\r\n  \"maxmempool\": 300000000,\r\n  \"mempoolminfee\": 0.00001000,\r\n  \"minrelaytxfee\": 0.00001000,\r\n  \"incrementalrelayfee\": 0.00001000,\r\n  \"unbroadcastcount\": 601,\r\n  \"fullrbf\": false\r\n}\r\n\r\n```",
      "user": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2019157978",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    },
    {
      "event": "commented",
      "id": 2019257723,
      "node_id": "IC_kwDOABII5854W217",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2019257723",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-26T02:10:09Z",
      "updated_at": "2024-03-26T02:10:09Z",
      "author_association": "MEMBER",
      "body": "> I ran another test that explicitly spends only the mature coinbase outputs independently. The error wasn't received. All transactions were allowed, so it appears that in the existing implementation, independent unconfirmed transactions are not affected by the limit?\r\n\r\nIt isn't failing because your script skips the unconfirmed outputs. The `send()` RPC command provides 'minconf=1' by default. This functional test checks the case of independent unconfirmed transactions and triggers the failure consistently:\r\n\r\n```diff\r\ndiff --git a/test/functional/wallet_spend_unconfirmed.py b/test/functional/wallet_spend_unconfirmed.py\r\n--- a/test/functional/wallet_spend_unconfirmed.py\t(revision 8ee4a2600371062ddda0ae623bc0b934c308d594)\r\n+++ b/test/functional/wallet_spend_unconfirmed.py\t(date 1711418421497)\r\n@@ -465,6 +465,25 @@\r\n \r\n         wallet.unloadwallet()\r\n \r\n+    def test_independent_unconfirmed_txs_limit(self):\r\n+        self.nodes[0].createwallet(\"independent_txs\")\r\n+        wallet = self.nodes[0].get_wallet_rpc(\"independent_txs\")\r\n+        # Generate spendable independent txs\r\n+        self.generatetoaddress(self.nodes[0], 700, wallet.getnewaddress())\r\n+\r\n+        # Consume 500 txs\r\n+        inputs = wallet.listunspent()\r\n+        assert len(inputs) > 500\r\n+        address = wallet.getnewaddress()\r\n+        for i in range(501):\r\n+            res = wallet.send(outputs=[{address: 1}],\r\n+                              options={\"minconf\": 1, \"fee_rate\": 10, \"add_inputs\": False, \"inputs\": [inputs[i]]})\r\n+            assert 'txid' in res\r\n+\r\n+        assert len(wallet.listunspent(minconf=0)) > 500\r\n+        assert_equal(wallet.getmempoolinfo()['size'], 501)\r\n+        # Trigger failure\r\n+        assert 'txid' in wallet.send(outputs=[{address: 5}], options={\"minconf\": 0, \"maxconf\": 0, \"fee_rate\": 10})\r\n \r\n     def run_test(self):\r\n         self.log.info(\"Starting UnconfirmedInputTest!\")\r\n@@ -504,5 +523,7 @@\r\n \r\n         self.test_external_input_unconfirmed_low()\r\n \r\n+        self.test_independent_unconfirmed_txs_limit()\r\n+\r\n if __name__ == '__main__':\r\n     UnconfirmedInputTest().main()\r\n```",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29711#issuecomment-2019257723",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29711"
    }
  ]
}