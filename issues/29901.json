{
  "type": "issue",
  "issue": {
    "id": 2248695751,
    "node_id": "I_kwDOABII586GCF_H",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29901",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29901/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29901/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29901/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29901",
    "number": 29901,
    "state": "open",
    "state_reason": null,
    "title": "Wallet fuzzing tracking issue",
    "body": "The wallet has poor fuzz coverage. Hopefully, some work is being done to improve it. The goal of this issue is to actively track current work and work that needs to be done to improve fuzz coverage for the wallet.\r\n\r\n## Open PRs / Ready to review\r\n\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/29694\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/28236\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/28074\r\n\r\n## Current wallet targets\r\n\r\nWe currently have 6 specific targets for wallet, which cover:\r\n\r\n- Fees (`wallet/fees.cpp`)\r\n- Coin selection\r\n- ScriptPubKeyManager (descriptor)\r\n- Coin control (`CCoinControl`)\r\n- Notifications\r\n- ISO8601 parser\r\n\r\n## Nice to have\r\n\r\n- [ ] Feebumper target\r\n- [ ] More coverage for `CWallet` stuff\r\n- [ ] Wallet transaction target\r\n- [ ] Wallet receive target\r\n\r\n## Won't/Can't cover\r\n\r\n### Legacy wallet removal\r\n\r\nThe goal is to remove legacy wallets and migrate them to descriptor ones. There is an open issue with a proposed timeline for Legacy Wallet and BDB removal (https://github.com/bitcoin/bitcoin/issues/20160). For this reason, we do not aim to increase fuzz coverage for legacy stuff. See that the `scriptpubkeyman` target only uses descriptor ones.\r\n\r\n### External signer\r\n\r\nI do believe we can't have fuzz coverage for external signer code.\r\n\r\n## Performance and determinism\r\n\r\nUnfortunately, some aspects of the wallet may affect the fuzzing performance.  E.g.:\r\n\r\n- `SetupDescriptorScriptPubKeyMans` (it might also be non-deterministic due to key generation)\r\n- Wallet encryption\r\n- Wallet migration (there is a PR improving it - https://github.com/bitcoin/bitcoin/pull/28574)\r\n\r\n----------------------\r\n\r\nAny ideas about it or PRs to add let me know.",
    "user": {
      "login": "brunoerg",
      "id": 19480819,
      "node_id": "MDQ6VXNlcjE5NDgwODE5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brunoerg",
      "html_url": "https://github.com/brunoerg",
      "followers_url": "https://api.github.com/users/brunoerg/followers",
      "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
      "organizations_url": "https://api.github.com/users/brunoerg/orgs",
      "repos_url": "https://api.github.com/users/brunoerg/repos",
      "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/brunoerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 1,
    "created_at": "2024-04-17T16:15:40Z",
    "updated_at": "2024-04-17T17:10:31Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2061781675,
      "node_id": "IC_kwDOABII58565Eqr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061781675",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-17T17:03:34Z",
      "updated_at": "2024-04-17T17:10:31Z",
      "author_association": "MEMBER",
      "body": "Coverage is nice, but if the fuzz test never finds any real user-facing issues, it will be useless. I don't think any wallet fuzz target found a real issue yet? Obviously coverage is the first step toward adding regression fuzz tests, so here are some ideas:\r\n\r\n* #23444 tried to add a regression fuzz test, but it was picked up as part of https://github.com/bitcoin/bitcoin/pull/28933, and I couldn't reproduce the regression crash by re-introducing it.\r\n* https://github.com/bitcoin/bitcoin/pull/27271 would be another idea to check\r\n* Something else?\r\n\r\n> `SetupDescriptorScriptPubKeyMans` (it might also be non-deterministic due to key generation)\r\n\r\nI wrote the `ImportDescriptors` helper, which should be deterministic.\r\n\r\nEdit: Also links to the current coverage:\r\n\r\n* https://maflcko.github.io/b-c-cov/fuzz.coverage/src/wallet/index-sort-l.html\r\n* https://storage.googleapis.com/oss-fuzz-coverage/bitcoin-core/reports/20240416/linux/src/bitcoin-core/src/wallet/report.html",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29901#issuecomment-2061781675",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29901"
    }
  ]
}