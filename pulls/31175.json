{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175",
    "id": 2151266647,
    "node_id": "PR_kwDOABII586AOblX",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31175",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31175.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31175.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/e742d66b1c77a90de502c45b452184b183b3778c",
    "number": 31175,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "rpc: Remove submitblock pre-checks",
    "user": {
      "login": "TheCharlatan",
      "id": 8421793,
      "node_id": "MDQ6VXNlcjg0MjE3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheCharlatan",
      "html_url": "https://github.com/TheCharlatan",
      "followers_url": "https://api.github.com/users/TheCharlatan/followers",
      "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
      "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
      "repos_url": "https://api.github.com/users/TheCharlatan/repos",
      "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "With the introduction of a mining ipc interface and the potential future introduction of a kernel library API it becomes increasingly important to offer common behaviour between them. An example of this is ProcessNewBlock, which is used by ipc, rpc, net_processing and (potentially) the kernel library. Having divergent behaviour on suggested pre-checks and checks for these functions is confusing to both developers and users and is a maintenance burden.\r\n\r\nThe rpc interface for ProcessNewBlock (submitblock) currently pre-checks if the block has a coinbase transaction and whether it has been processed before. While the current example binary for how to use the kernel library, bitcoin-chainstate, imitates these checks, the other interfaces do not.\r\n\r\nThe coinbase check is repeated again early during ProcessNewBlock. Pre-checking it may also shadow more fundamental problems with a block. In most cases the block header is checked first, before validating the transactions. Checking the coinbase first therefore masks potential issues with the header. Fix this by removing the pre-check, but still throwing the same more expressive exception in case a coinbase validation error occurs.\r\n\r\nSimilary the duplicate checks are repeated early in the contextual checks of ProcessNewBlock. If duplicate blocks are detected much of their validation is skipped. Depending on the constitution of the block, validating the merkle root of the block is part of the more intensive workload when validating a block. This could be an argument for moving the pre-checks into block processing. In net_processing this would have a smaller effect however, since the block mutation check, which also validates the merkle root, is done before.\r\n\r\nTesting spamming a node with valid, but duplicate unrequested blocks seems to exhaust a CPU thread, but does not seem to significantly impact keeping up with the tip. The benefits of adding these checks to net_processing are questionable, especially since there are other ways to trigger the more CPU-intensive checks without submitting a duplicate block. Since these DOS concerns apply even less to the RPC interface, which does not have banning mechanics built in, remove them too.\r\n\r\nFinally, also remove the pre-checks from `bitcoin-chainstate.cpp`.\r\n\r\n---\r\n\r\nThis PR is part of the [libbitcoinkernel project](https://github.com/bitcoin/bitcoin/issues/27587).",
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      }
    ],
    "created_at": "2024-10-29T11:05:05Z",
    "updated_at": "2024-11-06T21:00:27Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "f2bd088125c5b883f2b21c44b517c8413ea5b612",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "TheCharlatan:submitblock_prechecks",
      "ref": "submitblock_prechecks",
      "sha": "e742d66b1c77a90de502c45b452184b183b3778c",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 94456368,
        "node_id": "MDEwOlJlcG9zaXRvcnk5NDQ1NjM2OA==",
        "name": "bitcoin",
        "full_name": "TheCharlatan/bitcoin",
        "owner": {
          "login": "TheCharlatan",
          "id": 8421793,
          "node_id": "MDQ6VXNlcjg0MjE3OTM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/TheCharlatan",
          "html_url": "https://github.com/TheCharlatan",
          "followers_url": "https://api.github.com/users/TheCharlatan/followers",
          "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
          "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
          "repos_url": "https://api.github.com/users/TheCharlatan/repos",
          "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/TheCharlatan/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/TheCharlatan/bitcoin",
        "archive_url": "https://api.github.com/repos/TheCharlatan/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/TheCharlatan/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/TheCharlatan/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/TheCharlatan/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/TheCharlatan/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/events",
        "forks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/TheCharlatan/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/TheCharlatan/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/TheCharlatan/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/TheCharlatan/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/TheCharlatan/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/TheCharlatan/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/TheCharlatan/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/TheCharlatan/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/TheCharlatan/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:TheCharlatan/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/TheCharlatan/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/TheCharlatan/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/TheCharlatan/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/hooks",
        "svn_url": "https://github.com/TheCharlatan/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 249162,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-11-02T20:39:51Z",
        "created_at": "2017-06-15T16:03:35Z",
        "updated_at": "2024-10-09T08:59:51Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "da10e0bab4a3e98868dd663af02c43b1dc8b7f4a",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36312,
        "stargazers_count": 79219,
        "watchers_count": 79219,
        "size": 270720,
        "default_branch": "master",
        "open_issues_count": 637,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-11-06T21:01:16Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-11-06T21:23:59Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 13,
    "deletions": 44,
    "changed_files": 4,
    "commits": 2,
    "review_comments": 0,
    "comments": 3
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY5NzJjODc0ZDI5NTA2NjA4MmUwMGJmYmUxYWRjMmE2NTFhODBlZjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6972c874d295066082e00bfbe1adc2a651a80ef6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6972c874d295066082e00bfbe1adc2a651a80ef6",
      "tree": {
        "sha": "1f5be4460b286cf24cead48c67f0aae4b816e31b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1f5be4460b286cf24cead48c67f0aae4b816e31b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1f5be4460b286cf24cead48c67f0aae4b816e31b\nparent da10e0bab4a3e98868dd663af02c43b1dc8b7f4a\nauthor TheCharlatan <seb.kung@gmail.com> 1730129654 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1730199814 +0100\n\nrpc: Remove submitblock pre-checks\n\nWith the introduction of a mining ipc interface and the potential future\nintroduction of a kernel library API it becomes increasingly important\nto offer common behaviour between them. An example of this is\nProcessNewBlock, which is used by ipc, rpc, net_processing and\n(potentially) the kernel library. Having divergent behaviour on\nsuggested pre-checks and checks for these functions is confusing to both\ndevelopers and users and is a maintenance burden.\n\nThe rpc interface for ProcessNewBlock (submitblock) currently pre-checks\nif the block has a coinbase transaction and whether it has been\nprocessed before. While the current example binary for how to use the\nkernel library, bitcoin-chainstate, imitates these checks, the other\ninterfaces do not.\n\nThe coinbase check is repeated again early during ProcessNewBlock.\nPre-checking it may also shadow more fundamental problems with a block.\nIn most cases the block header is checked first, before validating the\ntransactions. Checking the coinbase first therefore masks potential\nissues with the header. Fix this by removing the pre-check, but still\nthrowing the same more expressive exception in case a coinbase\nvalidation error occurs.\n\nSimilary the duplicate checks are repeated early in the contextual\nchecks of ProcessNewBlock. If duplicate blocks are detected much of\ntheir validation is skipped. Depending on the constitution of the block,\nvalidating the merkle root of the block is part of the more intensive\nworkload when validating a block. This could be an argument for moving\nthe pre-checks into block processing. In net_processing this would have\na smaller effect however, since the block mutation check, which also\nvalidates the merkle root, is done before.\n\nTesting spamming a node with valid, but duplicate unrequested blocks\nseems to exhaust a CPU thread, but does not seem to significantly impact\nkeeping up with the tip. The benefits of adding these checks to\nnet_processing are questionable, especially since there are other ways\nto trigger the more CPU-intensive checks without submitting a duplicate\nblock. Since these DOS concerns apply even less to the RPC interface,\nwhich does not have banning mechanics built in, remove them too.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmcgwRkACgkQm3m0VpHb\nQXPTYRAAmMLqmvx1PrUa2luE9ff46A6QLdlOB89JufWMRgyG260WPyV55A/EGDcQ\nB0zT28u1SYAYVOSsBjWAiBpI3vHEkRXVb8AiZXgWxUL6yddIM9sz4e5lWuJQOT2q\n2Az6abBSv5AcHUKqf2u0oAv6wnfgpiMB6VwqLa8nKKekSillZ4RcNIAo23yJTSXm\nPhyNV5v6Nb80pEt6SpVWmNx+XhYSeOAxVM3N5caLaZUPK2MrR/g1/LSZbgcloMNF\ncV2aCljI1mHFn9gxvN6W1lrowC17nRFvUznFD6d2qsJljcRYJ4nYvKCx/OZgp+Oo\nLsX73nYCZl3nnwsD6XYZ693dnrS6SaLghW8jL9ppYorI1pdtUutV7fwuXwmRC5ZP\nlbcGYQUvWOpKCw1DhVgXlojNWIB72KDaI55+cDxz2TyLHroqYo9bFOjjisbvwaxv\nAvhA32eaS+JM/L3MoW3XTwx8GGpruT7WqgRV1jMzWxd9OV4zXRqUufI10HtokpNB\n54jBzu0vfLehoqLDYBv2/DX5PLi5+jO92us4TxpIJVdPWmELEnzVvsn8VzCopBYB\n1JutNzQUabZ7OkpTxnro0hYmZi2nZHUXWCe6qdU3HO2ePHVe+yYgtu46fSl05f8/\nk/8cMOfMyPXRz/E9Yj+3HVCrkY4Rs2KZWZWV9H0DyEXcuZdbums=\n=+GRb\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/da10e0bab4a3e98868dd663af02c43b1dc8b7f4a",
          "sha": "da10e0bab4a3e98868dd663af02c43b1dc8b7f4a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/da10e0bab4a3e98868dd663af02c43b1dc8b7f4a"
        }
      ],
      "message": "rpc: Remove submitblock pre-checks\n\nWith the introduction of a mining ipc interface and the potential future\nintroduction of a kernel library API it becomes increasingly important\nto offer common behaviour between them. An example of this is\nProcessNewBlock, which is used by ipc, rpc, net_processing and\n(potentially) the kernel library. Having divergent behaviour on\nsuggested pre-checks and checks for these functions is confusing to both\ndevelopers and users and is a maintenance burden.\n\nThe rpc interface for ProcessNewBlock (submitblock) currently pre-checks\nif the block has a coinbase transaction and whether it has been\nprocessed before. While the current example binary for how to use the\nkernel library, bitcoin-chainstate, imitates these checks, the other\ninterfaces do not.\n\nThe coinbase check is repeated again early during ProcessNewBlock.\nPre-checking it may also shadow more fundamental problems with a block.\nIn most cases the block header is checked first, before validating the\ntransactions. Checking the coinbase first therefore masks potential\nissues with the header. Fix this by removing the pre-check, but still\nthrowing the same more expressive exception in case a coinbase\nvalidation error occurs.\n\nSimilary the duplicate checks are repeated early in the contextual\nchecks of ProcessNewBlock. If duplicate blocks are detected much of\ntheir validation is skipped. Depending on the constitution of the block,\nvalidating the merkle root of the block is part of the more intensive\nworkload when validating a block. This could be an argument for moving\nthe pre-checks into block processing. In net_processing this would have\na smaller effect however, since the block mutation check, which also\nvalidates the merkle root, is done before.\n\nTesting spamming a node with valid, but duplicate unrequested blocks\nseems to exhaust a CPU thread, but does not seem to significantly impact\nkeeping up with the tip. The benefits of adding these checks to\nnet_processing are questionable, especially since there are other ways\nto trigger the more CPU-intensive checks without submitting a duplicate\nblock. Since these DOS concerns apply even less to the RPC interface,\nwhich does not have banning mechanics built in, remove them too.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-10-29T11:03:34Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-10-28T15:34:14Z"
      },
      "sha": "6972c874d295066082e00bfbe1adc2a651a80ef6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU3NDJkNjZiMWM3N2E5MGRlNTAyYzQ1YjQ1MjE4NGIxODNiMzc3OGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e742d66b1c77a90de502c45b452184b183b3778c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e742d66b1c77a90de502c45b452184b183b3778c",
      "tree": {
        "sha": "f0650a295a1e7e9e87a4898a9b3e09c85fecb929",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f0650a295a1e7e9e87a4898a9b3e09c85fecb929"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f0650a295a1e7e9e87a4898a9b3e09c85fecb929\nparent 6972c874d295066082e00bfbe1adc2a651a80ef6\nauthor TheCharlatan <seb.kung@gmail.com> 1730130418 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1730199840 +0100\n\nkernel: Make bitcoin-chainstate's block validation mirror submitblock's\n\nThe behaviour of submitblock was changed in the previous commit, so\nchange it here too.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmcgwSAACgkQm3m0VpHb\nQXNdVw/+KwTo2NG1eXUcMRmDhQJsdsjsQuPbhQo8mZeg+bDiaRZYc4EY6Hgjbljf\nmDXqsQ9Tg2KVJg+TC7pC/5k1v7xiNlnWIR0rnN05yh+UmPFWwz4SY5TImKdkE3CR\nCAm3YYYg3LEenxe/bB1tsCe+0YuiyZFzUrsKTY5CSpMpW46teuFRvtLZrOqHIyWn\ncrdwzY/BtAyhOThgwXGPIeO+XmsXpIBS80j3gUoZRzQT20qzxbOgILpk9cL9Crmn\n2/rer2TIw4uMO+INXtjFR49S74wd8Qp/of+KBk+rPEAasZnokjFD6K6lQNbkR0OS\naPXSoPXXjJTl3kIWW9Q/MFyL1pnqSWmuwep7SBwV+U6++jHE6oDMudsDx/2n99uG\n/r9TYmB5paJuU+WYv/QY3JiQFhEfIMcyz/HNK2RMVJp6sCw+RPXhI6tkQ+PtE+6p\n0G9i57EHYyynH9e96DA/TkEEOjFzPSd0YcoNPt5PeDEnvhsfn/3r+KzI8s0ZpRjS\ntjVI1IYYvTu2SUneaTQJnVnJ4Z8giM5vWlu6cb+FtBVuNCjNtanjldQVjc/61S6V\nzpFD51cU9v9432VHPMMH45Dv0vcJdDYHmm9XEBO7hh1XCI34CQ3jtYHEoDajqstS\n79XYDvsyNZFKCtvJbjPFH8BB3mqbfYTS8XNrDPtGPDetbIfCWNA=\n=ETBy\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6972c874d295066082e00bfbe1adc2a651a80ef6",
          "sha": "6972c874d295066082e00bfbe1adc2a651a80ef6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6972c874d295066082e00bfbe1adc2a651a80ef6"
        }
      ],
      "message": "kernel: Make bitcoin-chainstate's block validation mirror submitblock's\n\nThe behaviour of submitblock was changed in the previous commit, so\nchange it here too.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-10-29T11:04:00Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-10-28T15:46:58Z"
      },
      "sha": "e742d66b1c77a90de502c45b452184b183b3778c"
    },
    {
      "event": "commented",
      "id": 2443908337,
      "node_id": "IC_kwDOABII586RqxTx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2443908337",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-29T11:05:08Z",
      "updated_at": "2024-11-06T21:00:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31175.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2419408412) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31196](https://github.com/bitcoin/bitcoin/pull/31196) (Prune mining interface by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2443908337",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "labeled",
      "id": 14982190543,
      "node_id": "LE_lADOABII586cN9yczwAAAAN9AhXP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14982190543",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-29T11:05:11Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "reviewed",
      "id": 2402259498,
      "node_id": "PRR_kwDOABII586PL5Iq",
      "url": null,
      "actor": null,
      "commit_id": "e742d66b1c77a90de502c45b452184b183b3778c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Haven't looked deeply yet, just wanted to mention #10146, which introduced the coinbase check and was even backported (see also #10190 for a regression test). Makes me wonder if there is more historical context to this.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2402259498",
      "submitted_at": "2024-10-29T15:22:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
    },
    {
      "event": "commented",
      "id": 2449494945,
      "node_id": "IC_kwDOABII586SAFOh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2449494945",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-31T10:11:09Z",
      "updated_at": "2024-10-31T10:11:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Makes me wonder if there is more historical context to this.\r\n\r\nYes, me too. If there are good reasons to keep these checks, then we should document why (and why they are not needed for the other interfaces). I could not come up with one, so I opened this PR, but I may well be missing something.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2449494945",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "commented",
      "id": 2452572531,
      "node_id": "IC_kwDOABII586SL0lz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2452572531",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-01T20:50:47Z",
      "updated_at": "2024-11-01T20:50:47Z",
      "author_association": "MEMBER",
      "body": "my guess is from #10146 this commit ada0caa165905b50db351a56ec124518c922085a looks like a covert fix for `submitblock` with a completely empty block. https://github.com/bitcoin/bitcoin/blob/master/src/rpc/mining.cpp#L1041 shows that it will call:\r\n\r\n`UpdateUncommittedBlockStructures -> GetWitnessCommitmentIndex` which would result in UB, before any PoW checks are made.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2452572531",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "reviewed",
      "id": 2419408412,
      "node_id": "PRR_kwDOABII586QNT4c",
      "url": null,
      "actor": null,
      "commit_id": "e742d66b1c77a90de502c45b452184b183b3778c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nI agree with the general motivation. While this PR can change the error message of `submitblock` in case more than one thing is wrong with the block, I don't really see why one is more important than the other.\r\n\r\n> UpdateUncommittedBlockStructures -> GetWitnessCommitmentIndex which would result in UB, before any PoW checks are made.\r\n\r\nNice find!\r\nI think that it would be good to have a test that would trigger the UB if https://github.com/bitcoin/bitcoin/commit/ada0caa165905b50db351a56ec124518c922085a was reverted (it requires us to know the header so that `UpdateUncommittedBlockStructures()` gets called, so the added test for an empty block doesn't trigger it - could make another `deepcopy` of `block` instead and then delete the txns):\r\n\r\n> Fix this by removing the pre-check, but still throwing the same more expressive exception in case a coinbase validation error occurs.\r\n\r\nI realize that you want to keep the existing behavior in this PR, but I do wonder if it really makes sense to have other consensus errors return \"rejected\", and this particular one to throw an exception.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2419408412",
      "submitted_at": "2024-11-06T21:00:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
    }
  ],
  "comments": []
}