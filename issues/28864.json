{
  "type": "issue",
  "issue": {
    "id": 1991068699,
    "node_id": "I_kwDOABII5852rUwb",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28864",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28864/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28864/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28864/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/28864",
    "number": 28864,
    "state": "open",
    "state_reason": null,
    "title": "build: Configuring with `-mno-sse4.1` does not fail the sse4.1 instrinsics check",
    "body": "I would have expected that `CXXFLAGS=\"-mno-sse4.1\" ./configure` would make the sse4.1 intrinsics check fail but it doesn't:\r\n\r\n```\r\nconfigure:23377: checking for SSE4.1 intrinsics\r\nconfigure:23396: clang++ -std=c++17 -c -msse4.1 -mno-sse4.1  conftest.cpp >&5\r\nconfigure:23396: $? = 0\r\nconfigure:23398: result: yes\r\n```\r\n\r\nNot sure what is going on here, seems like a bug.",
    "user": {
      "login": "dergoegge",
      "id": 8077169,
      "node_id": "MDQ6VXNlcjgwNzcxNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dergoegge",
      "html_url": "https://github.com/dergoegge",
      "followers_url": "https://api.github.com/users/dergoegge/followers",
      "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
      "organizations_url": "https://api.github.com/users/dergoegge/orgs",
      "repos_url": "https://api.github.com/users/dergoegge/repos",
      "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dergoegge/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 2,
    "created_at": "2023-11-13T16:59:09Z",
    "updated_at": "2023-11-16T12:06:47Z"
  },
  "events": [
    {
      "event": "renamed",
      "id": 10944434295,
      "node_id": "RTE_lADOABII5852rUwbzwAAAAKMVtB3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10944434295",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-13T17:00:28Z",
      "rename": {
        "from": "build: Compiling with `-mno-sse4.1` does not fail the sse4.1 instrinsics check",
        "to": "build: Configuring with `-mno-sse4.1` does not fail the sse4.1 instrinsics check"
      }
    },
    {
      "event": "commented",
      "id": 1810503305,
      "node_id": "IC_kwDOABII585r6haJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1810503305",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-14T15:52:42Z",
      "updated_at": "2023-11-14T15:52:42Z",
      "author_association": "MEMBER",
      "body": "Note that this ultimately results in compile failure, but because we try and compile the `sha256_x86_shani.cpp` code, but fail because it `\"needs isa option -msse4.1\"`:\r\n```bash\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/13/include/immintrin.h:39,\r\n                 from crypto/sha256_x86_shani.cpp:12:\r\nIn function 'void {anonymous}::Shuffle(__m128i&, __m128i&)',\r\n    inlined from 'void sha256_x86_shani::Transform(uint32_t*, const unsigned char*, size_t)' at crypto/sha256_x86_shani.cpp:87:12:\r\ncrypto/sha256_x86_shani.cpp:57:10: error: '__builtin_ia32_pblendw128' needs isa option -msse4.1\r\n   57 |     s1 = _mm_blend_epi16(t2, t1, 0xF0);\r\n      |          ^~~~~~~~~~~~~~~\r\nIn function 'void {anonymous}::Unshuffle(__m128i&, __m128i&)',\r\n    inlined from 'void sha256_x86_shani::Transform(uint32_t*, const unsigned char*, size_t)' at crypto/sha256_x86_shani.cpp:138:14:\r\ncrypto/sha256_x86_shani.cpp:64:10: error: '__builtin_ia32_pblendw128' needs isa option -msse4.1\r\n   64 |     s0 = _mm_blend_epi16(t1, t2, 0xF0);\r\n      |          ^~~~~~~~~~~~~~~\r\nIn function 'void {anonymous}::Unshuffle(__m128i&, __m128i&)',\r\n    inlined from 'void sha256d64_x86_shani::Transform_2way(unsigned char*, const unsigned char*)' at crypto/sha256_x86_shani.cpp:270:14:\r\ncrypto/sha256_x86_shani.cpp:64:10: error: '__builtin_ia32_pblendw128' needs isa option -msse4.1\r\n   64 |     s0 = _mm_blend_epi16(t1, t2, 0xF0);\r\n      |          ^~~~~~~~~~~~~~~\r\nIn function 'void {anonymous}::Unshuffle(__m128i&, __m128i&)',\r\n    inlined from 'void sha256d64_x86_shani::Transform_2way(unsigned char*, const unsigned char*)' at crypto/sha256_x86_shani.cpp:271:14:\r\ncrypto/sha256_x86_shani.cpp:64:10: error: '__builtin_ia32_pblendw128' needs isa option -msse4.1\r\n   64 |     s0 = _mm_blend_epi16(t1, t2, 0xF0);\r\n      |          ^~~~~~~~~~~~~~~\r\nIn function 'void {anonymous}::Unshuffle(__m128i&, __m128i&)',\r\n    inlined from 'void sha256d64_x86_shani::Transform_2way(unsigned char*, const unsigned char*)' at crypto/sha256_x86_shani.cpp:348:14:\r\ncrypto/sha256_x86_shani.cpp:64:10: error: '__builtin_ia32_pblendw128' needs isa option -msse4.1\r\n   64 |     s0 = _mm_blend_epi16(t1, t2, 0xF0);\r\n      |          ^~~~~~~~~~~~~~~\r\nIn function 'void {anonymous}::Unshuffle(__m128i&, __m128i&)',\r\n    inlined from 'void sha256d64_x86_shani::Transform_2way(unsigned char*, const unsigned char*)' at crypto/sha256_x86_shani.cpp:349:14:\r\ncrypto/sha256_x86_shani.cpp:64:10: error: '__builtin_ia32_pblendw128' needs isa option -msse4.1\r\n   64 |     s0 = _mm_blend_epi16(t1, t2, 0xF0);\r\n      |          ^~~~~~~~~~~~~~~\r\nmake[2]: *** [Makefile:14527: crypto/libbitcoin_crypto_x86_shani_la-sha256_x86_shani.lo] Error 1\r\n```\r\nand also because we then try and compile the sse4.1 code anyways:\r\n```bash\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/13/include/immintrin.h:37,\r\n                 from crypto/sha256_sse41.cpp:8:\r\n/usr/lib/gcc/x86_64-linux-gnu/13/include/tmmintrin.h: In function '__m128i sha256d64_sse41::{anonymous}::Read4(const unsigned char*, int)':\r\n/usr/lib/gcc/x86_64-linux-gnu/13/include/tmmintrin.h:136:1: error: inlining failed in call to 'always_inline' '__m128i _mm_shuffle_epi8(__m128i, __m128i)': target specific option mismatch\r\n  136 | _mm_shuffle_epi8 (__m128i __X, __m128i __Y)\r\n      | ^~~~~~~~~~~~~~~~\r\ncrypto/sha256_sse41.cpp:55:28: note: called from here\r\n   55 |     return _mm_shuffle_epi8(ret, _mm_set_epi32(0x0C0D0E0FUL, 0x08090A0BUL, 0x04050607UL, 0x00010203UL));\r\n      |            ~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/usr/lib/gcc/x86_64-linux-gnu/13/include/tmmintrin.h:136:1: error: inlining failed in call to 'always_inline' '__m128i _mm_shuffle_epi8(__m128i, __m128i)': target specific option mismatch\r\n  136 | _mm_shuffle_epi8 (__m128i __X, __m128i __Y)\r\n      | ^~~~~~~~~~~~~~~~\r\ncrypto/sha256_sse41.cpp:55:28: note: called from here\r\n   55 |     return _mm_shuffle_epi8(ret, _mm_set_epi32(0x0C0D0E0FUL, 0x08090A0BUL, 0x04050607UL, 0x00010203UL));\r\n      |            ~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nmake[2]: *** [Makefile:14520: crypto/libbitcoin_crypto_sse41_la-sha256_sse41.lo] Error 1\r\n```\r\n\r\nBoth of these can / should be fixed up.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28864#issuecomment-1810503305",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28864"
    },
    {
      "event": "commented",
      "id": 1814316786,
      "node_id": "IC_kwDOABII585sJEby",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1814316786",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-16T12:06:46Z",
      "updated_at": "2023-11-16T12:06:46Z",
      "author_association": "MEMBER",
      "body": "FWIW, adding `-O1` to the test makes it fail with `CXXFLAGS=\"-mno-sse4.1\"`.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28864#issuecomment-1814316786",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28864"
    }
  ]
}