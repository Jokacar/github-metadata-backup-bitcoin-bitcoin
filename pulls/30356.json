{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30356",
    "id": 1943909110,
    "node_id": "PR_kwDOABII585z3bL2",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30356",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30356.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30356.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30356",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30356/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30356/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30356/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/4c57f2707e00bbfd2e2d2a6d3e05ea0bbb0609cd",
    "number": 30356,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "refactor: add coinbase constraints to BlockAssembler::Options",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "When generating a block template through e.g. getblocktemplate RPC, we reserve 4000 weight units and 400 sigops. Pools use this space for their coinbase outputs.\r\n\r\nAt least one pool patched their Bitcoin Core node to adjust these hardcoded values. They eventually [produced an invalid block](https://bitcoin.stackexchange.com/questions/117837/how-many-sigops-are-in-the-invalid-block-783426) which exceeded the sigops limit.\r\n\r\nThe existince of such patches suggests it may be useful to make this value configurable. This PR would make such a change easier. However, the main motivation is that in the Stratum v2 spec requires the pool to communicate the maximum bytes they intend\r\nto add to the coinbase outputs.\r\n\r\nSpecifically the `CoinbaseOutputDataSize` message which is part of the [Template Distribution Protocol](https://github.com/stratum-mining/sv2-spec/blob/main/07-Template-Distribution-Protocol.md#71-coinbaseoutputdatasize-client---server) has a field `coinbase_output_max_additional_size`.\r\n\r\nA proposed change to the spec adds the max additional sigops as well: https://github.com/stratum-mining/sv2-spec/pull/86. Whether that change makes it into the spec is not important though, as adding both to `BlockAssembler::Options` makes sense.\r\n\r\nThe first commit is a test refactor followup for #30335, related to the code that's changed here, but not required.\r\n\r\nThe second commit adds `coinbase_output_max_additional_size` and `coinbase_output_max_additional_sigops ` to `BlockAssembler::Options`, with their defaults set to the existing hardcoded values. \r\n\r\nThe third commit introduces `util/mining.h` as a place to store these defaults in a place where both the RPC and node interface can access them. I picked `libbitcoin_util` instead of `libbitcoin_common` to avoid a future dependency of the Stratum v2 Template Provider (#29432) on `libbitcoin_common`. The latter goal requires additional changes and is mostly just nice to have (the important bit is not depending on `libbitcoin_node`).\r\n\r\nThe last commit adds the two arguments to the mining interface. By default it uses the originally hardcoded values, and no existing caller overrides these defaults. This changes in #29432.",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      }
    ],
    "created_at": "2024-06-28T08:56:31Z",
    "updated_at": "2024-06-28T13:13:30Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "901b9c8918f2e79b9ca8ed6567f63e7a755d362a",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "Sjors:2024/06/coinbase-constraints",
      "ref": "2024/06/coinbase-constraints",
      "sha": "4c57f2707e00bbfd2e2d2a6d3e05ea0bbb0609cd",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 92390696,
        "node_id": "MDEwOlJlcG9zaXRvcnk5MjM5MDY5Ng==",
        "name": "bitcoin",
        "full_name": "Sjors/bitcoin",
        "owner": {
          "login": "Sjors",
          "id": 10217,
          "node_id": "MDQ6VXNlcjEwMjE3",
          "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/Sjors",
          "html_url": "https://github.com/Sjors",
          "followers_url": "https://api.github.com/users/Sjors/followers",
          "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
          "organizations_url": "https://api.github.com/users/Sjors/orgs",
          "repos_url": "https://api.github.com/users/Sjors/repos",
          "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/Sjors/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/Sjors/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/Sjors/bitcoin",
        "archive_url": "https://api.github.com/repos/Sjors/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/Sjors/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/Sjors/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/Sjors/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/Sjors/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/Sjors/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/Sjors/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/Sjors/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/Sjors/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/Sjors/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/Sjors/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/Sjors/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/Sjors/bitcoin/events",
        "forks_url": "https://api.github.com/repos/Sjors/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/Sjors/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/Sjors/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/Sjors/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/Sjors/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/Sjors/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/Sjors/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/Sjors/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/Sjors/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/Sjors/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/Sjors/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/Sjors/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/Sjors/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/Sjors/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/Sjors/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/Sjors/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:Sjors/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/Sjors/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/Sjors/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/Sjors/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/Sjors/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/Sjors/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/Sjors/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/Sjors/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/Sjors/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/Sjors/bitcoin/hooks",
        "svn_url": "https://github.com/Sjors/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 9,
        "stargazers_count": 5,
        "watchers_count": 5,
        "size": 240989,
        "default_branch": "sv2",
        "open_issues_count": 5,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": false,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-06-28T11:26:32Z",
        "created_at": "2017-05-25T10:05:54Z",
        "updated_at": "2024-06-28T06:54:04Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "2f6dca4d1c01ee47275a4292f128d714736837a1",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35580,
        "stargazers_count": 77042,
        "watchers_count": 77042,
        "size": 262278,
        "default_branch": "master",
        "open_issues_count": 687,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-06-28T13:12:02Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-06-28T13:38:09Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30356"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 52,
    "deletions": 10,
    "changed_files": 7,
    "commits": 4,
    "review_comments": 0,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY0ZmVmMzUzYzk5NzE2N2VlZTQxMDRhMmI4ZTg5NWIwODRlZDIxMzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/64fef353c997167eee4104a2b8e895b084ed2131",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/64fef353c997167eee4104a2b8e895b084ed2131",
      "tree": {
        "sha": "707ff1a4f39303227776ac88a5e46c92ae890afc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/707ff1a4f39303227776ac88a5e46c92ae890afc"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 707ff1a4f39303227776ac88a5e46c92ae890afc\nparent 2f6dca4d1c01ee47275a4292f128d714736837a1\nauthor Sjors Provoost <sjors@sprovoost.nl> 1719563713 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1719563727 +0200\n\nrefactor: use CHECK_NONFATAL to avoid single-use symbol\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmZ+ddAACgkQV/+b28ww\nEAkFcxAAwY1GGFhraRxWdsVjqzkhNUPUTr5LbYBPf/sCicHFG4rVdDuZnJBwXGQL\nCurv/RHEb6TjhFnUPbefp8GGqaJJ3Pem8w6ZvlTZ2gVHPdz2ak25aw5mEqntOz6A\nIeH3G5Lk1tK66tbPVvClurm4AU0A7cxmePtnX8q3uDSwjrxcHA+sClv+UedI4Xxi\ndCW6ejI1U9UTVOLCTQNZKfKBTC7d6fkRy1sTIRqGCuN0TbxY8X/nn9KIgFcsPVxf\n8XaX/FAM19M80gvFKd86PruH1RX8OkqM6ZBnbCFuUsPunuFh8ETjAzO4fpGnkqyf\nFQ5BcCUwuRzNBQsLN1x6d0daO7BOI0mYXKIm5ENKSfYFugfkOc8tVwhkqpem/7hU\n99Iao4XskAW4AMCO5lwOJ1i+2cZ/wbvWJTkdJQbgUFubDXLj552yADGqKJVFzx4/\n6JiHHR6pkAUpTPYfbDwACSdoUDqNMjXWmSPqZvDqbD49VPjxB5mbTHcyPX4BFyqs\nf1QvUcpZlTX5LlH0cLdKQ/iPk1TCunEqLIg2vxaC0BQ4JkiAG+UeVL9UcddN+S6S\nHhOSxBQJl5TurcQG5RN4E2OAOIX8zjeHgdrfKwkLcctY/7mKK69400VMI56nuMU+\nl+tK+wCQ1a8qcKvK0zJkLjzKZchoVu4ln6lO1iyC91LXjbEB4/Y=\n=K1Lf\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2f6dca4d1c01ee47275a4292f128d714736837a1",
          "sha": "2f6dca4d1c01ee47275a4292f128d714736837a1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2f6dca4d1c01ee47275a4292f128d714736837a1"
        }
      ],
      "message": "refactor: use CHECK_NONFATAL to avoid single-use symbol",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:35:27Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:35:13Z"
      },
      "sha": "64fef353c997167eee4104a2b8e895b084ed2131"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGViNGI0ZWFkNTU4MzgwOWViODE4MTYxYzM3MTIwNTZiYzY3ZTI2ODE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb4b4ead5583809eb818161c3712056bc67e2681",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/eb4b4ead5583809eb818161c3712056bc67e2681",
      "tree": {
        "sha": "bb5d39438726c3b91a33ba2cf42cebc7023e730d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bb5d39438726c3b91a33ba2cf42cebc7023e730d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bb5d39438726c3b91a33ba2cf42cebc7023e730d\nparent 64fef353c997167eee4104a2b8e895b084ed2131\nauthor Sjors Provoost <sjors@sprovoost.nl> 1719562149 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1719563728 +0200\n\nrefactor: add coinbase constraints to BlockAssembler::Options\n\nWhen generating a block template through e.g. getblocktemplate RPC,\nwe reserve 4000 weight units and 400 sigops. Pools use this space\nfor their coinbase outputs.\n\nAt least one pool patched their Bitcoin Core node to adjust\nthese hardcoded values. They eventually produced an invalid\nblock which exceeded the sigops limit.\nhttps://bitcoin.stackexchange.com/questions/117837/how-many-sigops-are-in-the-invalid-block-783426\n\nThe existince of such patches suggests it may be useful to\nmake this value configurable. This commit would make such a\nchange easier.\n\nThe main motivation however is that the Stratum v2 spec\nrequires the pool to communicate the maximum bytes they intend\nto add to the coinbase outputs. A proposed change to the spec\nwould also require them to communicate the maximum number of sigops.\n\nThis commit adds both to BlockAssembler::Options. The default\nis the same as the previously hardcode values.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmZ+ddAACgkQV/+b28ww\nEAmcfBAAguIMUs6R/BMcz9SeejPsp2Y8EOKZYTQuM9/MdiO76Zkp9kggiEEsCYCm\ndQ78GUxoBkI8MxiuDnxWELvG8CFwmagub+rysq1fM/zF0lFRkwyRcQqBU15e5GSp\nZBZv5W4Bimoa/5WWAchMPFl1OnFW4RQCLTtIs0PeyB18VMHkSIEiTHAlpmaAJfvF\nalyT+MtWLplLlTsgjrn7tIMj77DYYCyhyRlpjTqXbJ7drNABV7Ln2OZrDy5eBgtX\nOMWupIW6F0Fug5D2Bzwiph437r5rMbyWqTcX9FyOfGa0cB04yY4cLo8zoeRDULaH\nXq0i+RM0vZr14PjLVJqsygTYyPEGJONjUq8oiEvG2mJWbRiCS+9aXPyLyd45Gp/4\nEpocFrElP5+RaifFVRJsZqAoHCQhGkYdHXoTiYxWDtEL1oA0l5/cVagjP11KBI1r\nlYosrh5wvM8leYnOGxtjCpKjkPMkEK3nJXQvXRx/pVoc9ok9zwNUYGVQ7xKYVtth\ngoiyZigW5miFnGqpuVVKSmr/vBL4ZnX5purgmI2oRotDqZuDaPnb62OX8yGrPFHP\npJaGxklpDQHgXtECwKxvXXiZ/J87SVYXmya34sO4Cl6Jt4BGgwBTT+a//3ztXLfM\nS3YGmMNp/8o2dvvBNyaVtD+dl9kOIDZw3zu6nwS0Gznu8U4SvWM=\n=C2wt\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/64fef353c997167eee4104a2b8e895b084ed2131",
          "sha": "64fef353c997167eee4104a2b8e895b084ed2131",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/64fef353c997167eee4104a2b8e895b084ed2131"
        }
      ],
      "message": "refactor: add coinbase constraints to BlockAssembler::Options\n\nWhen generating a block template through e.g. getblocktemplate RPC,\nwe reserve 4000 weight units and 400 sigops. Pools use this space\nfor their coinbase outputs.\n\nAt least one pool patched their Bitcoin Core node to adjust\nthese hardcoded values. They eventually produced an invalid\nblock which exceeded the sigops limit.\nhttps://bitcoin.stackexchange.com/questions/117837/how-many-sigops-are-in-the-invalid-block-783426\n\nThe existince of such patches suggests it may be useful to\nmake this value configurable. This commit would make such a\nchange easier.\n\nThe main motivation however is that the Stratum v2 spec\nrequires the pool to communicate the maximum bytes they intend\nto add to the coinbase outputs. A proposed change to the spec\nwould also require them to communicate the maximum number of sigops.\n\nThis commit adds both to BlockAssembler::Options. The default\nis the same as the previously hardcode values.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:35:28Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:09:09Z"
      },
      "sha": "eb4b4ead5583809eb818161c3712056bc67e2681"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVkYWZjNjY5NjhlNGFiYzYyZjkxNTM2ZjQ1ZDFlNTAzNzU2ZWY4OGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5dafc66968e4abc62f91536f45d1e503756ef88b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5dafc66968e4abc62f91536f45d1e503756ef88b",
      "tree": {
        "sha": "cf47b4bed2d3d9b00044ff6363d1cf7451c5bfa6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cf47b4bed2d3d9b00044ff6363d1cf7451c5bfa6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cf47b4bed2d3d9b00044ff6363d1cf7451c5bfa6\nparent eb4b4ead5583809eb818161c3712056bc67e2681\nauthor Sjors Provoost <sjors@sprovoost.nl> 1718720678 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1719563728 +0200\n\nAdd util/mining.h for default coinbase constraints\n\nThese defaults are needed by the Mining interface in the next commit.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmZ+ddAACgkQV/+b28ww\nEAnQMhAAqgUjBHCBJ4KKACKEXqi133ZCvwD1G4rW2EG26+eBroX7OYa7y10o1D5X\n+ofnYU2lnM47qIN3pDAXMH9VQ7Xc33paemYxqK34yHf/yqVsw3Abz2S9U2IW6P/d\nDTmwMW5WQu2IHmuvhajkdQCEneVpLZaKBNo7UE6wezqKLR3NXNXMWSoZtiEBFXDo\nCe33qbJEcKNUaB+I3J3T3fJEiBpCFYwFlEYTKDaDO+OMmkTqYZn/ymCQ7Hhl2Ab8\nhaInUib/k/hGgygSwizJdkhC4iR7pYjayI6ydVgyBNVD1aOaPFiZDrmDVRouJ95o\nl0f3Z0LkCwZ2JO20rdW5DORrknHC0jzeAGJjLMHhjkxERy1N6ggFLLmplI39UDP8\nGv0IY8R0wH7QGylmOG+/FuMpSany096w1JgrQvh70YlsevthaDgNRVOchUs3Z/xB\nBhPWVmBZJ1RFfS2BEWekfg6rsdJ9MRQ0zGrqTODI7/t7e5tDbds1lUl7F/3uZW9v\nCKyaCLlyRTDV4UuZFE+MEL+Aw6hN0KU1Jg2C0dzIUUKiy0SIGsSlUpYg6yASeSNz\nvmbNEofUSCqMNM5BhDyt1I0r95l9Zf3uSQN8igXgS4LCBsk2KUfATqAZICJ+X4KR\ngvmlbjPPys72DpDI3pQdGmijuGoN0eQz8PBvOwzyOFLuBJPqjCA=\n=LbHO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb4b4ead5583809eb818161c3712056bc67e2681",
          "sha": "eb4b4ead5583809eb818161c3712056bc67e2681",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eb4b4ead5583809eb818161c3712056bc67e2681"
        }
      ],
      "message": "Add util/mining.h for default coinbase constraints\n\nThese defaults are needed by the Mining interface in the next commit.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:35:28Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-18T14:24:38Z"
      },
      "sha": "5dafc66968e4abc62f91536f45d1e503756ef88b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRjNTdmMjcwN2UwMGJiZmQyZTJkMmE2ZDNlMDVlYTBiYmIwNjA5Y2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4c57f2707e00bbfd2e2d2a6d3e05ea0bbb0609cd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4c57f2707e00bbfd2e2d2a6d3e05ea0bbb0609cd",
      "tree": {
        "sha": "5ca408601b2f2d1cada74187bdd846bee18aa598",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5ca408601b2f2d1cada74187bdd846bee18aa598"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5ca408601b2f2d1cada74187bdd846bee18aa598\nparent 5dafc66968e4abc62f91536f45d1e503756ef88b\nauthor Sjors Provoost <sjors@sprovoost.nl> 1719562432 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1719563728 +0200\n\nPass coinbase constraints to createNewBlock\n\nExisting callers of createNewBlock use the defaults,\nso this commit does not change behavior and the\nAssume(s) won't be false.\n\nThis commit also documents what happens when\n-blockmaxweight is lower than the coinbase\nreserved value.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmZ+ddAACgkQV/+b28ww\nEAlfwxAAhFph2gjGC5ztqI/nJeIWwsxjfNK2T/4Vr2thEL2AN2jLcCs05kXw0Fvd\nAy55qLZLubKiOw+BNAuv2bV8Avu4ZTczyJLlFFVCB04vJYdOD1DrvtAvvcO6eUis\nA8RNUQpAiT9q797a4Br9M8IUuYB6Pv+gasI8nNRdUyjeH5AbDcE0iRk0n/kN/ppw\ncLMQbhx4Mal1Rih/fZojPTEKojbQcDHiKN0DVykJzB6hi4GEpMGaAX5oi7nkr7Y2\n4Lnzdklt4EbA83RdIlfh7DOlcZH7R2fw3wT85wNAFuSJdgJZ88ZZfrleNSX2+2rp\naGCyfp2bVtPaHXiGSIS+obd0+mTWOYkuWEB982cYb1TVLMoMt479gxR9AUslTGiQ\nR8sJ7tJXkg6STYm5TQcaB78PJPRSFwYtjDW1HiYINxQwiLK0TJCAYUXBzrmLcydS\n3W1ByH+pdf83CGL33Yyt98qSQWsOzDuV+aZZay5UhOxPnVPubbmvg7XCaVHXCFGl\nJXvn6LlBZSnzNoFLfzOL+e0txkzxXJ1Hzon6QwBnsbUsDDl3TQt1EUQu2Tp/sC6J\nkDKhZefKTEspHUJnLBezpFh4teGrse6nOnzFaRm+eY0W0WMF//Pj3QQdjaHF9BJU\n74PjDrlWCgpye9g+EC2yDhobFkiYSaOOCiaMIxFlQFIp/PHoWDw=\n=Vh2h\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5dafc66968e4abc62f91536f45d1e503756ef88b",
          "sha": "5dafc66968e4abc62f91536f45d1e503756ef88b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5dafc66968e4abc62f91536f45d1e503756ef88b"
        }
      ],
      "message": "Pass coinbase constraints to createNewBlock\n\nExisting callers of createNewBlock use the defaults,\nso this commit does not change behavior and the\nAssume(s) won't be false.\n\nThis commit also documents what happens when\n-blockmaxweight is lower than the coinbase\nreserved value.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:35:28Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-06-28T08:13:52Z"
      },
      "sha": "4c57f2707e00bbfd2e2d2a6d3e05ea0bbb0609cd"
    },
    {
      "event": "commented",
      "id": 2196446059,
      "node_id": "IC_kwDOABII586C6xtr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2196446059",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-28T08:56:34Z",
      "updated_at": "2024-06-28T13:13:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30356).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29432](https://github.com/bitcoin/bitcoin/pull/29432) (Stratum v2 Template Provider (take 3) by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30356#issuecomment-2196446059",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30356"
    },
    {
      "event": "labeled",
      "id": 13328705456,
      "node_id": "LE_lADOABII586N2u5qzwAAAAMac-ew",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13328705456",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-28T08:56:36Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    }
  ],
  "comments": []
}