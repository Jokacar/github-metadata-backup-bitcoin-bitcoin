{
  "type": "issue",
  "issue": {
    "id": 2513740991,
    "node_id": "I_kwDOABII586V1KS_",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30852",
    "number": 30852,
    "state": "open",
    "state_reason": null,
    "title": "Increasing self-hosted runner raw performance",
    "body": "_disclaimer_: The following should **not** replace us investigating and fixing the root causes of timeouts and intermittent test runtime performance.\r\n\r\nNow seems an opportune time to open a discussion on some investigation I have been doing into our self-hosted runners, as our CI has been struggling again recently.\r\n\r\nI wanted to see what the cost/benefit implications would be on upgrading our self-hosted runners would look like. Hooking up a single [Hetzner AX52](https://www.hetzner.com/dedicated-rootserver/ax52/) (70 €/month) as a self-hosted runner saw each job run on average 3-5x faster (result image shown at end), which is not surprising in itself.\r\n\r\nIIUC correctly we currently have about 25 low powered, shared vCPU x86_64 runners (plus a sprinkling of ARM ones). If we had the appetite, and could find the funding, we might consider:\r\n\r\n1. upgrade the x86_64 runners to 12 dedicated CPU servers. At 70€ this would total 840€ per month, or 10080€ per year, vs current spend of ~3840€, so 2.5x more cost for 3-5x more speed. This feels like a decent return.\r\n\r\nalternatively\r\n\r\n2. Bump our current (shared vCPU) runners to the next \"level\" up. If e.g. [these](https://github.com/maflcko/bitcoin-core-qa-assets/wiki/Persistent-workers#set-up-servers) are the runners in use for us today, we could increment the CPX21s to CPX31s, and the CPX31s to CPX41s for a monthly cost of 505.6€ vs a current spend of 320€. I did not test performance gains of this path.\r\n\r\nWe could also\" just spend more\" buying larger numbers of the same (low-powered) runners, but IMO this would not be as effective as reducing the runtime of CI jobs, and eliminating CI run timeouts. Moving away from vCPUs feels like the correct choice, if we can, as it's possible that random contention on these could contribute to \"random\" timeouts and failures.\r\n\r\nAdditional thoughts in no particular order:\r\n\r\n- I have likely not considered all the benefits of having larger numbers of lower powered runners. Comments welcomed on this.\r\n  - These more powerful runners also (all) come with (some) more disk space, so we could potentially do things like configure total ccache size (across all jobs) to be something like 100's of GB, and try and maximize those cache hits!\r\n- I am not sure what the developer tradeoff is for \"CI startup time\" (i.e. when a job is picked up by a runner) vs \"CI runtime\".\r\n- Shold we employ a more scientific approach, which could be to caclulate total compute/€ and just get whatever wins out by that metric.\r\n\r\nI'd be curious to hear thoughts on whether this is something worth us looking at any further, or if folks have investigated this before and what they found.\r\n\r\n#### AX52 test\r\n\r\n1. A typical CI run using current runners (on a good day):\r\n\r\n![image](https://github.com/user-attachments/assets/d90bae58-0a96-460c-ad5d-210b1f9278c5)\r\n\r\n2. Jobs run using a single AX52 runner:\r\n\r\n![image](https://github.com/user-attachments/assets/60c7a80a-9e80-49c3-93b1-81f1e10bb6e2)\r\n",
    "user": {
      "login": "willcl-ark",
      "id": 6606587,
      "node_id": "MDQ6VXNlcjY2MDY1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/willcl-ark",
      "html_url": "https://github.com/willcl-ark",
      "followers_url": "https://api.github.com/users/willcl-ark/followers",
      "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
      "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
      "repos_url": "https://api.github.com/users/willcl-ark/repos",
      "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64584,
        "node_id": "MDU6TGFiZWw2NDU4NA==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
        "name": "Brainstorming",
        "color": "ebd775",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 0,
    "created_at": "2024-09-09T11:49:47Z",
    "updated_at": "2024-09-09T11:49:47Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 14181994926,
      "node_id": "LE_lADOABII586V1KS_zwAAAANNUBGu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14181994926",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T11:49:47Z",
      "label": {
        "name": "Brainstorming",
        "color": "ebd775"
      }
    }
  ]
}