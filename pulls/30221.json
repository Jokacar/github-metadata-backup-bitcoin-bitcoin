{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30221",
    "id": 1901745928,
    "node_id": "PR_kwDOABII585xWlcI",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30221",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30221.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30221.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30221/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30221/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/e5c98765257176397126678799a366c8d3412848",
    "number": 30221,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Ensure best block matches wallet scan state",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Implements the idea discussed in https://github.com/bitcoin/bitcoin/pull/29652#issuecomment-2010579484\r\n\r\nCurrently, `m_last_block_processed` and `m_last_block_processed_height` are not guaranteed to match the block locator stored in the wallet, nor do either of those fields actually represent the last block that the wallet is synced up to. This is confusing and unintuitive.\r\n\r\nThis PR changes the those last block fields to actually be in sync with the record stored on disk. This requires adding the block height to the `BESTBLOCK_NOMERKLE` record, which was done in a backwards compatible manner. Additionally, the issue with `chainStateFlushed` fixed in #29652 is also fixed here by removing `chainStateFlushed` entirely. The last block fields, now simply the best block, is updated for each `blockConnected` and `blockDisconnected` so that it does actually represent the block for which the wallet is synced up to.\r\n\r\nTo make it easier to deal with, the best block fields are consolidated into a `BestBlock` struct which also has the serialization code with backwards compatibility.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2024-06-03T21:58:09Z",
    "updated_at": "2024-06-18T03:57:27Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "9ca016d2f11a9ff4f125b291c2f260d78c311395",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "achow101:wallet-no-chainstateflushed",
      "ref": "wallet-no-chainstateflushed",
      "sha": "e5c98765257176397126678799a366c8d3412848",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 36,
        "watchers_count": 36,
        "size": 275838,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-06-17T16:31:34Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2024-04-04T14:22:50Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "f7a6d3444973421bfd35815fabe552874f462467",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35529,
        "stargazers_count": 76969,
        "watchers_count": 76969,
        "size": 261790,
        "default_branch": "master",
        "open_issues_count": 683,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-06-18T00:32:07Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-06-18T03:34:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30221"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 186,
    "deletions": 149,
    "changed_files": 17,
    "commits": 10,
    "review_comments": 0,
    "comments": 6
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFlM2I4MjgwYTdkYmI2Y2M4NzgxNGVkOTdkYmVhNWExMjJjZjgyMTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae3b8280a7dbb6cc87814ed97dbea5a122cf8215",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ae3b8280a7dbb6cc87814ed97dbea5a122cf8215",
      "tree": {
        "sha": "cd9ae053e5440e3ac3f803884f49642f16aea2b7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cd9ae053e5440e3ac3f803884f49642f16aea2b7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f7a6d3444973421bfd35815fabe552874f462467",
          "sha": "f7a6d3444973421bfd35815fabe552874f462467",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f7a6d3444973421bfd35815fabe552874f462467"
        }
      ],
      "message": "wallet: Update best block record after block dis/connect",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T18:47:45Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-26T21:12:52Z"
      },
      "sha": "ae3b8280a7dbb6cc87814ed97dbea5a122cf8215"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMzN2M3MDJmNDdmZjIzZDExYTg2YmI1ZTAwNDFlOGE5NTlkMGU3NTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c37c702f47ff23d11a86bb5e0041e8a959d0e758",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c37c702f47ff23d11a86bb5e0041e8a959d0e758",
      "tree": {
        "sha": "ecd845bec517b3ad3e0135b757583963d5d938b7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ecd845bec517b3ad3e0135b757583963d5d938b7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae3b8280a7dbb6cc87814ed97dbea5a122cf8215",
          "sha": "ae3b8280a7dbb6cc87814ed97dbea5a122cf8215",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ae3b8280a7dbb6cc87814ed97dbea5a122cf8215"
        }
      ],
      "message": "scripted-diff: Rename LastBlock to BestBlock\n\n-BEGIN VERIFY SCRIPT-\nsed -i \"s/SetLastBlockProcessed/SetBestBlock/\" $(git grep -l \"SetLastBlockProcessed\")\nsed -i \"s/GetLastBlock/GetBestBlock/g\" $(git grep -l \"GetLastBlock\")\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:42:56Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-29T20:38:20Z"
      },
      "sha": "c37c702f47ff23d11a86bb5e0041e8a959d0e758"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNmMmI0ZTQ1NGRiZDA2ZDhiMmZlZmI4MGIxZTIzMTc5MzIyOTc4YTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f2b4e454dbd06d8b2fefb80b1e23179322978a5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3f2b4e454dbd06d8b2fefb80b1e23179322978a5",
      "tree": {
        "sha": "07a03687f6bd5063f77c0103f97880e875c4a691",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/07a03687f6bd5063f77c0103f97880e875c4a691"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c37c702f47ff23d11a86bb5e0041e8a959d0e758",
          "sha": "c37c702f47ff23d11a86bb5e0041e8a959d0e758",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c37c702f47ff23d11a86bb5e0041e8a959d0e758"
        }
      ],
      "message": "wallet: Combine last block processed hash and height into a struct\n\nm_last_block_processed and m_last_block_processed_height are combined\ninto a new struct BestBlock.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:43:01Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-29T20:43:17Z"
      },
      "sha": "3f2b4e454dbd06d8b2fefb80b1e23179322978a5"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVlODE2NGM4NmZmMmU3ZmE4ZjNmYWI0Yjc0OTYxZDZjMzAyNDQyNjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5e8164c86ff2e7fa8f3fab4b74961d6c30244260",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5e8164c86ff2e7fa8f3fab4b74961d6c30244260",
      "tree": {
        "sha": "b627af9b50c74024384b31d8b393d2b67fc40c5d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b627af9b50c74024384b31d8b393d2b67fc40c5d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f2b4e454dbd06d8b2fefb80b1e23179322978a5",
          "sha": "3f2b4e454dbd06d8b2fefb80b1e23179322978a5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3f2b4e454dbd06d8b2fefb80b1e23179322978a5"
        }
      ],
      "message": "wallet: Replace chainStateFlushed in loading with WriteBestBlock\n\nThe only reason to call chainStateFlushed during wallet loading is to\nensure that the best block is written. Do these writes explicitly to\nprepare for removing chainStateFlushed.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:43:01Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T20:24:13Z"
      },
      "sha": "5e8164c86ff2e7fa8f3fab4b74961d6c30244260"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDlkZjkwMjdlMmI3ZjMzYWI2MTM4MzMwNWQ2NjM4NTE5YTA1Y2JlMjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9df9027e2b7f33ab61383305d6638519a05cbe20",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9df9027e2b7f33ab61383305d6638519a05cbe20",
      "tree": {
        "sha": "83751592679237d7345a076d297d8d0c4f269ec1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/83751592679237d7345a076d297d8d0c4f269ec1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5e8164c86ff2e7fa8f3fab4b74961d6c30244260",
          "sha": "5e8164c86ff2e7fa8f3fab4b74961d6c30244260",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5e8164c86ff2e7fa8f3fab4b74961d6c30244260"
        }
      ],
      "message": "wallet: Remove WriteBestBlock from chainStateFlushed",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:43:01Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T20:25:33Z"
      },
      "sha": "9df9027e2b7f33ab61383305d6638519a05cbe20"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA2NjdiODZiYjRmNWNhODNkMTY0NGE1MTNmYmI5NDM5YmU0MjM4MjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0667b86bb4f5ca83d1644a513fbb9439be423820",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0667b86bb4f5ca83d1644a513fbb9439be423820",
      "tree": {
        "sha": "2c03587ea77d003e556677b2402e01dd50671a68",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2c03587ea77d003e556677b2402e01dd50671a68"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9df9027e2b7f33ab61383305d6638519a05cbe20",
          "sha": "9df9027e2b7f33ab61383305d6638519a05cbe20",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9df9027e2b7f33ab61383305d6638519a05cbe20"
        }
      ],
      "message": "wallet: Sync m_best_block with BESTBLOCK_NOMERKLE\n\nThe BestBlock struct now contains the block locator, and is also\nserialized with the block height. For backwards compatibility, the\nheight is optional. The best block hash is retrieved from the block\nlocator when deserializing.\n\nSince the best block record has to store the height, additional\nchanges to AttachChain are made to faciliate auto upgrade as well as\nsetting the in-memory best block.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:43:01Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T20:59:09Z"
      },
      "sha": "0667b86bb4f5ca83d1644a513fbb9439be423820"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRmY2RkZDFmYTFlMDlmZjBjN2Y4MGJjZmIzMmRlOGJmOWQ5OGRjMjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dfcddd1fa1e09ff0c7f80bcfb32de8bf9d98dc23",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/dfcddd1fa1e09ff0c7f80bcfb32de8bf9d98dc23",
      "tree": {
        "sha": "467c26e3a9bea0b8874c62b5642b6fa3bd17b282",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/467c26e3a9bea0b8874c62b5642b6fa3bd17b282"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0667b86bb4f5ca83d1644a513fbb9439be423820",
          "sha": "0667b86bb4f5ca83d1644a513fbb9439be423820",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0667b86bb4f5ca83d1644a513fbb9439be423820"
        }
      ],
      "message": "wallet: Load best block record in LoadWallet\n\nInstead of setting the best block info later during AttachChain, read it\nduring LoadWallet so it is set (if it exists) before we get there.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:43:01Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:26:18Z"
      },
      "sha": "dfcddd1fa1e09ff0c7f80bcfb32de8bf9d98dc23"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBmOTc3NjNlODFjNmVlOTBkYTExN2RlNzcyMTUwNjQwODFiNWNhZjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0f97763e81c6ee90da117de77215064081b5caf8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0f97763e81c6ee90da117de77215064081b5caf8",
      "tree": {
        "sha": "310a171495a15322a9cbe041f69b1c1924353fd3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/310a171495a15322a9cbe041f69b1c1924353fd3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dfcddd1fa1e09ff0c7f80bcfb32de8bf9d98dc23",
          "sha": "dfcddd1fa1e09ff0c7f80bcfb32de8bf9d98dc23",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/dfcddd1fa1e09ff0c7f80bcfb32de8bf9d98dc23"
        }
      ],
      "message": "wallet: Use best block locator in migrate instead of re-reading it\n\nInstead of calling ReadBestBlock to get the best block locator, use the\nm_best_block.m_locator that we already have in CWallet.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:43:01Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-29T19:00:59Z"
      },
      "sha": "0f97763e81c6ee90da117de77215064081b5caf8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA5YTE0OTMxZTcxZmY3ZDczNzQ1N2NiOTIwMjkxNzlkODRkOGE2NjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09a14931e71ff7d737457cb92029179d84d8a664",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/09a14931e71ff7d737457cb92029179d84d8a664",
      "tree": {
        "sha": "ad270639173b6665affa9c4eb151ad662535d4e0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ad270639173b6665affa9c4eb151ad662535d4e0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0f97763e81c6ee90da117de77215064081b5caf8",
          "sha": "0f97763e81c6ee90da117de77215064081b5caf8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0f97763e81c6ee90da117de77215064081b5caf8"
        }
      ],
      "message": "wallet: use SetBestBlock when saving progress during rescan\n\nInstead of writing the best block record directly during a rescan, use\nSetBestBlock. This is safe because progress is only saved in a\nrescan when doing a rescan on loading. cs_wallet is held the entire time\nso new blocks or reorgs will not cause the best block record to be\nchanged unexpectedly.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:51:00Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-29T19:38:59Z"
      },
      "sha": "09a14931e71ff7d737457cb92029179d84d8a664"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU1Yzk4NzY1MjU3MTc2Mzk3MTI2Njc4Nzk5YTM2NmM4ZDM0MTI4NDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e5c98765257176397126678799a366c8d3412848",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e5c98765257176397126678799a366c8d3412848",
      "tree": {
        "sha": "0f555a85c5465d662b48a5a2b3cab1b2abc71630",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0f555a85c5465d662b48a5a2b3cab1b2abc71630"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09a14931e71ff7d737457cb92029179d84d8a664",
          "sha": "09a14931e71ff7d737457cb92029179d84d8a664",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/09a14931e71ff7d737457cb92029179d84d8a664"
        }
      ],
      "message": "wallet: Remove chainStateFlushed\n\nchainStateFlushed is no longer needed since the best block is updated\nafter a block is scanned. Since the chainstate being flushed does not\nnecessarily coincide with the wallet having processed said block, it\ndoes not entirely make sense for the wallet to be recording that block\nas its best block, and this can cause race conditions where some blocks\nare not processed. Thus, remove this notification.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-06-03T21:51:09Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-29T19:54:38Z"
      },
      "sha": "e5c98765257176397126678799a366c8d3412848"
    },
    {
      "event": "commented",
      "id": 2146197059,
      "node_id": "IC_kwDOABII585_7F5D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2146197059",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-03T21:58:12Z",
      "updated_at": "2024-06-18T03:57:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30221).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30214](https://github.com/bitcoin/bitcoin/pull/30214) (refactor: Improve assumeutxo state representation by ryanofsky)\n* [#29936](https://github.com/bitcoin/bitcoin/pull/29936) (fuzz: wallet: add target for `CreateTransaction` by brunoerg)\n* [#29652](https://github.com/bitcoin/bitcoin/pull/29652) (wallet: Avoid potentially writing incorrect best block locator by ryanofsky)\n* [#29256](https://github.com/bitcoin/bitcoin/pull/29256) (Improve new LogDebug/Trace/Info/Warning/Error Macros by ryanofsky)\n* [#28616](https://github.com/bitcoin/bitcoin/pull/28616) (Show transactions as not fully confirmed during background validation by Sjors)\n* [#28574](https://github.com/bitcoin/bitcoin/pull/28574) (wallet: optimize migration process, batch db transactions by furszy)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#25722](https://github.com/bitcoin/bitcoin/pull/25722) (refactor: Use util::Result class for wallet loading by ryanofsky)\n* [#24128](https://github.com/bitcoin/bitcoin/pull/24128) (wallet: BIP 326 sequence based anti-fee-snipe for taproot inputs by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#issuecomment-2146197059",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221"
    },
    {
      "event": "labeled",
      "id": 13027451431,
      "node_id": "LE_lADOABII586LAYCKzwAAAAMIfyIn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13027451431",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-03T21:58:14Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "reviewed",
      "id": 2095255300,
      "node_id": "PRR_kwDOABII58584w8E",
      "url": null,
      "actor": null,
      "commit_id": "e5c98765257176397126678799a366c8d3412848",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "Thompson1985",
        "id": 131511127,
        "node_id": "U_kgDOB9azVw",
        "avatar_url": "https://avatars.githubusercontent.com/u/131511127?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Thompson1985",
        "html_url": "https://github.com/Thompson1985",
        "followers_url": "https://api.github.com/users/Thompson1985/followers",
        "following_url": "https://api.github.com/users/Thompson1985/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Thompson1985/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Thompson1985/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Thompson1985/subscriptions",
        "organizations_url": "https://api.github.com/users/Thompson1985/orgs",
        "repos_url": "https://api.github.com/users/Thompson1985/repos",
        "events_url": "https://api.github.com/users/Thompson1985/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Thompson1985/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#pullrequestreview-2095255300",
      "submitted_at": "2024-06-04T04:02:25Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30221"
    },
    {
      "event": "commented",
      "id": 2147839858,
      "node_id": "IC_kwDOABII586ABW9y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2147839858",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-04T15:34:54Z",
      "updated_at": "2024-06-04T15:34:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm not sure, but it seems like a potentially good thing to me that `last_block_processed` and BESTBLOCK are two distinct concepts.\r\n\r\nThe last block processed is the block that CWallet in-memory state has been synced to (particularly CWalletTx::m_state which includes mempool / abandoned information not serialized to disk).\r\n\r\nThe BESTBLOCK record is the last block whose data has been flushed to disk, that the wallet should begin syncing from next time it is reloaded.\r\n\r\nIt seems like the first commit ae3b8280a7dbb6cc87814ed97dbea5a122cf8215 could lead to a performance regression if it is writing the flushing the BESTBLOCK record on every single blockConnected event from the node. For example during reindexing it could write and sync the database each time a block is connected, even if the block is before the wallets birthday, or doesn't have any relevant transactions?\r\n\r\nI think it probably makes sense to write BESTBLOCK in a smarter way, and probably write it more frequently, but it seems unnecessary to have to write it every block, and it might be bad for performance now or make optimizations harder in the future.\r\n\r\nI'm also curious about the idea of saving height with the best block record. I could imagine this being useful, since IIRC parts of wallet loading are complicated by not knowing heights of transactions before the chain is attached, but it doesn't really seem like the height is used for much yet. Was this intended to be used by something else later?",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#issuecomment-2147839858",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221"
    },
    {
      "event": "commented",
      "id": 2147869048,
      "node_id": "IC_kwDOABII586ABeF4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2147869048",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-04T15:48:43Z",
      "updated_at": "2024-06-04T15:48:43Z",
      "author_association": "MEMBER",
      "body": "> The last block processed is the block that CWallet in-memory state has been synced to (particularly CWalletTx::m_state which includes mempool / abandoned information not serialized to disk).\r\n\r\nBut none of that state is relevant to the last block processed. Any state related to blocks (confirmed or conflicted) is written to disk.\r\n\r\n> The BESTBLOCK record is the last block whose data has been flushed to disk, that the wallet should begin syncing from next time it is reloaded.\r\n\r\nThe point is that this discrepancy can result in skipping blocks. It doesn't make sense to me that we wouldn't store the block the wallet's state has been synced to, and it doesn't make sense that we should rely on a field that means something else to determine what point to start rescanning from on the next load.\r\n\r\nIf BESTBLOCK doesn't match the chainstate, that's fine because it's a locator and we will just find the fork and sync from there. I don't think it's necessary to record which block we think the chainstate is synced to.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#issuecomment-2147869048",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221"
    },
    {
      "event": "commented",
      "id": 2147885391,
      "node_id": "IC_kwDOABII586ABiFP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2147885391",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-04T15:56:56Z",
      "updated_at": "2024-06-04T15:56:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It doesn't make sense to me that we wouldn't store the block the wallet's state has been synced to\r\n\r\nYou may be right this is the better approach. But I think the previous approach does make some sense, too. You might not want to write to the wallet database each time a block is connected if the block doesn't contain any relevant transactions, especially during reindexing.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#issuecomment-2147885391",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221"
    },
    {
      "event": "commented",
      "id": 2148413538,
      "node_id": "IC_kwDOABII586ADjBi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2148413538",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-04T21:03:52Z",
      "updated_at": "2024-06-04T21:03:52Z",
      "author_association": "MEMBER",
      "body": "> You might not want to write to the wallet database each time a block is connected if the block doesn't contain any relevant transactions\r\n\r\nI think you would since not writing it would result in possibly rescanning that block at the next loading which takes a little bit of time, regardless of whether any relevant transactions are in the block.\r\n\r\n> especially during reindexing.\r\n\r\nPerhaps an easy solution to this is to just write the best block every 1000 blocks (or some other interval) when we are in IBD?\r\n\r\n> I'm also curious about the idea of saving height with the best block record. I could imagine this being useful, since IIRC parts of wallet loading are complicated by not knowing heights of transactions before the chain is attached, but it doesn't really seem like the height is used for much yet. Was this intended to be used by something else later?\r\n\r\nThis was mainly done to avoid looking up the height every time we load since that was being problematic and causing a tests to fail. But it definitely could be more useful in the future.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#issuecomment-2148413538",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221"
    },
    {
      "event": "commented",
      "id": 2150332074,
      "node_id": "IC_kwDOABII586AK3aq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2150332074",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-05T15:16:32Z",
      "updated_at": "2024-06-05T15:17:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "The idea of saving heights is interesting to me because wallet code assumes it know block heights many places, but it doesn't actually store heights anywhere. So for example, if the wallet stored a mapping of block hashes to heights (or other block information) it might be useful for allowing the wallet to work in an offline mode or letting the wallet CLI tool have more capabilities. This is all pretty abstract though, so I'm not suggesting something specific.\r\n\r\n> Perhaps an easy solution to this is to just write the best block every 1000 blocks (or some other interval) when we are in IBD?\r\n\r\nYes but I think that just adds back the complexity you were trying to get rid of, in a form that seems worse than the status quo. If you implement that, the wallet will be back to tracking the last block processed separately from the best block written to the database. And now, instead of the node determining when data should be flushed to disk and having all wallets flush that data simultaneously, each wallet will have internal logic deciding when to flush. This would be more complicated, and could be worse for power consumption and performance if there are multiple wallets and flushes are happening more frequently at different times.\r\n\r\nI think overall this PR is doing some good things, but the goals seem either not clear, or not clearly good, so I wonder if maybe you could take these changes and make more targeted PRs for the things you want to achieve?\r\n\r\nOr, if this PR is definitely the direction you want to go, I'm happy to review it. I don't like some things it is doing, but overall I think it is a reasonable change.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30221#issuecomment-2150332074",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30221"
    }
  ],
  "comments": []
}