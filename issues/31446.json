{
  "type": "issue",
  "issue": {
    "id": 2727444140,
    "node_id": "I_kwDOABII586ikX6s",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31446",
    "number": 31446,
    "state": "closed",
    "state_reason": "completed",
    "title": "Intermittent issue in feature_index_prune.py: assert_equal(pruneheight_new, 248) AssertionError: not(249 == 248)",
    "body": "https://cirrus-ci.com/task/5093097040773120?logs=ci#L2925\r\n\r\n```\r\n[05:55:03.695]  test  2024-12-03T05:55:02.834000Z TestFramework (ERROR): Assertion failed \r\n[05:55:03.695]                                    Traceback (most recent call last):\r\n[05:55:03.695]                                      File \"/ci_container_base/test/functional/test_framework/test_framework.py\", line 135, in main\r\n[05:55:03.695]                                        self.run_test()\r\n[05:55:03.695]                                      File \"/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/test/functional/feature_index_prune.py\", line 77, in run_test\r\n[05:55:03.695]                                        assert_equal(pruneheight_new, 248)\r\n[05:55:03.695]                                      File \"/ci_container_base/test/functional/test_framework/util.py\", line 77, in assert_equal\r\n[05:55:03.695]                                        raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\n[05:55:03.695]                                    AssertionError: not(249 == 248)",
    "user": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 4,
    "closed_at": "2024-12-30T19:28:06Z",
    "closed_by": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "created_at": "2024-12-09T15:29:12Z",
    "updated_at": "2024-12-30T19:28:06Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2528375070,
      "node_id": "IC_kwDOABII586Ws_Ee",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2528375070",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-09T15:29:41Z",
      "updated_at": "2024-12-09T15:29:41Z",
      "author_association": "MEMBER",
      "body": "https://cirrus-ci.com/task/5732914295472128?logs=ci#L2938",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31446#issuecomment-2528375070",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446"
    },
    {
      "event": "labeled",
      "id": 15585530729,
      "node_id": "LE_lADOABII586ikX6szwAAAAOg-FNp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15585530729",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-09T15:29:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2532884179,
      "node_id": "IC_kwDOABII586W-L7T",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2532884179",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-10T21:01:54Z",
      "updated_at": "2024-12-10T21:01:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "This is due to the possibility of blocks arriving out of order, even when syncing with just one peer:\r\n\r\nAs node 0 generates blocks, it sends out cmpctblock messages to its peers.\r\nIn response to this, node 1 will either reconstruct the blocks/write them to disk directly or (if it's slow in keeping up, and its tip is behind so that it sees the announcements as in the future) request them via GETDATA, adding a round trip.\r\nTherefore, blocks can be saved to disk out of order for node 1, and if that happens with the last block of the block file, the prune height can be different for one of the blocks receiving blocks via p2p.\r\n\r\nNot sure how to best fix this - I thought about just softening the assertions for the pruning height, but possibly the later subtest \"prune exactly up to the indices best blocks while the indices are disabled\" could fail due to that same effect? ",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31446#issuecomment-2532884179",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446"
    },
    {
      "event": "commented",
      "id": 2532928888,
      "node_id": "IC_kwDOABII586W-W14",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2532928888",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-10T21:28:24Z",
      "updated_at": "2024-12-10T21:28:24Z",
      "author_association": "MEMBER",
      "body": "I guess it could use a \"dumb\" sync instead of the P2P sync. Similar to:\r\n\r\n\r\n```\r\n$ git grep --line-number -A18 'def dumb_sync'\r\ntest/functional/wallet_upgradewallet.py:78:    def dumb_sync_blocks(self):\r\ntest/functional/wallet_upgradewallet.py-79-        \"\"\"\r\ntest/functional/wallet_upgradewallet.py-80-        Little helper to sync older wallets.\r\ntest/functional/wallet_upgradewallet.py-81-        Notice that v0.15.2's regtest is hardforked, so there is\r\ntest/functional/wallet_upgradewallet.py-82-        no sync for it.\r\ntest/functional/wallet_upgradewallet.py-83-        v0.15.2 is only being used to test for version upgrade\r\ntest/functional/wallet_upgradewallet.py-84-        and master hash key presence.\r\ntest/functional/wallet_upgradewallet.py-85-        v0.16.3 is being used to test for version upgrade and balances.\r\ntest/functional/wallet_upgradewallet.py-86-        Further info: https://github.com/bitcoin/bitcoin/pull/18774#discussion_r416967844\r\ntest/functional/wallet_upgradewallet.py-87-        \"\"\"\r\ntest/functional/wallet_upgradewallet.py-88-        node_from = self.nodes[0]\r\ntest/functional/wallet_upgradewallet.py-89-        v16_3_node = self.nodes[1]\r\ntest/functional/wallet_upgradewallet.py-90-        to_height = node_from.getblockcount()\r\ntest/functional/wallet_upgradewallet.py-91-        height = self.nodes[1].getblockcount()\r\ntest/functional/wallet_upgradewallet.py-92-        for i in range(height, to_height+1):\r\ntest/functional/wallet_upgradewallet.py-93-            b = node_from.getblock(blockhash=node_from.getblockhash(i), verbose=0)\r\ntest/functional/wallet_upgradewallet.py-94-            v16_3_node.submitblock(b)\r\ntest/functional/wallet_upgradewallet.py-95-        assert_equal(v16_3_node.getblockcount(), to_height)\r\ntest/functional/wallet_upgradewallet.py-96-\r\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31446#issuecomment-2532928888",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446"
    },
    {
      "event": "commented",
      "id": 2561273816,
      "node_id": "IC_kwDOABII586Yqe_Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2561273816",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-24T16:28:26Z",
      "updated_at": "2024-12-24T16:28:26Z",
      "author_association": "MEMBER",
      "body": "https://cirrus-ci.com/task/6171541521563648?logs=ci#L2939",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31446#issuecomment-2561273816",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31446"
    },
    {
      "event": "closed",
      "id": 15786592902,
      "node_id": "CE_lADOABII586ikX6szwAAAAOs9EqG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15786592902",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ba0cb7d5a54ffccc9dd2d801bff2ce1d898361da",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ba0cb7d5a54ffccc9dd2d801bff2ce1d898361da",
      "created_at": "2024-12-30T19:28:06Z"
    },
    {
      "event": "referenced",
      "id": 15786592971,
      "node_id": "REFE_lADOABII586ikX6szwAAAAOs9ErL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15786592971",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ba0cb7d5a54ffccc9dd2d801bff2ce1d898361da",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/ba0cb7d5a54ffccc9dd2d801bff2ce1d898361da",
      "created_at": "2024-12-30T19:28:07Z"
    }
  ]
}