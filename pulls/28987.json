{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
    "id": 1626725385,
    "node_id": "PR_kwDOABII585g9dwJ",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/28987",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/28987.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/28987.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/9a3c5c8697659e34d0476103af942a4615818f4e",
    "number": 28987,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "wallet: simplify and batch zap wallet txes process",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Work decoupled from #28574. Brother of #28894.\r\n\r\nIncludes two different, yet interconnected, performance and code improvements to the zap wallet transactions process.\r\n\r\n1) As the goal of the `ZapSelectTx` function is to erase tx records that match any of the inputted hashes. There is no need to traverse the whole database record by record. We could just check if the tx exist, and remove it directly by calling `EraseTx()`.\r\n\r\n2) Instead of performing single write operations per removed tx record, this PR batches them all within a single atomic db txn.\r\n\r\nMoreover, these changes will enable us to consolidate all individual write operations that take place during the wallet migration process into a single db txn in the future.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2023-12-02T14:03:31Z",
    "updated_at": "2024-02-13T12:11:50Z",
    "closed_at": "2024-02-12T18:42:03Z",
    "mergeable_state": "unknown",
    "merged_at": "2024-02-12T18:42:03Z",
    "merge_commit_sha": "6ff0aa089c01ff3e610ecb47814ed739d685a14c",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "furszy:2023_wallet_zaptx",
      "ref": "2023_wallet_zaptx",
      "sha": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 393622,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-12T20:39:55Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-08-30T13:12:58Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b2b2b1e9e415c3b5f74d517eaebfc2073cef5175",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36783,
        "stargazers_count": 73949,
        "watchers_count": 73949,
        "size": 249276,
        "default_branch": "master",
        "open_issues_count": 674,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-13T12:54:27Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-02-13T12:57:11Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 45,
    "deletions": 128,
    "changed_files": 7,
    "commits": 4,
    "review_comments": 14,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 1837156030,
      "node_id": "IC_kwDOABII585tgMa-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1837156030",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-02T14:03:34Z",
      "updated_at": "2024-02-12T14:00:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28987).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1936426651), [josibake](https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1938735308) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29403](https://github.com/bitcoin/bitcoin/pull/29403) (wallet: batch erase procedures and improve 'EraseRecords' performance by furszy)\n* [#22693](https://github.com/bitcoin/bitcoin/pull/22693) (RPC/Wallet: Add \"use_txids\" to output of getaddressinfo by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1837156030",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987"
    },
    {
      "event": "labeled",
      "id": 11129068609,
      "node_id": "LE_lADOABII5854hhEUzwAAAAKXWBxB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11129068609",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-02T14:03:37Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-02T20:32:37Z",
      "updated_at": "2023-12-02T20:32:37Z",
      "source": {
        "issue": {
          "id": 1924207353,
          "node_id": "PR_kwDOABII585by2eU",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28574/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28574/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28574/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28574",
          "number": 28574,
          "state": "open",
          "state_reason": null,
          "title": "wallet: optimize migration process, batch db transactions",
          "body": "The benchmark conducted locally showed a ~65% processing time reduction, on a SSD.\r\nResults can be found at the end of the description.\r\n\r\n#### Detailed Description:\r\nThe current wallet migration process performs only individual db writes. Accessing disk to\r\ndelete all legacy records, clone and clean each address book entry for every created wallet,\r\ncreate each new descriptor (with their corresponding master key, caches and key pool), and\r\nalso clone and delete each transaction that requires to be transferred to a different wallet.\r\n\r\nThis work consolidates all individual disk writes into two batch operations. One for the descriptors\r\ncreation from the legacy data and a second one for the execution of the migration process itself.\r\nEfficiently dumping all the information to disk at once atomically at the end of each process.\r\n\r\nThis represent a speed up and also a consistency improvement. During migration, we either\r\nwant to succeed or fail. No other outcomes should be accepted. We should never leave a\r\npartially migrated wallet on disk and request the user to manually restore the previous wallet from\r\na backup (at least not if we can avoid it).\r\n\r\nAdditionally, since db transactions relevant to the key pool generation were also batched, this work\r\nalso speeds up the regular wallet creation process.\r\n\r\n#### Note for Testers:\r\nThe first commit introduces a benchmark for the migration process. This one can be\r\ncherry-picked on top of master to compare results pre and post changes.\r\n\r\nPlease note that the benchmark setup may take some time (~70 seconds here) due to the absence\r\nof a batching mechanism for the address generation process (`GetNewDestination()` calls). Which,\r\nI plan to address in a separate PR, just to not continue expanding this PR.\r\n\r\n#### Final Notes:\r\nThis PR is intended to be an \"all-in-one\" solution that's ready for use and testing. In the coming days, \r\nwill start breaking it down into smaller, focused PRs for better manageability and review.\r\n\r\n————————————————————————\r\n\r\nBenchmark on master (debug mode)\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:-----------\r\n|   65,093,884,958.00 |                0.02 |    0.0% |     65.09 | `WalletMigration`\r\n\r\nBenchmark on this branch (debug mode)\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|   22,926,814,750.00 |                0.04 |    0.0% |     22.93 | `WalletMigration`",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28574",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28574.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28574.patch"
          },
          "created_at": "2023-10-03T13:54:18Z",
          "updated_at": "2024-02-13T12:14:53Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-02T22:53:42Z",
      "updated_at": "2023-12-02T22:53:42Z",
      "source": {
        "issue": {
          "id": 969809743,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NzExODMzMTUx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22693",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22693/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22693/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22693/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/22693",
          "number": 22693,
          "state": "open",
          "state_reason": null,
          "title": "RPC/Wallet: Add \"use_txids\" to output of getaddressinfo",
          "body": "(Non-GUI part of https://github.com/bitcoin-core/gui/pull/562, but without the bloom stuff)",
          "user": {
            "login": "luke-jr",
            "id": 1095675,
            "node_id": "MDQ6VXNlcjEwOTU2NzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/luke-jr",
            "html_url": "https://github.com/luke-jr",
            "followers_url": "https://api.github.com/users/luke-jr/followers",
            "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
            "organizations_url": "https://api.github.com/users/luke-jr/orgs",
            "repos_url": "https://api.github.com/users/luke-jr/repos",
            "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/luke-jr/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 19,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22693",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/22693",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/22693.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/22693.patch"
          },
          "created_at": "2021-08-13T00:19:27Z",
          "updated_at": "2024-02-12T19:08:58Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1806470102,
      "node_id": "PRR_kwDOABII585rrIvW",
      "url": null,
      "actor": null,
      "commit_id": "ff214259de28216a5190c358b786306985f30227",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1806470102",
      "submitted_at": "2024-01-05T17:38:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEyYjA3MWY5OTIwYzJmNDg5M2FmY2M0M2ExNTJmNTkzYzAzOTY2YmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a2b071f9920c2f4893afcc43a152f593c03966bf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a2b071f9920c2f4893afcc43a152f593c03966bf",
      "tree": {
        "sha": "4d3fa397057e2f50b05e544a5f2b2d2d3a4658cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4d3fa397057e2f50b05e544a5f2b2d2d3a4658cf"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4d3fa397057e2f50b05e544a5f2b2d2d3a4658cf\nparent 160d23677ad799cf9b493eaa923b2ac080c3fb8e\nauthor furszy <matiasfurszyfer@protonmail.com> 1689525667 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1704555619 -0300\n\nwallet: ZapSelectTx, remove db rewrite code\n\nThe function does not return DBErrors::NEED_REWRITE.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWZdGQACgkQXdI8zGhq\npiNcVRAAivXn6+DBkV3CnQSona0USsEeQLFYw3JO8unrqEZn3ei+RMI6az6KuVO9\nlcbfwj+Y9HhX1Mx5zyIlNREqJcJ7QFE17rLUn/u8181UExxmiePW3ls8YpLYo1GS\niQqQgcOnv4KQD1eiDgbye/FZXnzfvD211sHHvdZTIRUT9BYPbM3E+jPPUn+8zv3D\n9xgxUf+qHnPaxJuWKa+emvP/WwIRgR0tFw8d76YQZO1/RKo29ahejGpZLxAsbQJa\nitJNV1lYVLf3Og441PdxQ59gK73Y91euzU90D8os5MdixoApQaMWA8UmYdXo8h5/\nxMJ85OYcHmNxKeTyhJr+CxJ4GglXS21S+Emv2GHTGO3yKKbH77320UKagwBVSaUO\napBUQ3RasEmy7nT5EYnVyv2BnWOiVk8/sarvR6q1OFHv7Y7HYSU3DeiJP2XplWLq\nbE++7viwmj5cmJTYIea/Hq/E6VuLtSkjiEEoLzN5cMY2/8r3W1s9FZRYUfkmcsPx\ngGquRII1fMCfaIAa/Z2OurUWwf/F5fWYGOQFo9yrfZPCRbjTiUvFlH38XrA1IJBM\n0subudz5O1M3UW2CJjr91FMKEfg+WeP86wXmm/L8m5kTmQphbQfYtLySirCiqLjE\nsqcePxqpexPFo7uIhWwrpAG0SmzG3U7gMNiiHMSnqI57hz4+Mys=\n=KCXc\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/160d23677ad799cf9b493eaa923b2ac080c3fb8e",
          "sha": "160d23677ad799cf9b493eaa923b2ac080c3fb8e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/160d23677ad799cf9b493eaa923b2ac080c3fb8e"
        }
      ],
      "message": "wallet: ZapSelectTx, remove db rewrite code\n\nThe function does not return DBErrors::NEED_REWRITE.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-06T15:40:19Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-16T16:41:07Z"
      },
      "sha": "a2b071f9920c2f4893afcc43a152f593c03966bf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU5NWQ1MGExMDMyYWQ3ZmZhOTk0NTQ2NGM4NmFhNTdmMTY2NjVlOTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/595d50a1032ad7ffa9945464c86aa57f16665e93",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/595d50a1032ad7ffa9945464c86aa57f16665e93",
      "tree": {
        "sha": "19ca360c0fb44f440168d96776c28fdca1f2058f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/19ca360c0fb44f440168d96776c28fdca1f2058f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 19ca360c0fb44f440168d96776c28fdca1f2058f\nparent a2b071f9920c2f4893afcc43a152f593c03966bf\nauthor furszy <matiasfurszyfer@protonmail.com> 1689549363 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1704555620 -0300\n\nwallet: migration, remove extra NotifyTransactionChanged call\n\nThe wallet is unloaded at the beginning of the migration process,\nso no object is listening to the signals.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmWZdGQACgkQXdI8zGhq\npiPBgQ/8C2TThu9Bh+AwbvWnEQh67A9++rLgjyWx32cZCFQxcnrEYjD+tr4nMEnY\nVYRY/U40KoxSSG/oJvCAyU3b+XMy5R1GU6Mgb2Mvqrh7MW0JhqohkEIkvNouI0G8\nYSX1ykgZiIbXtXTNV1RTdKC5k6jTbpISnxP4ruD01bZs+iywGEYGsSs600jDwTVw\npModZU5JqV0+o/37Gvxu9I2AbXDQuWzNDCLgiO1VfS3J4diIr/sulsKHtzpauJiY\nYPJptnf8tGZBrzrlY+QCoY/lVoDLxIntHGHfsyyXihs0AAiZq617mpMQUbguMtvy\nmsb8FPrL4HLPFQAwbRCfSnEGv1UChTaVU24HhD5YBuDcz7BZwL496rmWXtQs0gaQ\nBDUmK91/vowMfI3P2KaoOgklTX6mY4LoScO7L5WF/E0z4PAs5pcNgwO2iKQF/1Bx\n1Xb8/4+TJt8Tp9y7z+Jp3t4fm3Nr/0xwqXQeE5EqQz7JB1k8w3ztQjfjq49cD2/I\nQe4gX0HmWMhtL7kFzqzFsRXECNg6UuhLlPx+0e6ebU4TEfwmgdf2vOHaBEVVTLCj\ncTWbUA2x5KzMgSWeRvgtIzER624DIf/3bv8EVrDwZw5xyyD5glFuUZdXK8SB7WR7\nD1pzzvst1qn0RE2bTkCKo1vZMByaKl526uOcsIh42ziSlqTm0bY=\n=8S7M\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a2b071f9920c2f4893afcc43a152f593c03966bf",
          "sha": "a2b071f9920c2f4893afcc43a152f593c03966bf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a2b071f9920c2f4893afcc43a152f593c03966bf"
        }
      ],
      "message": "wallet: migration, remove extra NotifyTransactionChanged call\n\nThe wallet is unloaded at the beginning of the migration process,\nso no object is listening to the signals.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-01-06T15:40:20Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-16T23:16:03Z"
      },
      "sha": "595d50a1032ad7ffa9945464c86aa57f16665e93"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11408833315,
      "node_id": "HRFPE_lADOABII5854hhEUzwAAAAKoBPsj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11408833315",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T15:53:24Z"
    },
    {
      "event": "reviewed",
      "id": 1807495476,
      "node_id": "PRR_kwDOABII585rvDE0",
      "url": null,
      "actor": null,
      "commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks achow. [Diff](https://github.com/bitcoin/bitcoin/compare/ff214259de28216a5190c358b786306985f30227..d26a28508d5322fe7c29b3642dcf3a17b0ea31f1).",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1807495476",
      "submitted_at": "2024-01-06T15:56:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    },
    {
      "event": "labeled",
      "id": 11408947270,
      "node_id": "LE_lADOABII5854hhEUzwAAAAKoBrhG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11408947270",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T16:41:35Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1810138430,
      "node_id": "PRR_kwDOABII585r5IU-",
      "url": null,
      "actor": null,
      "commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "CI failure is unrelated. Relates to #29112.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1810138430",
      "submitted_at": "2024-01-08T22:35:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-31T16:24:25Z",
      "updated_at": "2024-01-31T16:24:25Z",
      "source": {
        "issue": {
          "id": 1791741020,
          "node_id": "PR_kwDOABII585U0h8X",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28037",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28037/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28037/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28037/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28037",
          "number": 28037,
          "state": "open",
          "state_reason": null,
          "title": "rpc: Drop migratewallet experimental warning",
          "body": "The migration process itself hasn't fundamentally changed since it was added, so I think it's reasonable to say that it is no longer experimental.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "milestone": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61",
            "html_url": "https://github.com/bitcoin/bitcoin/milestone/61",
            "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/61/labels",
            "id": 9334188,
            "node_id": "MI_kwDOABII584Ajm2s",
            "number": 61,
            "state": "open",
            "title": "27.0",
            "description": "",
            "creator": {
              "login": "sipa",
              "id": 548488,
              "node_id": "MDQ6VXNlcjU0ODQ4OA==",
              "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/sipa",
              "html_url": "https://github.com/sipa",
              "followers_url": "https://api.github.com/users/sipa/followers",
              "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
              "organizations_url": "https://api.github.com/users/sipa/orgs",
              "repos_url": "https://api.github.com/users/sipa/repos",
              "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/sipa/received_events",
              "type": "User",
              "site_admin": false
            },
            "open_issues": 3,
            "closed_issues": 43,
            "created_at": "2023-04-27T08:01:57Z",
            "updated_at": "2024-02-13T12:43:17Z"
          },
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28037",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28037",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28037.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28037.patch"
          },
          "created_at": "2023-07-06T15:03:02Z",
          "updated_at": "2024-02-13T09:16:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1854269874,
      "node_id": "PRR_kwDOABII585uhemy",
      "url": null,
      "actor": null,
      "commit_id": "783e7de01c1f68b732ee8b1467a62fdfd558e46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1854269874",
      "submitted_at": "2024-01-31T16:33:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T13:43:51Z",
      "updated_at": "2024-02-07T13:43:51Z",
      "source": {
        "issue": {
          "id": 2123070878,
          "node_id": "PR_kwDOABII585mQ61G",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29403",
          "number": 29403,
          "state": "open",
          "state_reason": null,
          "title": "wallet: batch erase procedures and improve 'EraseRecords' performance",
          "body": "Seeks to optimize and simplify `WalletBatch::EraseRecords`. Currently, this process opens a cursor to iterate over the entire database, searching for records that match the type prefixes, to then call the `WalletBatch::Erase` function for each of the matching records.\r\nThis PR rewrites this 40-line manual process into a single line; instead of performing all of those actions manually, we can simply utilize the `ErasePrefix()` functionality. The result is 06216b344dea6ad6c385fda0b37808ff9ae5273b.\r\n\r\nMoreover, it expands the test coverage for the `ErasePrefix` functionality and documents the db txn requirement for `BerkeleyBatch::ErasePrefix` .",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29403",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29403.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29403.patch"
          },
          "created_at": "2024-02-07T13:42:56Z",
          "updated_at": "2024-02-13T10:21:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1868714524,
      "node_id": "PRR_kwDOABII585vYlIc",
      "url": null,
      "actor": null,
      "commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1868714524",
      "submitted_at": "2024-02-07T20:24:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T20:38:23Z",
      "updated_at": "2024-02-07T20:38:23Z",
      "source": {
        "issue": {
          "id": 722711719,
          "node_id": "MDU6SXNzdWU3MjI3MTE3MTk=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/20160",
          "number": 20160,
          "state": "open",
          "state_reason": null,
          "title": "Proposed Timeline for Legacy Wallet and BDB removal",
          "body": "Here is a proposed timeline for the move from legacy wallets to descriptor wallets, and at the same time, bdb to sqlite, culminating with the removal of both legacy wallets and bdb. Even though the wallet type and the wallet storage format are orthogonal to each other, as noted in #19077, I would like to tie them together for the sake of simplicity when it comes to how we make new wallets and the migration of one type to another.\r\n\r\nThe 4 combinations of type and format are: legacy-bdb, legacy-sqlite, descriptor-bdb, and descriptor-sqlite. While all 4 types will be supported, we will primarily deal with legacy-bdb and descriptor-sqlite. Setting `descriptors=True` in `createwallet` (or checking the Descriptors option in the GUI) will always make a descriptor-sqlite. Setting that to `False` will always make a legacy-bdb.\r\n\r\n- [x] 0.21 (late 2020)\r\n  - [x] Initial release of descriptor type and sqlite format. (#16528, #19077)\r\n  - [x] Descriptor type is experimental with a warning as such (#16528)\r\n  - [x] Only legacy-bdb and descriptor-sqlite will be created (#19077)\r\n- [x] 22.0 (mid 2021)\r\n  - [x] Implement descriptor exports (#20226)\r\n  - [x] Legacy type remains default (no pr needed)\r\n  - [x] Introduce `dump` and `createfromdump` wallet tool commands with an additional `-format` option to specify the wallet type (#19137)\r\n    * Users may use `dump` and then `createfromdump` in order to make legacy-sqlite from legacy-bdb\r\n    * Users may use `dump` and then `createfromdump` in order to make descriptor-bdb from descriptor-sqlite\r\n  - [x] If a wallet specified in conf or command line doesn't exist, don't make a wallet and instead warn (#15454)\r\n- [x] 23.0 (early 2022)\r\n  - [x] Change descriptor type to non-experimental (#23002)\r\n  - [x] Change `createwallet` `descriptors` default to `True` (#23002)\r\n  - [x] Change wallet tool `create` `-descriptors` default to `True` (#23002)\r\n- [x] 24.0 (late 2022)\r\n  - [x] Introduce `migratewallet` command to migrate a legacy-bdb to descriptor-sqlite (#19602)\r\n  - [x] For newly created legacy-bdb wallets, warn that they are deprecated and will soon be unsupported (#24505)\r\n- [x] 26.0 (late 2023)\r\n  - [x] When loading legacy-bdb, descriptor-bdb, or legacy-sqlite wallets, warn that the legacy type and bdb format will soon be unsupported, as applicable. (#27869)\r\n  - [x] Deprecate creating new legacy-bdb wallets #28597 \r\n  - [x] `migratewallet` bug fixes\r\n    - [x] #28609\r\n    - [x] #28546\r\n- [ ] 27.0 (early 2024)\r\n  - [ ] Improve performance of migratewallet #28574\r\n    - [x] address book performance improvement #26836\r\n    - [x] bulk deletion of txs performance improvement #28987\r\n    - [ ] bulk deletion of records performance improvement #29403\r\n  - [ ] Caching to improve performance of migrated non-HD descriptor wallets (also perf improvement in general) #26008\r\n  - [ ] Remove `migratewallet` experimental warning #28037 \r\n- [ ] 28.0 (late 2024)\r\n  - [ ] Reimplement legacy-bdb to descriptor-sqlite migration (maybe as a separate command or in the wallet tool) to be independent of `LegacyScriptPubKeyMan` and BDB (#26596)\r\n  - [ ] For `dump`, implement an independent BDB file loader (this should probably be shared with the previous) (#26606)\r\n  - [ ] Stop creating new legacy-bdb wallets (not yet started)\r\n  - [ ] GUI: Migrate wallets that are not loaded (not yet started)\r\n- [ ] 29.0 (early 2025)\r\n  - [ ] Stop loading legacy-bdb, descriptor-bdb, legacy-sqlite wallet entirely. Inform users how to migrate (not yet started)\r\n  - [ ] Remove `LegacyScriptPubKeyMan` except for the independent migration stuff (#28710)\r\n  - [ ] Remove BDB except for independent loading for migration stuff (#28710)\r\n\r\nAdditional improvements that have no target deadline:\r\n\r\n- [x] Backwards compatibility tests fixes for descriptor wallets #28027\r\n\r\nThe migration code will probably be around for a long time/forever.\r\n\r\nNote that we expect users who go through the effort to make a legacy-sqlite or descriptor-bdb wallet to suck it up and deal with the consequences of doing something that isn't really supported. Such users should be able to figure out for themselves how to migrate their wallets. (Maybe `migratewallet` can migrate legacy-sqlite to descriptor-sqlite. bdb to sqlite is way easier than legacy to descriptor).",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 36,
          "created_at": "2020-10-15T22:17:41Z",
          "updated_at": "2024-02-12T22:53:57Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11758966088,
      "node_id": "HRFPE_lADOABII5854hhEUzwAAAAK845VI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11758966088",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T14:52:27Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11760357813,
      "node_id": "HRFPE_lADOABII5854hhEUzwAAAAK8-NG1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11760357813",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T16:53:34Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11760630791,
      "node_id": "HRFPE_lADOABII5854hhEUzwAAAAK8_PwH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11760630791",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T17:22:08Z"
    },
    {
      "event": "reviewed",
      "id": 1872874268,
      "node_id": "PRR_kwDOABII585vocsc",
      "url": null,
      "actor": null,
      "commit_id": "e4f8a02210c801f47ac22a722186ce1e635e55ba",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks Marko and achow.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1872874268",
      "submitted_at": "2024-02-09T17:38:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgzYjc2Mjg0NWY1ODA0ZjIzYjYzNTI2ZDQwM2IyZjMyN2ZlOTk2MzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83b762845f5804f23b63526d403b2f327fe99632",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/83b762845f5804f23b63526d403b2f327fe99632",
      "tree": {
        "sha": "73b81732c18231ddcf7bd550b43d38b6c4b6c055",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/73b81732c18231ddcf7bd550b43d38b6c4b6c055"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 73b81732c18231ddcf7bd550b43d38b6c4b6c055\nparent 595d50a1032ad7ffa9945464c86aa57f16665e93\nauthor furszy <matiasfurszyfer@protonmail.com> 1689525098 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707501290 -0300\n\nwallet: batch and simplify ZapSelectTx process\n\nThe goal of the function is to erase the wallet transactions that\nmatch the inputted hashes. There is no need to traverse the database,\nreading record by record, to then perform single entry removals for\neach of them.\n\nTo ensure consistency and improve performance, this change-set removes\nall tx records within a single atomic db batch operation, as well as\nit cleans up code, improves error handling and simplifies the\ntransactions removal process entirely.\n\nThis optimizes the removal of watch-only transactions during the wallet\nmigration process and the 'removeprunedfunds' RPC command.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXGZuoACgkQXdI8zGhq\npiMRTA//UkNCKvLwlFNOmTzMKuhk62bdE0zBf3rKiko8PkG7TQwnvwmY09ko6sJE\njwwI08xdtDoOeF3EuKoos68kp1thywJwdu0X1WUxWhLPZK0KJd7hVkl/LyoSfe3S\nmV8rjnqtwdkLBVJrh08qqf6wh8zY9GYGTdS5Bya6f1BG9/pEIq7of7AdFKBIOBaR\ncvGpQUHVCGC58SP39hccLn9WbU/Auw7s3JJgTZ/BpUU0qOD4E5SHedU2DcsLlzvL\npFVkrQB40+2qQW8d/MbsntIhDjejeman5BScE895qu42RSVnahgokbWz+rO1u/eK\nTQCFzHBQ6cnlAveXXGZVELYCBRH18FVrW76j6esoguIFkS8DBeMIQjWcTicVO6Hm\nBygY9hMuSaNlJDXH4QrO7L18SPEJQoybDTos25rogL3AK0DTg/vSd4JYjJe5cYFY\nJBlPBrW8dXYA1Bah6+0gg/zxoD0NIX6R9T/C+NZHvvHjt3drhnvrx79KJsBCVRyc\nRp+UeZPEUYs779gWwk3kNudt2xp8q2hYlXp3OvWNkd9TDDeuPVCWdHgtd5ZkNnK2\nni2RUlN8Slpx+D1KFaOohS3kAWp/i2Xxh2IdopKVGTGXvXjt1XqIPWt5lTj/WUen\n4jhe4osjzEbamAxdZKurnziDn090zS+DQ7BfaUShlKw/emnixxY=\n=id2L\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/595d50a1032ad7ffa9945464c86aa57f16665e93",
          "sha": "595d50a1032ad7ffa9945464c86aa57f16665e93",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/595d50a1032ad7ffa9945464c86aa57f16665e93"
        }
      ],
      "message": "wallet: batch and simplify ZapSelectTx process\n\nThe goal of the function is to erase the wallet transactions that\nmatch the inputted hashes. There is no need to traverse the database,\nreading record by record, to then perform single entry removals for\neach of them.\n\nTo ensure consistency and improve performance, this change-set removes\nall tx records within a single atomic db batch operation, as well as\nit cleans up code, improves error handling and simplifies the\ntransactions removal process entirely.\n\nThis optimizes the removal of watch-only transactions during the wallet\nmigration process and the 'removeprunedfunds' RPC command.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-09T17:54:50Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-16T16:31:38Z"
      },
      "sha": "83b762845f5804f23b63526d403b2f327fe99632"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDlhM2M1Yzg2OTc2NTllMzRkMDQ3NjEwM2FmOTQyYTQ2MTU4MThmNGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a3c5c8697659e34d0476103af942a4615818f4e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9a3c5c8697659e34d0476103af942a4615818f4e",
      "tree": {
        "sha": "aae7681f684f6fe9dde8865532673320825bb2de",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/aae7681f684f6fe9dde8865532673320825bb2de"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree aae7681f684f6fe9dde8865532673320825bb2de\nparent 83b762845f5804f23b63526d403b2f327fe99632\nauthor furszy <matiasfurszyfer@protonmail.com> 1707489905 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707501290 -0300\n\nscripted-diff: rename ZapSelectTx to RemoveTxs\n\n-BEGIN VERIFY SCRIPT-\nsed -i 's/ZapSelectTx/RemoveTxs/g' $(git grep -l 'ZapSelectTx' ./src/wallet)\n-END VERIFY SCRIPT-\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXGZuoACgkQXdI8zGhq\npiP1VBAAwVwIEJEd96V29g7bdFKzpDW6Kugejpkxa2OyItQePJmAYHkp/9ktzswR\ncswmDpnq1BJfGyRSNYKP+RC17u7ShMs/tCvdl3yp124JLY9eg+nohRiqxRlMLKRv\n2YPVgYLdD7Hx4bwzThPYptIaKGJ9FjXg7HJ7VF1LDOjaSEXihFkvbvU72LEz2hRh\n6VTqa0Aa3ju7kpFDovJY3MmxycsdmLfd9NJ2a2STWqfjP5hIed59TAfBKpTchCWg\nit4OY5adVGLsebmzchBDrdbi1ig02VGWnyzQgx1MNbts6nq4EgPtIQk1f28eeioY\n9LWByqF5z1MLIuL9+Zu5/pNpBDGWqsa2zKwH/sDxgh7h4SnQhwsgXF/z8wcc/Tcv\n8IdI7J4fQmWcsH6f6kxVjjbo0vzFdnW7HGTSavOE8YIDmlFowHyR0JhCN3oYRxMG\nrnCezD00JNtRTrW7n6uNnJ+aXUFaZlx30mPYgxPVIP1xIH4b4R/neWX0O99vPcum\nk6y/T6xvnFJOZHNOaGiN7+yFEJ+tVdlzeNtOpjWQoOOGGxcG59aGZbiyPAUSRYAI\nXymdvVQxjqELCwCyfORAHKrU8yCRbXSE3Gd43jJByNyo5lXHvlctGEfjj6hk/Jha\nfcHvaeoiSwF/ygDlREu7ZfudUdOMwnupX+2mi0HRU7zVYst7+cI=\n=2Swu\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83b762845f5804f23b63526d403b2f327fe99632",
          "sha": "83b762845f5804f23b63526d403b2f327fe99632",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/83b762845f5804f23b63526d403b2f327fe99632"
        }
      ],
      "message": "scripted-diff: rename ZapSelectTx to RemoveTxs\n\n-BEGIN VERIFY SCRIPT-\nsed -i 's/ZapSelectTx/RemoveTxs/g' $(git grep -l 'ZapSelectTx' ./src/wallet)\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-09T17:54:50Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-09T14:45:05Z"
      },
      "sha": "9a3c5c8697659e34d0476103af942a4615818f4e"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11760928346,
      "node_id": "HRFPE_lADOABII5854hhEUzwAAAAK9AYZa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11760928346",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T17:55:44Z"
    },
    {
      "event": "commented",
      "id": 1936426651,
      "node_id": "IC_kwDOABII585za4ab",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936426651",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T18:40:07Z",
      "updated_at": "2024-02-09T18:40:07Z",
      "author_association": "MEMBER",
      "body": "ACK 9a3c5c8697659e34d0476103af942a4615818f4e\r\n\r\nThe new code is much simpler.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1936426651",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987"
    },
    {
      "event": "unlabeled",
      "id": 11761480834,
      "node_id": "UNLE_lADOABII5854hhEUzwAAAAK9CfSC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11761480834",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T18:59:40Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-10T04:37:39Z",
      "updated_at": "2024-02-10T04:37:39Z",
      "source": {
        "issue": {
          "id": 1958204865,
          "node_id": "PR_kwDOABII585dlfBo",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
          "number": 28710,
          "state": "open",
          "state_reason": null,
          "title": "Remove the legacy wallet and BDB dependency",
          "body": "The final step of #20160.\r\n\r\nA bare minimum of legacy wallet code is kept in order to perform wallet migration. Migration of legacy wallets uses the independent BDB parser and a minimal `LegacyDataSPKM` that allows the legacy data to be loaded so that the migration can be completed.\r\n\r\nAll tests which tested legacy wallet behavior have been removed. The `--descriptors` and `--legacy-wallet` options are removed from the functional tests.\r\n\r\nBDB has been removed as a dependency and documentation have been updated to reflect that.\r\n\r\nDepends on #26596",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28710",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28710.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28710.patch"
          },
          "created_at": "2023-10-23T23:36:07Z",
          "updated_at": "2024-02-10T04:46:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1938735308,
      "node_id": "IC_kwDOABII585zjsDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938735308",
      "actor": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-12T14:00:44Z",
      "updated_at": "2024-02-12T14:00:44Z",
      "author_association": "MEMBER",
      "body": "ACK https://github.com/bitcoin/bitcoin/pull/28987/commits/9a3c5c8697659e34d0476103af942a4615818f4e\r\n\r\nlooks good, also `RemoveTxs` is a much better name. Might be worth updating the description to mention the rename since the description ends up in the commit log.",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#issuecomment-1938735308",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987"
    },
    {
      "event": "merged",
      "id": 11778457304,
      "node_id": "ME_lADOABII5854hhEUzwAAAAK-DP7Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11778457304",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6ff0aa089c01ff3e610ecb47814ed739d685a14c",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6ff0aa089c01ff3e610ecb47814ed739d685a14c",
      "created_at": "2024-02-12T18:42:03Z"
    },
    {
      "event": "closed",
      "id": 11778457328,
      "node_id": "CE_lADOABII5854hhEUzwAAAAK-DP7w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11778457328",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-12T18:42:03Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 11778486524,
      "node_id": "HRDE_lADOABII5854hhEUzwAAAAK-DXD8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11778486524",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-12T18:45:16Z"
    },
    {
      "event": "reviewed",
      "id": 1877659260,
      "node_id": "PRR_kwDOABII585v6s58",
      "url": null,
      "actor": null,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#pullrequestreview-1877659260",
      "submitted_at": "2024-02-13T11:10:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443160561",
      "pull_request_review_id": 1806470102,
      "id": 1443160561,
      "node_id": "PRRC_kwDOABII585WBOHx",
      "diff_hunk": "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "559529480fedd4181dab76f4452b5998d0cdadc3",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 559529480fedd4181dab76f4452b5998d0cdadc3 \"refactor: decouple wallet EraseTxns from ZapSelectTx\"\r\n\r\nThe commit message calls this `EraseTxns`.",
      "created_at": "2024-01-05T17:34:28Z",
      "updated_at": "2024-01-05T17:38:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443160561",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443160561"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2314,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443161309",
      "pull_request_review_id": 1806470102,
      "id": 1443161309,
      "node_id": "PRRC_kwDOABII585WBOTd",
      "diff_hunk": "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n {\n-    AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    for (const uint256& hash : vHashIn) {\n+    for (const uint256& hash : tx_hashes) {\n         const auto& it = mapWallet.find(hash);\n         wtxOrdered.erase(it->second.m_it_wtxOrdered);\n-        for (const auto& txin : it->second.tx->vin)\n+        for (const auto& txin: it->second.tx->vin)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "559529480fedd4181dab76f4452b5998d0cdadc3",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 559529480fedd4181dab76f4452b5998d0cdadc3 \"refactor: decouple wallet EraseTxns from ZapSelectTx\"\r\n\r\nUnnecessary whitespace change.",
      "created_at": "2024-01-05T17:35:28Z",
      "updated_at": "2024-01-05T17:38:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443161309",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443161309"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": 2321,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2319,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443164969",
      "pull_request_review_id": 1806470102,
      "id": 1443164969,
      "node_id": "PRRC_kwDOABII585WBPMp",
      "diff_hunk": "@@ -3931,10 +3933,26 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n     watchonly_batch.reset(); // Flush\n     // Do the removes\n     if (txids_to_delete.size() > 0) {\n-        if (ZapSelectTx(txids_to_delete) != DBErrors::LOAD_OK) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "ff214259de28216a5190c358b786306985f30227",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In ff214259de28216a5190c358b786306985f30227 \"wallet: migration, remove watch-only transactions atomically\"\r\n\r\nIt seems unnecessary to be making this change here as `ZapSelectTx` is now atomic.",
      "created_at": "2024-01-05T17:38:16Z",
      "updated_at": "2024-01-05T17:38:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443164969",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443164969"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3934,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784908",
      "pull_request_review_id": 1807486280,
      "id": 1443784908,
      "node_id": "PRRC_kwDOABII585WDmjM",
      "diff_hunk": "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "559529480fedd4181dab76f4452b5998d0cdadc3",
      "in_reply_to_id": 1443160561,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2024-01-06T15:26:15Z",
      "updated_at": "2024-01-06T15:33:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443784908",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784908"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2314,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784954",
      "pull_request_review_id": 1807486280,
      "id": 1443784954,
      "node_id": "PRRC_kwDOABII585WDmj6",
      "diff_hunk": "@@ -2311,18 +2311,24 @@ DBErrors CWallet::LoadWallet()\n     return nLoadWalletRet;\n }\n \n-DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n+void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n {\n-    AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    for (const uint256& hash : vHashIn) {\n+    for (const uint256& hash : tx_hashes) {\n         const auto& it = mapWallet.find(hash);\n         wtxOrdered.erase(it->second.m_it_wtxOrdered);\n-        for (const auto& txin : it->second.tx->vin)\n+        for (const auto& txin: it->second.tx->vin)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "559529480fedd4181dab76f4452b5998d0cdadc3",
      "in_reply_to_id": 1443161309,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2024-01-06T15:26:22Z",
      "updated_at": "2024-01-06T15:33:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443784954",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443784954"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": 2321,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2319,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443785461",
      "pull_request_review_id": 1807486280,
      "id": 1443785461,
      "node_id": "PRRC_kwDOABII585WDmr1",
      "diff_hunk": "@@ -3931,10 +3933,26 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n     watchonly_batch.reset(); // Flush\n     // Do the removes\n     if (txids_to_delete.size() > 0) {\n-        if (ZapSelectTx(txids_to_delete) != DBErrors::LOAD_OK) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "ff214259de28216a5190c358b786306985f30227",
      "in_reply_to_id": 1443164969,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> In [ff21425](https://github.com/bitcoin/bitcoin/commit/ff214259de28216a5190c358b786306985f30227) \"wallet: migration, remove watch-only transactions atomically\"\r\n> \r\n> It seems unnecessary to be making this change here as `ZapSelectTx` is now atomic.\r\n\r\nTrue. This PR does not requires it. Will re-introduced it within #28574.",
      "created_at": "2024-01-06T15:28:28Z",
      "updated_at": "2024-01-06T15:33:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1443785461",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1443785461"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3934,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1473125056",
      "pull_request_review_id": 1854269874,
      "id": 1473125056,
      "node_id": "PRRC_kwDOABII585XzhrA",
      "diff_hunk": "@@ -1230,88 +1230,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     return result;\n }\n \n-DBErrors WalletBatch::FindWalletTxHashes(std::vector<uint256>& tx_hashes)\n+DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& txs_to_remove)\n {\n-    DBErrors result = DBErrors::LOAD_OK;\n-\n-    try {\n-        int nMinVersion = 0;\n-        if (m_batch->Read(DBKeys::MINVERSION, nMinVersion)) {\n-            if (nMinVersion > FEATURE_LATEST)\n-                return DBErrors::TOO_NEW;\n-        }\n-\n-        // Get cursor\n-        std::unique_ptr<DatabaseCursor> cursor = m_batch->GetNewCursor();\n-        if (!cursor)\n-        {\n-            LogPrintf(\"Error getting wallet database cursor\\n\");\n-            return DBErrors::CORRUPT;\n-        }\n-\n-        while (true)\n-        {\n-            // Read next record\n-            DataStream ssKey{};\n-            DataStream ssValue{};\n-            DatabaseCursor::Status status = cursor->Next(ssKey, ssValue);\n-            if (status == DatabaseCursor::Status::DONE) {\n-                break;\n-            } else if (status == DatabaseCursor::Status::FAIL) {\n-                LogPrintf(\"Error reading next record from wallet database\\n\");\n-                return DBErrors::CORRUPT;\n-            }\n-\n-            std::string strType;\n-            ssKey >> strType;\n-            if (strType == DBKeys::TX) {\n-                uint256 hash;\n-                ssKey >> hash;\n-                tx_hashes.push_back(hash);\n-            }\n-        }\n-    } catch (...) {\n-        result = DBErrors::CORRUPT;\n-    }\n-\n-    return result;\n-}\n-\n-DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<uint256>& vTxHashOut)\n-{\n-    // build list of wallet TX hashes\n-    std::vector<uint256> vTxHash;\n-    DBErrors err = FindWalletTxHashes(vTxHash);\n-    if (err != DBErrors::LOAD_OK) {\n-        return err;\n-    }\n-\n-    std::sort(vTxHash.begin(), vTxHash.end());\n-    std::sort(vTxHashIn.begin(), vTxHashIn.end());\n-\n-    // erase each matching wallet TX\n-    bool delerror = false;\n-    std::vector<uint256>::iterator it = vTxHashIn.begin();\n-    for (const uint256& hash : vTxHash) {\n-        while (it < vTxHashIn.end() && (*it) < hash) {\n-            it++;\n-        }\n-        if (it == vTxHashIn.end()) {\n-            break;\n+    bool fail = false;\n+    for (const uint256& hash : txs_to_remove) {\n+        if (!m_batch->Exists(std::make_pair(DBKeys::TX, hash))) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Cannot remove transaction: %s, not found in db\\n\", __func__, hash.GetHex());\n+            fail = true;\n+            continue;\n         }\n-        else if ((*it) == hash) {\n-            if(!EraseTx(hash)) {\n-                LogPrint(BCLog::WALLETDB, \"Transaction was found for deletion but returned database error: %s\\n\", hash.GetHex());\n-                delerror = true;\n-            }\n-            vTxHashOut.push_back(hash);\n+        if (!EraseTx(hash)) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Failure removing transaction: %s\\n\", __func__, hash.GetHex());",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 87,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "783e7de01c1f68b732ee8b1467a62fdfd558e46d",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Any reason to add `__func__` to this log, when it previously wasn't there? If someone is interested in the exact source location, they can enable the corresponding log option. If this is needed for context, it could make more sense to clarify the log message itself, so that it is unique and clear without requiring the source code as context.",
      "created_at": "2024-01-31T16:33:42Z",
      "updated_at": "2024-01-31T16:33:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1473125056",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1473125056"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482044079",
      "pull_request_review_id": 1868714524,
      "id": 1482044079,
      "node_id": "PRRC_kwDOABII585YVjKv",
      "diff_hunk": "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In d26a28508d5322fe7c29b3642dcf3a17b0ea31f1 \"wallet: batch ZapSelectTx db operations\"\r\n\r\nThis should explicitly call `TxnAbort` before returning as otherwise we will get extraenous logs about the tx being aborted before batch is destroyed.",
      "created_at": "2024-02-07T20:23:44Z",
      "updated_at": "2024-02-07T20:24:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1482044079",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482044079"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2334,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482045052",
      "pull_request_review_id": 1868714524,
      "id": 1482045052,
      "node_id": "PRRC_kwDOABII585YVjZ8",
      "diff_hunk": "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;\n \n+    // Apply db changes and remove transactions from the memory map\n+    if (!batch.TxnCommit()) return DBErrors::NONCRITICAL_ERROR;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In d26a28508d5322fe7c29b3642dcf3a17b0ea31f1 \"wallet: batch ZapSelectTx db operations\"\r\n\r\nI'm not sure if `NONCRITICAL_ERROR` is really the right return code. It seems like something has gone critically wrong if `TxnCommit` were to fail.",
      "created_at": "2024-02-07T20:24:26Z",
      "updated_at": "2024-02-07T20:24:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1482045052",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482045052"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2337,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606348",
      "pull_request_review_id": 1872874268,
      "id": 1484606348,
      "node_id": "PRRC_kwDOABII585YfUuM",
      "diff_hunk": "@@ -1230,88 +1230,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n     return result;\n }\n \n-DBErrors WalletBatch::FindWalletTxHashes(std::vector<uint256>& tx_hashes)\n+DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& txs_to_remove)\n {\n-    DBErrors result = DBErrors::LOAD_OK;\n-\n-    try {\n-        int nMinVersion = 0;\n-        if (m_batch->Read(DBKeys::MINVERSION, nMinVersion)) {\n-            if (nMinVersion > FEATURE_LATEST)\n-                return DBErrors::TOO_NEW;\n-        }\n-\n-        // Get cursor\n-        std::unique_ptr<DatabaseCursor> cursor = m_batch->GetNewCursor();\n-        if (!cursor)\n-        {\n-            LogPrintf(\"Error getting wallet database cursor\\n\");\n-            return DBErrors::CORRUPT;\n-        }\n-\n-        while (true)\n-        {\n-            // Read next record\n-            DataStream ssKey{};\n-            DataStream ssValue{};\n-            DatabaseCursor::Status status = cursor->Next(ssKey, ssValue);\n-            if (status == DatabaseCursor::Status::DONE) {\n-                break;\n-            } else if (status == DatabaseCursor::Status::FAIL) {\n-                LogPrintf(\"Error reading next record from wallet database\\n\");\n-                return DBErrors::CORRUPT;\n-            }\n-\n-            std::string strType;\n-            ssKey >> strType;\n-            if (strType == DBKeys::TX) {\n-                uint256 hash;\n-                ssKey >> hash;\n-                tx_hashes.push_back(hash);\n-            }\n-        }\n-    } catch (...) {\n-        result = DBErrors::CORRUPT;\n-    }\n-\n-    return result;\n-}\n-\n-DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<uint256>& vTxHashOut)\n-{\n-    // build list of wallet TX hashes\n-    std::vector<uint256> vTxHash;\n-    DBErrors err = FindWalletTxHashes(vTxHash);\n-    if (err != DBErrors::LOAD_OK) {\n-        return err;\n-    }\n-\n-    std::sort(vTxHash.begin(), vTxHash.end());\n-    std::sort(vTxHashIn.begin(), vTxHashIn.end());\n-\n-    // erase each matching wallet TX\n-    bool delerror = false;\n-    std::vector<uint256>::iterator it = vTxHashIn.begin();\n-    for (const uint256& hash : vTxHash) {\n-        while (it < vTxHashIn.end() && (*it) < hash) {\n-            it++;\n-        }\n-        if (it == vTxHashIn.end()) {\n-            break;\n+    bool fail = false;\n+    for (const uint256& hash : txs_to_remove) {\n+        if (!m_batch->Exists(std::make_pair(DBKeys::TX, hash))) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Cannot remove transaction: %s, not found in db\\n\", __func__, hash.GetHex());\n+            fail = true;\n+            continue;\n         }\n-        else if ((*it) == hash) {\n-            if(!EraseTx(hash)) {\n-                LogPrint(BCLog::WALLETDB, \"Transaction was found for deletion but returned database error: %s\\n\", hash.GetHex());\n-                delerror = true;\n-            }\n-            vTxHashOut.push_back(hash);\n+        if (!EraseTx(hash)) {\n+            LogPrint(BCLog::WALLETDB, \"%s: Failure removing transaction: %s\\n\", __func__, hash.GetHex());",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 87,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "783e7de01c1f68b732ee8b1467a62fdfd558e46d",
      "in_reply_to_id": 1473125056,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Any reason to add __func__ to this log, when it previously wasn't there?\r\n\r\njust an old bad habit. Removed. Thanks.",
      "created_at": "2024-02-09T17:23:00Z",
      "updated_at": "2024-02-09T17:38:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484606348",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606348"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606675",
      "pull_request_review_id": 1872874268,
      "id": 1484606675,
      "node_id": "PRRC_kwDOABII585YfUzT",
      "diff_hunk": "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "in_reply_to_id": 1482044079,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> This should explicitly call TxnAbort before returning as otherwise we will get extraenous logs about the tx being aborted before batch is destroyed.\r\n\r\nsure. Fixed.",
      "created_at": "2024-02-09T17:23:19Z",
      "updated_at": "2024-02-09T17:38:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484606675",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484606675"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2334,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484621811",
      "pull_request_review_id": 1872874268,
      "id": 1484621811,
      "node_id": "PRRC_kwDOABII585YfYfz",
      "diff_hunk": "@@ -2326,16 +2326,18 @@ void CWallet::ClearTxns(const std::vector<uint256>& tx_hashes)\n DBErrors CWallet::ZapSelectTx(std::vector<uint256>& vHashIn)\n {\n     AssertLockHeld(cs_wallet);\n-    DBErrors nZapSelectTxRet = WalletBatch(GetDatabase()).ZapSelectTx(vHashIn);\n-    // Remove transactions from the memory map\n-    ClearTxns(vHashIn);\n \n-    if (nZapSelectTxRet != DBErrors::LOAD_OK)\n-        return nZapSelectTxRet;\n+    WalletBatch batch(GetDatabase());\n+    if (!batch.TxnBegin()) return DBErrors::NONCRITICAL_ERROR;\n+    DBErrors db_status = batch.ZapSelectTx(vHashIn);\n+    // All deletions should have been added to the db txn, otherwise we abort the process.\n+    if (db_status != DBErrors::LOAD_OK) return db_status;\n \n+    // Apply db changes and remove transactions from the memory map\n+    if (!batch.TxnCommit()) return DBErrors::NONCRITICAL_ERROR;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "d26a28508d5322fe7c29b3642dcf3a17b0ea31f1",
      "in_reply_to_id": 1482045052,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": " > I'm not sure if `NONCRITICAL_ERROR` is really the right return code. It seems like something has gone critically wrong if `TxnCommit` were to fail.\r\n\r\nThe returned error code doesn't really matter. Anything different from `LOAD_OK` is an error for all the function's callers. And they behave exactly the same for all codes.\r\nActually, the `DBErrors` return doesn't make sense anymore after this PR changes. The function is no longer traversing the entire db nor checking for extra, unneeded, stuff like the version inside anymore.\r\n\r\nBased on this, I have reworked the PR cleaning up this aspect as well.\r\n",
      "created_at": "2024-02-09T17:37:47Z",
      "updated_at": "2024-02-09T17:38:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1484621811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484621811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2337,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1487645981",
      "pull_request_review_id": 1877659260,
      "id": 1487645981,
      "node_id": "PRRC_kwDOABII585Yq60d",
      "diff_hunk": "@@ -3935,19 +3951,10 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n     watchonly_batch.reset(); // Flush\n     // Do the removes\n     if (txids_to_delete.size() > 0) {\n-        std::vector<uint256> deleted_txids;\n-        if (ZapSelectTx(txids_to_delete, deleted_txids) != DBErrors::LOAD_OK) {\n-            error = _(\"Error: Could not delete watchonly transactions\");\n+        if (auto res = RemoveTxs(txids_to_delete); !res) {\n+            error = _(\"Error: Could not delete watchonly transactions. \") + util::ErrorString(res);",
      "path": "src/wallet/wallet.cpp",
      "position": 78,
      "original_position": 78,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "in_reply_to_id": null,
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: The trailing space could be easily overlooked and dropped during translation.",
      "created_at": "2024-02-13T11:10:11Z",
      "updated_at": "2024-02-13T11:10:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1487645981",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1487645981"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3955,
      "original_line": 3955,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1487741844",
      "pull_request_review_id": 1877788343,
      "id": 1487741844,
      "node_id": "PRRC_kwDOABII585YrSOU",
      "diff_hunk": "@@ -3935,19 +3951,10 @@ bool CWallet::ApplyMigrationData(MigrationData& data, bilingual_str& error)\n     watchonly_batch.reset(); // Flush\n     // Do the removes\n     if (txids_to_delete.size() > 0) {\n-        std::vector<uint256> deleted_txids;\n-        if (ZapSelectTx(txids_to_delete, deleted_txids) != DBErrors::LOAD_OK) {\n-            error = _(\"Error: Could not delete watchonly transactions\");\n+        if (auto res = RemoveTxs(txids_to_delete); !res) {\n+            error = _(\"Error: Could not delete watchonly transactions. \") + util::ErrorString(res);",
      "path": "src/wallet/wallet.cpp",
      "position": 78,
      "original_position": 78,
      "commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "original_commit_id": "9a3c5c8697659e34d0476103af942a4615818f4e",
      "in_reply_to_id": 1487645981,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> nit: The trailing space could be easily overlooked and dropped during translation.\r\n\r\n@hebasto, what about creating a constant to represent the whitespace, or alternatively, implementing a function that concatenates strings with the whitespace inserted between them?",
      "created_at": "2024-02-13T12:11:42Z",
      "updated_at": "2024-02-13T12:11:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28987#discussion_r1487741844",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1487741844"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3955,
      "original_line": 3955,
      "side": "RIGHT"
    }
  ]
}