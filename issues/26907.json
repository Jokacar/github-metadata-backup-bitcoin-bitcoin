{
  "type": "issue",
  "issue": {
    "id": 1536748974,
    "node_id": "I_kwDOABII585bmO2u",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26907",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26907/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26907/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26907/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/26907",
    "number": 26907,
    "state": "closed",
    "state_reason": "completed",
    "title": "Expose addrman size info via RPC ",
    "body": "If #26847 gets merged, addrman will maintain counts of addresses stored on the new & tried tables, broken down by network. This is useful information for monitoring the state of our addrman when we run it with different network configs on mainnet.\r\n\r\nCurrently when running a node, we can get a rough estimate into this information using the cli argument `-addrinfo`. However, this is just an estimate because it uses the RPC endpoint `getnodeaddresses`, which calls through to `Addrman::GetAddr`. Although this logic path skips the addr caching logic we apply for results propagated to the p2p network, it still applies some logic to filter results. For example it removes addresses that meet the `IsTerrible` attributes. It also doesn’t distinguish between the new and tried tables. \r\n\r\nSo, I recommend we expose the raw counts to provide a better picture of addrman’s workings, especially since addrman & network integrations are particularly hard to test via our automated tooling. We can breakdown the counts by network & new vs tried. \r\n\r\nThere are a few different options for how we can expose this information. I expect this feature to primarily be used by bitcoin core contributors or super-users that understand bitcoind’s inner workings. Thus, I suggest we expose it as a new, hidden RPC. That enables exposing the information to devs without having to guarantee a stable RPC interface over future versions. The name of the RPC can be something generic like  `addrmaninfo`, to allow for future extensions for other debugging information. \r\n\r\nFor more historic context around bitcoin cli’s `-addrinfo` and conversation about cli vs RPC, see [#21595](https://github.com/bitcoin/bitcoin/pull/21595).  If we do end up implementing a new RPC endpoint, we could consider reworking the cli to use these values directly rather than trying to compute them with partial information. \r\n",
    "user": {
      "login": "amitiuttarwar",
      "id": 1500952,
      "node_id": "MDQ6VXNlcjE1MDA5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amitiuttarwar",
      "html_url": "https://github.com/amitiuttarwar",
      "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
      "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
      "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
      "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
      "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": true,
    "comments": 2,
    "closed_at": "2023-09-23T10:34:36Z",
    "created_at": "2023-01-17T17:14:35Z",
    "updated_at": "2024-09-22T20:47:02Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 8247914584,
      "node_id": "LE_lADOABII585bmO2uzwAAAAHrnTBY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8247914584",
      "actor": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T17:14:35Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 1407773924,
      "node_id": "IC_kwDOABII585T6Ozk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407773924",
      "actor": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-29T21:25:56Z",
      "updated_at": "2023-01-29T21:25:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "This would be useful to have. I’ve tried this RPC endpoint in #26988 with the following structure.\r\n\r\n    \r\n    addrmaninfo ( \"network\" )\r\n    \r\n    Arguments:\r\n    1. network    (string, optional) Network type (ipv4, ipv6, onion, i2p, cjdns)\r\n    \r\n    Result:\r\n    [\r\n      {\r\n        \"network\" : \"str\",    (string) The network (ipv4, ipv6, onion, i2p, cjdns)\r\n        \"new\" : n,            (numeric) number of addresses in new table\r\n        \"tried\" : n           (numeric) number of addresses in tried table\r\n      },\r\n      ...\r\n    ]\r\n    ",
      "user": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26907#issuecomment-1407773924",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26907"
    },
    {
      "event": "referenced",
      "id": 10422529365,
      "node_id": "REFE_lADOABII585bmO2uzwAAAAJtOy1V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10422529365",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ff564c75e751db6cfaf2a5f1b8a3b471f510976f",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/ff564c75e751db6cfaf2a5f1b8a3b471f510976f",
      "created_at": "2023-09-20T12:25:31Z"
    },
    {
      "event": "commented",
      "id": 1732127277,
      "node_id": "IC_kwDOABII585nPiot",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1732127277",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-22T23:35:44Z",
      "updated_at": "2023-09-22T23:35:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "Can be closed now that https://github.com/bitcoin/bitcoin/pull/27511 is merged!",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26907#issuecomment-1732127277",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26907"
    },
    {
      "event": "closed",
      "id": 10452998469,
      "node_id": "CE_lADOABII585bmO2uzwAAAAJvDBlF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10452998469",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-23T10:34:36Z"
    },
    {
      "event": "referenced",
      "id": 10468365865,
      "node_id": "REFE_lADOABII585bmO2uzwAAAAJv9pYp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10468365865",
      "actor": {
        "login": "Frank-GER",
        "id": 87550788,
        "node_id": "MDQ6VXNlcjg3NTUwNzg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/87550788?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Frank-GER",
        "html_url": "https://github.com/Frank-GER",
        "followers_url": "https://api.github.com/users/Frank-GER/followers",
        "following_url": "https://api.github.com/users/Frank-GER/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Frank-GER/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Frank-GER/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Frank-GER/subscriptions",
        "organizations_url": "https://api.github.com/users/Frank-GER/orgs",
        "repos_url": "https://api.github.com/users/Frank-GER/repos",
        "events_url": "https://api.github.com/users/Frank-GER/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Frank-GER/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "da7ea225a7fe1f9291d2ac7184bcd2cdb4ff4598",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/da7ea225a7fe1f9291d2ac7184bcd2cdb4ff4598",
      "created_at": "2023-09-25T23:25:48Z"
    },
    {
      "event": "referenced",
      "id": 10477891602,
      "node_id": "REFE_lADOABII585bmO2uzwAAAAJwh_AS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10477891602",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f2c8dfcc9a3c8e81ff02a659f8b65a72f0d40e74",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/f2c8dfcc9a3c8e81ff02a659f8b65a72f0d40e74",
      "created_at": "2023-09-26T16:58:43Z"
    },
    {
      "event": "locked",
      "id": 14355523252,
      "node_id": "LOE_lADOABII585bmO2uzwAAAANXp-a0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14355523252",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-22T20:47:02Z"
    }
  ]
}