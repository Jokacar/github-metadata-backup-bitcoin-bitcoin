{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267",
    "id": 1913905474,
    "node_id": "PR_kwDOABII585yE-FC",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30267",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30267.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30267.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30267",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30267/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/fe25b9b017300384fe0ca30c878c7f74cae1729d",
    "number": 30267,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "assumeutxo: Check snapshot base block is not in invalid chain",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This was discovered in a discussion in #29996\r\n\r\nIf the base block of the snapshot is marked invalid or part of an invalid chain, we currently still load the snapshot and get stuck in a weird state where we have the snapshot chainstate but it will never connect to our valid chain.\r\n\r\nWhile this scenario is highly unlikely to occur on mainnet, it still seems good to prevent this inconsistent state.\r\n\r\nAlso removes an unnecessary restart introduced in #29428.",
    "labels": [
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2024-06-11T08:49:29Z",
    "updated_at": "2024-06-19T19:42:28Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "4733aa5e7d53f8ea035bffe94e5373b89a83ac82",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "fjahr:2024-06-invalid-snapshot-block",
      "ref": "2024-06-invalid-snapshot-block",
      "sha": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 196253948,
        "node_id": "MDEwOlJlcG9zaXRvcnkxOTYyNTM5NDg=",
        "name": "bitcoin",
        "full_name": "fjahr/bitcoin",
        "owner": {
          "login": "fjahr",
          "id": 1322187,
          "node_id": "MDQ6VXNlcjEzMjIxODc=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/fjahr",
          "html_url": "https://github.com/fjahr",
          "followers_url": "https://api.github.com/users/fjahr/followers",
          "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
          "organizations_url": "https://api.github.com/users/fjahr/orgs",
          "repos_url": "https://api.github.com/users/fjahr/repos",
          "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/fjahr/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/fjahr/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/fjahr/bitcoin",
        "archive_url": "https://api.github.com/repos/fjahr/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/fjahr/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/fjahr/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/fjahr/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/fjahr/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/fjahr/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/fjahr/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/fjahr/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/fjahr/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/fjahr/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/fjahr/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/fjahr/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/fjahr/bitcoin/events",
        "forks_url": "https://api.github.com/repos/fjahr/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/fjahr/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/fjahr/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/fjahr/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/fjahr/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/fjahr/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/fjahr/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/fjahr/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/fjahr/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/fjahr/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/fjahr/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/fjahr/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/fjahr/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/fjahr/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/fjahr/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/fjahr/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:fjahr/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/fjahr/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/fjahr/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/fjahr/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/fjahr/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/fjahr/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/fjahr/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/fjahr/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/fjahr/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/fjahr/bitcoin/hooks",
        "svn_url": "https://github.com/fjahr/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 247679,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-06-19T19:42:00Z",
        "created_at": "2019-07-10T18:11:06Z",
        "updated_at": "2024-04-27T19:57:43Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "2d21060af831fa8f8f1791b4464961d5f28a88cb",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35538,
        "stargazers_count": 76937,
        "watchers_count": 76937,
        "size": 261754,
        "default_branch": "master",
        "open_issues_count": 686,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-06-19T19:42:03Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-06-19T19:44:27Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 66,
    "deletions": 52,
    "changed_files": 6,
    "commits": 3,
    "review_comments": 9,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 2160152241,
      "node_id": "IC_kwDOABII586AwU6x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2160152241",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-11T08:49:32Z",
      "updated_at": "2024-06-18T18:13:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30267).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [tdb3](https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2110894428), [alfonsoromanz](https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2112255189), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2113239131) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30214](https://github.com/bitcoin/bitcoin/pull/30214) (refactor: Improve assumeutxo state representation by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#issuecomment-2160152241",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30267"
    },
    {
      "event": "reviewed",
      "id": 2110894428,
      "node_id": "PRR_kwDOABII58590bFc",
      "url": null,
      "actor": null,
      "commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK cbc604f6a7739bf22a5d811b6366453860d59f4c\r\nSeems like an improvement to avoid expending resources loading a snapshot that won't be part of a valid chain.\r\n\r\nBuilt and ran unit and functional tests (including `feature_assumeutxo`).  All passed.\r\n\r\nTested that `feature_assumeutxo` would fail with:\r\n```c++\r\nbool start_block_invalid = false;\r\n```\r\nTest failed as expected.\r\n",
      "user": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2110894428",
      "submitted_at": "2024-06-11T16:05:50Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
    },
    {
      "event": "reviewed",
      "id": 2112255189,
      "node_id": "PRR_kwDOABII58595nTV",
      "url": null,
      "actor": null,
      "commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK cbc604f6a7739bf22a5d811b6366453860d59f4c\r\n\r\nThis PR successfully builds and passes the test when running `test/functional/feature_assumeutxo.py`.\r\n\r\nAdditionally, I tested this in the context of my PR ([#29996](https://github.com/bitcoin/bitcoin/pull/29996)) back when the code looked something like this:\r\n\r\n```\r\n    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\r\n        node = self.nodes[2]\r\n        # Rollback the chain down to START_HEIGHT\r\n        block_hash = node.getblockhash(START_HEIGHT + 1)\r\n        node.invalidateblock(block_hash)\r\n        assert_equal(node.getblockcount(), START_HEIGHT)\r\n\r\n        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\r\n        # Generate a divergent chain up to 298\r\n        self.generate(node, nblocks=99, sync_fun=self.no_op)\r\n        assert_equal(node.getblockcount(), SNAPSHOT_BASE_HEIGHT - 1)\r\n\r\n        # Try importing the snapshot and assert its success\r\n        self.log.info('Importing the snapshot')\r\n        loaded = node.loadtxoutset(dump_output_path)\r\n```\r\n\r\nThe snapshot load failed with the expected message: `test_framework.authproxy.JSONRPCException: The base block header is part of an invalid chain. (-32603)`",
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2112255189",
      "submitted_at": "2024-06-12T07:58:38Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
    },
    {
      "event": "reviewed",
      "id": 2113239131,
      "node_id": "PRR_kwDOABII58599Xhb",
      "url": null,
      "actor": null,
      "commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code Review ACK cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "user": {
        "login": "BrandonOdiwuor",
        "id": 15610188,
        "node_id": "MDQ6VXNlcjE1NjEwMTg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/15610188?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BrandonOdiwuor",
        "html_url": "https://github.com/BrandonOdiwuor",
        "followers_url": "https://api.github.com/users/BrandonOdiwuor/followers",
        "following_url": "https://api.github.com/users/BrandonOdiwuor/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BrandonOdiwuor/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BrandonOdiwuor/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BrandonOdiwuor/subscriptions",
        "organizations_url": "https://api.github.com/users/BrandonOdiwuor/orgs",
        "repos_url": "https://api.github.com/users/BrandonOdiwuor/repos",
        "events_url": "https://api.github.com/users/BrandonOdiwuor/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BrandonOdiwuor/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2113239131",
      "submitted_at": "2024-06-12T14:36:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
    },
    {
      "event": "reviewed",
      "id": 2113246508,
      "node_id": "PRR_kwDOABII58599ZUs",
      "url": null,
      "actor": null,
      "commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "BrandonOdiwuor",
        "id": 15610188,
        "node_id": "MDQ6VXNlcjE1NjEwMTg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/15610188?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BrandonOdiwuor",
        "html_url": "https://github.com/BrandonOdiwuor",
        "followers_url": "https://api.github.com/users/BrandonOdiwuor/followers",
        "following_url": "https://api.github.com/users/BrandonOdiwuor/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BrandonOdiwuor/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BrandonOdiwuor/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BrandonOdiwuor/subscriptions",
        "organizations_url": "https://api.github.com/users/BrandonOdiwuor/orgs",
        "repos_url": "https://api.github.com/users/BrandonOdiwuor/repos",
        "events_url": "https://api.github.com/users/BrandonOdiwuor/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BrandonOdiwuor/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2113246508",
      "submitted_at": "2024-06-12T14:39:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
    },
    {
      "event": "reviewed",
      "id": 2116621895,
      "node_id": "PRR_kwDOABII585-KRZH",
      "url": null,
      "actor": null,
      "commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#pullrequestreview-2116621895",
      "submitted_at": "2024-06-13T18:26:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13200781317,
      "node_id": "HRFPE_lADOABII586L0eOEzwAAAAMS0_AF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13200781317",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-18T12:57:29Z"
    },
    {
      "event": "commented",
      "id": 2176462392,
      "node_id": "IC_kwDOABII586Bui44",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2176462392",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-18T16:02:30Z",
      "updated_at": "2024-06-18T16:02:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\n🚧 At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/26368413924</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#issuecomment-2176462392",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30267"
    },
    {
      "event": "labeled",
      "id": 13203473116,
      "node_id": "LE_lADOABII586L0eOEzwAAAAMS_QLc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13203473116",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-18T16:02:30Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13220059197,
      "node_id": "HRFPE_lADOABII586L0eOEzwAAAAMT-hg9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13220059197",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-19T19:00:59Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA4ZjhhNWMzYmM3N2JmNDU2YzdhOTg4YjFkMWJmOTE4YzUzN2U0OGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/08f8a5c3bc77bf456c7a988b1d1bf918c537e48f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/08f8a5c3bc77bf456c7a988b1d1bf918c537e48f",
      "tree": {
        "sha": "2469c4c6eecbe71100aa7224b937ab618f397a9a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2469c4c6eecbe71100aa7224b937ab618f397a9a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2469c4c6eecbe71100aa7224b937ab618f397a9a\nparent 9c5cdf07f30f816cd134e2cd2dca9c27ef7067a5\nauthor Fabian Jahr <fjahr@protonmail.com> 1718713495 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1718826114 +0200\n\nrefactor: Move early loadtxoutset checks into ActiveSnapshot\n\nAlso changes the return type of ActiveSnapshot to allow returning the\nerror message to the user of the loadtxoutset RPC.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmZzNIMVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNUKoQAI+V0TbqBQlKtAEIkprCi76/ra5/\nHYthSyWtycZ3HpegQtkGdIyyf/cH532s2Mc96Cs/OARh7lzJ1WJDBCkvAVqFESI9\n825gqUz3qjDO/vgmTrMCkJ9B6V60gSJt3ihA+2G4uhwENhGJrO5T3k5B9DGAHSr3\nFbrYhjwyUVdRzUqWH7Zxr+pAx3RYckJ+9SOhCE9gBtY0NWiXRYvMa7BURxfjOhaE\noEDkWKyfjgyB5a7v7PoA3Xb5W2TE8MPMeOf8++pSvghR5p+L9huSwb+TU/dEFtDr\nrHgRX0Cg1MRv9cjKpDHVdCsBvF8/OKtTaPTaKBQXR4BNcPk93PylYGK3h60PEYuw\nERLvzehYlCon613M7CX6/UBnM3hti20tA8GLg7z0mfVW8UlBzx3eC8nW1cLm3mm8\nE6Yy00nKCYOlfrzI2CID/l3loSvtF3DAgyV3dYrEuDOuEYmRDdYiYxJVPGlVRnLF\nVeehXZtU7ZqGVkK/A/c0ONn2BSplkT0dQgKaOByROmHY0TE/1M2My3KS9TK4LkB9\nYddb1oqQzqabN1sNdH/bqbzEpxzd9fkFE2WSVBuGSPYPjkXDm7+GmdRdhUsraKHT\nag/smnHW0QqYGm5rQBpFFChDIcTa0jCYpmR6a9CHa42LUERMxQqKOrl5eGVTccE+\nnp2xkOIW3h3o9LgP\n=3mzq\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9c5cdf07f30f816cd134e2cd2dca9c27ef7067a5",
          "sha": "9c5cdf07f30f816cd134e2cd2dca9c27ef7067a5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9c5cdf07f30f816cd134e2cd2dca9c27ef7067a5"
        }
      ],
      "message": "refactor: Move early loadtxoutset checks into ActiveSnapshot\n\nAlso changes the return type of ActiveSnapshot to allow returning the\nerror message to the user of the loadtxoutset RPC.",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2024-06-19T19:41:54Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2024-06-18T12:24:55Z"
      },
      "sha": "08f8a5c3bc77bf456c7a988b1d1bf918c537e48f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJlN2IxNGE5MzVhNTM0ODNjOTllNTA2NDAyYTY2YjVkZjMwMDgxNTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/be7b14a935a53483c99e506402a66b5df3008155",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/be7b14a935a53483c99e506402a66b5df3008155",
      "tree": {
        "sha": "3be5bfba2505f578a75b8faa301eabb5ec3859a5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3be5bfba2505f578a75b8faa301eabb5ec3859a5"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3be5bfba2505f578a75b8faa301eabb5ec3859a5\nparent 08f8a5c3bc77bf456c7a988b1d1bf918c537e48f\nauthor Fabian Jahr <fjahr@protonmail.com> 1718714090 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1718826115 +0200\n\nassumeutxo: Check snapshot base block is not marked invalid\n\nCo-authored-by: Alfonso Roman Zubeldia <alfonsoromanz24@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmZzNIMVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNTb0QAJjpg77zPAHC0OQPXNJ/3wzjzWy+\nc5Lf5KqLbFyNTnAuyoDIuZb4HoBaQBWNCc82etPqMbsvdpIsihjKzjiKZcIKUwF9\na+D4mkDgDCrrIdF5jtfCj4+ABzKFQXIzsNbGEp0BaB2l+EFmiVeFWARxjvKEaD1w\n9U8v5UpNmMHtvXOYe+jUgeYzk7/5Vul2J7tOqNeRiMPneoipUICS5KZDghUtgQOP\n3SYZdtsrerPPX9eOD++GA2SA33Mvb0oB4WhaOHOLePVbZHgsTzWtIY8Oyt6TPFBk\nH/GRSZbAcUPO6Gv04ciDamNwpaJnq8SM1/tzOyEJQGyhzXCQW7gVeyRr1VfnsgT3\nM6cnwDw6qtm6sk9s505dFUOsB4SIsMXqtx/F+KcmkyWDpEiMXx290uei+qXQI2Kz\nnaowqy7sgLRA5Ah8PhBhWXnXBPSUpOT85zjOan9xIjHcopxsLF8zsQmNl/jh/lkh\nE1c1J7eElZSbZs3Fx8ZcECNnQ6L0Yf8lQM3KiVYEyXZ8fvcA2uH5ItbE4nirSK/5\nRANjfZNPW1dvF837+fjGsw61yvAbsR0DvJUwq8BdUbuqvGisg/LbZPGu1gSbBfHj\n/EtWVL7tRviuAkI6t/fNvcj3YVnITSqOwARxyht20sYonN0jbk23y4TFg/bKMIW5\nrMsU41eUp0yhKoia\n=Qze5\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/08f8a5c3bc77bf456c7a988b1d1bf918c537e48f",
          "sha": "08f8a5c3bc77bf456c7a988b1d1bf918c537e48f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/08f8a5c3bc77bf456c7a988b1d1bf918c537e48f"
        }
      ],
      "message": "assumeutxo: Check snapshot base block is not marked invalid\n\nCo-authored-by: Alfonso Roman Zubeldia <alfonsoromanz24@gmail.com>",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2024-06-19T19:41:55Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2024-06-18T12:34:50Z"
      },
      "sha": "be7b14a935a53483c99e506402a66b5df3008155"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZlMjViOWIwMTczMDAzODRmZTBjYTMwYzg3OGM3Zjc0Y2FlMTcyOWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "tree": {
        "sha": "622810872043c5df45be0a4e49ddfbee4a250f2c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/622810872043c5df45be0a4e49ddfbee4a250f2c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 622810872043c5df45be0a4e49ddfbee4a250f2c\nparent be7b14a935a53483c99e506402a66b5df3008155\nauthor Fabian Jahr <fjahr@protonmail.com> 1718709749 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1718826115 +0200\n\ntest: Remove unnecessary restart in assumeutxo test\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAmZzNIMVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNSnkQAJUZyREfIAZTMVaEMACLkxBpLHLh\nVX74YwsbBlDqsf0G6ZUH2werbXSVSsI+1N+b14y7mvVnF4YIce0sdNGBAmJsplMy\n/lpmKh3UoH5BMbFWNtgjvQwGr4K2eZrDguS4zye2Wntyt/CKF3mL8Tc0FICSPDxh\nwrAgJPguPcxPgQTUvR4qzCTSPJYRLsAp16X9GX5bQTbqVdj6+now2j4CSrS2unfX\n7TxJds0vzlgHEX5KE4hElRxa4RPySrZlLTLyJmdfkyu9MfK8va7q/iM7JYisVZz5\n6/nudcRB77w87bBoGPwNmM+loLlsV4E8ScEPVqSTWTGFsaM1HL7IOAPux5bP23co\nPoujvKAImA84eMMC1UwIePxZ2TDSdBk5VClS9PKHe2qp5WPRU5XRDJ1t2uYisfSG\nosnafpZF9wbjNbfrc0kTtgrLIJ9I68XzkrZPNLryR9FtK6lMP2DHnmP8Ts/Bv4hj\nbGxyRrXaHygDcFtkKmrE+Sx2kip8VOAGcrGsCg9Rx+Z++y8B10EKU2GxRA+o+P1v\ni3FvrmSmB4aI4UMp0/9udB1yqXvZFhMRmYfGVrs7oK7eiijxKYxTyb4MWaEFU/z7\n4GJJYtMjN4Z8FWdAvojwh8cQQPHA3U/FDJjQtOSW6N3eTlN8eL+U6PGtlAPJ/OW1\nqasmYsDNDmJKuBym\n=0oir\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/be7b14a935a53483c99e506402a66b5df3008155",
          "sha": "be7b14a935a53483c99e506402a66b5df3008155",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/be7b14a935a53483c99e506402a66b5df3008155"
        }
      ],
      "message": "test: Remove unnecessary restart in assumeutxo test",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2024-06-19T19:41:55Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2024-06-18T11:22:29Z"
      },
      "sha": "fe25b9b017300384fe0ca30c878c7f74cae1729d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13220347813,
      "node_id": "HRFPE_lADOABII586L0eOEzwAAAAMT_n-l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13220347813",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-19T19:42:02Z"
    },
    {
      "event": "commented",
      "id": 2179369598,
      "node_id": "IC_kwDOABII586B5op-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2179369598",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-19T19:42:27Z",
      "updated_at": "2024-06-19T19:42:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "Needed to rebase because of a silent merge conflict.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#issuecomment-2179369598",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30267"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1635144969",
      "pull_request_review_id": 2110894428,
      "id": 1635144969,
      "node_id": "PRRC_kwDOABII585hdlUJ",
      "diff_hunk": "@@ -202,7 +202,15 @@ def test_snapshot_with_less_work(self, dump_output_path):\n         assert_equal(node.getblockcount(), FINAL_HEIGHT)\n         with node.assert_debug_log(expected_msgs=[\"[snapshot] activation failed - work does not exceed active chainstate\"]):\n             assert_raises_rpc_error(-32603, \"Unable to load UTXO snapshot\", node.loadtxoutset, dump_output_path)\n-        self.restart_node(0, extra_args=self.extra_args[0])\n+\n+    def test_snapshot_block_invalidated(self, dump_output_path):\n+        self.log.info(\"Test snapshot is not loaded when base block is invalid.\")\n+        node = self.nodes[0]\n+        block_hash = node.getblockhash(SNAPSHOT_BASE_HEIGHT - 1)\n+        node.invalidateblock(block_hash)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 10,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "in_reply_to_id": null,
      "user": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> If the base block of the snapshot is marked invalid or part of an invalid chain\r\n\r\nThis existing test seems to focus on the base block being part of an invalid chain.  Is it also worth adding an explicit test for an invalid base block itself (or would it be overkill)?",
      "created_at": "2024-06-11T16:05:35Z",
      "updated_at": "2024-06-11T16:05:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1635144969",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1635144969"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1636599996",
      "pull_request_review_id": 2113246508,
      "id": 1636599996,
      "node_id": "PRRC_kwDOABII585hjIi8",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {\n+        throw JSONRPCError(\n+            RPC_INTERNAL_ERROR,\n+            \"The base block header is part of an invalid chain.\");",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "in_reply_to_id": null,
      "user": {
        "login": "BrandonOdiwuor",
        "id": 15610188,
        "node_id": "MDQ6VXNlcjE1NjEwMTg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/15610188?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BrandonOdiwuor",
        "html_url": "https://github.com/BrandonOdiwuor",
        "followers_url": "https://api.github.com/users/BrandonOdiwuor/followers",
        "following_url": "https://api.github.com/users/BrandonOdiwuor/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BrandonOdiwuor/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BrandonOdiwuor/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BrandonOdiwuor/subscriptions",
        "organizations_url": "https://api.github.com/users/BrandonOdiwuor/orgs",
        "repos_url": "https://api.github.com/users/BrandonOdiwuor/repos",
        "events_url": "https://api.github.com/users/BrandonOdiwuor/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BrandonOdiwuor/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: Would it be better to include the base block hash on the error message to help in debugging \r\n\r\n```cpp\r\nthrow JSONRPCError(\r\n            RPC_INTERNAL_ERROR,\r\n            \"The base block header (%s) is part of an invalid chain.\", base_blockhash.ToString());\r\n```",
      "created_at": "2024-06-12T14:39:42Z",
      "updated_at": "2024-06-12T14:39:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1636599996",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1636599996"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2845,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1638706909",
      "pull_request_review_id": 2116621895,
      "id": 1638706909,
      "node_id": "PRRC_kwDOABII585hrK7d",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "f3029560620453d7848e57bc2cbf5b042cb0a2a6",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Some checks are within `ActivateSnapshot()`, others, like the added one, are in the rpc code (which means that they can't be covered in  unit tests for that function). Do you know if there is a reason for that?",
      "created_at": "2024-06-13T18:25:33Z",
      "updated_at": "2024-06-13T18:26:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1638706909",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1638706909"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2842,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642951609",
      "pull_request_review_id": 2123141969,
      "id": 1642951609,
      "node_id": "PRRC_kwDOABII585h7XO5",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "f3029560620453d7848e57bc2cbf5b042cb0a2a6",
      "in_reply_to_id": 1638706909,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1638706909\r\n\r\n> Some checks are within `ActivateSnapshot()`, others, like the added one, are in the rpc code (which means that they can't be covered in unit tests for that function). Do you know if there is a reason for that?\r\n\r\nI think this is just a mistake, and it makes the checks less reliable because they are done without keeping cs_main locked. I suggested fixing this before in https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1325193433.\r\n\r\n\r\n",
      "created_at": "2024-06-17T14:55:41Z",
      "updated_at": "2024-06-17T14:56:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1642951609",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642951609"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2842,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644425136",
      "pull_request_review_id": 2125454807,
      "id": 1644425136,
      "node_id": "PRRC_kwDOABII585iA--w",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "f3029560620453d7848e57bc2cbf5b042cb0a2a6",
      "in_reply_to_id": 1638706909,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think these were always separated like that. But sounds good to me to move them. I have added a refactoring commit which moves the other two early checks into `ActivateSnapshot()` and then I am adding the new check there as well.",
      "created_at": "2024-06-18T12:59:26Z",
      "updated_at": "2024-06-18T12:59:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1644425136",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644425136"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2842,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644425662",
      "pull_request_review_id": 2125455693,
      "id": 1644425662,
      "node_id": "PRRC_kwDOABII585iA_G-",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {\n+        throw JSONRPCError(\n+            RPC_INTERNAL_ERROR,\n+            \"The base block header is part of an invalid chain.\");",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "in_reply_to_id": 1636599996,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "taken with minor edits",
      "created_at": "2024-06-18T12:59:47Z",
      "updated_at": "2024-06-18T12:59:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1644425662",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644425662"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2845,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644425900",
      "pull_request_review_id": 2125456132,
      "id": 1644425900,
      "node_id": "PRRC_kwDOABII585iA_Ks",
      "diff_hunk": "@@ -202,7 +202,15 @@ def test_snapshot_with_less_work(self, dump_output_path):\n         assert_equal(node.getblockcount(), FINAL_HEIGHT)\n         with node.assert_debug_log(expected_msgs=[\"[snapshot] activation failed - work does not exceed active chainstate\"]):\n             assert_raises_rpc_error(-32603, \"Unable to load UTXO snapshot\", node.loadtxoutset, dump_output_path)\n-        self.restart_node(0, extra_args=self.extra_args[0])\n+\n+    def test_snapshot_block_invalidated(self, dump_output_path):\n+        self.log.info(\"Test snapshot is not loaded when base block is invalid.\")\n+        node = self.nodes[0]\n+        block_hash = node.getblockhash(SNAPSHOT_BASE_HEIGHT - 1)\n+        node.invalidateblock(block_hash)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 10,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "cbc604f6a7739bf22a5d811b6366453860d59f4c",
      "in_reply_to_id": 1635144969,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it's a bit overkill but it was easy to add and also shouldn't make the test considerably slower, so I added coverage for this as well.",
      "created_at": "2024-06-18T12:59:59Z",
      "updated_at": "2024-06-18T12:59:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1644425900",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644425900"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644893828",
      "pull_request_review_id": 2126225985,
      "id": 1644893828,
      "node_id": "PRRC_kwDOABII585iCxaE",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "f3029560620453d7848e57bc2cbf5b042cb0a2a6",
      "in_reply_to_id": 1638706909,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Looks good (except for the compiler issue with `Join()`) - I think it would be helpful to not only log the reason, but also return them with the RPC - for that, `ActivateSnapshot()` would need to return it, possibly as `util::Result` as suggested by ryanofsky, but that could be a follow-up.\r\nThough for now, it might be helpful to expand the error (\"Unable to load UTXO snapshot\") to point the user to the debug log for the reason.",
      "created_at": "2024-06-18T18:35:06Z",
      "updated_at": "2024-06-18T18:35:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1644893828",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644893828"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2842,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646607479",
      "pull_request_review_id": 2128911453,
      "id": 1646607479,
      "node_id": "PRRC_kwDOABII585iJTx3",
      "diff_hunk": "@@ -2836,6 +2836,15 @@ static RPCHelpMan loadtxoutset()\n             strprintf(\"The base block header (%s) must appear in the headers chain. Make sure all headers are syncing, and call this RPC again.\",\n                       base_blockhash.ToString()));\n     }\n+\n+    bool start_block_invalid = WITH_LOCK(::cs_main,\n+            return snapshot_start_block->nStatus & BLOCK_FAILED_MASK);\n+    if (start_block_invalid) {",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "fe25b9b017300384fe0ca30c878c7f74cae1729d",
      "original_commit_id": "f3029560620453d7848e57bc2cbf5b042cb0a2a6",
      "in_reply_to_id": 1638706909,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, yeah, I gave it a shot and it pretty simple so I am changing the return type as well in the refactoring commit now.",
      "created_at": "2024-06-19T19:02:20Z",
      "updated_at": "2024-06-19T19:02:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30267#discussion_r1646607479",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646607479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30267"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2842,
      "side": "RIGHT"
    }
  ]
}