{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370",
    "id": 1708766324,
    "node_id": "PR_kwDOABII585l2bR0",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29370",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29370.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29370.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
    "number": 29370,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "assumeutxo: Get rid of faked nTx and nChainTx values",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The `PopulateAndValidateSnapshot` function introduced in f6e2da5fb7c6406c37612c838c998078ea8d2252 from #19806 has been setting fake `nTx` and `nChainTx` values that can show up in RPC results (https://github.com/bitcoin/bitcoin/issues/29328) and make `CBlockIndex` state hard to reason about, because it is difficult to know whether the values are real or fake.\r\n\r\nRevert to previous behavior of setting `nTx` and `nChainTx` to 0 when the values are unknown, instead of faking them. Also drop no-longer needed `BLOCK_ASSUMED_VALID` flag.\r\n\r\nThis PR fixes an assert failure in the `(pindex->nChainTx == pindex->nTx + prev_chain_tx)` check that would previously happen if a snapshot was loaded, and a block was submitted which forked from the chain before the snapshot block and after the last downloaded background chain block. This block would not be marked assumed-valid because it would not be an ancestor of the snapshot, and it would have `nTx` set, `nChainTx` set to a nonsense value based on a sum with the previous block's fake value, and `prev->nChainTx` set with a real value, so the assert would fail. After this commit, `nChainTx` is unset instead of being set to a fake value, so the assert succeeds. A test which submits a block like this and previously crashed the node has been added in feature_assumeutxo.py. It was written and posted by maflcko in https://github.com/bitcoin/bitcoin/issues/29261#issuecomment-1918947945 \r\n\r\nCompatibility note: This change could result in `-checkblockindex` failures if a snapshot was loaded by a previous version of Bitcoin Core and not fully validated, because fake `nTx` values will have been saved to the block index. It would be pretty easy to avoid these failures by adding some compatibility code to `LoadBlockIndex` and changing `nTx` values from 1 to 0 when they are fake (when `(pindex->nStatus & BLOCK_VALID_MASK) < BLOCK_VALID_TRANSACTIONS`), but a little simpler not to worry about being compatible in this case.",
    "labels": [],
    "created_at": "2024-02-02T16:18:52Z",
    "updated_at": "2024-02-08T16:48:22Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "4e4eae438ab134312f551c4cbeb2c6c53f64f490",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "ryanofsky:pr/nofake",
      "ref": "pr/nofake",
      "sha": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 69901633,
        "node_id": "MDEwOlJlcG9zaXRvcnk2OTkwMTYzMw==",
        "name": "bitcoin",
        "full_name": "ryanofsky/bitcoin",
        "owner": {
          "login": "ryanofsky",
          "id": 7133040,
          "node_id": "MDQ6VXNlcjcxMzMwNDA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ryanofsky",
          "html_url": "https://github.com/ryanofsky",
          "followers_url": "https://api.github.com/users/ryanofsky/followers",
          "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
          "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
          "repos_url": "https://api.github.com/users/ryanofsky/repos",
          "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/ryanofsky/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ryanofsky/bitcoin",
        "archive_url": "https://api.github.com/repos/ryanofsky/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ryanofsky/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ryanofsky/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ryanofsky/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ryanofsky/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ryanofsky/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ryanofsky/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ryanofsky/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ryanofsky/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ryanofsky/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ryanofsky/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ryanofsky/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ryanofsky/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ryanofsky/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ryanofsky/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ryanofsky/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ryanofsky/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ryanofsky/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ryanofsky/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ryanofsky/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ryanofsky/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ryanofsky/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ryanofsky/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ryanofsky/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ryanofsky/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ryanofsky/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ryanofsky/bitcoin/hooks",
        "svn_url": "https://github.com/ryanofsky/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 9,
        "stargazers_count": 12,
        "watchers_count": 12,
        "size": 244138,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-08T16:47:24Z",
        "created_at": "2016-10-03T19:05:43Z",
        "updated_at": "2024-01-25T23:52:08Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "0471aee5077fef81a0e2e032f3c16bdc948a70f2",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36735,
        "stargazers_count": 73775,
        "watchers_count": 73775,
        "size": 248404,
        "default_branch": "master",
        "open_issues_count": 691,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-08T16:47:27Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-02-08T16:58:36Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 145,
    "deletions": 140,
    "changed_files": 7,
    "commits": 4,
    "review_comments": 24,
    "comments": 9
  },
  "events": [
    {
      "event": "commented",
      "id": 1924196872,
      "node_id": "IC_kwDOABII585ysOoI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924196872",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T16:18:55Z",
      "updated_at": "2024-02-05T23:58:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29370).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29355](https://github.com/bitcoin/bitcoin/pull/29355) (doc: Assert that assumed-valid blocks are not fully valid in CheckBlockIndex() by maflcko)\n* [#29331](https://github.com/bitcoin/bitcoin/pull/29331) (redeclare nChainTx to use uint64_t by russeree)\n* [#28339](https://github.com/bitcoin/bitcoin/pull/28339) (validation: improve performance of CheckBlockIndex by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1924196872",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T16:20:02Z",
      "updated_at": "2024-02-02T16:20:02Z",
      "source": {
        "issue": {
          "id": 2102425719,
          "node_id": "I_kwDOABII5859UHh3",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29328",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29328/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29328/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29328/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/29328",
          "number": 29328,
          "state": "open",
          "state_reason": null,
          "title": "assumeutxo: nTx and nChainTx in RPC results are off",
          "body": "AssumeUtxo mocks the `nTx` value of headers after the last background block and before the snapshot header with `nTx=1`. This means that the `getblockheader` and `getchaintxstats` RPCs return the wrong `nTx` or `txcount` fields for those blocks.\r\n\r\nNot sure if anything should be done about this?",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64584,
              "node_id": "MDU6TGFiZWw2NDU4NA==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
              "name": "Brainstorming",
              "color": "ebd775",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 7,
          "created_at": "2024-01-26T15:38:55Z",
          "updated_at": "2024-02-02T16:20:03Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1924254747,
      "node_id": "IC_kwDOABII585yscwb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924254747",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T16:47:18Z",
      "updated_at": "2024-02-02T16:47:18Z",
      "author_association": "MEMBER",
      "body": "> Backwards compatibility code in LoadBlockIndex to override `nTx == 1` values set by previous code when they are fake (when ` (pindex->nStatus & BLOCK_VALID_MASK) < BLOCK_VALID_TRANSACTIONS`)\r\n\r\nNot sure. This can only happen on test-chains, so I think it would be cleaner to just require the developers, if there are any, to finish their background sync, or to wipe their chainstate, or the blocksdir, or the whole test data dir.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1924254747",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "labeled",
      "id": 11686894489,
      "node_id": "LE_lADOABII585-FJRJzwAAAAK4l9uZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11686894489",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T17:16:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1924315726,
      "node_id": "IC_kwDOABII585ysrpO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924315726",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T17:16:09Z",
      "updated_at": "2024-02-02T17:16:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\n🚧 At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21160915955</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1924315726",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11687790207,
      "node_id": "HRFPE_lADOABII585-FJRJzwAAAAK4pYZ_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11687790207",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T18:36:17Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T18:38:59Z",
      "updated_at": "2024-02-02T18:38:59Z",
      "source": {
        "issue": {
          "id": 2110088973,
          "node_id": "PR_kwDOABII585lkgAR",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29355",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29355/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29355/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29355/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29355",
          "number": 29355,
          "state": "open",
          "state_reason": null,
          "title": "doc: Assert that assumed-valid blocks are not fully valid in CheckBlockIndex()",
          "body": "It does not make sense for a block to be fully-valid and assumed-valid at the same time.\r\n\r\nCheck it in `CheckBlockIndex()` and fix the tests that violate this assumption.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 148216,
              "node_id": "MDU6TGFiZWwxNDgyMTY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Docs",
              "name": "Docs",
              "color": "02d7e1",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29355",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29355",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29355.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29355.patch"
          },
          "created_at": "2024-01-31T13:22:47Z",
          "updated_at": "2024-02-05T15:59:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T18:44:11Z",
      "updated_at": "2024-02-02T18:44:11Z",
      "source": {
        "issue": {
          "id": 2108356707,
          "node_id": "PR_kwDOABII585lenr3",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29349",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29349/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29349/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29349/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29349",
          "number": 29349,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: Remove nChainTx from consensus",
          "body": "`nChainTx` is returned by RPCs and is used to estimate (sync and rescan) progress.\r\n\r\nHowever, it is also used for consensus and P2P logic to denote that a block and all its parents have `BLOCK_VALID_TRANSACTIONS` set.\r\n\r\nThis is confusing, because:\r\n\r\n* It would be clearer to use the `BlockStatus` enum for this as well.\r\n* It requires AssumeUtxo to fake the `nChainTx` values.\r\n* It makes it harder to remove `nChainTx` completely, or limit it to code that needs it (estimate sync and scan progress and report it on RPC).\r\n\r\nFix it by introducing a new `BLOCK_VALID_TRANSACTIONS_TREE` level and use it where possible.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29349",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29349",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29349.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29349.patch"
          },
          "closed_at": "2024-02-05T13:14:00Z",
          "created_at": "2024-01-30T17:08:21Z",
          "updated_at": "2024-02-05T13:14:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1924479030,
      "node_id": "IC_kwDOABII585ytTg2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1924479030",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T18:44:52Z",
      "updated_at": "2024-02-02T18:44:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Not sure. This can only happen on test-chains, so I think it would be cleaner to just require the developers, if there are any, to finish their background sync, or to wipe their chainstate, or the blocksdir, or the whole test data dir.\r\n\r\nIt makes sense that having backwards compatibility may not be worth it, but I don't see why test chains would set `nTx` to a real value without also setting BLOCK_VALID_TRANSACTIONS. It seems like we should be able to use BLOCK_VALID_TRANSACTIONS to know if nTx is real or fake, as long as we are checking for BLOCK_VALID_TRANSACTIONS, directly, and not using the IsValid() helper which is also influenced by BLOCK_FAILED flags.\r\n\r\n---\r\n\r\nUpdated 4c70d993e3ac0e9b7923eded51826fe1faa2d004 -> a3228f02f69e28960f7da76054965c916e781f27 ([`pr/nofake.1`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.1) -> [`pr/nofake.2`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.2), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nofake.1..pr/nofake.2)) to fix broken validation_block_tests due to a buggy check, also making some minor cleanups",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1924479030",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T18:51:09Z",
      "updated_at": "2024-02-02T18:51:09Z",
      "source": {
        "issue": {
          "id": 2102946052,
          "node_id": "PR_kwDOABII585lMryi",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29331",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29331/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29331/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29331/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29331",
          "number": 29331,
          "state": "open",
          "state_reason": null,
          "title": "redeclare nChainTx to use uint64_t",
          "body": "Following up on https://github.com/bitcoin/bitcoin/issues/29258 the type of ```nChainTx``` has now been changed to a ```uint64_t``` allowing for the counting of TXs well into the future. The note about changing the type in 2024 was also removed. This passes all extended tests.",
          "user": {
            "login": "russeree",
            "id": 3104223,
            "node_id": "MDQ6VXNlcjMxMDQyMjM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3104223?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/russeree",
            "html_url": "https://github.com/russeree",
            "followers_url": "https://api.github.com/users/russeree/followers",
            "following_url": "https://api.github.com/users/russeree/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/russeree/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/russeree/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/russeree/subscriptions",
            "organizations_url": "https://api.github.com/users/russeree/orgs",
            "repos_url": "https://api.github.com/users/russeree/repos",
            "events_url": "https://api.github.com/users/russeree/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/russeree/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29331",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29331",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29331.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29331.patch"
          },
          "created_at": "2024-01-26T21:44:46Z",
          "updated_at": "2024-02-05T12:57:18Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unlabeled",
      "id": 11689460814,
      "node_id": "UNLE_lADOABII585-FJRJzwAAAAK4vwRO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11689460814",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-02T21:02:13Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1862394105,
      "node_id": "PRR_kwDOABII585vAeD5",
      "url": null,
      "actor": null,
      "commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "lgtm",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1862394105",
      "submitted_at": "2024-02-05T11:12:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    },
    {
      "event": "reviewed",
      "id": 1862459885,
      "node_id": "PRR_kwDOABII585vAuHt",
      "url": null,
      "actor": null,
      "commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1862459885",
      "submitted_at": "2024-02-05T11:14:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    },
    {
      "event": "commented",
      "id": 1927200215,
      "node_id": "IC_kwDOABII585y3r3X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1927200215",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-05T15:00:52Z",
      "updated_at": "2024-02-05T15:00:52Z",
      "author_association": "MEMBER",
      "body": "Also, it would be good to include the test to ensure the crash no longer happens.\r\n\r\nhttps://github.com/bitcoin/bitcoin/issues/29261#issuecomment-1918947945",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1927200215",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "reviewed",
      "id": 1863282117,
      "node_id": "PRR_kwDOABII585vD23F",
      "url": null,
      "actor": null,
      "commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the close review! Will work on your suggestions",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1863282117",
      "submitted_at": "2024-02-05T17:24:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11710486424,
      "node_id": "HRFPE_lADOABII585-FJRJzwAAAAK5_9eY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11710486424",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-05T22:14:39Z"
    },
    {
      "event": "reviewed",
      "id": 1863598337,
      "node_id": "PRR_kwDOABII585vFEEB",
      "url": null,
      "actor": null,
      "commit_id": "3bdbc3fc7f116856acc7d955f591110b96f5ebd2",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Updated a3228f02f69e28960f7da76054965c916e781f27 -> 3bdbc3fc7f116856acc7d955f591110b96f5ebd2 ([`pr/nofake.2`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.2) -> [`pr/nofake.3`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.3), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nofake.2..pr/nofake.3)) implementing all suggestions, adding test coverage for the RPCs, and adding a new commit that drops the no longer needed BLOCK_ASSUMED_VALID flag.\r\nUpdated 3bdbc3fc7f116856acc7d955f591110b96f5ebd2 -> 603a92c9881ed78e29f15c48121ce8bf35d30837 ([`pr/nofake.3`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.3) -> [`pr/nofake.4`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.4), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nofake.3..pr/nofake.4)) removing more BLOCK_ASSUMED_VALID references",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1863598337",
      "submitted_at": "2024-02-05T22:29:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11710770846,
      "node_id": "HRFPE_lADOABII585-FJRJzwAAAAK6BC6e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11710770846",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-05T22:43:03Z"
    },
    {
      "event": "labeled",
      "id": 11710771656,
      "node_id": "LE_lADOABII585-FJRJzwAAAAK6BDHI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11710771656",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-05T22:43:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-06T02:58:36Z",
      "updated_at": "2024-02-06T02:58:36Z",
      "source": {
        "issue": {
          "id": 1865661446,
          "node_id": "PR_kwDOABII585YuJ5c",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28339",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28339/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28339/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28339/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28339",
          "number": 28339,
          "state": "open",
          "state_reason": null,
          "title": "validation: improve performance of CheckBlockIndex",
          "body": "`CheckBlockIndex() ` are consistency checks that are currently enabled by default on regtest.\r\n\r\nThe function is rather slow, which is annoying if you\r\n* attempt to run it on other networks, especially if not fully synced\r\n* want to generate a long chain on regtest and see block generation slow down because you forgot to disable `-checkblockindex` or don't know it existed.\r\n\r\nOne reason why it's slow is that in order to be able to traverse the block tree depth-first from genesis, it inserts pointers to all block indices into a `std::multimap` - for which inserts and lookups become slow once there are hundred thousands of entries.\r\nHowever, typically the block index is mostly chain-like with just a few forks so a multimap isn't really needed for the most part. This PR suggests to store the block indices of the chain ending in the best header in a vector instead, and store only the rest of the indices in a multimap. This does not change the actual consistency checks that are being performed for each index, just the way the block index tree is stored and traversed.\r\n\r\nThis adds a bit of complication to make sure each block is visited (note that there are asserts that check it), making sure that the two containers are traversed correctly, but it speeds up the function considerably:\r\n\r\nOn master, a single invocation of `CheckBlockIndex` takes ~1.4s on mainnet for me (4.9s on testnet which has >2.4 million blocks).\r\nWith this branch, the runtime goes down to ~0.27s (0.85s on testnet).This is a speedup by a factor ~5.",
          "user": {
            "login": "mzumsande",
            "id": 48763452,
            "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mzumsande",
            "html_url": "https://github.com/mzumsande",
            "followers_url": "https://api.github.com/users/mzumsande/followers",
            "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
            "organizations_url": "https://api.github.com/users/mzumsande/orgs",
            "repos_url": "https://api.github.com/users/mzumsande/repos",
            "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/mzumsande/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28339",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28339",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28339.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28339.patch"
          },
          "created_at": "2023-08-24T18:18:30Z",
          "updated_at": "2024-02-08T14:24:58Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1864200241,
      "node_id": "PRR_kwDOABII585vHXAx",
      "url": null,
      "actor": null,
      "commit_id": "603a92c9881ed78e29f15c48121ce8bf35d30837",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1864200241",
      "submitted_at": "2024-02-06T03:08:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    },
    {
      "event": "reviewed",
      "id": 1864605869,
      "node_id": "PRR_kwDOABII585vI6Ct",
      "url": null,
      "actor": null,
      "commit_id": "603a92c9881ed78e29f15c48121ce8bf35d30837",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1864605869",
      "submitted_at": "2024-02-06T09:02:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    },
    {
      "event": "commented",
      "id": 1929064411,
      "node_id": "IC_kwDOABII585y-y_b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1929064411",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-06T09:04:07Z",
      "updated_at": "2024-02-06T09:04:07Z",
      "author_association": "MEMBER",
      "body": "Needs rebase",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1929064411",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-06T20:08:55Z",
      "updated_at": "2024-02-06T20:08:55Z",
      "source": {
        "issue": {
          "id": 2085596644,
          "node_id": "I_kwDOABII5858T63k",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29258",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29258/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29258/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29258/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/29258",
          "number": 29258,
          "state": "open",
          "state_reason": null,
          "title": "Update nChainTx to 64bit type",
          "body": "https://github.com/bitcoin/bitcoin/blob/8106b268cde8e97a7c330afdda39b6bb55e5574a/src/chain.h#L178-L186\r\n\r\nHey, it's 2024! `nChainTx` seems to currently be 953368191 (height 826100), which is hex `38d3 3e7f`, so we're only 22% of the way to an overflow, and would still need another 200k blocks (~ four years) full of 60 byte transactions to get there.",
          "user": {
            "login": "ajtowns",
            "id": 127186,
            "node_id": "MDQ6VXNlcjEyNzE4Ng==",
            "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ajtowns",
            "html_url": "https://github.com/ajtowns",
            "followers_url": "https://api.github.com/users/ajtowns/followers",
            "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
            "organizations_url": "https://api.github.com/users/ajtowns/orgs",
            "repos_url": "https://api.github.com/users/ajtowns/repos",
            "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ajtowns/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 11,
          "created_at": "2024-01-17T07:42:30Z",
          "updated_at": "2024-02-08T16:42:40Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQyYmJlNDI3ZDMzNDAwY2U3NWU4MTJmNjY3Nzg3ZmI5NDNlYWNiM2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2bbe427d33400ce75e812f667787fb943eacb3c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d2bbe427d33400ce75e812f667787fb943eacb3c",
      "tree": {
        "sha": "4193e83f0b3a10a85569b6a005736479fc73cc36",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4193e83f0b3a10a85569b6a005736479fc73cc36"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b8990a1f3c49b0b02b7383c69e95320acbda13e",
          "sha": "5b8990a1f3c49b0b02b7383c69e95320acbda13e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5b8990a1f3c49b0b02b7383c69e95320acbda13e"
        }
      ],
      "message": "assumeutxo test: Add RPC test for fake nTx and nChainTx values\n\nThe fake values will be removed in the next commit, so it is useful to have\ntest coverage confirming the change in behavior.",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-07T00:45:04Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-05T21:16:14Z"
      },
      "sha": "d2bbe427d33400ce75e812f667787fb943eacb3c"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11725768291,
      "node_id": "HRFPE_lADOABII585-FJRJzwAAAAK66QZj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11725768291",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T01:03:18Z"
    },
    {
      "event": "commented",
      "id": 1931061991,
      "node_id": "IC_kwDOABII585zGarn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1931061991",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T01:07:56Z",
      "updated_at": "2024-02-07T01:07:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Needs rebase\r\n\r\nYes, thanks for recognizing the CI failures.\r\n\r\nRebased 603a92c9881ed78e29f15c48121ce8bf35d30837 -> 3f0b8607f549b27e9bb0cc8b189252a5cd954a36 ([`pr/nofake.4`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.4) -> [`pr/nofake.5`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.5), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nofake.4-rebase..pr/nofake.5)) with test fixes needed after silent conflict with #29354",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1931061991",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "unlabeled",
      "id": 11726155369,
      "node_id": "UNLE_lADOABII585-FJRJzwAAAAK67u5p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11726155369",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T01:59:38Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1931513793,
      "node_id": "IC_kwDOABII585zII_B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1931513793",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T08:25:29Z",
      "updated_at": "2024-02-07T08:25:29Z",
      "author_association": "MEMBER",
      "body": "Could include the test https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1927200215 , or did you want to leave that for later?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1931513793",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11736659660,
      "node_id": "HRFPE_lADOABII585-FJRJzwAAAAK7jzbM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11736659660",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T19:08:55Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T19:16:14Z",
      "updated_at": "2024-02-07T19:16:14Z",
      "source": {
        "issue": {
          "id": 2086334042,
          "node_id": "I_kwDOABII5858Wu5a",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29261",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29261/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29261/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29261/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/29261",
          "number": 29261,
          "state": "open",
          "state_reason": "reopened",
          "title": "assumeutxo: nTx and nChainTx violations in CheckBlockIndex",
          "body": "When disabling the \"test-only\" assumptions in CheckBlockIndex, the check fails. This is problematic, because test-only code should not affect the behavior of the program in production.\r\n\r\nCurrent diff:\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 8c583c586c..00d7ee3736 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -4866,9 +4866,9 @@ void ChainstateManager::CheckBlockIndex()\r\n         unsigned int prev_chain_tx = pindex->pprev ? pindex->pprev->nChainTx : 0;\r\n         assert((pindex->nChainTx == pindex->nTx + prev_chain_tx)\r\n                // For testing, allow transaction counts to be completely unset.\r\n-               || (pindex->nChainTx == 0 && pindex->nTx == 0)\r\n+               //|| (pindex->nChainTx == 0 && pindex->nTx == 0)\r\n                // For testing, allow this nChainTx to be unset if previous is also unset.\r\n-               || (pindex->nChainTx == 0 && prev_chain_tx == 0 && pindex->pprev)\r\n+               //|| (pindex->nChainTx == 0 && prev_chain_tx == 0 && pindex->pprev)\r\n                // Transaction counts prior to snapshot are unknown.\r\n                || pindex->IsAssumedValid());\r\n \r\n```\r\n\r\nSteps to reproduce the crash:\r\n\r\n```\r\n$ ./src/qt/bitcoin-qt -datadir=/tmp -regtest\r\n> generatetodescriptor 1 raw(ff)\r\n```\r\n\r\nRelated to https://github.com/bitcoin/bitcoin/pull/28791 and https://github.com/bitcoin/bitcoin/pull/28562#discussion_r1350470707",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 148216,
              "node_id": "MDU6TGFiZWwxNDgyMTY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Docs",
              "name": "Docs",
              "color": "02d7e1",
              "default": false
            },
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 19,
          "created_at": "2024-01-17T14:38:20Z",
          "updated_at": "2024-02-07T20:30:31Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1932712410,
      "node_id": "IC_kwDOABII585zMtna",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932712410",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T19:19:29Z",
      "updated_at": "2024-02-07T19:19:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1931513793\r\n\r\n> Could include the test [#29370 (comment)](https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1927200215) , or did you want to leave that for later?\r\n\r\nI had just forgotten about this. Added the test now, and fixed another bug uncovered by the test (forgetting to reset pindexFirstNeverProcessed after moving upwards from the snapshot block).\r\n\r\nUpdated 3f0b8607f549b27e9bb0cc8b189252a5cd954a36 -> 2f4e7e8dc82adb60a339211cdc15408b5a6919ce ([`pr/nofake.5`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.5) -> [`pr/nofake.6`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.6), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nofake.5..pr/nofake.6)) adding maflcko's test\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#issuecomment-1932712410",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29370"
    },
    {
      "event": "ready_for_review",
      "id": 11736979131,
      "node_id": "RFRE_lADOABII585-FJRJzwAAAAK7lBa7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11736979131",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T19:41:27Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg5ZDk1YmYxM2JiYzE1MWNlZmIxZjZmNzg5Y2YxYWM5NDI1NmUwYzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89d95bf13bbc151cefb1f6f789cf1ac94256e0c8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/89d95bf13bbc151cefb1f6f789cf1ac94256e0c8",
      "tree": {
        "sha": "781bada63089791671ae788437d9f14a648a0a40",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/781bada63089791671ae788437d9f14a648a0a40"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2bbe427d33400ce75e812f667787fb943eacb3c",
          "sha": "d2bbe427d33400ce75e812f667787fb943eacb3c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d2bbe427d33400ce75e812f667787fb943eacb3c"
        }
      ],
      "message": "validation: Check GuessVerificationProgress is not called with disconnected block\n\nUse Assume macro as suggested https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1479427801",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-08T16:37:19Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-08T16:37:19Z"
      },
      "sha": "89d95bf13bbc151cefb1f6f789cf1ac94256e0c8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDIwN2ExNzE3NjlhNjYyNDIxYzU0OTBmNmYzZGRjYTkwOThhZTNlNzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/207a171769a662421c5490f6f3ddca9098ae3e78",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/207a171769a662421c5490f6f3ddca9098ae3e78",
      "tree": {
        "sha": "9590e32498d5063c33808cf06d0d540f58db4067",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9590e32498d5063c33808cf06d0d540f58db4067"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89d95bf13bbc151cefb1f6f789cf1ac94256e0c8",
          "sha": "89d95bf13bbc151cefb1f6f789cf1ac94256e0c8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/89d95bf13bbc151cefb1f6f789cf1ac94256e0c8"
        }
      ],
      "message": "assumeutxo: Get rid of faked nTx and nChainTx values\n\nThe `PopulateAndValidateSnapshot` function introduced in\nf6e2da5fb7c6406c37612c838c998078ea8d2252 from #19806 has been setting fake\n`nTx` and `nChainTx` values that can show up in RPC results (see #29328) and\nmake `CBlockIndex` state hard to reason about, because it is difficult to know\nwhether the values are real or fake.\n\nRevert to previous behavior of setting `nTx` and `nChainTx` to 0 when the\nvalues are unknown, instead of faking them.\n\nThis commit fixes an assert failure in the (pindex->nChainTx == pindex->nTx +\nprev_chain_tx) check that would previously happen if a snapshot was loaded, and\na block was submitted which forked from the chain before the snapshot block and\nafter the last downloaded background chain block. This block would not be\nmarked assumed-valid because it would not be an ancestor of the snapshot, and\nit would have nTx set, nChainTx unset, and prev->nChainTx set with a fake\nvalue, so the assert would fail. After this commit, prev->nChainTx is unset\ninstead of being set to a fake value, so the assert succeeds. A test which\nsubmits a block like this and previously crashed the node has been added in\nfeature_assumeutxo.py. It was written and posted by maflcko in\nhttps://github.com/bitcoin/bitcoin/issues/29261#issuecomment-1918947945\n\nCompatibility note: This change could result in -checkblockindex failures if a\nsnapshot was loaded by a previous version of Bitcoin Core and not fully\nvalidated, because fake nTx values will have been saved to the block index. It\nwould be pretty easy to avoid these failures by adding some compatibility code\nto `LoadBlockIndex` and changing `nTx` values from 1 to 0 when they are fake\n(when `(pindex->nStatus & BLOCK_VALID_MASK) < BLOCK_VALID_TRANSACTIONS`), but a\nlittle simpler not to worry about being compatible in this case.\n\nCo-authored-by: MarcoFalke <*~=`'#}+{/-|&$^_@721217.xyz>",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-08T16:37:19Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-02T15:59:24Z"
      },
      "sha": "207a171769a662421c5490f6f3ddca9098ae3e78"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM5Y2E0Y2E0ZDk3MGY5ZDQyZDAyNTQ3NzVjMDRkMTE0YmQyMTUyYzM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "tree": {
        "sha": "c272707b107d32ea7181929a445a38f75a030dba",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c272707b107d32ea7181929a445a38f75a030dba"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/207a171769a662421c5490f6f3ddca9098ae3e78",
          "sha": "207a171769a662421c5490f6f3ddca9098ae3e78",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/207a171769a662421c5490f6f3ddca9098ae3e78"
        }
      ],
      "message": "Remove BLOCK_ASSUMED_VALID flag\n\nFlag adds complexity and is not currently used for anything.",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-08T16:37:19Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-02-05T22:10:27Z"
      },
      "sha": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11748590556,
      "node_id": "HRFPE_lADOABII585-FJRJzwAAAAK8RUPc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11748590556",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T16:47:26Z"
    },
    {
      "event": "reviewed",
      "id": 1870720275,
      "node_id": "PRR_kwDOABII585vgO0T",
      "url": null,
      "actor": null,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Updated 2f4e7e8dc82adb60a339211cdc15408b5a6919ce -> c9ca4ca4d970f9d42d0254775c04d114bd2152c3 ([`pr/nofake.6`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.6) -> [`pr/nofake.7`](https://github.com/ryanofsky/bitcoin/commits/pr/nofake.7), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nofake.6..pr/nofake.7)) added suggested unset nChainTx check in GuessVerificationProgress",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#pullrequestreview-1870720275",
      "submitted_at": "2024-02-08T16:48:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477981888",
      "pull_request_review_id": 1862394105,
      "id": 1477981888,
      "node_id": "PRRC_kwDOABII585YGDbA",
      "diff_hunk": "@@ -168,21 +169,18 @@ class CBlockIndex\n     //! (memory only) Total amount of work (expected number of hashes) in the chain up to and including this block\n     arith_uint256 nChainWork{};\n \n-    //! Number of transactions in this block.\n+    //! Number of transactions in this block. This will be nonzero if the block\n+    //! reached the VALID_TRANSACTIONS validity level, and zero otherwise.\n     //! Note: in a potential headers-first mode, this number cannot be relied upon\n     //! Note: this value is faked during UTXO snapshot load to ensure that\n     //! LoadBlockIndex() will load index entries for blocks that we lack data for.\n     //! @sa ActivateSnapshot\n     unsigned int nTx{0};\n \n     //! (memory only) Number of transactions in the chain up to and including this block.\n-    //! This value will be non-zero only if and only if transactions for this block and all its parents are available.\n-    //! Change to 64-bit type before 2024 (assuming worst case of 60 byte transactions).",
      "path": "src/chain.h",
      "position": 67,
      "original_position": 25,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Any reason to touch this LOC?",
      "created_at": "2024-02-05T10:39:14Z",
      "updated_at": "2024-02-05T11:12:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477981888",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477981888"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 185,
      "original_line": 185,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477996772",
      "pull_request_review_id": 1862394105,
      "id": 1477996772,
      "node_id": "PRRC_kwDOABII585YGHDk",
      "diff_hunk": "@@ -465,6 +465,12 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n         // Blocks with heights in range [91, 110] are marked ASSUMED_VALID\n         if (i < last_assumed_valid_idx && i >= assumed_valid_start_idx) {\n             index->nStatus = BlockStatus::BLOCK_VALID_TREE | BlockStatus::BLOCK_ASSUMED_VALID;\n+            index->nTx = 0;\n+            // Keep nChainTx for the snapshot base since it is part of the\n+            // snapshot metadata. Reset it for other blocks this is simulating\n+            // not having been downloaded yet.\n+            if (i < last_assumed_valid_idx == 1) index->nChainTx = 0;",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            index->nChainTx = 0;\r\n```\r\n\r\nisn't this always true? Maybe you meant to type `-` instead of `<`?\r\n\r\nIn any case, the test seems to be passing either way, so this is \"dead\" code, similar to a code comment.",
      "created_at": "2024-02-05T10:51:34Z",
      "updated_at": "2024-02-05T11:12:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477996772",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477996772"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477998490",
      "pull_request_review_id": 1862394105,
      "id": 1477998490,
      "node_id": "PRRC_kwDOABII585YGHea",
      "diff_hunk": "@@ -91,13 +91,10 @@ CreateAndActivateUTXOSnapshot(\n             // these blocks instead\n             CBlockIndex *pindex = orig_tip;\n             while (pindex && pindex != chain.m_chain.Tip()) {\n-                pindex->nStatus &= ~BLOCK_HAVE_DATA;\n-                pindex->nStatus &= ~BLOCK_HAVE_UNDO;\n-                // We have to set the ASSUMED_VALID flag, because otherwise it\n-                // would not be possible to have a block index entry without HAVE_DATA\n-                // and with nTx > 0 (since we aren't setting the pruned flag);\n-                // see CheckBlockIndex().\n-                pindex->nStatus |= BLOCK_ASSUMED_VALID;\n+                pindex->nStatus = BlockStatus::BLOCK_VALID_TREE;\n+                pindex->nTx = 0;\n+                pindex->nChainTx = 0;\n+                pindex->nSequenceId = 0;",
      "path": "src/test/util/chainstate.h",
      "position": 20,
      "original_position": 14,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Any reason to change the sequence id? I think this isn't changed in `loadtxoutset` either?",
      "created_at": "2024-02-05T10:53:08Z",
      "updated_at": "2024-02-05T11:12:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477998490",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477998490"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 103,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477998941",
      "pull_request_review_id": 1862394105,
      "id": 1477998941,
      "node_id": "PRRC_kwDOABII585YGHld",
      "diff_hunk": "@@ -465,6 +465,12 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n         // Blocks with heights in range [91, 110] are marked ASSUMED_VALID\n         if (i < last_assumed_valid_idx && i >= assumed_valid_start_idx) {\n             index->nStatus = BlockStatus::BLOCK_VALID_TREE | BlockStatus::BLOCK_ASSUMED_VALID;\n+            index->nTx = 0;\n+            // Keep nChainTx for the snapshot base since it is part of the\n+            // snapshot metadata. Reset it for other blocks this is simulating\n+            // not having been downloaded yet.\n+            if (i < last_assumed_valid_idx == 1) index->nChainTx = 0;\n+            index->nSequenceId = 0;",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Same (sequence id)",
      "created_at": "2024-02-05T10:53:33Z",
      "updated_at": "2024-02-05T11:12:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477998941",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1477998941"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 473,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478006900",
      "pull_request_review_id": 1862394105,
      "id": 1478006900,
      "node_id": "PRRC_kwDOABII585YGJh0",
      "diff_hunk": "@@ -4577,15 +4577,7 @@ bool ChainstateManager::LoadBlockIndex()\n \n         for (CBlockIndex* pindex : vSortedByHeight) {\n             if (m_interrupt) return false;\n-            // If we have an assumeutxo-based chainstate, then the snapshot\n-            // block will be a candidate for the tip, but it may not be\n-            // VALID_TRANSACTIONS (eg if we haven't yet downloaded the block),\n-            // so we special-case the snapshot block as a potential candidate\n-            // here.\n-            if (pindex == GetSnapshotBaseBlock() ||\n-                    (pindex->IsValid(BLOCK_VALID_TRANSACTIONS) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is removing the validity check intended?",
      "created_at": "2024-02-05T11:00:32Z",
      "updated_at": "2024-02-05T11:12:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478006900",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478006900"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4585,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478018977",
      "pull_request_review_id": 1862394105,
      "id": 1478018977,
      "node_id": "PRRC_kwDOABII585YGMeh",
      "diff_hunk": "@@ -4903,36 +4890,23 @@ void ChainstateManager::CheckBlockIndex()\n         if (!pindex->HaveNumChainTxs()) assert(pindex->nSequenceId <= 0); // nSequenceId can't be set positive for blocks that aren't linked (negative is used for preciousblock)\n         // VALID_TRANSACTIONS is equivalent to nTx > 0 for all nodes (whether or not pruning has occurred).\n         // HAVE_DATA is only equivalent to nTx > 0 (or VALID_TRANSACTIONS) if no pruning has occurred.\n-        // Unless these indexes are assumed valid and pending block download on a\n-        // background chainstate.\n-        if (!m_blockman.m_have_pruned && !pindex->IsAssumedValid()) {\n+        if (!m_blockman.m_have_pruned) {\n             // If we've never pruned, then HAVE_DATA should be equivalent to nTx > 0\n             assert(!(pindex->nStatus & BLOCK_HAVE_DATA) == (pindex->nTx == 0));\n-            if (pindexFirstAssumeValid == nullptr) {\n-                // If we've got some assume valid blocks, then we might have\n-                // missing blocks (not HAVE_DATA) but still treat them as\n-                // having been processed (with a fake nTx value). Otherwise, we\n-                // can assert that these are the same.\n-                assert(pindexFirstMissing == pindexFirstNeverProcessed);\n-            }\n+            assert(pindexFirstMissing == pindexFirstNeverProcessed);\n         } else {\n             // If we have pruned, then we can only say that HAVE_DATA implies nTx > 0\n             if (pindex->nStatus & BLOCK_HAVE_DATA) assert(pindex->nTx > 0);\n         }\n         if (pindex->nStatus & BLOCK_HAVE_UNDO) assert(pindex->nStatus & BLOCK_HAVE_DATA);\n-        if (pindex->IsAssumedValid()) {\n-            // Assumed-valid blocks should have some nTx value.\n-            assert(pindex->nTx > 0);\n-            // Assumed-valid blocks should connect to the main chain.\n-            assert((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TREE);\n-        } else {\n-            // Otherwise there should only be an nTx value if we have\n-            // actually seen a block's transactions.\n-            assert(((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TRANSACTIONS) == (pindex->nTx > 0)); // This is pruning-independent.\n-        }\n+        // There there should only be an nTx value if we have\n+        // actually seen a block's transactions.\n+        assert(((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TRANSACTIONS) == (pindex->nTx > 0)); // This is pruning-independent.\n         // All parents having had data (at some point) is equivalent to all parents being VALID_TRANSACTIONS, which is equivalent to HaveNumChainTxs().\n-        assert((pindexFirstNeverProcessed == nullptr) == pindex->HaveNumChainTxs());\n-        assert((pindexFirstNotTransactionsValid == nullptr) == pindex->HaveNumChainTxs());\n+        // HaveNumChainTxs will also be set in the assumeutxo snapshot block from snapshot metadata.\n+        const bool snap_block = pindex == GetSnapshotBaseBlock();",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can this be further limited to only mark the snap_block if it has ASSUMED_VALID set? Otherwise, nodes which never used loadtxoutset will assume that some block is a \"snapshot block\", even though they never used that feature.",
      "created_at": "2024-02-05T11:11:04Z",
      "updated_at": "2024-02-05T11:12:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478018977",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478018977"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4907,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478022794",
      "pull_request_review_id": 1862459885,
      "id": 1478022794,
      "node_id": "PRRC_kwDOABII585YGNaK",
      "diff_hunk": "@@ -4903,36 +4890,23 @@ void ChainstateManager::CheckBlockIndex()\n         if (!pindex->HaveNumChainTxs()) assert(pindex->nSequenceId <= 0); // nSequenceId can't be set positive for blocks that aren't linked (negative is used for preciousblock)\n         // VALID_TRANSACTIONS is equivalent to nTx > 0 for all nodes (whether or not pruning has occurred).\n         // HAVE_DATA is only equivalent to nTx > 0 (or VALID_TRANSACTIONS) if no pruning has occurred.\n-        // Unless these indexes are assumed valid and pending block download on a\n-        // background chainstate.\n-        if (!m_blockman.m_have_pruned && !pindex->IsAssumedValid()) {\n+        if (!m_blockman.m_have_pruned) {\n             // If we've never pruned, then HAVE_DATA should be equivalent to nTx > 0\n             assert(!(pindex->nStatus & BLOCK_HAVE_DATA) == (pindex->nTx == 0));\n-            if (pindexFirstAssumeValid == nullptr) {\n-                // If we've got some assume valid blocks, then we might have\n-                // missing blocks (not HAVE_DATA) but still treat them as\n-                // having been processed (with a fake nTx value). Otherwise, we\n-                // can assert that these are the same.\n-                assert(pindexFirstMissing == pindexFirstNeverProcessed);\n-            }\n+            assert(pindexFirstMissing == pindexFirstNeverProcessed);\n         } else {\n             // If we have pruned, then we can only say that HAVE_DATA implies nTx > 0\n             if (pindex->nStatus & BLOCK_HAVE_DATA) assert(pindex->nTx > 0);\n         }\n         if (pindex->nStatus & BLOCK_HAVE_UNDO) assert(pindex->nStatus & BLOCK_HAVE_DATA);\n-        if (pindex->IsAssumedValid()) {\n-            // Assumed-valid blocks should have some nTx value.\n-            assert(pindex->nTx > 0);\n-            // Assumed-valid blocks should connect to the main chain.\n-            assert((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TREE);",
      "path": "src/validation.cpp",
      "position": 79,
      "original_position": 78,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Any reason to remove this check?",
      "created_at": "2024-02-05T11:14:35Z",
      "updated_at": "2024-02-05T11:14:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478022794",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478022794"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4926,
      "original_line": 4926,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478549351",
      "pull_request_review_id": 1863282117,
      "id": 1478549351,
      "node_id": "PRRC_kwDOABII585YIN9n",
      "diff_hunk": "@@ -168,21 +169,18 @@ class CBlockIndex\n     //! (memory only) Total amount of work (expected number of hashes) in the chain up to and including this block\n     arith_uint256 nChainWork{};\n \n-    //! Number of transactions in this block.\n+    //! Number of transactions in this block. This will be nonzero if the block\n+    //! reached the VALID_TRANSACTIONS validity level, and zero otherwise.\n     //! Note: in a potential headers-first mode, this number cannot be relied upon\n     //! Note: this value is faked during UTXO snapshot load to ensure that\n     //! LoadBlockIndex() will load index entries for blocks that we lack data for.\n     //! @sa ActivateSnapshot\n     unsigned int nTx{0};\n \n     //! (memory only) Number of transactions in the chain up to and including this block.\n-    //! This value will be non-zero only if and only if transactions for this block and all its parents are available.\n-    //! Change to 64-bit type before 2024 (assuming worst case of 60 byte transactions).",
      "path": "src/chain.h",
      "position": 67,
      "original_position": 25,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477981888,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477981888\r\n\r\n> Any reason to touch this LOC?\r\n\r\nNo, will restore. I only meant to update the comments around it.",
      "created_at": "2024-02-05T16:40:57Z",
      "updated_at": "2024-02-05T17:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478549351",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478549351"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 185,
      "original_line": 185,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478561706",
      "pull_request_review_id": 1863282117,
      "id": 1478561706,
      "node_id": "PRRC_kwDOABII585YIQ-q",
      "diff_hunk": "@@ -91,13 +91,10 @@ CreateAndActivateUTXOSnapshot(\n             // these blocks instead\n             CBlockIndex *pindex = orig_tip;\n             while (pindex && pindex != chain.m_chain.Tip()) {\n-                pindex->nStatus &= ~BLOCK_HAVE_DATA;\n-                pindex->nStatus &= ~BLOCK_HAVE_UNDO;\n-                // We have to set the ASSUMED_VALID flag, because otherwise it\n-                // would not be possible to have a block index entry without HAVE_DATA\n-                // and with nTx > 0 (since we aren't setting the pruned flag);\n-                // see CheckBlockIndex().\n-                pindex->nStatus |= BLOCK_ASSUMED_VALID;\n+                pindex->nStatus = BlockStatus::BLOCK_VALID_TREE;\n+                pindex->nTx = 0;\n+                pindex->nChainTx = 0;\n+                pindex->nSequenceId = 0;",
      "path": "src/test/util/chainstate.h",
      "position": 20,
      "original_position": 14,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477998490,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477998490\r\n\r\n> Any reason to change the sequence id? I think this isn't changed in `loadtxoutset` either?\r\n\r\nI'll double check and add a comment. I think this might be needed to satisfy an assert that ensures nChainTx is set if nSequenceId is set, since these are both set when a block is received and all blocks before it have also been received.",
      "created_at": "2024-02-05T16:43:34Z",
      "updated_at": "2024-02-05T17:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478561706",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478561706"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 103,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478567668",
      "pull_request_review_id": 1863282117,
      "id": 1478567668,
      "node_id": "PRRC_kwDOABII585YISb0",
      "diff_hunk": "@@ -465,6 +465,12 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n         // Blocks with heights in range [91, 110] are marked ASSUMED_VALID\n         if (i < last_assumed_valid_idx && i >= assumed_valid_start_idx) {\n             index->nStatus = BlockStatus::BLOCK_VALID_TREE | BlockStatus::BLOCK_ASSUMED_VALID;\n+            index->nTx = 0;\n+            // Keep nChainTx for the snapshot base since it is part of the\n+            // snapshot metadata. Reset it for other blocks this is simulating\n+            // not having been downloaded yet.\n+            if (i < last_assumed_valid_idx == 1) index->nChainTx = 0;",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477996772,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477996772\r\n\r\n> isn't this always true? Maybe you meant to type `-` instead of `<`?\r\n> \r\n> In any case, the test seems to be passing either way, so this is \"dead\" code, similar to a code comment.\r\n\r\nI think it was supposed to be i < last_assumed_valid_idx - 1, to preserve nChainTx in the snapshot block, and only set nChainTx to 0 before the snapshot block, so the test matches what happens in reality. But it does seem like this is not necessary so will simplify.",
      "created_at": "2024-02-05T16:47:16Z",
      "updated_at": "2024-02-05T17:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478567668",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478567668"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478584012",
      "pull_request_review_id": 1863282117,
      "id": 1478584012,
      "node_id": "PRRC_kwDOABII585YIWbM",
      "diff_hunk": "@@ -4577,15 +4577,7 @@ bool ChainstateManager::LoadBlockIndex()\n \n         for (CBlockIndex* pindex : vSortedByHeight) {\n             if (m_interrupt) return false;\n-            // If we have an assumeutxo-based chainstate, then the snapshot\n-            // block will be a candidate for the tip, but it may not be\n-            // VALID_TRANSACTIONS (eg if we haven't yet downloaded the block),\n-            // so we special-case the snapshot block as a potential candidate\n-            // here.\n-            if (pindex == GetSnapshotBaseBlock() ||\n-                    (pindex->IsValid(BLOCK_VALID_TRANSACTIONS) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1478006900,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478006900\r\n\r\n> Is removing the validity check intended?\r\n\r\nIt was intended, but on second thought it is probably better to add back. The reason for removing it is that the block reaching VALID_TRANSACTIONS level is not really significant, because what is actually needed is for the block and all its ancestors back to the snapshot block or genesis block to reach VALID_TRANACTIONS level, and HaveNumChainTxs() is the direct and efficient way to check for that.\r\n\r\nBut it should still be useful to call the IsValid() function because it additionally checks for BLOCK_FAILED flags. So it would be good to add back to avoid changing behavior, and be more efficient if there are invalid blocks.",
      "created_at": "2024-02-05T16:59:53Z",
      "updated_at": "2024-02-05T17:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478584012",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478584012"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4585,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478594492",
      "pull_request_review_id": 1863282117,
      "id": 1478594492,
      "node_id": "PRRC_kwDOABII585YIY-8",
      "diff_hunk": "@@ -4903,36 +4890,23 @@ void ChainstateManager::CheckBlockIndex()\n         if (!pindex->HaveNumChainTxs()) assert(pindex->nSequenceId <= 0); // nSequenceId can't be set positive for blocks that aren't linked (negative is used for preciousblock)\n         // VALID_TRANSACTIONS is equivalent to nTx > 0 for all nodes (whether or not pruning has occurred).\n         // HAVE_DATA is only equivalent to nTx > 0 (or VALID_TRANSACTIONS) if no pruning has occurred.\n-        // Unless these indexes are assumed valid and pending block download on a\n-        // background chainstate.\n-        if (!m_blockman.m_have_pruned && !pindex->IsAssumedValid()) {\n+        if (!m_blockman.m_have_pruned) {\n             // If we've never pruned, then HAVE_DATA should be equivalent to nTx > 0\n             assert(!(pindex->nStatus & BLOCK_HAVE_DATA) == (pindex->nTx == 0));\n-            if (pindexFirstAssumeValid == nullptr) {\n-                // If we've got some assume valid blocks, then we might have\n-                // missing blocks (not HAVE_DATA) but still treat them as\n-                // having been processed (with a fake nTx value). Otherwise, we\n-                // can assert that these are the same.\n-                assert(pindexFirstMissing == pindexFirstNeverProcessed);\n-            }\n+            assert(pindexFirstMissing == pindexFirstNeverProcessed);\n         } else {\n             // If we have pruned, then we can only say that HAVE_DATA implies nTx > 0\n             if (pindex->nStatus & BLOCK_HAVE_DATA) assert(pindex->nTx > 0);\n         }\n         if (pindex->nStatus & BLOCK_HAVE_UNDO) assert(pindex->nStatus & BLOCK_HAVE_DATA);\n-        if (pindex->IsAssumedValid()) {\n-            // Assumed-valid blocks should have some nTx value.\n-            assert(pindex->nTx > 0);\n-            // Assumed-valid blocks should connect to the main chain.\n-            assert((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TREE);",
      "path": "src/validation.cpp",
      "position": 79,
      "original_position": 78,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1478022794,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478022794\r\n\r\n> Any reason to remove this check?\r\n\r\nNo, good catch, I'll add it back. I was thinking it wasn't really related to the other checks here, and trying to eliminate unnecessary uses of BLOCK_ASSUMED_VALID / IsAssumedValid in general. But as long as we have the assumed valid flag, might as well check this.",
      "created_at": "2024-02-05T17:08:36Z",
      "updated_at": "2024-02-05T17:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478594492",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478594492"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4926,
      "original_line": 4926,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478604893",
      "pull_request_review_id": 1863282117,
      "id": 1478604893,
      "node_id": "PRRC_kwDOABII585YIbhd",
      "diff_hunk": "@@ -4903,36 +4890,23 @@ void ChainstateManager::CheckBlockIndex()\n         if (!pindex->HaveNumChainTxs()) assert(pindex->nSequenceId <= 0); // nSequenceId can't be set positive for blocks that aren't linked (negative is used for preciousblock)\n         // VALID_TRANSACTIONS is equivalent to nTx > 0 for all nodes (whether or not pruning has occurred).\n         // HAVE_DATA is only equivalent to nTx > 0 (or VALID_TRANSACTIONS) if no pruning has occurred.\n-        // Unless these indexes are assumed valid and pending block download on a\n-        // background chainstate.\n-        if (!m_blockman.m_have_pruned && !pindex->IsAssumedValid()) {\n+        if (!m_blockman.m_have_pruned) {\n             // If we've never pruned, then HAVE_DATA should be equivalent to nTx > 0\n             assert(!(pindex->nStatus & BLOCK_HAVE_DATA) == (pindex->nTx == 0));\n-            if (pindexFirstAssumeValid == nullptr) {\n-                // If we've got some assume valid blocks, then we might have\n-                // missing blocks (not HAVE_DATA) but still treat them as\n-                // having been processed (with a fake nTx value). Otherwise, we\n-                // can assert that these are the same.\n-                assert(pindexFirstMissing == pindexFirstNeverProcessed);\n-            }\n+            assert(pindexFirstMissing == pindexFirstNeverProcessed);\n         } else {\n             // If we have pruned, then we can only say that HAVE_DATA implies nTx > 0\n             if (pindex->nStatus & BLOCK_HAVE_DATA) assert(pindex->nTx > 0);\n         }\n         if (pindex->nStatus & BLOCK_HAVE_UNDO) assert(pindex->nStatus & BLOCK_HAVE_DATA);\n-        if (pindex->IsAssumedValid()) {\n-            // Assumed-valid blocks should have some nTx value.\n-            assert(pindex->nTx > 0);\n-            // Assumed-valid blocks should connect to the main chain.\n-            assert((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TREE);\n-        } else {\n-            // Otherwise there should only be an nTx value if we have\n-            // actually seen a block's transactions.\n-            assert(((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TRANSACTIONS) == (pindex->nTx > 0)); // This is pruning-independent.\n-        }\n+        // There there should only be an nTx value if we have\n+        // actually seen a block's transactions.\n+        assert(((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TRANSACTIONS) == (pindex->nTx > 0)); // This is pruning-independent.\n         // All parents having had data (at some point) is equivalent to all parents being VALID_TRANSACTIONS, which is equivalent to HaveNumChainTxs().\n-        assert((pindexFirstNeverProcessed == nullptr) == pindex->HaveNumChainTxs());\n-        assert((pindexFirstNotTransactionsValid == nullptr) == pindex->HaveNumChainTxs());\n+        // HaveNumChainTxs will also be set in the assumeutxo snapshot block from snapshot metadata.\n+        const bool snap_block = pindex == GetSnapshotBaseBlock();",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1478018977,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478018977\r\n\r\n> Can this be further limited to only mark the snap_block if it has ASSUMED_VALID set? Otherwise, nodes which never used loadtxoutset will assume that some block is a \"snapshot block\", even though they never used that feature.\r\n\r\nI'm pretty sure I can do that, but it should not change anything. If loadtxoutset is not used, GetSnapshotBaseBlock will return null and snap_block should already be false. The only case where the suggestion would change the checks performed (when GetSnapshotBaseBlock() == pindex && !pindex->IsAssumedValid()) is the case where background chain has been downloaded and fully validated, and the snapshot block loses it's assumed_valid flag after it become validated. In that case, none of the snap_block conditions will ever be reached. Whether a snapshot block is still considered a snapshot block after the snapshot is validated is just a semantic question.",
      "created_at": "2024-02-05T17:17:43Z",
      "updated_at": "2024-02-05T17:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478604893",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478604893"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4907,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478757569",
      "pull_request_review_id": 1863598337,
      "id": 1478757569,
      "node_id": "PRRC_kwDOABII585YJAzB",
      "diff_hunk": "@@ -91,13 +91,10 @@ CreateAndActivateUTXOSnapshot(\n             // these blocks instead\n             CBlockIndex *pindex = orig_tip;\n             while (pindex && pindex != chain.m_chain.Tip()) {\n-                pindex->nStatus &= ~BLOCK_HAVE_DATA;\n-                pindex->nStatus &= ~BLOCK_HAVE_UNDO;\n-                // We have to set the ASSUMED_VALID flag, because otherwise it\n-                // would not be possible to have a block index entry without HAVE_DATA\n-                // and with nTx > 0 (since we aren't setting the pruned flag);\n-                // see CheckBlockIndex().\n-                pindex->nStatus |= BLOCK_ASSUMED_VALID;\n+                pindex->nStatus = BlockStatus::BLOCK_VALID_TREE;\n+                pindex->nTx = 0;\n+                pindex->nChainTx = 0;\n+                pindex->nSequenceId = 0;",
      "path": "src/test/util/chainstate.h",
      "position": 20,
      "original_position": 14,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477998490,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477998490\r\n\r\nAdded a comment. It is necessary to set nSequenceId to avoid an assert failure in CheckBlockIndex. I think it's also a reasonable thing to do to make the block look like it was never received.",
      "created_at": "2024-02-05T19:03:01Z",
      "updated_at": "2024-02-05T22:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478757569",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478757569"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 103,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478766159",
      "pull_request_review_id": 1863598337,
      "id": 1478766159,
      "node_id": "PRRC_kwDOABII585YJC5P",
      "diff_hunk": "@@ -465,6 +465,12 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n         // Blocks with heights in range [91, 110] are marked ASSUMED_VALID\n         if (i < last_assumed_valid_idx && i >= assumed_valid_start_idx) {\n             index->nStatus = BlockStatus::BLOCK_VALID_TREE | BlockStatus::BLOCK_ASSUMED_VALID;\n+            index->nTx = 0;\n+            // Keep nChainTx for the snapshot base since it is part of the\n+            // snapshot metadata. Reset it for other blocks this is simulating\n+            // not having been downloaded yet.\n+            if (i < last_assumed_valid_idx == 1) index->nChainTx = 0;",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477996772,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477996772\r\n\r\nThanks, removed this",
      "created_at": "2024-02-05T19:12:18Z",
      "updated_at": "2024-02-05T22:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478766159",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478766159"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478766291",
      "pull_request_review_id": 1863598337,
      "id": 1478766291,
      "node_id": "PRRC_kwDOABII585YJC7T",
      "diff_hunk": "@@ -465,6 +465,12 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n         // Blocks with heights in range [91, 110] are marked ASSUMED_VALID\n         if (i < last_assumed_valid_idx && i >= assumed_valid_start_idx) {\n             index->nStatus = BlockStatus::BLOCK_VALID_TREE | BlockStatus::BLOCK_ASSUMED_VALID;\n+            index->nTx = 0;\n+            // Keep nChainTx for the snapshot base since it is part of the\n+            // snapshot metadata. Reset it for other blocks this is simulating\n+            // not having been downloaded yet.\n+            if (i < last_assumed_valid_idx == 1) index->nChainTx = 0;\n+            index->nSequenceId = 0;",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477998941,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477998941\r\n\r\n> Same (sequence id)\r\n\r\nThanks, removed this",
      "created_at": "2024-02-05T19:12:26Z",
      "updated_at": "2024-02-05T22:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478766291",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478766291"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 473,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478776687",
      "pull_request_review_id": 1863598337,
      "id": 1478776687,
      "node_id": "PRRC_kwDOABII585YJFdv",
      "diff_hunk": "@@ -4577,15 +4577,7 @@ bool ChainstateManager::LoadBlockIndex()\n \n         for (CBlockIndex* pindex : vSortedByHeight) {\n             if (m_interrupt) return false;\n-            // If we have an assumeutxo-based chainstate, then the snapshot\n-            // block will be a candidate for the tip, but it may not be\n-            // VALID_TRANSACTIONS (eg if we haven't yet downloaded the block),\n-            // so we special-case the snapshot block as a potential candidate\n-            // here.\n-            if (pindex == GetSnapshotBaseBlock() ||\n-                    (pindex->IsValid(BLOCK_VALID_TRANSACTIONS) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1478006900,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478006900\r\n\r\nThanks, reverted this",
      "created_at": "2024-02-05T19:23:17Z",
      "updated_at": "2024-02-05T22:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478776687",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478776687"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4585,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478943273",
      "pull_request_review_id": 1863598337,
      "id": 1478943273,
      "node_id": "PRRC_kwDOABII585YJuIp",
      "diff_hunk": "@@ -168,21 +169,18 @@ class CBlockIndex\n     //! (memory only) Total amount of work (expected number of hashes) in the chain up to and including this block\n     arith_uint256 nChainWork{};\n \n-    //! Number of transactions in this block.\n+    //! Number of transactions in this block. This will be nonzero if the block\n+    //! reached the VALID_TRANSACTIONS validity level, and zero otherwise.\n     //! Note: in a potential headers-first mode, this number cannot be relied upon\n     //! Note: this value is faked during UTXO snapshot load to ensure that\n     //! LoadBlockIndex() will load index entries for blocks that we lack data for.\n     //! @sa ActivateSnapshot\n     unsigned int nTx{0};\n \n     //! (memory only) Number of transactions in the chain up to and including this block.\n-    //! This value will be non-zero only if and only if transactions for this block and all its parents are available.\n-    //! Change to 64-bit type before 2024 (assuming worst case of 60 byte transactions).",
      "path": "src/chain.h",
      "position": 67,
      "original_position": 25,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1477981888,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1477981888\r\n\r\nThanks, restored this line",
      "created_at": "2024-02-05T21:46:40Z",
      "updated_at": "2024-02-05T22:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478943273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478943273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 185,
      "original_line": 185,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478947294",
      "pull_request_review_id": 1863598337,
      "id": 1478947294,
      "node_id": "PRRC_kwDOABII585YJvHe",
      "diff_hunk": "@@ -4903,36 +4890,23 @@ void ChainstateManager::CheckBlockIndex()\n         if (!pindex->HaveNumChainTxs()) assert(pindex->nSequenceId <= 0); // nSequenceId can't be set positive for blocks that aren't linked (negative is used for preciousblock)\n         // VALID_TRANSACTIONS is equivalent to nTx > 0 for all nodes (whether or not pruning has occurred).\n         // HAVE_DATA is only equivalent to nTx > 0 (or VALID_TRANSACTIONS) if no pruning has occurred.\n-        // Unless these indexes are assumed valid and pending block download on a\n-        // background chainstate.\n-        if (!m_blockman.m_have_pruned && !pindex->IsAssumedValid()) {\n+        if (!m_blockman.m_have_pruned) {\n             // If we've never pruned, then HAVE_DATA should be equivalent to nTx > 0\n             assert(!(pindex->nStatus & BLOCK_HAVE_DATA) == (pindex->nTx == 0));\n-            if (pindexFirstAssumeValid == nullptr) {\n-                // If we've got some assume valid blocks, then we might have\n-                // missing blocks (not HAVE_DATA) but still treat them as\n-                // having been processed (with a fake nTx value). Otherwise, we\n-                // can assert that these are the same.\n-                assert(pindexFirstMissing == pindexFirstNeverProcessed);\n-            }\n+            assert(pindexFirstMissing == pindexFirstNeverProcessed);\n         } else {\n             // If we have pruned, then we can only say that HAVE_DATA implies nTx > 0\n             if (pindex->nStatus & BLOCK_HAVE_DATA) assert(pindex->nTx > 0);\n         }\n         if (pindex->nStatus & BLOCK_HAVE_UNDO) assert(pindex->nStatus & BLOCK_HAVE_DATA);\n-        if (pindex->IsAssumedValid()) {\n-            // Assumed-valid blocks should have some nTx value.\n-            assert(pindex->nTx > 0);\n-            // Assumed-valid blocks should connect to the main chain.\n-            assert((pindex->nStatus & BLOCK_VALID_MASK) >= BLOCK_VALID_TREE);",
      "path": "src/validation.cpp",
      "position": 79,
      "original_position": 78,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "a3228f02f69e28960f7da76054965c916e781f27",
      "in_reply_to_id": 1478022794,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478022794\r\n\r\nRestored this check",
      "created_at": "2024-02-05T21:51:28Z",
      "updated_at": "2024-02-05T22:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1478947294",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1478947294"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4926,
      "original_line": 4926,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1479169504",
      "pull_request_review_id": 1864200241,
      "id": 1479169504,
      "node_id": "PRRC_kwDOABII585YKlXg",
      "diff_hunk": "@@ -5531,14 +5536,6 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     for (int i = AFTER_GENESIS_START; i <= snapshot_chainstate.m_chain.Height(); ++i) {\n         index = snapshot_chainstate.m_chain[i];\n \n-        // Fake nTx so that LoadBlockIndex() loads assumed-valid CBlockIndex\n-        // entries (among other things)\n-        if (!index->nTx) {\n-            index->nTx = 1;\n-        }\n-        // Fake nChainTx so that GuessVerificationProgress reports accurately",
      "path": "src/validation.cpp",
      "position": 214,
      "original_position": 176,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "59a8ca9333d2a618c989fb9c4cc7276068f658c7",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Would `GuessVerificationProgress` lose accuracy with the removal or was the comment wrong?",
      "created_at": "2024-02-06T03:07:51Z",
      "updated_at": "2024-02-06T03:08:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1479169504",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1479169504"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5538,
      "original_line": 5538,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1479427801",
      "pull_request_review_id": 1864604493,
      "id": 1479427801,
      "node_id": "PRRC_kwDOABII585YLkbZ",
      "diff_hunk": "@@ -5531,14 +5536,6 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     for (int i = AFTER_GENESIS_START; i <= snapshot_chainstate.m_chain.Height(); ++i) {\n         index = snapshot_chainstate.m_chain[i];\n \n-        // Fake nTx so that LoadBlockIndex() loads assumed-valid CBlockIndex\n-        // entries (among other things)\n-        if (!index->nTx) {\n-            index->nTx = 1;\n-        }\n-        // Fake nChainTx so that GuessVerificationProgress reports accurately",
      "path": "src/validation.cpp",
      "position": 214,
      "original_position": 176,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "59a8ca9333d2a618c989fb9c4cc7276068f658c7",
      "in_reply_to_id": 1479169504,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the comment was wrong, or do you have a code path where nChainTx is read when it was wrong (previously) or is unset (now)?\r\n\r\nGenerally, `GuessVerificationProgress` is only called to estimate the IBD progress at the tip, in which case nChainTx is set to the correct value. It is also used to guess rescan progress, which is not possible for blocks outside the active chain or blocks that have data missing, so nChainTx should be correct there as well.\r\n\r\nunrelated to this pull: Maybe an `Assume(nchaintx)` can be added to `GuessVerificationProgress`?",
      "created_at": "2024-02-06T09:01:17Z",
      "updated_at": "2024-02-06T09:01:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1479427801",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1479427801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5538,
      "original_line": 5538,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1479428612",
      "pull_request_review_id": 1864605869,
      "id": 1479428612,
      "node_id": "PRRC_kwDOABII585YLkoE",
      "diff_hunk": "@@ -199,6 +199,34 @@ def run_test(self):\n         assert_equal(loaded['coins_loaded'], SNAPSHOT_BASE_HEIGHT)\n         assert_equal(loaded['base_height'], SNAPSHOT_BASE_HEIGHT)\n \n+        # After loading the snapshot, check nTx values in the starting block\n+        # before loading the snapshot, the first block after it, the last block\n+        # before the snapshot block, and the snapshot block.\n+        start_hash = n1.getblockhash(height=START_HEIGHT)\n+        start_next_hash = n1.getblockhash(height=START_HEIGHT+1)\n+        snapshot_prev_hash = n1.getblockhash(height=SNAPSHOT_BASE_HEIGHT-1)\n+        snapshot_hash = n1.getblockhash(height=SNAPSHOT_BASE_HEIGHT)\n+        assert_equal(n1.getblockheader(start_hash)[\"nTx\"], 1)\n+        assert_equal(n1.getblockheader(start_next_hash)[\"nTx\"], 0)\n+        assert_equal(n1.getblockheader(snapshot_prev_hash)[\"nTx\"], 0)\n+        assert_equal(n1.getblockheader(snapshot_hash)[\"nTx\"], 0)\n+\n+        # After loading the snapshot, check nChainTx values indirectly, by using the\n+        # getchaintxstats RPC, which returns differences of nChainTx values\n+        # between two blocks at the beginning and end of a specified window.\n+\n+        # nChainTx of the snapshot block should be SNAPSHOT_BASE_HEIGHT+1\n+        # because every block has one transaction. nChainTx of the previous\n+        # block should be 0. Confirm expected difference of these values.\n+        stats = n1.getchaintxstats(nblocks=1, blockhash=snapshot_hash)\n+        assert_equal(stats[\"window_tx_count\"], SNAPSHOT_BASE_HEIGHT+1)\n+\n+        # nChainTx of all blocks after START_HEIGHT and before\n+        # SNAPSHOT_BASE_HEIGHT should be 0. Confirm expected difference at\n+        # beginning and end of this window.\n+        stats = n1.getchaintxstats(nblocks=SNAPSHOT_BASE_HEIGHT-START_HEIGHT-2, blockhash=snapshot_prev_hash)\n+        assert_equal(stats[\"window_tx_count\"], 0)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": 62,
      "original_position": 30,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "603a92c9881ed78e29f15c48121ce8bf35d30837",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "unrelated to this pull: May be better to throw here, instead of returning wrong data, but this can be done in a follow-up.",
      "created_at": "2024-02-06T09:02:02Z",
      "updated_at": "2024-02-06T09:02:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1479428612",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1479428612"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1480436573",
      "pull_request_review_id": 1866151418,
      "id": 1480436573,
      "node_id": "PRRC_kwDOABII585YPatd",
      "diff_hunk": "@@ -5531,14 +5536,6 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     for (int i = AFTER_GENESIS_START; i <= snapshot_chainstate.m_chain.Height(); ++i) {\n         index = snapshot_chainstate.m_chain[i];\n \n-        // Fake nTx so that LoadBlockIndex() loads assumed-valid CBlockIndex\n-        // entries (among other things)\n-        if (!index->nTx) {\n-            index->nTx = 1;\n-        }\n-        // Fake nChainTx so that GuessVerificationProgress reports accurately",
      "path": "src/validation.cpp",
      "position": 214,
      "original_position": 176,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "59a8ca9333d2a618c989fb9c4cc7276068f658c7",
      "in_reply_to_id": 1479169504,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> do you have a code path where nChainTx is read when it was wrong (previously) or is unset (now)\r\n\r\nno, I never understood how the fake `nChainTx` values would help with guessing progress, but also wasn't 100% sure.",
      "created_at": "2024-02-06T19:27:10Z",
      "updated_at": "2024-02-06T19:27:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1480436573",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1480436573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5538,
      "original_line": 5538,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483275071",
      "pull_request_review_id": 1870720275,
      "id": 1483275071,
      "node_id": "PRRC_kwDOABII585YaPs_",
      "diff_hunk": "@@ -5531,14 +5536,6 @@ bool ChainstateManager::PopulateAndValidateSnapshot(\n     for (int i = AFTER_GENESIS_START; i <= snapshot_chainstate.m_chain.Height(); ++i) {\n         index = snapshot_chainstate.m_chain[i];\n \n-        // Fake nTx so that LoadBlockIndex() loads assumed-valid CBlockIndex\n-        // entries (among other things)\n-        if (!index->nTx) {\n-            index->nTx = 1;\n-        }\n-        // Fake nChainTx so that GuessVerificationProgress reports accurately",
      "path": "src/validation.cpp",
      "position": 214,
      "original_position": 176,
      "commit_id": "c9ca4ca4d970f9d42d0254775c04d114bd2152c3",
      "original_commit_id": "59a8ca9333d2a618c989fb9c4cc7276068f658c7",
      "in_reply_to_id": 1479169504,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1479169504\r\n\r\n> unrelated to this pull: Maybe an `Assume(nchaintx)` can be added to `GuessVerificationProgress`?\r\n\r\nI went ahead and added this in a separate commit\r\n",
      "created_at": "2024-02-08T16:35:39Z",
      "updated_at": "2024-02-08T16:48:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29370#discussion_r1483275071",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483275071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29370"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5538,
      "original_line": 5538,
      "side": "LEFT"
    }
  ]
}