{
  "type": "issue",
  "issue": {
    "id": 2031632152,
    "node_id": "I_kwDOABII5855GD8Y",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29026",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29026/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29026/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29026/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29026",
    "number": 29026,
    "state": "open",
    "state_reason": null,
    "title": "DB_RUNRECOVERY: Fatal error, run database recovery",
    "body": "### Is there an existing issue for this?\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Current behaviour\r\n\r\nWe are experiencing the build failures in NixPkgs both on x86_64-darwin and aarch64-darwin:\r\n\r\n```\r\n> 2023-12-07T14:45:33.311681Z [test] [wallet/bdb.cpp:189] [Open] BerkeleyEnvironment::Open: Error -30974 opening database environment: DB_RUNRECOVERY: Fatal error, run database recovery\r\n> make[3]: *** [Makefile:22524: wallet/test/wallet_tests.cpp.test] Error 1\r\n```\r\n\r\nThe full log is available from here: https://logs.ofborg.org/?key=nixos/nixpkgs.272548&attempt_id=8f5f1aaa-a3f7-4292-a194-57f85c49959a\r\n\r\nI can reproduce the issue locally on my Macbook M1.\r\n\r\nAt first, the issue looks like a duplicate of https://github.com/bitcoin/bitcoin/issues/26869 but this time the issue is in `wallet/test/wallet_tests.cpp.test` not in `test/functional/wallet_backwards_compatibility.py`\r\n\r\n### Expected behaviour\r\n\r\nThe test does not fail\r\n\r\n### Steps to reproduce\r\n\r\n1. install `nix`\r\n2. `git clone https://github.com/nixos/nixpkgs.git`\r\n3. `cd nixpkgs`\r\n4. `git fetch origin pull/272548/head:pr-272548`\r\n5. `git checkout pr-272548`\r\n6. `nix-shell -I nixpkgs=$(pwd) -p bitcoin`\r\n\r\n### Relevant log output\r\n\r\nhttps://logs.ofborg.org/?key=nixos/nixpkgs.272548&attempt_id=8f5f1aaa-a3f7-4292-a194-57f85c49959a\r\n\r\n### How did you obtain Bitcoin Core\r\n\r\nCompiled from source\r\n\r\n### What version of Bitcoin Core are you using?\r\n\r\n26.0\r\n\r\n### Operating system and version\r\n\r\nmacOS 13\r\n\r\n### Machine specifications\r\n\r\n_No response_",
    "user": {
      "login": "prusnak",
      "id": 42201,
      "node_id": "MDQ6VXNlcjQyMjAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prusnak",
      "html_url": "https://github.com/prusnak",
      "followers_url": "https://api.github.com/users/prusnak/followers",
      "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
      "organizations_url": "https://api.github.com/users/prusnak/orgs",
      "repos_url": "https://api.github.com/users/prusnak/repos",
      "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/prusnak/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 0,
    "created_at": "2023-12-07T22:31:51Z",
    "updated_at": "2023-12-07T22:49:16Z"
  },
  "events": [
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-07T22:33:42Z",
      "updated_at": "2023-12-07T22:33:42Z",
      "source": {
        "issue": {
          "id": 2029409840,
          "node_id": "PR_kwDOAEVQ_M5hWcoV",
          "url": "https://api.github.com/repos/NixOS/nixpkgs/issues/272548",
          "repository_url": "https://api.github.com/repos/NixOS/nixpkgs",
          "labels_url": "https://api.github.com/repos/NixOS/nixpkgs/issues/272548/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/NixOS/nixpkgs/issues/272548/comments",
          "events_url": "https://api.github.com/repos/NixOS/nixpkgs/issues/272548/events",
          "html_url": "https://github.com/NixOS/nixpkgs/pull/272548",
          "number": 272548,
          "state": "open",
          "state_reason": null,
          "title": "bitcoin: 25.1 -> 26.0",
          "body": "## Description of changes\r\n\r\n- new major release\r\n- release notes: https://bitcoincore.org/en/releases/26.0/ + https://github.com/bitcoin/bitcoin/blob/26.x/doc/release-notes.md\r\n\r\n<!--\r\nFor package updates please link to a changelog or describe changes, this helps your fellow maintainers discover breaking updates.\r\nFor new packages please briefly describe the package or provide a link to its homepage.\r\n-->\r\n\r\n## Things done\r\n\r\n<!-- Please check what applies. Note that these are not hard requirements but merely serve as information for reviewers. -->\r\n\r\n- Built on platform(s)\r\n  - [ ] x86_64-linux\r\n  - [ ] aarch64-linux\r\n  - [ ] x86_64-darwin\r\n  - [ ] aarch64-darwin\r\n- For non-Linux: Is sandboxing enabled in `nix.conf`? (See [Nix manual](https://nixos.org/manual/nix/stable/command-ref/conf-file.html))\r\n  - [ ] `sandbox = relaxed`\r\n  - [ ] `sandbox = true`\r\n- [ ] Tested, as applicable:\r\n  - [NixOS test(s)](https://nixos.org/manual/nixos/unstable/index.html#sec-nixos-tests) (look inside [nixos/tests](https://github.com/NixOS/nixpkgs/blob/master/nixos/tests))\r\n  - and/or [package tests](https://nixos.org/manual/nixpkgs/unstable/#sec-package-tests)\r\n  - or, for functions and \"core\" functionality, tests in [lib/tests](https://github.com/NixOS/nixpkgs/blob/master/lib/tests) or [pkgs/test](https://github.com/NixOS/nixpkgs/blob/master/pkgs/test)\r\n  - made sure NixOS tests are [linked](https://nixos.org/manual/nixpkgs/unstable/#ssec-nixos-tests-linking) to the relevant packages\r\n- [ ] Tested compilation of all packages that depend on this change using `nix-shell -p nixpkgs-review --run \"nixpkgs-review rev HEAD\"`. Note: all changes have to be committed, also see [nixpkgs-review usage](https://github.com/Mic92/nixpkgs-review#usage)\r\n- [x] Tested basic functionality of all binary files (usually in `./result/bin/`)\r\n- [24.05 Release Notes](https://github.com/NixOS/nixpkgs/blob/master/nixos/doc/manual/release-notes/rl-2405.section.md) (or backporting [23.05](https://github.com/NixOS/nixpkgs/blob/master/nixos/doc/manual/release-notes/rl-2305.section.md) and [23.11](https://github.com/NixOS/nixpkgs/blob/master/nixos/doc/manual/release-notes/rl-2311.section.md) Release notes)\r\n  - [ ] (Package updates) Added a release notes entry if the change is major or breaking\r\n  - [ ] (Module updates) Added a release notes entry if the change is significant\r\n  - [ ] (Module addition) Added a release notes entry if adding a new NixOS module\r\n- [x] Fits [CONTRIBUTING.md](https://github.com/NixOS/nixpkgs/blob/master/CONTRIBUTING.md).\r\n\r\n<!--\r\nTo help with the large amounts of pull requests, we would appreciate your\r\nreviews of other pull requests, especially simple package updates. Just leave a\r\ncomment describing what you have tested in the relevant package/service.\r\nReviewing helps to reduce the average time-to-merge for everyone.\r\nThanks a lot if you do!\r\n\r\nList of open PRs: https://github.com/NixOS/nixpkgs/pulls\r\nReviewing guidelines: https://nixos.org/manual/nixpkgs/unstable/#chap-reviewing-contributions\r\n-->\r\n\r\n---\r\n\r\nAdd a :+1: [reaction] to [pull requests you find important].\r\n\r\n[reaction]: https://github.blog/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/\r\n[pull requests you find important]: https://github.com/NixOS/nixpkgs/pulls?q=is%3Aopen+sort%3Areactions-%2B1-desc\r\n",
          "user": {
            "login": "prusnak",
            "id": 42201,
            "node_id": "MDQ6VXNlcjQyMjAx",
            "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/prusnak",
            "html_url": "https://github.com/prusnak",
            "followers_url": "https://api.github.com/users/prusnak/followers",
            "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
            "organizations_url": "https://api.github.com/users/prusnak/orgs",
            "repos_url": "https://api.github.com/users/prusnak/repos",
            "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/prusnak/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 731733923,
              "node_id": "MDU6TGFiZWw3MzE3MzM5MjM=",
              "url": "https://api.github.com/repos/NixOS/nixpkgs/labels/10.rebuild-linux:%201-10",
              "name": "10.rebuild-linux: 1-10",
              "color": "eeffee",
              "default": false
            },
            {
              "id": 731735222,
              "node_id": "MDU6TGFiZWw3MzE3MzUyMjI=",
              "url": "https://api.github.com/repos/NixOS/nixpkgs/labels/10.rebuild-darwin:%201-10",
              "name": "10.rebuild-darwin: 1-10",
              "color": "eeffee",
              "default": false
            },
            {
              "id": 740714914,
              "node_id": "MDU6TGFiZWw3NDA3MTQ5MTQ=",
              "url": "https://api.github.com/repos/NixOS/nixpkgs/labels/11.by:%20package-maintainer",
              "name": "11.by: package-maintainer",
              "color": "ddeecc",
              "default": false
            },
            {
              "id": 4022794309,
              "node_id": "LA_kwDOAEVQ_M7vxvhF",
              "url": "https://api.github.com/repos/NixOS/nixpkgs/labels/12.approvals:%202",
              "name": "12.approvals: 2",
              "description": "",
              "color": "0E8A16",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/NixOS/nixpkgs/pulls/272548",
            "html_url": "https://github.com/NixOS/nixpkgs/pull/272548",
            "diff_url": "https://github.com/NixOS/nixpkgs/pull/272548.diff",
            "patch_url": "https://github.com/NixOS/nixpkgs/pull/272548.patch"
          },
          "created_at": "2023-12-06T21:24:34Z",
          "updated_at": "2023-12-07T22:33:43Z"
        },
        "type": "issue"
      }
    }
  ]
}