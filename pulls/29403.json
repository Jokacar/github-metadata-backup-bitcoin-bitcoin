{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
    "id": 1715711302,
    "node_id": "PR_kwDOABII585mQ61G",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29403",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29403.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29403.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/da103ecf4a7a341e7376c6ef31af11aed05aed5c",
    "number": 29403,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: batch erase procedures and improve 'EraseRecords' performance",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The first two commits are coming from #26836. They are required for these changes.\r\nFound this while working on #28987.\r\n\r\nSeeks to optimize and simplify `WalletBatch::EraseRecords`. Currently, this process opens a cursor to iterate over the entire database, searching for records that match the type prefixes, to then call the `WalletBatch::Erase` function for each of the matching records.\r\nThis PR rewrites this 40-line manual process into a single line; instead of performing all of those actions manually, we can simply utilize the `ErasePrefix()` functionality. The result is 06216b344dea6ad6c385fda0b37808ff9ae5273b.\r\n\r\nMoreover, it expands the test coverage for the `ErasePrefix` functionality and documents the db txn requirement for `BerkeleyBatch::ErasePrefix` .",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2024-02-07T13:42:56Z",
    "updated_at": "2024-02-07T13:50:54Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "8edaba11d359584c7f715219fd933365420544a9",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2024_wallet_simplify_EraseRecords",
      "ref": "2024_wallet_simplify_EraseRecords",
      "sha": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 391725,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-07T13:02:13Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-08-30T13:12:58Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5b8990a1f3c49b0b02b7383c69e95320acbda13e",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36729,
        "stargazers_count": 73756,
        "watchers_count": 73756,
        "size": 248267,
        "default_branch": "master",
        "open_issues_count": 693,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-07T13:44:29Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-02-07T13:49:54Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 66,
    "deletions": 45,
    "changed_files": 5,
    "commits": 4,
    "review_comments": 1,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDlhNGUxZjU0OTc5ZTViYTVkZmQ2YmVlYWQzMGQyYmZhYzcyZmI0M2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f",
      "tree": {
        "sha": "01e89a793556808888864e5426a78ffb9c2e5c58",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/01e89a793556808888864e5426a78ffb9c2e5c58"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 01e89a793556808888864e5426a78ffb9c2e5c58\nparent 592e01398e765bf3c3f4fc106f40c8be373b4bb0\nauthor furszy <matiasfurszyfer@protonmail.com> 1657413057 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707255436 -0300\n\nwallet: clean redundancies in DelAddressBook\n\n1) Encode destination only once (instead of three).\n2) Don't remove entry from memory if db write fail.\n3) Notify GUI only if removal succeeded\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXCpowACgkQXdI8zGhq\npiPsZA/+I501PRKt/ZPgtBylcfziaMzgDVKZcUJlUc/5sEiRBbC19CMWh+10gP1R\nL9MmvACg1yQzI+WBrH8kvI86ZWSsHmtmOTs1EGUKPfMYNakmEC3jj3gGnUkHzmRV\nj6fJJoxUsrNko+8GabsRHGf2l0u6N1uvdbqYdHV8+2Gvs+F17m1AnxqVIgjETbGZ\neuQ5Q5sLG9zjuz/1rXoVg4gYjSi5RYIH5Jp+hFgslsraTRF76TLYcSJyLwQqwdVP\ny7ErrLqKugPKhjJ9Mw+t6HMipjEVOoQ2KG0writ26R5IjDZtEUoUvRfw+NDIESV+\n0YmE+yKZOCSU1YB/gX03nxrTtZeEeoLDr0x7NKgOgIhLZSQxnAVcNANt1Fh5Uo6J\nB22usHxTuUChwVW9ZoFIKeyfoKD29hTwj0Kz5YyLut1fU0WTd7zGqNl9fb8YPKjl\nycR30JheskRtFuTvlkNIOwcQRetOnwUwRGv8RFujN20T164FFFkWL+6fJfEbLhVg\nVuCFxYPBth9m9K1jqZ8MWupXsLEUcsPznEELqnoeFVu7D+UzFZRLYAU2kUR47QAA\n8Rg3FC0YtT59tyuypCjAmSBt/PDm51s4B62KHihOhOM+pKbQk8hpYAp6TFCQnp5R\nZqyLkylcUY2kDvJReV+2+c7kLpVc5f/ENe500i/VRNcWjeEiEe4=\n=k2wo\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/592e01398e765bf3c3f4fc106f40c8be373b4bb0",
          "sha": "592e01398e765bf3c3f4fc106f40c8be373b4bb0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/592e01398e765bf3c3f4fc106f40c8be373b4bb0"
        }
      ],
      "message": "wallet: clean redundancies in DelAddressBook\n\n1) Encode destination only once (instead of three).\n2) Don't remove entry from memory if db write fail.\n3) Notify GUI only if removal succeeded",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-06T21:37:16Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-07-10T00:30:57Z"
      },
      "sha": "9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDIwY2RlMDUzOTFlOTY4M2Q2NzNmYjRjMDk1YzhkMDk2ZGZhZDZmYjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/20cde05391e9683d673fb4c095c8d096dfad6fb0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/20cde05391e9683d673fb4c095c8d096dfad6fb0",
      "tree": {
        "sha": "fa8d2501b710ab82287b7ed54f41b7f51abb2190",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fa8d2501b710ab82287b7ed54f41b7f51abb2190"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree fa8d2501b710ab82287b7ed54f41b7f51abb2190\nparent 9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f\nauthor furszy <matiasfurszyfer@protonmail.com> 1707255374 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707310922 -0300\n\nwallet: batch 'DelAddressBook' db write operations\n\nWriting data to disk atomically, maintaining consistency\nin case of failure.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXDf0oACgkQXdI8zGhq\npiP0+BAAhU/kW4OgXOblqAmZySRSY30xt+AgbWJu3xM52NV28c8Ka9WL+e/Czl/Y\nr3PV+1xFFhf/gb/8z6ipGBMparm3R9d2gzKHHucWp3gtTgpv9TSdF6Ac/eLkVggf\nqOwHxVLx2C7VFfS8GCcwkuNsvECaQYPuY/dZDKUOh0htZSZOrPSMDvFXVSb7O7gU\n5I/fZyuIfdifer7nTEADCe7skVpB4Xo93WGUgpBKcpmgJj5Yezoqb0kMMXcIZydc\nxTD2YXKuJW4kjtt/aKtMEoOe3LW1RVlc3Iyyl0CgxeSdRscyFBZ7mwKDBNJk742I\nvFDTr47WDyAlBUPmDtuOhl0DUv2QWQHDOzy6UdG7a6TSS37HZcafhttQdja4BVD5\nPrBgtkqrFn83FVvc40DWWdybBPvlgwf+DGUllR+8EA/U1tztQQiRvU3EavzEv5LZ\npfknH6WUVwl2Q9Bigp0mAuwWTv6NOZhnG1F5lsrYad56US/FXw7dXQZ2OwRb8tHE\nPsFLjUarewBHUqlTW+GkjlfMsj1/eg6BG1vi2z7TsmsiQ3P05yLI8Xqy1eRms86Q\nt0Af+/XwTQllN6PYptHnV7mZA2atyXlQ8PivGD0PiCv+CHwyglw/a9r/Cavx6I0u\n8B7ClHqzJ81byCM2ZxNSmrYGu3enefALVlbi156LXh1mWc2pgog=\n=39wj\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f",
          "sha": "9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9a4e1f54979e5ba5dfd6beead30d2bfac72fb43f"
        }
      ],
      "message": "wallet: batch 'DelAddressBook' db write operations\n\nWriting data to disk atomically, maintaining consistency\nin case of failure.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-07T13:02:02Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-06T21:36:14Z"
      },
      "sha": "20cde05391e9683d673fb4c095c8d096dfad6fb0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkxYjAxNDhhZGQzM2Q2MDI3ZDhmNzQ5M2ViNzQ3YmI1OGYxZGE0ODY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/91b0148add33d6027d8f7493eb747bb58f1da486",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/91b0148add33d6027d8f7493eb747bb58f1da486",
      "tree": {
        "sha": "ee7ee01bba047085173e4090fb25fc4d53f9c2ca",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ee7ee01bba047085173e4090fb25fc4d53f9c2ca"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ee7ee01bba047085173e4090fb25fc4d53f9c2ca\nparent 20cde05391e9683d673fb4c095c8d096dfad6fb0\nauthor furszy <matiasfurszyfer@protonmail.com> 1707247703 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707310923 -0300\n\nwallet: bdb batch 'ErasePrefix', do not create txn internally\n\nTransactions are intended to be started on upper layers rather than\ninternally by the bdb batch object. This enables us to consolidate\ndifferent write operations within a procedure in the same db txn,\nimproving consistency due to the atomic property of the transaction,\nas well as its performance due to the reduction of disk write\noperations.\n\nImportant Note:\nThis approach also ensures that the BerkeleyBatch::ErasePrefix\nfunction behaves exactly as the SQLiteBatch::ErasePrefix function,\nwhich does not create a db txn internally.\n\nFurthermore, due our current bdb configurations, it is required for\nthe `BerkeleyBatch::ErasePrefix` implementation to be called within\nan already initialized db txn.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXDf0sACgkQXdI8zGhq\npiMHtA//XvFXlqKKAoPXCVBKK0+08z7vWhtfL+fSRw+8RXbzfqr++TKJEvjQ4LbN\nOh02b/f+1z17hbSn42swyGvxdKLlfgm2KqpF/L+uqhY88EU/f5cxRDZyqpm4QQNU\nPgW6dkfpaeCYhO4UxFqD6Wvw4llgqA1sur0jEVGXoiGz0L6uVVOuuKNGVxI1TcLw\nVj7NAGQuOrgcLrU/XQe0PWT8xEZMbW37MJAKe3ncVk3ZprBB7SEfXaOjNZXrvSeW\ndezdqKDPydlKIRqSLUo7eTWC4bjP4erbuCoYasmh2xyQZ+0/y9KUSXteIBUX0Pys\nomfYN4GneTU+9qhFZENdFAMKGgOfSWqzyEZjntbULF5VwIeDUNUYoQ38Fz/Ej74X\nbHDIOeohorSo09eAgJmzGfdXsaeks0lpQdjpVkRQOiWwP6CJqlv0er75ffHrOAMA\n0ErePvRViAzMcp+XxZQI/So1pGBfiiT6yREUvCVAZiPP2yAbn6YPU5+GTUYO+GR9\nmjZiUpG0SfS6OcjcxSUrUbXf7/7+h+LEu59CPwsNaa2kKXExIl2boWJfZdsYEQSE\nspZT/FbMzmJqfCeITn00ZYQcIjNoXQjN09EGkgpmDe2R+hLeaV69Rr70NRnsS7Bg\n1M/aamo3H9J091FGElxStjnQ2sUvKkfjYDDG7b2gYfqGJICO3kg=\n=489E\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/20cde05391e9683d673fb4c095c8d096dfad6fb0",
          "sha": "20cde05391e9683d673fb4c095c8d096dfad6fb0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/20cde05391e9683d673fb4c095c8d096dfad6fb0"
        }
      ],
      "message": "wallet: bdb batch 'ErasePrefix', do not create txn internally\n\nTransactions are intended to be started on upper layers rather than\ninternally by the bdb batch object. This enables us to consolidate\ndifferent write operations within a procedure in the same db txn,\nimproving consistency due to the atomic property of the transaction,\nas well as its performance due to the reduction of disk write\noperations.\n\nImportant Note:\nThis approach also ensures that the BerkeleyBatch::ErasePrefix\nfunction behaves exactly as the SQLiteBatch::ErasePrefix function,\nwhich does not create a db txn internally.\n\nFurthermore, due our current bdb configurations, it is required for\nthe `BerkeleyBatch::ErasePrefix` implementation to be called within\nan already initialized db txn.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-07T13:02:03Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-06T19:28:23Z"
      },
      "sha": "91b0148add33d6027d8f7493eb747bb58f1da486"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRhMTAzZWNmNGE3YTM0MWU3Mzc2YzZlZjMxYWYxMWFlZDA1YWVkNWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "tree": {
        "sha": "49762abdcc35dcdcb160ceb161d8ba76268763d0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/49762abdcc35dcdcb160ceb161d8ba76268763d0"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 49762abdcc35dcdcb160ceb161d8ba76268763d0\nparent 91b0148add33d6027d8f7493eb747bb58f1da486\nauthor furszy <matiasfurszyfer@protonmail.com> 1707225948 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707310923 -0300\n\nwallet: simplify EraseRecords by using 'ErasePrefix'\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXDf0sACgkQXdI8zGhq\npiMhihAArt5pCEQ9+u5CauQYii66wfvTwCA0nVU0xioV7X9by6VtGXK7FinVkCm2\n5b2Owmmj/bYpDx90zdW3sVXwF2HKyaU+2QgdEEGjJyYT0MYul3N0ldOYX0zeM6Y5\nG8VCxgM4RBBSMDKRnxwm/ft7jzEoKKxGxzYf3YS0IWbsQQCI2f7Vbty9L55QMbwc\n0lcv8CfuFeTdOOCVEVmLSgZm7UiFWrNkR9W4/ud2K1hdy/U7vBfqjMomqf0YtKAN\nSb7JrXC7ZflEX2bXBtQhG6Gvd3H0+sfENu4jy0tVSRFXuLEDCooyr+SXelneK3ud\nuQnQGShvui/XMqo5NXT/4XWRUYirhEFzF2PIKTh7R7i/sytAyiL6ah9blhi2dlYO\n3+f+oIVC8a/l8+P5CZsmDq3j91ZbHNT8Uy/s23OLJoe4lf9zsPzK0KTipK7yfpRM\nWz7NP9eLQcQu6SsyFOLS55p6z75CQDEelp3jr6T8uxuk4kx+niSvNEI5aKXnAFdE\nQyottM2H33pdyDRn/PWjfd3YD9Bht2GVT4B9brGSU2h3zCtyeq4G+QZoQWjQLzuf\nlBb+P9sO89Rh8OYJtSVmjKGgVaH1sx6osI+h2zdZbrsT5KucSm/LfKcoxRIHFP7V\nae8jqVFnBKxXsCO9ZsDr/8gQkcojrnwYGiprLPukVq3D3BFJ3aw=\n=VWnu\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/91b0148add33d6027d8f7493eb747bb58f1da486",
          "sha": "91b0148add33d6027d8f7493eb747bb58f1da486",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/91b0148add33d6027d8f7493eb747bb58f1da486"
        }
      ],
      "message": "wallet: simplify EraseRecords by using 'ErasePrefix'",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-07T13:02:03Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-06T13:25:48Z"
      },
      "sha": "da103ecf4a7a341e7376c6ef31af11aed05aed5c"
    },
    {
      "event": "commented",
      "id": 1932079274,
      "node_id": "IC_kwDOABII585zKTCq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932079274",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T13:42:59Z",
      "updated_at": "2024-02-07T13:43:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29403).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932079274",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403"
    },
    {
      "event": "labeled",
      "id": 11732630908,
      "node_id": "LE_lADOABII585-i32ezwAAAAK7Ub18",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11732630908",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T13:43:01Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "reviewed",
      "id": 1867863458,
      "node_id": "PRR_kwDOABII585vVVWi",
      "url": null,
      "actor": null,
      "commit_id": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1867863458",
      "submitted_at": "2024-02-07T13:50:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563",
      "pull_request_review_id": 1867863458,
      "id": 1481506563,
      "node_id": "PRRC_kwDOABII585YTf8D",
      "diff_hunk": "@@ -2395,15 +2395,37 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             WalletLogPrintf(\"%s called with IsMine address, NOT SUPPORTED. Please report this bug! %s\\n\", __func__, PACKAGE_BUGREPORT);\n             return false;\n         }\n+\n+        WalletBatch batch(GetDatabase());\n+        if (!batch.TxnBegin()) {\n+            WalletLogPrintf(\"Error: cannot create db txn for address book entry removal\\n\");\n+            return false;\n+        }\n+\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {\n+            WalletLogPrintf(\"%s error erasing purpose/name\\n\", __func__);",
      "path": "src/wallet/wallet.cpp",
      "position": 29,
      "original_position": 29,
      "commit_id": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "original_commit_id": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit, feel free to ignore: Any reason to add `__func__` to this log, when none of the other logs have it here? If someone is interested in the exact source location, they can enable the corresponding log option. If this is needed for context, it could make more sense to clarify the log message itself, so that it is unique and clear without requiring the source code as context.\r\n",
      "created_at": "2024-02-07T13:50:54Z",
      "updated_at": "2024-02-07T13:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481506563",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2413,
      "original_line": 2413,
      "side": "RIGHT"
    }
  ]
}