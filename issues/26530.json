{
  "type": "issue",
  "issue": {
    "id": 1455183006,
    "node_id": "I_kwDOABII585WvFSe",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/26530",
    "number": 26530,
    "state": "closed",
    "state_reason": "completed",
    "title": "Breking in Mac OS",
    "body": "I'm trying to use bitcoin core on mac OS\r\nI want to record on an external hd\r\n\r\nbut i get the following error all the time\r\n\r\n2022-11-17T22:07:44Z msghand thread exit\r\n2022-11-17T22:07:44Z net thread exit\r\n2022-11-17T22:07:44Z opencon thread exit\r\n2022-11-17T22:07:44Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:44Z ERROR: SerializeFileDB: Failed to flush file /Volumes/Extreme SSD/bitcoin_core/peers.8611\r\n2022-11-17T22:07:44Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat started\r\n2022-11-17T22:07:44Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:44Z ERROR: SerializeFileDB: Failed to flush file /Volumes/Extreme SSD/bitcoin_core/anchors.ceb3\r\n2022-11-17T22:07:44Z DumpAnchors: Flush 2 outbound block-relay-only peer addresses to anchors.dat completed (0.01s)\r\n2022-11-17T22:07:44Z scheduler thread exit\r\n2022-11-17T22:07:44Z Writing 0 unbroadcast transactions to disk.\r\n2022-11-17T22:07:44Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:44Z Failed to dump mempool: FileCommit failed. Continuing anyway.\r\n2022-11-17T22:07:45Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:45Z ERROR: Flush: failed to commit file 1\r\n2022-11-17T22:07:45Z *** Flushing block file to disk failed. This is likely the result of an I/O error.\r\n2022-11-17T22:07:45Z Error: A fatal internal error occurred, see debug.log for details\r\n2022-11-17T22:07:45Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:45Z ERROR: Flush: failed to commit file 1\r\n2022-11-17T22:07:45Z *** Flushing undo file to disk failed. This is likely the result of an I/O error.\r\n2022-11-17T22:07:45Z Error: A fatal internal error occurred, see debug.log for details\r\n2022-11-17T22:07:46Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:46Z ERROR: Flush: failed to commit file 1\r\n2022-11-17T22:07:46Z *** Flushing block file to disk failed. This is likely the result of an I/O error.\r\n2022-11-17T22:07:46Z Error: A fatal internal error occurred, see debug.log for details\r\n2022-11-17T22:07:46Z FileCommit: fcntl F_FULLFSYNC failed: 25\r\n2022-11-17T22:07:46Z ERROR: Flush: failed to commit file 1\r\n2022-11-17T22:07:46Z *** Flushing undo file to disk failed. This is likely the result of an I/O error.\r\n2022-11-17T22:07:46Z Error: A fatal internal error occurred, see debug.log for details\r\n2022-11-17T22:07:46Z Shutdown: done\r\n",
    "user": {
      "login": "mateusgalasso",
      "id": 3990028,
      "node_id": "MDQ6VXNlcjM5OTAwMjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3990028?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mateusgalasso",
      "html_url": "https://github.com/mateusgalasso",
      "followers_url": "https://api.github.com/users/mateusgalasso/followers",
      "following_url": "https://api.github.com/users/mateusgalasso/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/mateusgalasso/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/mateusgalasso/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/mateusgalasso/subscriptions",
      "organizations_url": "https://api.github.com/users/mateusgalasso/orgs",
      "repos_url": "https://api.github.com/users/mateusgalasso/repos",
      "events_url": "https://api.github.com/users/mateusgalasso/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/mateusgalasso/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      },
      {
        "id": 234879,
        "node_id": "MDU6TGFiZWwyMzQ4Nzk=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/macOS",
        "name": "macOS",
        "description": "",
        "color": "660000",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "comments": 3,
    "closed_at": "2022-11-18T15:14:25Z",
    "created_at": "2022-11-18T14:05:34Z",
    "updated_at": "2022-11-22T16:41:10Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 7844103792,
      "node_id": "LE_lADOABII585WvFSezwAAAAHTi4Zw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7844103792",
      "actor": {
        "login": "mateusgalasso",
        "id": 3990028,
        "node_id": "MDQ6VXNlcjM5OTAwMjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3990028?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mateusgalasso",
        "html_url": "https://github.com/mateusgalasso",
        "followers_url": "https://api.github.com/users/mateusgalasso/followers",
        "following_url": "https://api.github.com/users/mateusgalasso/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mateusgalasso/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mateusgalasso/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mateusgalasso/subscriptions",
        "organizations_url": "https://api.github.com/users/mateusgalasso/orgs",
        "repos_url": "https://api.github.com/users/mateusgalasso/repos",
        "events_url": "https://api.github.com/users/mateusgalasso/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mateusgalasso/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T14:05:34Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 1320141605,
      "node_id": "IC_kwDOABII585Or8Ml",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320141605",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:03:21Z",
      "updated_at": "2022-11-18T15:03:21Z",
      "author_association": "MEMBER",
      "body": "@mateusgalasso \r\n\r\nConsidering your previous https://github.com/bitcoin/bitcoin/issues/26490#issuecomment-1319226675 and https://github.com/bitcoin/bitcoin/issues/26490#issuecomment-1319255210, is it correct that an error happens on macOS Ventura?\r\n\r\nIf so, please see https://github.com/bitcoin/bitcoin/issues/26400#issuecomment-1294866176 and https://github.com/bitcoin/bitcoin/issues/26397#issuecomment-1292300303.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26530#issuecomment-1320141605",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530"
    },
    {
      "event": "mentioned",
      "id": 7844694418,
      "node_id": "MEE_lADOABII585WvFSezwAAAAHTlImS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7844694418",
      "actor": {
        "login": "mateusgalasso",
        "id": 3990028,
        "node_id": "MDQ6VXNlcjM5OTAwMjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3990028?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mateusgalasso",
        "html_url": "https://github.com/mateusgalasso",
        "followers_url": "https://api.github.com/users/mateusgalasso/followers",
        "following_url": "https://api.github.com/users/mateusgalasso/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mateusgalasso/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mateusgalasso/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mateusgalasso/subscriptions",
        "organizations_url": "https://api.github.com/users/mateusgalasso/orgs",
        "repos_url": "https://api.github.com/users/mateusgalasso/repos",
        "events_url": "https://api.github.com/users/mateusgalasso/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mateusgalasso/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:03:22Z"
    },
    {
      "event": "subscribed",
      "id": 7844694428,
      "node_id": "SE_lADOABII585WvFSezwAAAAHTlImc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7844694428",
      "actor": {
        "login": "mateusgalasso",
        "id": 3990028,
        "node_id": "MDQ6VXNlcjM5OTAwMjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3990028?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mateusgalasso",
        "html_url": "https://github.com/mateusgalasso",
        "followers_url": "https://api.github.com/users/mateusgalasso/followers",
        "following_url": "https://api.github.com/users/mateusgalasso/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mateusgalasso/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mateusgalasso/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mateusgalasso/subscriptions",
        "organizations_url": "https://api.github.com/users/mateusgalasso/orgs",
        "repos_url": "https://api.github.com/users/mateusgalasso/repos",
        "events_url": "https://api.github.com/users/mateusgalasso/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mateusgalasso/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:03:22Z"
    },
    {
      "event": "labeled",
      "id": 7844696240,
      "node_id": "LE_lADOABII585WvFSezwAAAAHTlJCw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7844696240",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:03:34Z",
      "label": {
        "name": "macOS",
        "color": "660000"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:04:50Z",
      "updated_at": "2022-11-18T15:04:50Z",
      "source": {
        "issue": {
          "id": 1445485019,
          "node_id": "I_kwDOABII585WKFnb",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26490",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26490/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26490/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26490/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/26490",
          "number": 26490,
          "state": "closed",
          "state_reason": "completed",
          "title": "macOS reports error on shutdown of GUI",
          "body": "macOS reports error on shutdown of GUI. \"Bitcoin Core quit unexpectedly...\" Although this may be hardware related , memory and cpu load seem normal (screenshots and logs attached.)\r\n\r\n**Expected behavior**\r\n\r\nApplication closes without error message.\r\n\r\n**Actual behavior**\r\n\r\nApplication quits (and restarts without error or corruption of data) but message persists.\r\n\r\n**To reproduce**\r\n\r\nThe error message seems to persist every time under normal conditions, (closing the application invokes the message \"Bitcoin Core is shutting down, do not shut down the computer until this window has disappeared\" Then opens fine on relaunch.\r\n\r\n**System information**\r\n\r\nBitcoin Core           23.0.0\r\nVersion:               23.0.0 (23.0.0)\r\nCode Type:             X86-64 (Native)\r\nParent Process:        launchd [1]\r\n\r\nOS Version:            macOS 13.0 (22A380)\r\n\r\n[log2022-11-11.txt](https://github.com/bitcoin/bitcoin/files/9990546/log2022-11-11.txt)\r\n<img width=\"280\" alt=\"Screenshot 2022-11-11 at 20 51 52\" src=\"https://user-images.githubusercontent.com/1854925/201350529-5164f0ad-3781-4849-8914-09ddc8f760e2.png\">\r\n<img width=\"631\" alt=\"Screenshot 2022-11-11 at 21 24 41\" src=\"https://user-images.githubusercontent.com/1854925/201350606-918c0588-9f7f-4304-a7eb-fbca54ad3f7f.png\">\r\n<img width=\"615\" alt=\"Screenshot 2022-11-11 at 21 24 48\" src=\"https://user-images.githubusercontent.com/1854925/201350618-3e7d2e65-7fb8-4c7d-9651-a77c0a11b56a.png\">\r\n",
          "user": {
            "login": "xjmzx",
            "id": 1854925,
            "node_id": "MDQ6VXNlcjE4NTQ5MjU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1854925?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xjmzx",
            "html_url": "https://github.com/xjmzx",
            "followers_url": "https://api.github.com/users/xjmzx/followers",
            "following_url": "https://api.github.com/users/xjmzx/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/xjmzx/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/xjmzx/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/xjmzx/subscriptions",
            "organizations_url": "https://api.github.com/users/xjmzx/orgs",
            "repos_url": "https://api.github.com/users/xjmzx/repos",
            "events_url": "https://api.github.com/users/xjmzx/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/xjmzx/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            },
            {
              "id": 135946,
              "node_id": "MDU6TGFiZWwxMzU5NDY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/GUI",
              "name": "GUI",
              "color": "02d7e1",
              "default": false
            },
            {
              "id": 234879,
              "node_id": "MDU6TGFiZWwyMzQ4Nzk=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/macOS",
              "name": "macOS",
              "description": "",
              "color": "660000",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "NONE",
          "locked": false,
          "comments": 28,
          "closed_at": "2022-11-17T14:30:29Z",
          "created_at": "2022-11-11T13:34:16Z",
          "updated_at": "2022-12-06T21:35:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1320150236,
      "node_id": "IC_kwDOABII585Or-Tc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320150236",
      "actor": {
        "login": "john-moffett",
        "id": 116917595,
        "node_id": "U_kgDOBvgFWw",
        "avatar_url": "https://avatars.githubusercontent.com/u/116917595?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/john-moffett",
        "html_url": "https://github.com/john-moffett",
        "followers_url": "https://api.github.com/users/john-moffett/followers",
        "following_url": "https://api.github.com/users/john-moffett/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/john-moffett/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/john-moffett/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/john-moffett/subscriptions",
        "organizations_url": "https://api.github.com/users/john-moffett/orgs",
        "repos_url": "https://api.github.com/users/john-moffett/repos",
        "events_url": "https://api.github.com/users/john-moffett/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/john-moffett/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:07:17Z",
      "updated_at": "2022-11-18T15:07:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "Likely duplicate of #26455\r\n\r\nI think this is a MacOS 13 (Ventura) specific bug for `fcntl` that occurs when using certain external drives. Are you running Ventura? If so, do you have Apple silicon (eg - M1 or M2)? \r\n\r\nOther projects [seem to have the same or substantially similar issue](https://groups.google.com/g/rocksdb/c/ryYJO5ZXUF0/m/MC8Aw2hoBgAJ).\r\n\r\nA *possible* temporary and ugly workaround may be to delete or comment out the following lines and compile from source:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/6d4048468430d9d1fe5e7c5fcda13708879d1083/src/util/system.cpp#L1187-L1191\r\n\r\n",
      "user": {
        "login": "john-moffett",
        "id": 116917595,
        "node_id": "U_kgDOBvgFWw",
        "avatar_url": "https://avatars.githubusercontent.com/u/116917595?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/john-moffett",
        "html_url": "https://github.com/john-moffett",
        "followers_url": "https://api.github.com/users/john-moffett/followers",
        "following_url": "https://api.github.com/users/john-moffett/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/john-moffett/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/john-moffett/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/john-moffett/subscriptions",
        "organizations_url": "https://api.github.com/users/john-moffett/orgs",
        "repos_url": "https://api.github.com/users/john-moffett/repos",
        "events_url": "https://api.github.com/users/john-moffett/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/john-moffett/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26530#issuecomment-1320150236",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530"
    },
    {
      "event": "commented",
      "id": 1320160018,
      "node_id": "IC_kwDOABII585OsAsS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1320160018",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:14:18Z",
      "updated_at": "2022-11-18T15:14:18Z",
      "author_association": "MEMBER",
      "body": "> Likely duplicate of #26455\r\n\r\nAgree. Closing this one.\r\n\r\nLet's keep discussion in #26455.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26530#issuecomment-1320160018",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26530"
    },
    {
      "event": "closed",
      "id": 7844803846,
      "node_id": "CE_lADOABII585WvFSezwAAAAHTljUG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7844803846",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-18T15:14:25Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "john-moffett",
        "id": 116917595,
        "node_id": "U_kgDOBvgFWw",
        "avatar_url": "https://avatars.githubusercontent.com/u/116917595?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/john-moffett",
        "html_url": "https://github.com/john-moffett",
        "followers_url": "https://api.github.com/users/john-moffett/followers",
        "following_url": "https://api.github.com/users/john-moffett/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/john-moffett/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/john-moffett/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/john-moffett/subscriptions",
        "organizations_url": "https://api.github.com/users/john-moffett/orgs",
        "repos_url": "https://api.github.com/users/john-moffett/repos",
        "events_url": "https://api.github.com/users/john-moffett/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/john-moffett/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-19T17:10:54Z",
      "updated_at": "2022-11-19T17:10:54Z",
      "source": {
        "issue": {
          "id": 1456582981,
          "node_id": "PR_kwDOABII585DSWG9",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26534",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26534/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26534/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26534/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26534",
          "number": 26534,
          "state": "closed",
          "state_reason": null,
          "title": "Fix macOS failing to flush blockfiles to disk for certain external drives",
          "body": "This PR attempts to close (or at least help) #26455 (and closed duplicates #26400 #26530).\r\n\r\n### Context\r\n\r\nmacOS's `fsync` only flushes writes to the drive, but doesn't ask the drive to *immediately* commit the data to permanent storage (ie - physically write it) ([manpage](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man2/fsync.2.html)). The data will eventually be physically written, but there are no guarantees when it will happen -- it could be several seconds or more. For a stronger 'immediate-write' guarantee, they offer an `F_FULLFSYNC` option to `fcntl` ([manpage](https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man2/fcntl.2.html#//apple_ref/doc/man/2/fcntl:~:text=current%20file%20offset.-,F_FULLFSYNC,-Does%20the%20same)) to accomplish that. This `fsync`-on-macOS behavior has caused [historical problems](https://github.com/bitcoin/bitcoin/issues/2770#issuecomment-22686426) in this project for macOS builds, so, since then, the `F_FULLSYNC` approach has been used for writing (see #3000).\r\n\r\nHowever, certain external drives or filesystems do not support `fcntl` with `F_FULLFSYNC` option. (And some that *do* supposedly support the option do not actually do it.) These drives/filesystems will typically report `errno` `ENOTSUP` or `ENOTTY`, which is what was reported in the referenced issues. [However, there is no reliable way to determine lack of support](https://github.com/google/leveldb/commit/296de8d5b8e4e57bd1e46c981114dfbe58a8c4fa), so **relying on specific error codes is insufficient**.\r\n\r\nThis bug seems to only be affecting macOS 13 (Ventura) systems, but in theory, any macOS version could be affected.\r\n\r\n### What other projects have done\r\n\r\nOther projects, including [LevelDB](https://github.com/google/leveldb/commit/296de8d5b8e4e57bd1e46c981114dfbe58a8c4fa), [SQLite](https://sqlite.org/src/file?name=src/os_unix.c&ci=5c669f5f399fe899#:~:text=If%20the%20FULLFSYNC%20failed%2C%20fall%20back%20to%20attempting%20an%20fsync()), and [MariaDB](https://github.com/MariaDB/server/commit/746fd9fdacc52ccc297db7703ea9288b67138167) have experienced similar issues, and have taken the strategy of falling back on the (less reliable) `fsync` when `F_FULLFSYNC` isn't supported. (See helpful [Twitter thread](https://twitter.com/TigerBeetleDB/status/1422855270716293123).) Some (SQLite, MariaDB, LevelDB) fall back to `fsync` on *any* error, and others only fall back on specific errors (BerkeleyDB 4.8 [falls back only on `ENOTSUP`](https://github.com/observerdev/db-4.8.30/blob/3c75267f11336acb1be06bed419e8056cc689d09/os/os_fsync.c#L81-L88), which is why this PR may not fully fix #26455, as the wallet is getting the error `ENOTTY`.)\r\n\r\n### This PR\r\n\r\nI propose to follow that general strategy and fall back on `fsync` if `F_FULLFSYNC` fails for any reason, while preserving both error codes for debugging. \r\n\r\n(I think we should also print the error strings using `SysErrorString` rather than print the raw platform-dependent error codes, but I wanted to keep this PR as atomic as possible and save those changes (4 or 5 lines in addition to these) for another PR (which I'd be happy to submit -- or modify this PR to include).)",
          "user": {
            "login": "john-moffett",
            "id": 116917595,
            "node_id": "U_kgDOBvgFWw",
            "avatar_url": "https://avatars.githubusercontent.com/u/116917595?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/john-moffett",
            "html_url": "https://github.com/john-moffett",
            "followers_url": "https://api.github.com/users/john-moffett/followers",
            "following_url": "https://api.github.com/users/john-moffett/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/john-moffett/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/john-moffett/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/john-moffett/subscriptions",
            "organizations_url": "https://api.github.com/users/john-moffett/orgs",
            "repos_url": "https://api.github.com/users/john-moffett/repos",
            "events_url": "https://api.github.com/users/john-moffett/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/john-moffett/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26534",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26534",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26534.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26534.patch"
          },
          "closed_at": "2022-11-29T23:56:59Z",
          "created_at": "2022-11-19T17:10:54Z",
          "updated_at": "2022-11-29T23:56:59Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "locked",
      "id": 7869797834,
      "node_id": "LOE_lADOABII585WvFSezwAAAAHVE5XK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7869797834",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-22T16:41:10Z"
    }
  ]
}