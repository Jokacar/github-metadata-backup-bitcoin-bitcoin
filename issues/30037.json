{
  "type": "issue",
  "issue": {
    "id": 2278400334,
    "node_id": "I_kwDOABII586HzaFO",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30037",
    "number": 30037,
    "state": "open",
    "state_reason": null,
    "title": "RfC: increase minimum prune target?",
    "body": "The minimum pruning target of `550MiB` was chosen based on a physical block size of `1 MiB`, see  https://github.com/bitcoin/bitcoin/blob/f5b6f621fff7540ca97974b26a66ca1cc6db018c/src/validation.h#L69-L76\r\nWe never prune files within 288 blocks from the tip, so the size limit will not be respected if these blocks take up more space.\r\n\r\nSince physical block sizes have increased since segwit, I think that there is no benefit to choosing `-prune=550` as opposed to `-prune=1000`:\r\nRunning with the smaller value will likely slow down IBD a bit (because we prune / flush chainstate more often), but once we are getting closer to the tip, the blockfile directory will be between `700MiB` and `900 MiB`, so we'll need more disk space eventually anyway (also, today's chainstate is > 12 GiB, which is large in comparison).\r\n\r\nSo I wonder if we should\r\n* increase the limit in a hard way - this would be an inconvenience to lots of existing users who would need to update their `bitcoin.conf` to be able to start bitcoind.\r\n* increase it in a soft way, something like disrepecting it on purpose by setting it to a higher value, but without an init error.\r\n* add a comment to the `-prune` doc that values around 550MiB are pointless.\r\n* do nothing",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 219890555,
        "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
        "name": "Block storage",
        "color": "000000",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 3,
    "created_at": "2024-05-03T20:46:13Z",
    "updated_at": "2024-05-06T16:55:19Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2094223248,
      "node_id": "IC_kwDOABII585800-Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2094223248",
      "actor": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-04T14:34:28Z",
      "updated_at": "2024-05-06T16:55:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "Great find!\r\n\r\nIt seems reasonable and safer to increase the min prune target, since blocks can be larger post-segwit (and we've seen it, e.g. 774628).  Some rough napkin math for a new value (correct me if something looks off):\r\n- 4MB per block, 288 blocks = 1152MB\r\n- Add 15% for Undo data = 1325MB\r\n- Add 20% for Orphan block rate = 1590MB\r\n- Add one block file + added 15% undo data = 147MB\r\n- Target >= 1737MB, so something like 1750MB seems at first glance that it could work\r\n\r\nI would recommend we minimize impact to existing nodes and provide time for warning/deprecation.\r\n>increase the limit in a hard way - this would be an inconvenience to lots of existing users who would need to update their bitcoin.conf to be able to start bitcoind\r\n\r\nThis seems like a no-go to me as it can impact node runtime.  An alternate option is presented below\r\n\r\n>increase it in a soft way, something like disrepecting it on purpose by setting it to a higher value, but without an init error.\r\n\r\nThis seems at minimum unintuitive and at most dangerous for node operators, since nodes with limited space would believe bitcoind was being limited/constrained to a particular allocated amount of space but would be exceeding the allocated amount.\r\n\r\n>add a comment to the -prune doc that values around 550MiB are pointless.\r\n\r\nYes, this seems prudent.\r\n\r\n>do nothing\r\n\r\nWe should do something, as this seems like a bug given current allowed block sizes.\r\n\r\nHow about something like:\r\n- Temporarily allow and respect values >= 550MB (e.g. for one release)\r\n- bitcoind provides a warning message for values between 550MB and 1750MB\r\n- Add a clear deprecation warning in the release notes\r\n- Add note/comment for `prune` in the default bitcoin.conf and `-prune` help/doc about values between 550MB and 1750MB being supported temporarily but unsupported in a future release, and that actual consumed storage may approach 1750MB even if 550MB is specified.\r\n- In a future release, the min prune target can be changed to and enforced to 1750MB",
      "user": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30037#issuecomment-2094223248",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037"
    },
    {
      "event": "labeled",
      "id": 12707469250,
      "node_id": "LE_lADOABII586HzaFOzwAAAAL1bJfC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12707469250",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-05T13:55:25Z",
      "label": {
        "name": "Block storage",
        "color": "000000"
      }
    },
    {
      "event": "commented",
      "id": 2096202995,
      "node_id": "IC_kwDOABII58588YTz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2096202995",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-06T14:42:34Z",
      "updated_at": "2024-05-06T14:43:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "> since nodes with limited space would believe bitcoind was being limited/constrained to a particular allocated amount of space but would be exceeding the allocated amount\r\n\r\nThis is already the case today, because the 288 blocks rule takes precedence over the user-provided number. With average block sizes of 1.6MiB currently, my synced `prune=550` node usually takes up between 700MiB and 900MiB of space for `*.blk` and `*.rev` files.. The target is only respected when possible (during the earlier parts of IBD where blocks are still small). So the point would be that if we are going to disrepect the target anyway in later stages of IBD we might as well start earlier (and gain some performance benefits).\r\n\r\n> Temporarily allow and respect values >= 550MB **but < 1750MB** (e.g. for one release)\r\n\r\nYou probably didn't mean it that way , but there is no maximum target, everything >=550MB is respected today, and we won't want to change that.\r\n\r\n> How about something like:\r\n\r\nSounds reasonable to me in general.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30037#issuecomment-2096202995",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037"
    },
    {
      "event": "commented",
      "id": 2096487922,
      "node_id": "IC_kwDOABII58589d3y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2096487922",
      "actor": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-06T16:51:34Z",
      "updated_at": "2024-05-06T16:51:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "> > since nodes with limited space would believe bitcoind was being limited/constrained to a particular allocated amount of space but would be exceeding the allocated amount\r\n> \r\n> This is already the case today, because the 288 blocks rule takes precedence over the user-provided number. With average block sizes of 1.6MiB currently, my synced `prune=550` node usually takes up between 700MiB and 900MiB of space for `*.blk` and `*.rev` files.. The target is only respected when possible (during the earlier parts of IBD where blocks are still small). So the point would be that if we are going to disrepect the target anyway in later stages of IBD we might as well start earlier (and gain some performance benefits).\r\n\r\nMaybe a good way to handle this is to include/enhance a warning (described above) to let the user know that actual consumed storage can be greater (e.g. up to 1750MB) even if 550MB is specified.\r\n\r\n> \r\n> > Temporarily allow and respect values >= 550MB **but < 1750MB** (e.g. for one release)\r\n> \r\n> You probably didn't mean it that way , but there is no maximum target, everything >=550MB is respected today, and we won't want to change that.\r\n\r\nCorrect, thanks for clarifying.  I should have been more accurate in describing it, and have adjusted the description above.  The overall idea is that in the interim we could be allowing/forgiving of values greater than 550MB but less than 1750MB.  Values < 550MB cause init failure.  In the interim all values >= 550MB are allowed.  At some point later, only values >= 1750MB are allowed.\r\n\r\n> \r\n> > How about something like:\r\n> \r\n> Sounds reasonable to me in general.\r\n\r\n",
      "user": {
        "login": "tdb3",
        "id": 106488469,
        "node_id": "U_kgDOBljilQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/106488469?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdb3",
        "html_url": "https://github.com/tdb3",
        "followers_url": "https://api.github.com/users/tdb3/followers",
        "following_url": "https://api.github.com/users/tdb3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tdb3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tdb3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tdb3/subscriptions",
        "organizations_url": "https://api.github.com/users/tdb3/orgs",
        "repos_url": "https://api.github.com/users/tdb3/repos",
        "events_url": "https://api.github.com/users/tdb3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tdb3/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30037#issuecomment-2096487922",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30037"
    }
  ]
}