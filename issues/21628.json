{
  "type": "issue",
  "issue": {
    "id": 852041145,
    "node_id": "MDU6SXNzdWU4NTIwNDExNDU=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/21628",
    "number": 21628,
    "state": "closed",
    "state_reason": "completed",
    "title": "Up to 100x perfomance difference for sqlite vs BDB in CreateWallet test ",
    "body": "Building master @ 41a8d2b96ff5cbc2efa9b0996f30228d0a625fdb (sqlite):\r\n```bash\r\n./autogen.sh\r\n./configure --without-bdb --without-gui --with-sqlite\r\n  with wallet     = yes\r\n    with sqlite   = yes\r\n    with bdb      = no\r\ngmake -j8\r\nsrc/test/test_bitcoin --run_test=wallet_tests --log_level=all\r\n...\r\nwallet/test/wallet_tests.cpp:696: Entering test case \"CreateWallet\"\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:734: info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp:740: info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp:741: info: check addtx_count == 2 has passed\r\nwallet/test/wallet_tests.cpp:744: info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:745: info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:753: info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp:767: info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:772: info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp:780: info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp:783: info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:784: info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:696: Leaving test case \"CreateWallet\"; testing time: 201296644us\r\nwallet/test/wallet_tests.cpp:791: Entering test case \"ZapSelectTx\"\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:810: info: check wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp:811: info: check wallet->mapWallet.count(block_hash) == 1u has passed\r\nwallet/test/wallet_tests.cpp:814: info: check wallet->ZapSelectTx(vHashIn, vHashOut) == DBErrors::LOAD_OK has passed\r\nwallet/test/wallet_tests.cpp:816: info: check !wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp:817: info: check wallet->mapWallet.count(block_hash) == 0u has passed\r\nwallet/test/wallet_tests.cpp:791: Leaving test case \"ZapSelectTx\"; testing time: 200866629us\r\n```\r\n\r\nCompare that to running the same tests after building with just bdb:\r\n```bash\r\ngmake clean\r\n./configure --without-gui --with-sqlite=no\r\n  with wallet     = yes\r\n    with sqlite   = no\r\n    with bdb      = yes\r\ngmake -j8\r\nsrc/test/test_bitcoin --run_test=wallet_tests --log_level=all\r\n...\r\nwallet/test/wallet_tests.cpp:696: Entering test case \"CreateWallet\"\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:734: info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp:740: info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp:741: info: check addtx_count == 2 has passed\r\nwallet/test/wallet_tests.cpp:744: info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:745: info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:753: info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp:767: info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:772: info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp:780: info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp:783: info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:784: info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp:696: Leaving test case \"CreateWallet\"; testing time: 2139054us\r\nwallet/test/wallet_tests.cpp:791: Entering test case \"ZapSelectTx\"\r\nwallet/test/wallet_tests.cpp:69: info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp:810: info: check wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp:811: info: check wallet->mapWallet.count(block_hash) == 1u has passed\r\nwallet/test/wallet_tests.cpp:814: info: check wallet->ZapSelectTx(vHashIn, vHashOut) == DBErrors::LOAD_OK has passed\r\nwallet/test/wallet_tests.cpp:816: info: check !wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp:817: info: check wallet->mapWallet.count(block_hash) == 0u has passed\r\nwallet/test/wallet_tests.cpp:791: Leaving test case \"ZapSelectTx\"; testing time: 1821042us\r\n```\r\n\r\nIn the sqlite case,`CreateWallet` is taking ~100x longer: `201296644us` vs `2139054us`. `ZapWalletTx` is similar: `200866629us` vs `1821042us`. [Full logs here](https://gist.github.com/fanquake/09e983acf0792482534f0fe7e916a03a).\r\n\r\nI thought this might be some weird macOS behaviour, but I tested on Linux, and am also seeing up to 27x difference. `CreateWallet`: `27905993us` vs `1092394us`. `ZapWalletTx`: `28024310us` vs `969432us`. [Full logs here](https://gist.github.com/fanquake/a1104888b5574af00a40a9998cfd0b36).",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      },
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 3,
    "closed_at": "2021-04-13T14:32:36Z",
    "created_at": "2021-04-07T06:04:00Z",
    "updated_at": "2022-08-18T19:53:09Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 4560365724,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ1NjAzNjU3MjQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4560365724",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T06:04:00Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "labeled",
      "id": 4560365726,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ1NjAzNjU3MjY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4560365726",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T06:04:00Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T06:17:14Z",
      "updated_at": "2021-04-07T06:17:14Z",
      "source": {
        "issue": {
          "id": 842736565,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NjAyMjQwMDcx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21540",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21540/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21540/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21540/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/21540",
          "number": 21540,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: refactor: dedup sqlite statement preparations/deletions",
          "body": "This refactoring PR deduplicates repeated SQLite statement preparation calls (`sqlite3_prepare_v2(...)`) / deletions (`sqlite3_finalize(...)`) and its surrounding logic by putting each prepared statement and its corresponding text representation into a ~std::map~ ~`std::array`~ `std::vector`. This should be more readable and less error-prone, e.g. in case an additional statement needs to be added in the  future or the error handling has to be adapted.",
          "user": {
            "login": "theStack",
            "id": 91535,
            "node_id": "MDQ6VXNlcjkxNTM1",
            "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/theStack",
            "html_url": "https://github.com/theStack",
            "followers_url": "https://api.github.com/users/theStack/followers",
            "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
            "organizations_url": "https://api.github.com/users/theStack/orgs",
            "repos_url": "https://api.github.com/users/theStack/repos",
            "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/theStack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21540",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/21540",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/21540.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/21540.patch"
          },
          "closed_at": "2021-04-07T06:18:00Z",
          "created_at": "2021-03-28T13:17:30Z",
          "updated_at": "2022-08-18T18:32:31Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 815146101,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTE0NjEwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/815146101",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T18:52:13Z",
      "updated_at": "2021-04-07T18:52:13Z",
      "author_association": "MEMBER",
      "body": "I'm not seeing this on my system.\r\n\r\n```\r\n./autogen.sh && ./configure --with-bdb --without-gui --without-sqlite && make -j31\r\n...\r\n  with wallet     = yes\r\n    with sqlite   = no\r\n    with bdb      = yes\r\n...\r\nsrc/test/test_bitcoin -t wallet_tests/CreateWallet -t wallet_tests/ZapSelectTx --log_level=all\r\n...\r\nwallet/test/wallet_tests.cpp(696): Entering test case \"CreateWallet\"\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(734): info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp(740): info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp(741): info: check addtx_count == 2 has passed\r\nwallet/test/wallet_tests.cpp(744): info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(745): info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(753): info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp(767): info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(772): info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp(780): info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp(783): info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(784): info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(696): Leaving test case \"CreateWallet\"; testing time: 990347us\r\nwallet/test/wallet_tests.cpp(791): Entering test case \"ZapSelectTx\"\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(810): info: check wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp(811): info: check wallet->mapWallet.count(block_hash) == 1u has passed\r\nwallet/test/wallet_tests.cpp(814): info: check wallet->ZapSelectTx(vHashIn, vHashOut) == DBErrors::LOAD_OK has passed\r\nwallet/test/wallet_tests.cpp(816): info: check !wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp(817): info: check wallet->mapWallet.count(block_hash) == 0u has passed\r\nwallet/test/wallet_tests.cpp(791): Leaving test case \"ZapSelectTx\"; testing time: 882547us\r\nwallet/test/wallet_tests.cpp(38): Leaving test suite \"wallet_tests\"; testing time: 1873052us\r\n```\r\n\r\n```\r\n./autogen.sh && ./configure --without-bdb --without-gui --with-sqlite && make -j31\r\n...\r\n  with wallet     = yes\r\n    with sqlite   = yes\r\n    with bdb      = no\r\n...\r\nsrc/test/test_bitcoin -t wallet_tests/CreateWallet -t wallet_tests/ZapSelectTx --log_level=all\r\n...\r\nwallet/test/wallet_tests.cpp(696): Entering test case \"CreateWallet\"\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(734): info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp(740): info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp(741): info: check addtx_count == 2 has passed\r\nwallet/test/wallet_tests.cpp(744): info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(745): info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(753): info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp(767): info: check rescan_completed has passed\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(772): info: check m_node.chain->broadcastTransaction(MakeTransactionRef(mempool_tx), DEFAULT_TRANSACTION_MAXFEE, false, error) has passed\r\nwallet/test/wallet_tests.cpp(780): info: check addtx_count == 4 has passed\r\nwallet/test/wallet_tests.cpp(783): info: check wallet->mapWallet.count(block_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(784): info: check wallet->mapWallet.count(mempool_tx.GetHash()) == 1U has passed\r\nwallet/test/wallet_tests.cpp(696): Leaving test case \"CreateWallet\"; testing time: 1006674us\r\nwallet/test/wallet_tests.cpp(791): Entering test case \"ZapSelectTx\"\r\nwallet/test/wallet_tests.cpp(69): info: check SignTransaction(mtx, &keystore, coins, SIGHASH_ALL, input_errors) has passed\r\nwallet/test/wallet_tests.cpp(810): info: check wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp(811): info: check wallet->mapWallet.count(block_hash) == 1u has passed\r\nwallet/test/wallet_tests.cpp(814): info: check wallet->ZapSelectTx(vHashIn, vHashOut) == DBErrors::LOAD_OK has passed\r\nwallet/test/wallet_tests.cpp(816): info: check !wallet->HasWalletSpend(prev_hash) has passed\r\nwallet/test/wallet_tests.cpp(817): info: check wallet->mapWallet.count(block_hash) == 0u has passed\r\nwallet/test/wallet_tests.cpp(791): Leaving test case \"ZapSelectTx\"; testing time: 934239us\r\n```",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21628#issuecomment-815146101",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628"
    },
    {
      "event": "commented",
      "id": 815164817,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTE2NDgxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/815164817",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T19:21:36Z",
      "updated_at": "2021-04-07T19:47:52Z",
      "author_association": "MEMBER",
      "body": "Tested on macOS 11.2.3 with Sqlite 3.34.1 via homebrew (though the wallet log says `Using SQLite Version 3.34.0`).\r\n\r\nWith sqlite the `CreateWallet` test seems to just freeze, though eventually it finished. 867 seconds. No notable CPU / memory / disk use.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21628#issuecomment-815164817",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628"
    },
    {
      "event": "commented",
      "id": 815253787,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTI1Mzc4Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/815253787",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T20:50:02Z",
      "updated_at": "2021-04-07T20:50:36Z",
      "author_association": "MEMBER",
      "body": "I am able to replicate this now. The issue is with disk I/O. When I have the unit tests use my hard drive (vs the ramdisk for my /tmp), I see slowdown.\r\n\r\nWith sqlite:\r\n\r\n```\r\nwallet/test/wallet_tests.cpp(696): Leaving test case \"CreateWallet\"; testing time: 1124026946us\r\n```\r\n\r\nWith BDB:\r\n\r\n```\r\nwallet/test/wallet_tests.cpp(696): Leaving test case \"CreateWallet\"; testing time: 3407781us\r\n```\r\n\r\nPresumably we are using sqlite sub-optimally and it is doing a lot more writes than BDB.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21628#issuecomment-815253787",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21628"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-08T01:28:09Z",
      "updated_at": "2021-04-08T01:28:09Z",
      "source": {
        "issue": {
          "id": 852968421,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NjExMTQwOTk2",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21634",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21634/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21634/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21634/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/21634",
          "number": 21634,
          "state": "closed",
          "state_reason": null,
          "title": "tests: Skip SQLite fsyncs while testing",
          "body": "Since we want tests to run quickly, and since tests do a lot more db operations than expected we expect to see in actual usage, we disable sqlite's syncing behavior to make db operations run much faster. This syncing behavior is necessary for normal operation as it helps guarantee that data won't become lost or corrupted, but in tests, we don't care about that.\r\n\r\nFixes #21628",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21634",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/21634",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/21634.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/21634.patch"
          },
          "closed_at": "2021-04-13T14:32:38Z",
          "created_at": "2021-04-08T01:28:09Z",
          "updated_at": "2022-08-18T18:23:05Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-12T16:05:11Z",
      "updated_at": "2021-04-12T16:05:11Z",
      "source": {
        "issue": {
          "id": 856127976,
          "node_id": "MDU6SXNzdWU4NTYxMjc5NzY=",
          "url": "https://api.github.com/repos/chaincodelabs/bitcoinperf/issues/59",
          "repository_url": "https://api.github.com/repos/chaincodelabs/bitcoinperf",
          "labels_url": "https://api.github.com/repos/chaincodelabs/bitcoinperf/issues/59/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/chaincodelabs/bitcoinperf/issues/59/comments",
          "events_url": "https://api.github.com/repos/chaincodelabs/bitcoinperf/issues/59/events",
          "html_url": "https://github.com/chaincodelabs/bitcoinperf/issues/59",
          "number": 59,
          "state": "open",
          "state_reason": null,
          "title": "Track sqlite wallet performance",
          "body": "See https://github.com/bitcoin/bitcoin/issues/21628",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "COLLABORATOR",
          "locked": false,
          "comments": 0,
          "created_at": "2021-04-12T16:05:11Z",
          "updated_at": "2021-04-12T16:05:11Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "closed",
      "id": 4588457895,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDU4ODQ1Nzg5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4588457895",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a1f0b8b62eb851c837a3618583b7c2fd4d12006c",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a1f0b8b62eb851c837a3618583b7c2fd4d12006c",
      "created_at": "2021-04-13T14:32:36Z"
    },
    {
      "event": "referenced",
      "id": 4589039315,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ1ODkwMzkzMTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4589039315",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c0ef5fd1e17f1383d250f81bc14e4856b130762d",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/c0ef5fd1e17f1383d250f81bc14e4856b130762d",
      "created_at": "2021-04-13T16:13:27Z"
    },
    {
      "event": "locked",
      "id": 7217166805,
      "node_id": "LOE_lADOABII584yyR25zwAAAAGuLTnV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7217166805",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-18T19:53:09Z",
      "lock_reason": "resolved"
    }
  ]
}