{
  "type": "issue",
  "issue": {
    "id": 2067634093,
    "node_id": "I_kwDOABII5857PZet",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29187",
    "number": 29187,
    "state": "open",
    "state_reason": null,
    "title": "Witness scripts being abused to bypass datacarriersize limit (CVE-2023-50428)",
    "body": "The `datacarriersize` policy option is meant to limit the size of extra data allowed in transactions for relaying and mining. Since the end of 2022, however, attackers have found a way to bypass this limit by obfuscating their spam inside OP_FALSE OP_IF patterns instead of using the standardized OP_RETURN. This remains under active exploitation to a degree very harmful to Bitcoin even today.\r\n\r\nA straightforward way to address this is to simply fix the bug (#28408), but that was (inappropriately) closed due to social attacks.\r\n\r\nThis remains an active issue that needs to be addressed.\r\n\r\nOther solutions have been proposed, including:\r\n\r\n* Rejecting transactions entirely if they attempt to bypass the datacarriersize limit (so-called \"Ordisrespector\")\r\n* Extending the existing policy script size limits to Tapscript. Currently, this varies for pre-segwit (1650) and segwit v0 transactions (3600), but could be unified and applied equally to all scripts. (This is included in Knots v25.1 currently)\r\n* Identifying extra data yet removing the witness discount rather than filtering it out entirely. It's not clear this would be effective alone, but is supported by Knots v25.1.\r\n* Adding a second `datacarriersize` with a broader scope like in #28408 ([suggested by glozow](https://github.com/bitcoin/bitcoin/issues/29187#issuecomment-1878972398)).\r\n* Moving back to a whitelist-based transaction policy, where only known/standardized scripts are accepted.\r\n* A softfork making data storage impractical. This would likely be very \"painful\" to implement, review, and even adopt (it would require upgrades from all wallets). It would also be a slow process and entail risks without significant economic support upfront.\r\n\r\nI have written code for the first 3, which I am happy to PR if there's interest. Perhaps others can suggest and/or implement other solutions.",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 82428251,
        "node_id": "MDU6TGFiZWw4MjQyODI1MQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy",
        "name": "TX fees and policy",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 4,
    "created_at": "2024-01-05T16:19:21Z",
    "updated_at": "2024-01-05T17:37:57Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1878972398,
      "node_id": "IC_kwDOABII585v_tfu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1878972398",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T16:51:24Z",
      "updated_at": "2024-01-05T16:51:24Z",
      "author_association": "MEMBER",
      "body": "> The datacarriersize policy option is meant to limit the size of extra data allowed in transactions for relaying and mining.\r\n\r\nHistory of this config option suggests `datacarriersize` is meant to limit the size of data in `OP_RETURN` outputs, so this statement is untrue.\r\n\r\n- comments on #3715: \r\n  - [comment](https://github.com/bitcoin/bitcoin/pull/3715#issuecomment-35701201) asked about including the usage of bare CHECKSIG and CHECKMULTISIG, arguing it should be in scope for that PR\r\n  - [comment](https://github.com/bitcoin/bitcoin/pull/3715#issuecomment-44412464) asked whether \"Data carrrier TX means in that context, that this are TXes, which contain data unrelated to the Bitcoin system...?\"\r\n  - [comment](https://github.com/bitcoin/bitcoin/pull/3715#issuecomment-44424455) said \"data carrier tx means a tx with an op_return output\"\r\n  - [comment](https://github.com/bitcoin/bitcoin/pull/3715#issuecomment-47009929) suggested people talking about bare multisig should go to #3939, indicating it was out of scope\r\n- #5077 adding `-datacarriersize` used `MAX_OP_RETURN_RELAY` as the default. That is still the case today.\r\n- 0.10.0, in which `-datacarrier` and `-datacarriersize` were first introduced, explicitly defined the term \"data carrier\" as pertaining to OP_RETURN transactions in the  [release notes](https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.10.0.md#mining-and-relay-policy-enhancements) :\r\n```\r\n    -datacarrier=0/1 : Relay and mine \"data carrier\" (OP_RETURN) transactions if this is 1.\r\n    -datacarriersize=n : Maximum size, in bytes, we consider acceptable for \"data carrier\" outputs.\r\n```\r\n- PR #11058 added the doc \"A data carrying output is an unspendable output containing data. The script type is designated as TX_NULL_DATA.\"\r\n\r\nThe docs from #11058 have not changed except for moving files:\r\nhttps://github.com/bitcoin/bitcoin/blob/cb6d619931e8a29ad2bee034c94b9e7ff8ac0a65/src/kernel/mempool_options.h#L46-L53\r\n\r\n\r\nInstead of retroactively deciding that `-datacarriersize` applies to more than just `OP_RETURN`s, why not propose a new config option?",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29187#issuecomment-1878972398",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187"
    },
    {
      "event": "commented",
      "id": 1879009564,
      "node_id": "IC_kwDOABII585v_2kc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879009564",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T17:17:31Z",
      "updated_at": "2024-01-05T17:17:31Z",
      "author_association": "MEMBER",
      "body": ">History of this config option suggests datacarriersize is meant to limit the size of data in OP_RETURN outputs, so this statement is untrue.\r\n\r\nIt's meant to limit extra data in transactions. OP_RETURN was supposed to be the only tolerated way to do that. `datacarriersize` has no possible use if it's trivial to bypass. The \"Ordisrespector\" approach would take us back to that prior status quo.\r\n\r\n>why not propose a new config option?\r\n\r\nIt would be confusingly redundant. But if that is Concept ACK'd, I would be happy to do it. (Added to list of solutions in OP for now)",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29187#issuecomment-1879009564",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187"
    },
    {
      "event": "commented",
      "id": 1879021930,
      "node_id": "IC_kwDOABII585v_5lq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879021930",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T17:27:35Z",
      "updated_at": "2024-01-05T17:27:35Z",
      "author_association": "MEMBER",
      "body": "> It's meant to limit extra data in transactions. OP_RETURN was supposed to be the only tolerated way to do that. \r\n\r\nCan you add any references for this? because the GitHub and git history very clearly contradicts your statements (https://github.com/bitcoin/bitcoin/issues/29187#issuecomment-1878972398).",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29187#issuecomment-1879021930",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187"
    },
    {
      "event": "labeled",
      "id": 11403586936,
      "node_id": "LE_lADOABII5857PZetzwAAAAKntO14",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11403586936",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T17:32:31Z",
      "label": {
        "name": "TX fees and policy",
        "color": "5319e7"
      }
    },
    {
      "event": "commented",
      "id": 1879034293,
      "node_id": "IC_kwDOABII585v_8m1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879034293",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T17:37:56Z",
      "updated_at": "2024-01-05T17:37:56Z",
      "author_association": "MEMBER",
      "body": "No, it doesn't contradict it. That overview conveniently leaves out the context of OP_RETURN being the _only_ way tolerated, and the `datacarriersize` limit makes no sense the way you want to spin it.",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29187#issuecomment-1879034293",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29187"
    }
  ]
}