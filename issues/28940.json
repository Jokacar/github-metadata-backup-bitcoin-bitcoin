{
  "type": "issue",
  "issue": {
    "id": 2010792387,
    "node_id": "I_kwDOABII58532kHD",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28940",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28940/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28940/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28940/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/28940",
    "number": 28940,
    "state": "open",
    "state_reason": null,
    "title": "`AddrManSelectByNetwork` benchmark fails on Windows",
    "body": "When compiling without external signer support, the resulted `bench_bitcoin.exe` fails on Windows:\r\n```\r\n>.\\bench_bitcoin.exe -filter=AddrManSelectByNetwork\r\nError: bad optional access\r\n```\r\n\r\nSteps to reproduce the failure:\r\n- cross compiling on Ubuntu 22.04:\r\n```\r\n$ make -j $(nproc) -C depends HOST=x86_64-w64-mingw32 NO_QT=1\r\n$ ./autogen.sh\r\n$ ./configure CONFIG_SITE=$PWD/depends/x86_64-w64-mingw32/share/config.site --disable-external-signer\r\n$ make -j $(nproc)\r\n```\r\n- compiling natively on Windows:\r\n\r\nApply the diff as follows:\r\n```diff\r\n--- a/build_msvc/bitcoin_config.h.in\r\n+++ b/build_msvc/bitcoin_config.h.in\r\n@@ -41,9 +41,6 @@\r\n /* Define this symbol to enable ZMQ functions */\r\n #define ENABLE_ZMQ 1\r\n \r\n-/* define if external signer support is enabled (requires Boost::Process) */\r\n-#define ENABLE_EXTERNAL_SIGNER /**/\r\n-\r\n /* Define to 1 if you have the declaration of `be16toh', and to 0 if you\r\n    don't. */\r\n #define HAVE_DECL_BE16TOH 0\r\n```\r\nThen\r\n```\r\n>py -3 build_msvc\\msvc-autogen.py\r\n>msbuild build_msvc\\bitcoin.sln -property:Configuration=Release -verbosity:minimal\r\n>src\\bench_bitcoin.exe -filter=AddrManSelectByNetwork\r\nError: bad optional access\r\n```\r\n\r\n---\r\n\r\nThe failure does not manifest itself when running `bench_bitcoin.exe` using Wine on Linux.",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 234877,
        "node_id": "MDU6TGFiZWwyMzQ4Nzc=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Windows",
        "name": "Windows",
        "color": "884400",
        "default": false
      },
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 2,
    "created_at": "2023-11-25T20:48:23Z",
    "updated_at": "2023-11-27T17:03:46Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 11061430226,
      "node_id": "LE_lADOABII58532kHDzwAAAAKTUAfS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11061430226",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-25T20:48:23Z",
      "label": {
        "name": "Windows",
        "color": "884400"
      }
    },
    {
      "event": "labeled",
      "id": 11061430228,
      "node_id": "LE_lADOABII58532kHDzwAAAAKTUAfU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11061430228",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-25T20:48:23Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-25T20:51:55Z",
      "updated_at": "2023-11-25T20:51:55Z",
      "source": {
        "issue": {
          "id": 1897386070,
          "node_id": "PR_kwDOABII585aYuI8",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28486",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28486/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28486/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28486/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28486",
          "number": 28486,
          "state": "open",
          "state_reason": null,
          "title": "bench: Initialize and terminate use of Winsock properly",
          "body": "On the master branch, when compiling without external signer support, the `bench_bitcoin.exe` does not initialize Winsock DLL that is required, for example, here: https://github.com/bitcoin/bitcoin/blob/459272d639b9547f68000d2b9a5a0d991d477de5/src/bench/addrman.cpp#L124\r\n\r\nThis PR fixes Winsock DLL initialization.\r\n\r\nMore docs:\r\n- https://learn.microsoft.com/en-us/windows/win32/winsock/initializing-winsock\r\n- https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-wsastartup\r\n- https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-wsacleanup\r\n\r\nFix https://github.com/bitcoin/bitcoin/issues/28940.",
          "user": {
            "login": "hebasto",
            "id": 32963518,
            "node_id": "MDQ6VXNlcjMyOTYzNTE4",
            "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hebasto",
            "html_url": "https://github.com/hebasto",
            "followers_url": "https://api.github.com/users/hebasto/followers",
            "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
            "organizations_url": "https://api.github.com/users/hebasto/orgs",
            "repos_url": "https://api.github.com/users/hebasto/repos",
            "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/hebasto/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 11,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28486",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28486",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28486.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28486.patch"
          },
          "created_at": "2023-09-14T22:08:00Z",
          "updated_at": "2023-11-25T20:56:01Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1828249319,
      "node_id": "IC_kwDOABII585s-N7n",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828249319",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-27T16:57:31Z",
      "updated_at": "2023-11-27T16:57:31Z",
      "author_association": "MEMBER",
      "body": "Yep, this makes sense to me.\r\n\r\nSee boost asio: https://github.com/boostorg/asio/blob/develop/include/boost/asio/detail/impl/winsock_init.ipp#L39\r\n\r\nAnd a static instance of that is created here: https://github.com/boostorg/asio/blob/develop/include/boost/asio/detail/winsock_init.hpp#L116\r\n\r\nAnd I see those being included by`<boost/process.hpp>` from `run_command.cpp`. So I'm guessing boost has been quietly initializing our network stack :(",
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28940#issuecomment-1828249319",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28940"
    },
    {
      "event": "commented",
      "id": 1828260119,
      "node_id": "IC_kwDOABII585s-QkX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1828260119",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-27T17:03:44Z",
      "updated_at": "2023-11-27T17:03:44Z",
      "author_association": "MEMBER",
      "body": "YUCK.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28940#issuecomment-1828260119",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28940"
    }
  ]
}