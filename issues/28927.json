{
  "type": "issue",
  "issue": {
    "id": 2006484738,
    "node_id": "I_kwDOABII5853mIcC",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/28927",
    "number": 28927,
    "state": "open",
    "state_reason": null,
    "title": "importing a wallet containing an hdseed overwrites target wallet hdseed",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\n\r\nMy basic idea was to have two nodes running with the same keys, if one fails, I can just rescan the blockchain on the other one and failover to it seamlessly.\r\n\r\nI made a wallet on Node1, generated a few thousands addresses, saved the dumpwallet. Now I want to import the same keys to Node2, but I want it to be an HD wallet from the same seed, to avoid the headache of sendtoaddress, when out of spare keys, creating a new change privkey that will not be backed up anywhere. With the hdseed those \"new\" change addresses should still be accessible to whomever owns the hdseed (right?)\r\n\r\nThis doesn't seem to work so well as importwallet on Node2 seems to get it rid of the hdseed I set to be the same as on Node1.\r\n\r\nI don't know if the resulting state of Node2 means that it still has an HD wallet. Doesn't look so from the dumpwallet ouput.\r\nImportwallet seems to overwrite hdseed, making it just a regular privkey, no longer being hdseed.\r\n\r\nNot sure this is working as intended.\r\n\r\n\r\n\n\n### Expected behaviour\n\nExpected behaviour: Node2 keeps its hdseed\n\n### Steps to reproduce\n\nNode1: has a wallet with hdseed=X\r\nNode1: dumpwallet, grab the hdseed privkey from the output\r\n\r\nNode2: createwallet \"test\" false true\r\nNode2: sethdseed to the above-obtained hdseed privkey X\r\nNode2: importwallet from the above dump\r\nNode2: dumpwallet. Result does not contain an hdseed=1 line. It does contain the private key, but just with a \"label=\"\r\nNode2: sethdseed again to the hdseed privkey fails with the message \"either already has an hdseed or it's a loose private key\"\r\n\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv22.0\n\n### Operating system and version\n\nDebian 12\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "quakemmo",
      "id": 39710297,
      "node_id": "MDQ6VXNlcjM5NzEwMjk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/39710297?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quakemmo",
      "html_url": "https://github.com/quakemmo",
      "followers_url": "https://api.github.com/users/quakemmo/followers",
      "following_url": "https://api.github.com/users/quakemmo/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/quakemmo/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/quakemmo/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/quakemmo/subscriptions",
      "organizations_url": "https://api.github.com/users/quakemmo/orgs",
      "repos_url": "https://api.github.com/users/quakemmo/repos",
      "events_url": "https://api.github.com/users/quakemmo/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/quakemmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 3,
    "created_at": "2023-11-22T14:36:29Z",
    "updated_at": "2024-03-15T04:19:36Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1825170183,
      "node_id": "IC_kwDOABII585syeMH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1825170183",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-24T05:34:57Z",
      "updated_at": "2023-11-24T05:34:57Z",
      "author_association": "MEMBER",
      "body": "`importwallet` does not import any metadata, including whether something is the seed. That it overwrites the seed metadata is expected behavior, although it should still work as the seed. You can check whether both wallets use the same seed by looking at `hdseedid` in `getwalletinfo`, and also generating some addresses to see if both wallets recognize them with `getaddressinfo`.\r\n\r\nHowever, the workflow that you are using uses the legacy wallet storage format which is targeted to be removed soon. If there is indeed an issue, it is unlikely that it will be fixed, particularly as the effect that you want to achieve can be done with different methods. I do want to note though that the same wallet on two nodes is not recommended as metadata will not be the same and there can still be discrepancies between the copies of the wallet due to things such as RBF and related issues with unconfirmed transactions.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28927#issuecomment-1825170183",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927"
    },
    {
      "event": "commented",
      "id": 1825262967,
      "node_id": "IC_kwDOABII585sy013",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1825262967",
      "actor": {
        "login": "quakemmo",
        "id": 39710297,
        "node_id": "MDQ6VXNlcjM5NzEwMjk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/39710297?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/quakemmo",
        "html_url": "https://github.com/quakemmo",
        "followers_url": "https://api.github.com/users/quakemmo/followers",
        "following_url": "https://api.github.com/users/quakemmo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/quakemmo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/quakemmo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/quakemmo/subscriptions",
        "organizations_url": "https://api.github.com/users/quakemmo/orgs",
        "repos_url": "https://api.github.com/users/quakemmo/repos",
        "events_url": "https://api.github.com/users/quakemmo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/quakemmo/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-24T07:43:32Z",
      "updated_at": "2023-11-24T08:31:29Z",
      "author_association": "NONE",
      "body": "@achow101 Thank you for your reply.\r\n\r\nCan you please point me to the right direction as far as the \"proper workflow\" is concerned? My basic need is to have two nodes that I can failover between in case one goes down, with no coin loss (obviously) and reasonable downtime.\r\n\r\nThe nodes will be used for a classic mechanism of receiving user deposits (each user has its own BTC address), and sending withdrawals using \"sendtoaddress\" at first, then using raw transactions when I implement that.  I pregenerated a number of addresses using \"getnewaddress\" and backed up the pkeys in addition to the hdseed, just in case. I managed to set the same hdseed on both nodes and imported the pregenerated addresses from node 1 to node 2.\r\n\r\nAlso can you please elaborate on the \"unconfirmed transactions\" discrepancies\"? If that means that by failing to another node will lose the original node's mempool, then it's no big deal as I save the original transactions data (that I get by \"getrawtransaction\") and can just propagate them again if needed. Or do you mean something different?\r\n\r\nThanks!\r\n\r\nPS: current getwalletinfo on both nodes is:\r\n\r\n```\r\n{\r\n  \"walletname\": \"main\",\r\n  \"walletversion\": 169900,\r\n  \"format\": \"bdb\",\r\n  \"balance\": 0.00000000,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 0,\r\n  \"keypoololdest\": 1669302186,\r\n  \"keypoolsize\": 1000,\r\n  \"hdseedid\": \"<stripped>\",\r\n  \"keypoolsize_hd_internal\": 1000,\r\n  \"paytxfee\": 0.00000000,\r\n  \"private_keys_enabled\": true,\r\n  \"avoid_reuse\": false,\r\n  \"scanning\": false,\r\n  \"descriptors\": false\r\n}\r\n```\r\n\r\nThe only difference being the keypoololdest field that is higher on node2 (seems logical).",
      "user": {
        "login": "quakemmo",
        "id": 39710297,
        "node_id": "MDQ6VXNlcjM5NzEwMjk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/39710297?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/quakemmo",
        "html_url": "https://github.com/quakemmo",
        "followers_url": "https://api.github.com/users/quakemmo/followers",
        "following_url": "https://api.github.com/users/quakemmo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/quakemmo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/quakemmo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/quakemmo/subscriptions",
        "organizations_url": "https://api.github.com/users/quakemmo/orgs",
        "repos_url": "https://api.github.com/users/quakemmo/repos",
        "events_url": "https://api.github.com/users/quakemmo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/quakemmo/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28927#issuecomment-1825262967",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927"
    },
    {
      "event": "mentioned",
      "id": 11053664906,
      "node_id": "MEE_lADOABII5853mIcCzwAAAAKS2YqK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11053664906",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-24T07:43:33Z"
    },
    {
      "event": "subscribed",
      "id": 11053664913,
      "node_id": "SE_lADOABII5853mIcCzwAAAAKS2YqR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11053664913",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-24T07:43:33Z"
    },
    {
      "event": "labeled",
      "id": 11587091885,
      "node_id": "LE_lADOABII5853mIcCzwAAAAKypP2t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11587091885",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-24T16:55:26Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "commented",
      "id": 1998909730,
      "node_id": "IC_kwDOABII5853JPEi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1998909730",
      "actor": {
        "login": "bitchad42",
        "id": 161651197,
        "node_id": "U_kgDOCaKZ_Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/161651197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitchad42",
        "html_url": "https://github.com/bitchad42",
        "followers_url": "https://api.github.com/users/bitchad42/followers",
        "following_url": "https://api.github.com/users/bitchad42/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitchad42/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitchad42/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitchad42/subscriptions",
        "organizations_url": "https://api.github.com/users/bitchad42/orgs",
        "repos_url": "https://api.github.com/users/bitchad42/repos",
        "events_url": "https://api.github.com/users/bitchad42/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitchad42/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-15T04:19:35Z",
      "updated_at": "2024-03-15T04:19:35Z",
      "author_association": "NONE",
      "body": "\"Don't use the node for wallet\" seems to be the proper workflow, it seems.\r\n\r\nI find it unacceptable that if the hard drive dies there is a chance to lose coins because the wallet can't be reliably derived on another device.\r\n\r\nI was trying to find out if this is the case, and apparently it is.",
      "user": {
        "login": "bitchad42",
        "id": 161651197,
        "node_id": "U_kgDOCaKZ_Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/161651197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitchad42",
        "html_url": "https://github.com/bitchad42",
        "followers_url": "https://api.github.com/users/bitchad42/followers",
        "following_url": "https://api.github.com/users/bitchad42/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitchad42/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitchad42/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitchad42/subscriptions",
        "organizations_url": "https://api.github.com/users/bitchad42/orgs",
        "repos_url": "https://api.github.com/users/bitchad42/repos",
        "events_url": "https://api.github.com/users/bitchad42/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitchad42/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28927#issuecomment-1998909730",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28927"
    }
  ]
}