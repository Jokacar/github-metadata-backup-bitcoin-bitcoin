{
  "type": "issue",
  "issue": {
    "id": 2265800207,
    "node_id": "I_kwDOABII586HDV4P",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29972",
    "number": 29972,
    "state": "open",
    "state_reason": null,
    "title": "qa: Support git worktrees when running the linters locally via Docker",
    "body": "I discovered that running this command (from `test/lint/README.md`):\r\n```\r\nDOCKER_BUILDKIT=1 docker build -t bitcoin-linter --file \"./ci/lint_imagefile\" ./ && docker run --rm -v $(pwd):/bitcoin -it bitcoin-linter\r\n```\r\ndoesn't work when trying to run it out of a git worktree:\r\n```\r\nfatal: not a git repository: /home/sdaftuar/bitcoin/.git/worktrees/2024-04-cluster-mempool-txgraph-rebased\r\n```\r\n (Though it did work for me when I tried checking out my branch in a regular git repo).  \r\n\r\nI don't know anything about these scripts, but if there's an easy way to support worktrees I think it would be useful!",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      },
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 10,
    "created_at": "2024-04-26T13:32:11Z",
    "updated_at": "2024-05-03T10:24:48Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 12623947265,
      "node_id": "LE_lADOABII586HDV4PzwAAAALwciYB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12623947265",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-26T13:32:11Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "labeled",
      "id": 12623992267,
      "node_id": "LE_lADOABII586HDV4PzwAAAALwctXL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12623992267",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-26T13:35:54Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 2079680643,
      "node_id": "IC_kwDOABII58579WiD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2079680643",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-26T16:06:10Z",
      "updated_at": "2024-04-26T16:06:10Z",
      "author_association": "MEMBER",
      "body": "Yes, this happens if you try to run any of the CI tasks locally in a worktree.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2079680643",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2080415116,
      "node_id": "IC_kwDOABII5858AJ2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2080415116",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-27T08:25:44Z",
      "updated_at": "2024-04-27T08:25:44Z",
      "author_association": "MEMBER",
      "body": "i think the root problem here is that docker only provides access to the source directory to the container, and a worktree isn't self-contained, it contains a path to the actual repository the worktree comes from, which won't be available there. The linters need access to git metadata to do their checks (for example, to make sure that they only check files in git, not generated ones).",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2080415116",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2080420581,
      "node_id": "IC_kwDOABII5858ALLl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2080420581",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-27T08:51:26Z",
      "updated_at": "2024-04-27T08:51:26Z",
      "author_association": "MEMBER",
      "body": "> Yes, this happens if you try to run any of the CI tasks locally in a worktree.\r\n\r\nAt least for the \"real\" CI tasks, we should consider making a fallback, as I don't think much from git is needed? So far I could only find `git log -1` in `ci/test/`, but that should work in a worktree, no?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2080420581",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2080422077,
      "node_id": "IC_kwDOABII5858ALi9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2080422077",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-27T08:57:44Z",
      "updated_at": "2024-04-27T08:57:44Z",
      "author_association": "MEMBER",
      "body": ">  but that should work in a worktree, no?\r\n\r\nAll git commands work in a worktree, but not when it is seperated from its main repository by containers.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2080422077",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2081499778,
      "node_id": "IC_kwDOABII5858ESqC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2081499778",
      "actor": {
        "login": "eval-exec",
        "id": 46400566,
        "node_id": "MDQ6VXNlcjQ2NDAwNTY2",
        "avatar_url": "https://avatars.githubusercontent.com/u/46400566?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eval-exec",
        "html_url": "https://github.com/eval-exec",
        "followers_url": "https://api.github.com/users/eval-exec/followers",
        "following_url": "https://api.github.com/users/eval-exec/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eval-exec/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eval-exec/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eval-exec/subscriptions",
        "organizations_url": "https://api.github.com/users/eval-exec/orgs",
        "repos_url": "https://api.github.com/users/eval-exec/repos",
        "events_url": "https://api.github.com/users/eval-exec/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eval-exec/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-28T14:17:20Z",
      "updated_at": "2024-04-28T14:17:20Z",
      "author_association": "NONE",
      "body": "I can't reproduce that error:\r\n```\r\nbitcoin on  exec/worktree via 🐍 v3.8.18 via ❄️   impure (btc)\r\n❯ DOCKER_BUILDKIT=1 docker build -t bitcoin-linter --file \"./ci/lint_imagefile\" ./ && docker run --rm -v $(pwd):/bitcoin -it bitcoin-linter\r\n[+] Building 3.4s (12/12) FINISHED                                                                                                                                    docker:default\r\n => [internal] load build definition from lint_imagefile                                                                                                                        0.0s\r\n => => transferring dockerfile: 708B                                                                                                                                            0.0s\r\n => [internal] load .dockerignore                                                                                                                                               0.0s\r\n => => transferring context: 2B                                                                                                                                                 0.0s\r\n => [internal] load metadata for docker.io/library/debian:bookworm                                                                                                              3.4s\r\n => [1/7] FROM docker.io/library/debian:bookworm@sha256:1aadfee8d292f64b045adb830f8a58bfacc15789ae5f489a0fedcd517a862cb9                                                        0.0s\r\n => [internal] load build context                                                                                                                                               0.0s\r\n => => transferring context: 473B                                                                                                                                               0.0s\r\n => CACHED [2/7] COPY ./.python-version /.python-version                                                                                                                        0.0s\r\n => CACHED [3/7] COPY ./ci/lint/container-entrypoint.sh /entrypoint.sh                                                                                                          0.0s\r\n => CACHED [4/7] COPY ./ci/lint/04_install.sh /install.sh                                                                                                                       0.0s\r\n => CACHED [5/7] COPY ./test/lint/test_runner /test/lint/test_runner                                                                                                            0.0s\r\n => CACHED [6/7] RUN /install.sh &&   echo 'alias lint=\"./ci/lint/06_script.sh\"' >> ~/.bashrc &&   chmod 755 /entrypoint.sh &&   rm -rf /var/lib/apt/lists/*                    0.0s\r\n => CACHED [7/7] WORKDIR /bitcoin                                                                                                                                               0.0s\r\n => exporting to image                                                                                                                                                          0.0s\r\n => => exporting layers                                                                                                                                                         0.0s\r\n => => writing image sha256:f1751706ad3a59a294be4c368f55e034b440840a6a892bcc84890ca31417d273                                                                                    0.0s\r\n => => naming to docker.io/library/bitcoin-linter                                                                                                                               0.0s\r\n+ '[' -n '' ']'\r\n++ git rev-list --max-count=1 --merges HEAD\r\n+ COMMIT_RANGE=3aaf7328eb656b642e5f0f74f3e4d51645a1d0ab..HEAD\r\n+ export COMMIT_RANGE\r\n+ echo\r\n\r\n+ git log --no-merges --oneline 3aaf7328eb656b642e5f0f74f3e4d51645a1d0ab..HEAD\r\n+ echo\r\n\r\n+ test/lint/commit-script-check.sh 3aaf7328eb656b642e5f0f74f3e4d51645a1d0ab..HEAD\r\n+ RUST_BACKTRACE=1\r\n+ /lint_test_runner/test_runner\r\nsrc/crc32c in HEAD currently refers to tree 454691a9b89ee8b9e1f71a48a7398edba49c3805\r\nsrc/crc32c in HEAD was last updated in commit 5d45552fd4303f8d668ffbc50cce1053485aeead (tree 454691a9b89ee8b9e1f71a48a7398edba49c3805)\r\nGOOD\r\nsrc/crypto/ctaes in HEAD currently refers to tree 1b6c31139a71f80245c09597c343936a8e41d021\r\nsrc/crypto/ctaes in HEAD was last updated in commit 8501bedd7508ac514385806e191aec21ee978891 (tree 1b6c31139a71f80245c09597c343936a8e41d021)\r\nGOOD\r\nsrc/leveldb in HEAD currently refers to tree bd49d3c60051c1a8d8f030fa4ba7a29237fe7479\r\nsrc/leveldb in HEAD was last updated in commit 1a463c70a368fb20316e03efac273438cf47baa3 (tree bd49d3c60051c1a8d8f030fa4ba7a29237fe7479)\r\nGOOD\r\nsrc/minisketch in HEAD currently refers to tree a584efdc3ab5184a004807db66381c5c482e5f41\r\nsrc/minisketch in HEAD was last updated in commit 1eea10a6d25fd8225560347cda2b1cfdc267910d (tree a584efdc3ab5184a004807db66381c5c482e5f41)\r\nGOOD\r\nsrc/secp256k1 in HEAD currently refers to tree c3c4db9c0e4636135963272b005b11a451303feb\r\nsrc/secp256k1 in HEAD was last updated in commit 53eec53dca1cb677d11564b055d3b8581ddd6747 (tree c3c4db9c0e4636135963272b005b11a451303feb)\r\nGOOD\r\nArgs used        : 210\r\nArgs documented  : 222\r\nArgs undocumented: 0\r\nset()\r\nArgs unknown     : 12\r\n{'-zmqpubhashtx', '-zmqpubrawtx', '-zmqpubsequence', '-zmqpubhashblockhwm', '-zmqpubrawblock', '-testdatadir', '-zmqpubhashblock', '-zmqpubsequencehwm', '-zmqpubhashtxhwm', '-includeconf', '-zmqpubrawblockhwm', '-zmqpubrawtxhwm'}\r\nSuccess: no issues found in 292 source files\r\n+ '[' '' = bitcoin/bitcoin ']'\r\nbitcoin on  exec/worktree via 🐍 v3.8.18 via ❄️   impure (btc) took 23s\r\n❯ pwd\r\n/home/exec/Projects/github.com/bitcoin/bitcoin\r\nbitcoin on  exec/worktree via 🐍 v3.8.18 via ❄️   impure (btc)\r\n❯ git status\r\nOn branch exec/worktree\r\nChanges not staged for commit:\r\n  (use \"git add <file>...\" to update what will be committed)\r\n  (use \"git restore <file>...\" to discard changes in working directory)\r\n        modified:   src/addrdb.cpp\r\n\r\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\r\n\r\n```",
      "user": {
        "login": "eval-exec",
        "id": 46400566,
        "node_id": "MDQ6VXNlcjQ2NDAwNTY2",
        "avatar_url": "https://avatars.githubusercontent.com/u/46400566?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eval-exec",
        "html_url": "https://github.com/eval-exec",
        "followers_url": "https://api.github.com/users/eval-exec/followers",
        "following_url": "https://api.github.com/users/eval-exec/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eval-exec/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eval-exec/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eval-exec/subscriptions",
        "organizations_url": "https://api.github.com/users/eval-exec/orgs",
        "repos_url": "https://api.github.com/users/eval-exec/repos",
        "events_url": "https://api.github.com/users/eval-exec/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eval-exec/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2081499778",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2091588721,
      "node_id": "IC_kwDOABII5858qxxx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2091588721",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T21:04:35Z",
      "updated_at": "2024-05-02T21:25:44Z",
      "author_association": "MEMBER",
      "body": "On closer inspection, this seems to end up writing some files as root in the mypy_cache dire worktree which is not ideal as it means the worktree can't be deleted in the usual way.\r\n\r\n~~I think it _can_ be done, although it's quite hacky:~~\r\n\r\n```bash\r\nDOCKER_BUILDKIT=1 docker build -t bitcoin-linter --file \"./ci/lint_imagefile\" ./ && GIT_DIR=$(git rev-parse --path-format=absolute --git-common-dir) docker run --rm -v $(pwd):/bitcoin -v \"$GIT_DIR\":\"$GIT_DIR\" -it bitcoin-linter\r\n```\r\n\r\n~~This mounts the external (real) `.git` directory (which is a symlink in the worktree, and not possible to follow from inside of the container) to the same location inside of the container, making the symlink work again. The mount is not quite perfect and could perhaps be refined, but `git` does not seem to mind.~~\r\n\r\nI don't think it will be possible to support worktrees in a less hacky way with the container, so the other option is to activate a python (v)env with required deps + shellcheck, and run the test-runner manually in the worktree with e.g.:\r\n\r\n```bash\r\ncd test/lint/test_runner\r\nCOMMIT_RANGE=\"$( git rev-list --max-count=1 --merges HEAD )..HEAD\" cargo run\r\n```",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2091588721",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2092489093,
      "node_id": "IC_kwDOABII5858uNmF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2092489093",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T07:51:08Z",
      "updated_at": "2024-05-03T07:51:08Z",
      "author_association": "MEMBER",
      "body": "Update:\r\n\r\nTo avoid creating root-owned mypy files you can run the container with your user:group specified:\r\n\r\n```bash\r\nDOCKER_BUILDKIT=1 docker build -t bitcoin-linter --file \"./ci/lint_imagefile\" ./ && GIT_DIR=$(git rev-parse --path-format=absolute --git-common-dir) docker run --rm -v $(pwd):/bitcoin -v \"$GIT_DIR\":\"$GIT_DIR\" -u $(id -u):$(id -g) -it bitcoin-linter\r\n```\r\n\r\nThis allows `git worktree remove` to succeed.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2092489093",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2092643562,
      "node_id": "IC_kwDOABII5858uzTq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2092643562",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T09:31:12Z",
      "updated_at": "2024-05-03T09:31:12Z",
      "author_association": "MEMBER",
      "body": "> To avoid creating root-owned mypy files\r\n\r\nProbably unrelated, but ideally, I'd say that the container should not modify anything on the host. The \"real\" CI script use a `readonly` `--mount`.\r\n\r\nIf something needs to be cached, it can be done in a persisted volume?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2092643562",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "commented",
      "id": 2092689211,
      "node_id": "IC_kwDOABII5858u-c7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2092689211",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T10:01:40Z",
      "updated_at": "2024-05-03T10:01:40Z",
      "author_association": "MEMBER",
      "body": "Yes I agree, this bothers me too.\r\n\r\nSeems like we could perhaps use mypy's [--cache-dir](https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-cache-dir) option to have it use `/dev/null` and avoid modifying source dir. I might try it out with the RO mount soon and see if it works OK that way or if there's anything else trying to make changes to the FS.\r\n\r\nI don't want to derail this issue, but in a somewhat-related changeset I was also wondering if I could _speed up_ the linter image build (with better layer caching) by building from the python base image and absorbing the install script into the image (as part of a general python revamp in [this branch](https://github.com/bitcoin/bitcoin/compare/master...willcl-ark:bitcoin:fixup-lint-docker-image)).\r\n\r\nI'd be curious what you thought of this approach @maflcko (perhaps I should open another issue to discuss it?) ISTM that without the install script, and with the introduction of `requirements-lint.txt` developers would generally be able to run the local linter (`pip install -r requirements-lint.txt && cd test/lint/test_runner && cargo run ...`) more easily, and the container can build can be sped up quite significantly. What I'm not sure of is if the script has other purposes which this would interfere with...\r\n\r\nNB: the CI stuff in that branch is broken/WIP, and I'm not convinced in any benefit to merging `.style.yapf` into a potential `pyproject.toml`.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2092689211",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    },
    {
      "event": "mentioned",
      "id": 12694426415,
      "node_id": "MEE_lADOABII586HDV4PzwAAAAL0pZMv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12694426415",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T10:01:41Z"
    },
    {
      "event": "subscribed",
      "id": 12694426422,
      "node_id": "SE_lADOABII586HDV4PzwAAAAL0pZM2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12694426422",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T10:01:41Z"
    },
    {
      "event": "commented",
      "id": 2092726109,
      "node_id": "IC_kwDOABII5858vHdd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2092726109",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T10:24:47Z",
      "updated_at": "2024-05-03T10:24:47Z",
      "author_association": "MEMBER",
      "body": "> (as part of a general python revamp in [this branch](https://github.com/bitcoin/bitcoin/compare/master...willcl-ark:bitcoin:fixup-lint-docker-image)).\r\n\r\nNot sure about complicating the cirrus yml. I think it should be considered to be set in stone, because any changes will break re-running the lint task on old pull requests, IIRC. At this point, if you want to change it substantially, it could make sense to move it to GHA, along with an update to DrahtBot to be able to re-run GHA tasks. :sweat_smile:\r\n\r\nAlso, not sure about dockers `python:`, as that removes the flexibility to use (let's say) debian:trixie, or ubuntu:noble.\r\n\r\nNo objection about using more layers, if you think that is useful and needed often.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29972#issuecomment-2092726109",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29972"
    }
  ]
}