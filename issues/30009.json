{
  "type": "issue",
  "issue": {
    "id": 2272605641,
    "node_id": "I_kwDOABII586HdTXJ",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30009",
    "number": 30009,
    "state": "open",
    "state_reason": null,
    "title": "Change estimate_mode default to \"ECONOMICAL\" in these RPC calls",
    "body": "The default fee estimate mode for the following RPC calls is set to \"ECONOMICAL\" rather than \"CONSERVATIVE\".\r\n\r\nMy observation running a Bitcoin non-custodial exchange and payment processor which creates a lot transactions is that Bitcoin Core on conservative mode consistently overpays transaction fees as compared to mempool's fee estimation algorithm. I have collected data on this, if anyone needs convincing, but I think this is common knowledge.\r\n\r\nSince RBF, it is standard best practice for advanced Bitcoin users to \"lowall\" transaction fees instead and RBF later if their transaction. Unfortunately, Bitcoin Core users and wallets which use Bitcoin Core's fee estimation will probably use the default mode (as users always do) and this will lead them to \"overpay\" more often than not.\r\n\r\nTherefore, I suggest changing the default fee estimation mode to \"ECONOMICAL\" in the following RPCs\r\n\r\n[estimatesmartfee](https://developer.bitcoin.org/reference/rpc/estimatesmartfee.html?highlight=estimate_mode)\r\n\r\n[send](https://developer.bitcoin.org/reference/rpc/send.html?highlight=estimate_mode)\r\n\r\n[sendmany](https://developer.bitcoin.org/reference/rpc/sendmany.html?highlight=estimate_mode)\r\n\r\n[sendtoaddress](https://developer.bitcoin.org/reference/rpc/sendtoaddress.html?highlight=estimate_mode)\r\n\r\n[fundrawtransaction](https://developer.bitcoin.org/reference/rpc/fundrawtransaction.html?highlight=estimate_mode)\r\n\r\n[Getting Started](https://developer.bitcoin.org/index.html?highlight=estimate_mode)\r\n\r\n[walletcreatefundedpsbt](https://developer.bitcoin.org/reference/rpc/walletcreatefundedpsbt.html?highlight=estimate_mode)\r\n\r\nI would exclude this change from RBF related RPCs, where the user probably wants the RBF to be sucessful and is clearly willing to pay more for faster confirmation.\r\n\r\n[psbtbumpfee](https://developer.bitcoin.org/reference/rpc/psbtbumpfee.html?highlight=estimate_mode)\r\n\r\n[bumpfee](https://developer.bitcoin.org/reference/rpc/bumpfee.html?highlight=estimate_mode)\r\n\r\nI'm not a developer but am willing to financially support a developer willing to make a PR for this if there is interest.\r\n",
    "user": {
      "login": "BullishNode",
      "id": 75800272,
      "node_id": "MDQ6VXNlcjc1ODAwMjcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/75800272?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BullishNode",
      "html_url": "https://github.com/BullishNode",
      "followers_url": "https://api.github.com/users/BullishNode/followers",
      "following_url": "https://api.github.com/users/BullishNode/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/BullishNode/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/BullishNode/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/BullishNode/subscriptions",
      "organizations_url": "https://api.github.com/users/BullishNode/orgs",
      "repos_url": "https://api.github.com/users/BullishNode/repos",
      "events_url": "https://api.github.com/users/BullishNode/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/BullishNode/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 7,
    "created_at": "2024-04-30T22:48:25Z",
    "updated_at": "2024-06-12T03:04:28Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 12664829318,
      "node_id": "LE_lADOABII586HdTXJzwAAAALy4fWG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12664829318",
      "actor": {
        "login": "BullishNode",
        "id": 75800272,
        "node_id": "MDQ6VXNlcjc1ODAwMjcy",
        "avatar_url": "https://avatars.githubusercontent.com/u/75800272?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BullishNode",
        "html_url": "https://github.com/BullishNode",
        "followers_url": "https://api.github.com/users/BullishNode/followers",
        "following_url": "https://api.github.com/users/BullishNode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BullishNode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BullishNode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BullishNode/subscriptions",
        "organizations_url": "https://api.github.com/users/BullishNode/orgs",
        "repos_url": "https://api.github.com/users/BullishNode/repos",
        "events_url": "https://api.github.com/users/BullishNode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BullishNode/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T22:48:25Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 2087669682,
      "node_id": "IC_kwDOABII5858b0-y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2087669682",
      "actor": {
        "login": "BullishNode",
        "id": 75800272,
        "node_id": "MDQ6VXNlcjc1ODAwMjcy",
        "avatar_url": "https://avatars.githubusercontent.com/u/75800272?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BullishNode",
        "html_url": "https://github.com/BullishNode",
        "followers_url": "https://api.github.com/users/BullishNode/followers",
        "following_url": "https://api.github.com/users/BullishNode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BullishNode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BullishNode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BullishNode/subscriptions",
        "organizations_url": "https://api.github.com/users/BullishNode/orgs",
        "repos_url": "https://api.github.com/users/BullishNode/repos",
        "events_url": "https://api.github.com/users/BullishNode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BullishNode/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T22:54:34Z",
      "updated_at": "2024-04-30T22:54:34Z",
      "author_association": "NONE",
      "body": "Another option would be to have a config for default estimate mode but in that case also the default should be \"ECONOMICAL\" and not \"CONSERVATIVE\"",
      "user": {
        "login": "BullishNode",
        "id": 75800272,
        "node_id": "MDQ6VXNlcjc1ODAwMjcy",
        "avatar_url": "https://avatars.githubusercontent.com/u/75800272?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BullishNode",
        "html_url": "https://github.com/BullishNode",
        "followers_url": "https://api.github.com/users/BullishNode/followers",
        "following_url": "https://api.github.com/users/BullishNode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BullishNode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BullishNode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BullishNode/subscriptions",
        "organizations_url": "https://api.github.com/users/BullishNode/orgs",
        "repos_url": "https://api.github.com/users/BullishNode/repos",
        "events_url": "https://api.github.com/users/BullishNode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BullishNode/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2087669682",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "commented",
      "id": 2088162169,
      "node_id": "IC_kwDOABII5858dtN5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2088162169",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-01T08:42:22Z",
      "updated_at": "2024-05-01T08:42:22Z",
      "author_association": "MEMBER",
      "body": "> Therefore, I suggest changing the default fee estimation mode to \"ECONOMICAL\" in the following RPCs\r\n\r\nUnfortunately even \"economic\" mode still overestimate so changing default mode to \"economic\" does not fix this issue.\r\n\r\nThere is an ongoing effort \"see [delving post](https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703)\" where contributors are discussing the challenges of `CBlockPolicyEstimator` which is the fee estimation strategy used by all those RPC's.\r\n\r\nYes this is a known issue and there is a work in progress to resolve it.\r\n",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2088162169",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "commented",
      "id": 2088717254,
      "node_id": "IC_kwDOABII5858f0vG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2088717254",
      "actor": {
        "login": "dupontcy",
        "id": 1293089,
        "node_id": "MDQ6VXNlcjEyOTMwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1293089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dupontcy",
        "html_url": "https://github.com/dupontcy",
        "followers_url": "https://api.github.com/users/dupontcy/followers",
        "following_url": "https://api.github.com/users/dupontcy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dupontcy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dupontcy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dupontcy/subscriptions",
        "organizations_url": "https://api.github.com/users/dupontcy/orgs",
        "repos_url": "https://api.github.com/users/dupontcy/repos",
        "events_url": "https://api.github.com/users/dupontcy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dupontcy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-01T16:22:32Z",
      "updated_at": "2024-05-01T16:22:32Z",
      "author_association": "NONE",
      "body": "> Unfortunately even \"economic\" mode still overestimate so changing default mode to \"economic\" does not fix this issue.\r\n\r\nMaybe it does not fix it all together, but it makes it overestimate less.\r\n\r\nThe difference between ECONOMICAL and CONSERVATIVE for a confirmation target of  2 to 12 blocks is HUGE (by a factor of 7)\r\nHere is recent data from our node with a confirmation target of 2 blocks\r\nECONOMICAL:   0.00020106 \r\nCONSERVATIVE:  0.00141359\r\n\r\nThe CONSERVATIVE mode uses the long stats for the 95% confirmation target, they have a half-time of 1008 blocks!\r\nAny spike in fees and number transaction will get into the long stats and decay only very very slowly.",
      "user": {
        "login": "dupontcy",
        "id": 1293089,
        "node_id": "MDQ6VXNlcjEyOTMwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1293089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dupontcy",
        "html_url": "https://github.com/dupontcy",
        "followers_url": "https://api.github.com/users/dupontcy/followers",
        "following_url": "https://api.github.com/users/dupontcy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dupontcy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dupontcy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dupontcy/subscriptions",
        "organizations_url": "https://api.github.com/users/dupontcy/orgs",
        "repos_url": "https://api.github.com/users/dupontcy/repos",
        "events_url": "https://api.github.com/users/dupontcy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dupontcy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2088717254",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "commented",
      "id": 2088788922,
      "node_id": "IC_kwDOABII5858gGO6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2088788922",
      "actor": {
        "login": "BullishNode",
        "id": 75800272,
        "node_id": "MDQ6VXNlcjc1ODAwMjcy",
        "avatar_url": "https://avatars.githubusercontent.com/u/75800272?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BullishNode",
        "html_url": "https://github.com/BullishNode",
        "followers_url": "https://api.github.com/users/BullishNode/followers",
        "following_url": "https://api.github.com/users/BullishNode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BullishNode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BullishNode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BullishNode/subscriptions",
        "organizations_url": "https://api.github.com/users/BullishNode/orgs",
        "repos_url": "https://api.github.com/users/BullishNode/repos",
        "events_url": "https://api.github.com/users/BullishNode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BullishNode/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-01T17:14:39Z",
      "updated_at": "2024-05-01T17:14:39Z",
      "author_association": "NONE",
      "body": "Agreed that switching to economical is not a long-term fix for fee estimation, but it's still a notable improvement. Implementing this change would likely lead to a very noticeable reduction in fees paid by Bitcoin Core users, and users of Bitcoin Core fee estimation, and Bitcoin users as a whole.\r\n\r\nTo give an idea of how much this affects a business which does a lot of Bitcoin transaction, we actually created software that will pull the recomended fees from the mempool api and we feed that to Bitcoin Core as feerate instead of using the confirmation target.\r\n\r\nNot everybody has the technical capacity to do that, switching to economical as default would provide much needed relief without any additional complexity added to the fee estimation algorithm. \r\n",
      "user": {
        "login": "BullishNode",
        "id": 75800272,
        "node_id": "MDQ6VXNlcjc1ODAwMjcy",
        "avatar_url": "https://avatars.githubusercontent.com/u/75800272?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BullishNode",
        "html_url": "https://github.com/BullishNode",
        "followers_url": "https://api.github.com/users/BullishNode/followers",
        "following_url": "https://api.github.com/users/BullishNode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BullishNode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BullishNode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BullishNode/subscriptions",
        "organizations_url": "https://api.github.com/users/BullishNode/orgs",
        "repos_url": "https://api.github.com/users/BullishNode/repos",
        "events_url": "https://api.github.com/users/BullishNode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BullishNode/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2088788922",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "commented",
      "id": 2089182279,
      "node_id": "IC_kwDOABII5858hmRH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2089182279",
      "actor": {
        "login": "Symphonic3",
        "id": 46897919,
        "node_id": "MDQ6VXNlcjQ2ODk3OTE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/46897919?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Symphonic3",
        "html_url": "https://github.com/Symphonic3",
        "followers_url": "https://api.github.com/users/Symphonic3/followers",
        "following_url": "https://api.github.com/users/Symphonic3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Symphonic3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Symphonic3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Symphonic3/subscriptions",
        "organizations_url": "https://api.github.com/users/Symphonic3/orgs",
        "repos_url": "https://api.github.com/users/Symphonic3/repos",
        "events_url": "https://api.github.com/users/Symphonic3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Symphonic3/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-01T21:41:18Z",
      "updated_at": "2024-05-01T21:41:18Z",
      "author_association": "NONE",
      "body": "Willing to create a PR for this if desired!",
      "user": {
        "login": "Symphonic3",
        "id": 46897919,
        "node_id": "MDQ6VXNlcjQ2ODk3OTE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/46897919?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Symphonic3",
        "html_url": "https://github.com/Symphonic3",
        "followers_url": "https://api.github.com/users/Symphonic3/followers",
        "following_url": "https://api.github.com/users/Symphonic3/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Symphonic3/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Symphonic3/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Symphonic3/subscriptions",
        "organizations_url": "https://api.github.com/users/Symphonic3/orgs",
        "repos_url": "https://api.github.com/users/Symphonic3/repos",
        "events_url": "https://api.github.com/users/Symphonic3/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Symphonic3/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2089182279",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "commented",
      "id": 2090106386,
      "node_id": "IC_kwDOABII5858lH4S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2090106386",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T10:21:09Z",
      "updated_at": "2024-05-02T10:21:09Z",
      "author_association": "MEMBER",
      "body": "Are you sure this isn't already happening?\r\n\r\nThis code suggests it does, but I haven't tested:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/9d1a286f20b8a602ffe72928bcd79be09fdbf9d0/src/wallet/fees.cpp#L52-L53\r\n\r\ncc @achow101",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2090106386",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "mentioned",
      "id": 12680743814,
      "node_id": "MEE_lADOABII586HdTXJzwAAAALz1MuG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12680743814",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T10:21:10Z"
    },
    {
      "event": "subscribed",
      "id": 12680743834,
      "node_id": "SE_lADOABII586HdTXJzwAAAALz1Mua",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12680743834",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T10:21:10Z"
    },
    {
      "event": "commented",
      "id": 2092147297,
      "node_id": "IC_kwDOABII5858s6Jh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2092147297",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-03T04:55:42Z",
      "updated_at": "2024-05-03T05:03:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "> This code suggests it does, but I haven't tested:\r\n\r\n`estimatesmartfee` rpc defaults to conservative, even if all the wallet stuff defaults to economical via defaulting to rbf-enabled.\r\n(#10589 might be worth looking at for context)",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30009#issuecomment-2092147297",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30009"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T11:44:10Z",
      "updated_at": "2024-05-23T11:44:10Z",
      "source": {
        "issue": {
          "id": 2312700303,
          "node_id": "PR_kwDOABII585wUc8Y",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/30157",
          "number": 30157,
          "state": "open",
          "state_reason": null,
          "title": "Fee Estimation via Fee rate Forecasters",
          "body": "### This PR aims at improving Bitcoin Core fee estimation\r\n\r\n\r\n### The objectives of this improvement are to:\r\n\r\n- Reduce overestimation done by the current `CBlockPolicyEstimator`\r\n- Make the fee estimator aware of the state of the mempool, allowing it to respond to changing conditions immediately.\r\n- Empower node users to be self-sovereign and use their node's estimates, as is now, the majority rely on third parties for fee estimation.\r\n- Simplify the process of adding new fee estimation strategies in the future.\r\n\r\nThe PR creates a new `FeeEstimator` class which is responsible for getting estimates from one or more subscribed `Forcaster`'s.\r\n\r\nA `Forcaster` will register with the `FeeEstimator` as being able to provide estimates, and when an estimate is requested, should return two fee rate estimates (high and low) and a confidence level.\r\n\r\nThe estimator will then take (currently undecided):\r\n1. the lowest estimated rate, or\r\n1. the weighted average of all the estimated rates\r\n\r\n...and return the two 'high' and 'low' estimations to the user.\r\n\r\nThe `FeeEstimator` also owns access to the legacy estimator, accessible via a pointer.\r\n\r\nThis PR deliberately does **not** try to modify existing fee estimation code, but instead uses new modules with cleaner seperation. This will make new code and interfaces much easier to introduce, and also make it easier to, if desired in the future, drop legacy estimation code.\r\n\r\n### Currently, this PR implements two forecasters:\r\n\r\n1. Mempool-based forecaster (`MemPoolForecaster`): It estimates fees simply by generating a block template from the node's mempool and returns the 25th and 50th percentile mining scores as low-priority and high-priority fee estimates, respectively.\r\n1. Last 6 Blocks forecaster (`BlockForecaster`): Uses the transactions from the previous six blocks _which were also seen in the node's mempool_, to make an estimate.\r\n\r\n    It listens to the validation interface notifications for removed mempool transactions, linearizes the transactions using a mini miner, and saves the 25th and 50th percentile mining scores. When estimating fees, it averages the mining scores of the percentiles from the last six mined blocks.\r\n    \r\n    NB. As this **excludes** transactions that never entered the node's mempool, it's likely to undershoot slightly\r\n\r\nThese two forecasters both estimate fees for (1, 2) block confirmation targets, referred to as \"as soon as possible (ASAP)\" fee rate estimates.\r\n\r\nFor both forcasters use of RBF is strongly recommended in order that transactions can be fee-bumped if desired.\r\n\r\n### Next steps:\r\n\r\n- Give some statistics of estimates \"missing the block\" (~percentage of estimates below the 5th percentile mining score of the confirmed block) and \"over paying\" (~percentage of estimates above the 25th 50th and 75th percentiles mining score) \r\n\r\n- Extend the feature to the wallet; currently it's only exposed in an RPC `estimatefee`.\r\n- Update forecasters to return confidence levels in their estimates.\r\n\r\n### Confidence levels\r\n\r\nConfidence levels are determined by heuristics.\r\n\r\nFor the mempool-based forecaster:\r\n\r\n- Suspected high mining score transactions should be confirmed but aren't.\r\n- Most transactions in previously mined blocks were in our node's mempool.\r\n- High mining score mempool transactions are confirmed.\r\n\r\nFor the last 6 blocks forecaster:\r\n\r\n- Presence of empty blocks in the last 6 blocks.\r\n- Most of the last 6 blocks' transactions were seen in the node's mempool or not.\r\n\r\nThe fee estimator  will select the fee rate from the forecasters based on confidence level instead of just taking the lowest fee rate estimate.\r\n\r\n\r\n### How does this fit in with `CBlockPolicyEstimator`?\r\n\r\nThis fee estimator owns the legacy `CBlockPolicyEstimator` and does not change any of its interfaces. The wallet still uses `estimatesmartfee`, and RPCs also access it through the Fee Estimator.\r\nHowever, this will change when we switch to using estimates from `GetFeeEstimateFromForecasters`, which works much better than the `estimatesmartfee` in (1, 2) confirmation target scenarios.\r\n\r\nMoreover, when we have another forecaster that supports confirmation targets beyond (1, 2) and works better than `estimatesmartfee`, we will eventually phase out `CBlockPolicyEstimator` as the new Fee Estimator module makes it easy to do so.\r\n\r\nThis PR addresses two open issues and has been requested by users in the past.\r\n\r\n#27995\r\n#30009\r\n\r\n### FAQ\r\n\r\n1. **Will miners broadcast high fee rate transactions, and then evict them with a conflicting transaction in the next block, trick users of this fee estimator into making transactions with high fees?**\r\n   https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703/6?u=ismaelsadeeq\r\n\r\n   This PR addresses this concern by ensuring that the fee estimate does not surge immediately whenever this happens the mempool based forecaster estimate will be higher than last 6 block forecaster estimate. As such the last six blocks forecaster estimate will be returned, preventing users to be victims of this attack.\r\n\r\n2. **In times of high confirmation times or high block space demand, fee estimates tend to rise. If the mempool-based forecaster estimate rises, the fee estimator will fall back to the last six blocks fee estimate, if it's low, will that make transactions constructed with the estimate get stuck in the mempool?**\r\nThe ASAP fee estimate provides an estimate for transactions to confirm in the next one or two blocks. During periods of high confirmation times, fee rates rise due to congestion. Once a block is mined, the mempool clears high mining score transactions, making room for lower fee rate transactions. If congestion recurs and the transaction is time-sensitive, users can safely fee bump assuming it's an RBF-enabled transaction.\r\nIn times of immediate high block demand, if the mempool-based fee estimate surges while the last six blocks fee estimate is low, users can fee bump their transactions if they take longer to confirm. As more blocks are mined, the last six blocks forecaster will adjust and reflect the higher fee rates. When demand decreases, the mempool forecaster will immediately respond to the new conditions by providing a lower fee estimate and the fee estimator will return it instead.\r\n\r\n3. **Currently, getting a block template is expensive. How do you tackle that in the mempool-based forecaster?**\r\nThe forecaster cache the recently generated fee rate estimates and only generate a new block template when the time delta between the recent estimate and the current time exceeds 30 seconds.\r\n\r\n---\r\nThis is a collaborative work with @willcl-ark and a result of collecting insight from other contributors.\r\n",
          "user": {
            "login": "ismaelsadeeq",
            "id": 48946461,
            "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ismaelsadeeq",
            "html_url": "https://github.com/ismaelsadeeq",
            "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
            "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
            "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
            "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
            "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30157",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/30157",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/30157.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/30157.patch"
          },
          "created_at": "2024-05-23T11:44:09Z",
          "updated_at": "2024-06-11T12:20:29Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "comment_deleted",
      "id": 13125208073,
      "node_id": "CDE_lADOABII586HdTXJzwAAAAMOUsgJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13125208073",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-12T03:04:27Z"
    }
  ]
}