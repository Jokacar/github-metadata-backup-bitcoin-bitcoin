{
  "type": "issue",
  "issue": {
    "id": 2081837012,
    "node_id": "I_kwDOABII5858Fk_U",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29248",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29248/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29248/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29248/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29248",
    "number": 29248,
    "state": "open",
    "state_reason": null,
    "title": "build: multiprocess compile failure on macOS",
    "body": "master @ 28ccc7003a4c3f198a255d6f55f5748d4fd8fd1a\r\n\r\n```bash\r\nApple clang version 15.0.0 (clang-1500.1.0.2.5)\r\n\r\nmake -C depends -j12 MULTIPROCESS=1 NO_QT=1 NO_WALLET=1 NO_NATPMP=1 NO_UPNP=1 NO_ZMQ=1\r\n./autogen.sh\r\nCONFIG_SITE=/bitcoin/depends/aarch64-apple-darwin23.2.0/share/config.site ./configure\r\nmake\r\n```\r\n\r\n```bash\r\nIn file included from ipc/capnp/echo.capnp.proxy-client.c++:3:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy.h:9:\r\nIn file included from /bitcoin/depends/aarch64-apple-darwin23.2.0/include/mp/proxy.h:8:\r\n/bitcoin/depends/aarch64-apple-darwin23.2.0/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/bitcoin/depends/aarch64-apple-darwin23.2.0/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\n2 errors generated.\r\n```\r\n\r\n`std::result_of` was [removed in C++20](https://en.cppreference.com/w/cpp/types/result_of), but we are still using it in multiprocess: https://github.com/chaincodelabs/libmultiprocess/blob/2cbbd09d8b9972a8f5c68b510c0dae9a9f7a22da/include/mp/util.h#L128.\r\n\r\nBy the looks of it, we can probably remove most of the code in that file, given we now require C++20.\r\ncc @ryanofsky.",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 61889416,
        "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
        "name": "Build system",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 1,
    "created_at": "2024-01-15T11:28:22Z",
    "updated_at": "2024-01-18T15:59:55Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 11487067695,
      "node_id": "LE_lADOABII5858Fk_UzwAAAAKsrr4v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11487067695",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-15T11:28:22Z",
      "label": {
        "name": "Build system",
        "color": "5319e7"
      }
    },
    {
      "event": "mentioned",
      "id": 11487067782,
      "node_id": "MEE_lADOABII5858Fk_UzwAAAAKsrr6G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11487067782",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-15T11:28:23Z"
    },
    {
      "event": "subscribed",
      "id": 11487067796,
      "node_id": "SE_lADOABII5858Fk_UzwAAAAKsrr6U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11487067796",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-15T11:28:23Z"
    },
    {
      "event": "commented",
      "id": 1898755858,
      "node_id": "IC_kwDOABII585xLLcS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1898755858",
      "actor": {
        "login": "edilmedeiros",
        "id": 78322931,
        "node_id": "MDQ6VXNlcjc4MzIyOTMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/78322931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/edilmedeiros",
        "html_url": "https://github.com/edilmedeiros",
        "followers_url": "https://api.github.com/users/edilmedeiros/followers",
        "following_url": "https://api.github.com/users/edilmedeiros/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/edilmedeiros/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/edilmedeiros/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/edilmedeiros/subscriptions",
        "organizations_url": "https://api.github.com/users/edilmedeiros/orgs",
        "repos_url": "https://api.github.com/users/edilmedeiros/repos",
        "events_url": "https://api.github.com/users/edilmedeiros/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/edilmedeiros/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-18T15:56:26Z",
      "updated_at": "2024-01-18T15:59:55Z",
      "author_association": "NONE",
      "body": "I confirm this. I installed libmutiprocess manually; I'm not using what's on `depends`, but it generates the same error.\r\n\r\nMoreover, I tried on the current master head (03c5b006) and build fails in more places.\r\n\r\n```\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-echo.capnp.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-init.capnp.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-echo.capnp.proxy-client.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-init.capnp.proxy-client.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-echo.capnp.proxy-server.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-init.capnp.proxy-server.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-echo.capnp.proxy-types.o\r\n  CXX      ipc/capnp/libbitcoin_ipc_a-init.capnp.proxy-types.o\r\nIn file included from ipc/capnp/echo.capnp.proxy-client.c++:3:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy.h:9:\r\nIn file included from /usr/local/include/mp/proxy.h:8:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\nIn file included from ipc/capnp/echo.capnp.proxy-server.c++:3:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy.h:9:\r\nIn file included from /usr/local/include/mp/proxy.h:8:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\n2 errors generated.\r\n  CCLD     libsecp256k1_precomputed.la\r\nmake[2]: *** [ipc/capnp/libbitcoin_ipc_a-echo.capnp.proxy-client.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nIn file included from ipc/process.cpp:7:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\nIn file included from ipc/capnp/echo.capnp.proxy-types.c++:3:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/echo.capnp.proxy.h:9:\r\nIn file included from /usr/local/include/mp/proxy.h:8:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\n2 errors generated.\r\n2 errors generated.\r\nmake[2]: *** [ipc/libbitcoin_ipc_a-process.o] Error 1\r\nmake[2]: *** [ipc/capnp/libbitcoin_ipc_a-echo.capnp.proxy-server.o] Error 1\r\nIn file included from ipc/capnp/init.capnp.proxy-client.c++:3:\r\nIn file included from ./ipc/capnp/init.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/init.capnp.proxy.h:9:\r\nIn file included from /usr/local/include/mp/proxy.h:8:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\n2 errors generated.\r\nmake[2]: *** [ipc/capnp/libbitcoin_ipc_a-echo.capnp.proxy-types.o] Error 1\r\nIn file included from ipc/capnp/init.capnp.proxy-server.c++:3:\r\nIn file included from ./ipc/capnp/init.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/init.capnp.proxy.h:9:\r\nIn file included from /usr/local/include/mp/proxy.h:8:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\n2 errors generated.\r\nmake[2]: *** [ipc/capnp/libbitcoin_ipc_a-init.capnp.proxy-client.o] Error 1\r\nIn file included from ipc/capnp/init.capnp.proxy-types.c++:3:\r\nIn file included from ./ipc/capnp/init.capnp.proxy-types.h:6:\r\nIn file included from ./ipc/capnp/init.capnp.proxy.h:9:\r\nIn file included from /usr/local/include/mp/proxy.h:8:\r\n/usr/local/include/mp/util.h:128:23: error: no type named 'result_of' in namespace 'std'\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n        ~~~~~~~~~~~~~~^~~~~~~~~\r\n/usr/local/include/mp/util.h:128:32: error: expected ';' at end of declaration list\r\n        typename std::result_of<Base(BoundArgs&..., BindArg&, FreeArgs...)>::type\r\n                               ^\r\n                               ;\r\n2 errors generated.\r\nmake[2]: *** [ipc/capnp/libbitcoin_ipc_a-init.capnp.proxy-server.o] Error 1\r\n2 errors generated.\r\nmake[2]: *** [ipc/capnp/libbitcoin_ipc_a-init.capnp.proxy-types.o] Error 1\r\n  CCLD     libsecp256k1.la\r\nmake[1]: *** [all-recursive] Error 1\r\nmake: *** [all-recursive] Error 1\r\n```\r\n\r\nNot using homebrew, but macports to install dependencies.\r\n\r\n```bash\r\nCPPFLAGS=\"$CPPFLAGS -isystem /opt/local/include\" LIBS=\"$LIBS -L/opt/local/lib\" PKG_CONFIG_PATH=\"/usr/local/lib/pkgconfig\" LIBMULTIPROCESS_CFLAGS=\"-I/usr/local/include\" LIBMULTIPROCESS_LIBS=\"-L/usr/local/lib\" EVENT_CFLAGS=\"-I/opt/local/include\" EVENT_LIBS=\"-L/opt/local/lib -levent\" ./configure --enable-multiprocess --without-dbd --without-miniupnpc --without-natpmp --without-gui --disable-zmq --disable-wallet --with-boost=/opt/local/libexec/boost/1.78\r\n\r\nmake -j11\r\n```",
      "user": {
        "login": "edilmedeiros",
        "id": 78322931,
        "node_id": "MDQ6VXNlcjc4MzIyOTMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/78322931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/edilmedeiros",
        "html_url": "https://github.com/edilmedeiros",
        "followers_url": "https://api.github.com/users/edilmedeiros/followers",
        "following_url": "https://api.github.com/users/edilmedeiros/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/edilmedeiros/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/edilmedeiros/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/edilmedeiros/subscriptions",
        "organizations_url": "https://api.github.com/users/edilmedeiros/orgs",
        "repos_url": "https://api.github.com/users/edilmedeiros/repos",
        "events_url": "https://api.github.com/users/edilmedeiros/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/edilmedeiros/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29248#issuecomment-1898755858",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29248"
    }
  ]
}