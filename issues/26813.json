{
  "type": "issue",
  "issue": {
    "id": 1519317507,
    "node_id": "I_kwDOABII585ajvID",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/26813",
    "number": 26813,
    "state": "open",
    "state_reason": null,
    "title": "listreceivedbyaddress is empty for descriptor (but not legacy) wallets",
    "body": "https://bitcoincore.org/bin/bitcoin-core-24.0.1/bitcoin-24.0.1-x86_64-linux-gnu.tar.gz\r\n\r\nProblem: listreceivedbyaddress always returns an empty array for a watch-only wallet when it's of type descriptor (not legacy). This problem doesn't occur with a legacy watch-only wallet, only a descriptor watch-only wallet.\r\n\r\nApparent reason: bitcoind thinks the addresses are for change.\r\n\r\nWork-around: When importing descriptors, set active=true.\r\n\r\nThanks to achow101 on IRC Libera Chat #bitcoin-core-dev, 2023-01-04.\r\n\r\n```\r\n$ cat $HOME/data1/bitcoin.conf \r\nprinttoconsole=1\r\nregtest=1\r\ntxindex=1\r\n[regtest]\r\nport=18444\r\nrpcport=18443\r\n\r\n$ $HOME/bitcoin-24.0.1/bin/bitcoin-qt -datadir=$HOME/data1 -server -fallbackfee=0.00001 &\r\n\r\n$ cat bcli.sh \r\n#!/bin/bash\r\n$HOME/bitcoin-24.0.1/bin/bitcoin-cli -datadir=$HOME/data1 \"$@\"\r\n\r\n\r\n$ bcli.sh createwallet w1\r\n$ bcli.sh createwallet w2 true true\r\n$ bcli.sh -rpcwallet=w1 listdescriptors\r\n...\r\n    {\r\n      \"desc\": \"wpkh([577ce3ca/84'/1'/0']tpubDCNwCevBBSLGZm5d2urnpLDD2B4s5dWf7TRigFngte9M7sijNQg6QVjq1K7Nb7uLAP7xLn2h4X1MoiT3JmMP3sQYuKsY1qnPj1HR63hQDuT/0/*)#cw6xz6mx\",\r\n      \"timestamp\": 1672848018,\r\n      \"active\": true,\r\n      \"internal\": false,\r\n      \"range\": [\r\n        0,\r\n        999\r\n      ],\r\n      \"next\": 0\r\n    },\r\n...\r\n\r\n$ bcli.sh -rpcwallet=w2 importdescriptors \"[{\\\"desc\\\": \\\"wpkh([577ce3ca/84'/1'/0']tpubDCNwCevBBSLGZm5d2urnpLDD2B4s5dWf7TRigFngte9M7sijNQg6QVjq1K7Nb7uLAP7xLn2h4X1MoiT3JmMP3sQYuKsY1qnPj1HR63hQDuT/0/*)#cw6xz6mx\\\", \\\"timestamp\\\": 0, \\\"range\\\": 999}]\"\r\n\r\n$ bcli.sh -rpcwallet=w1 getnewaddress\r\nbcrt1qxu3fl6lyqydvtgxsdpeu69gyywy2dya5a4kray\r\n\r\n$ bcli.sh -rpcwallet=w1 generatetoaddress 101 bcrt1qxu3fl6lyqydvtgxsdpeu69gyywy2dya5a4kray\r\n\r\n$ bcli.sh -rpcwallet=w2 listreceivedbyaddress 1 true true \"\" true\r\n[\r\n]\r\n```",
    "user": {
      "login": "vibs29",
      "id": 1073437,
      "node_id": "MDQ6VXNlcjEwNzM0Mzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1073437?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vibs29",
      "html_url": "https://github.com/vibs29",
      "followers_url": "https://api.github.com/users/vibs29/followers",
      "following_url": "https://api.github.com/users/vibs29/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vibs29/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vibs29/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vibs29/subscriptions",
      "organizations_url": "https://api.github.com/users/vibs29/orgs",
      "repos_url": "https://api.github.com/users/vibs29/repos",
      "events_url": "https://api.github.com/users/vibs29/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vibs29/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 5,
    "created_at": "2023-01-04T17:13:42Z",
    "updated_at": "2023-01-05T21:08:03Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 8153086621,
      "node_id": "LE_lADOABII585ajvIDzwAAAAHl9jqd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8153086621",
      "actor": {
        "login": "vibs29",
        "id": 1073437,
        "node_id": "MDQ6VXNlcjEwNzM0Mzc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1073437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vibs29",
        "html_url": "https://github.com/vibs29",
        "followers_url": "https://api.github.com/users/vibs29/followers",
        "following_url": "https://api.github.com/users/vibs29/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vibs29/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vibs29/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vibs29/subscriptions",
        "organizations_url": "https://api.github.com/users/vibs29/orgs",
        "repos_url": "https://api.github.com/users/vibs29/repos",
        "events_url": "https://api.github.com/users/vibs29/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vibs29/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-04T17:13:42Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 1372290985,
      "node_id": "IC_kwDOABII585Ry3-p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1372290985",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T14:29:36Z",
      "updated_at": "2023-01-05T14:34:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think the reason for this problem is: `listreceivedbyaddress` iterates through `CWallet::m_address_book` to get the items.\r\n\r\nBut an address is only added to `m_address_book` when it is generated via `getnewaddress`.\r\nSince this command has been run in the hot wallet, the watch-only has no way of knowing that this has been added to the `CWallet::m_address_book`.\r\n\r\nBut you reported it is working in a legacy watch-only wallet. How are you creating it ?",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26813#issuecomment-1372290985",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813"
    },
    {
      "event": "commented",
      "id": 1372294553,
      "node_id": "IC_kwDOABII585Ry42Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1372294553",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T14:32:39Z",
      "updated_at": "2023-01-05T14:33:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "When loading the wallets, you can see what I described above.\r\n\r\n```bash\r\n2023-01-05T14:20:56Z [w1] Wallet completed loading in             528ms\r\n2023-01-05T14:20:56Z [w1] setKeyPool.size() = 8000\r\n2023-01-05T14:20:56Z [w1] mapWallet.size() = 1\r\n2023-01-05T14:20:56Z [w1] m_address_book.size() = 1\r\n...\r\n2023-01-05T14:20:58Z [w2] Wallet completed loading in              84ms\r\n2023-01-05T14:20:58Z [w2] setKeyPool.size() = 0\r\n2023-01-05T14:20:58Z [w2] mapWallet.size() = 1\r\n2023-01-05T14:20:58Z [w2] m_address_book.size() = 0\r\n```\r\n\r\nNote the difference between `m_address_book.size()` in `[w1]` and `[w2]`.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26813#issuecomment-1372294553",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813"
    },
    {
      "event": "commented",
      "id": 1372340673,
      "node_id": "IC_kwDOABII585RzEHB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1372340673",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T15:10:15Z",
      "updated_at": "2023-01-05T15:12:03Z",
      "author_association": "MEMBER",
      "body": "hmm yeah, it's a deeper problem. This make me remember to #25979, where I started heading towards a general solution for the change detection but.. it's still not ready (atm detects change from active descriptors only; IIRC, I should be able to expand it to non-active ones based on their derivation paths pretty easily, which will solve this issue. But still need to re-review the detection when a descriptor get removed -- which is basically achow101's comment there --).\r\n\r\nwill start reviving it, and probably decouple most of the base functionality tests into another PR, so 25979 is mostly focused on the new change detection functionality.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26813#issuecomment-1372340673",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813"
    },
    {
      "event": "commented",
      "id": 1372456440,
      "node_id": "IC_kwDOABII585RzgX4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1372456440",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T16:40:20Z",
      "updated_at": "2023-01-05T16:41:26Z",
      "author_association": "MEMBER",
      "body": "What's happening here is that with descriptor wallets, we do not add any address book entries for descriptors imported without a label. Ranged descriptors cannot have any labels applied because labels are per-address, and a ranged descriptor can produce (basically) infinite addresses. So any addresses for ranged descriptors do not get any address book entries, and so we would detect any coins sent to such addresses to be change.\r\n\r\nHowever, if the descriptor is an active descriptor, when we add a transaction to the wallet, we will additionally lookup whether the active descriptor is also an internal descriptor. If it is not, we will create an address book entry so that anything that needs to know whether the address is change can use the address book lookup mechanism to figure this out. This is how the active=true workaround works.\r\n\r\nThis is not an issue for legacy wallets because legacy wallets do not truly support ranged descriptors. It will expand the ranged descriptor and get all of the scriptPubKeys it produces, then import each one individually. When it does this, it can apply a label and add an address book entry for every single thing imported. Thus it avoids this problem.\r\n\r\n***\r\n\r\nI think the only real solution to this problem is to change how we detect change. Ideally we would have some system that can infer it intelligently, and also have change be explicitly marked rather, so the default is to assume everything is receiving, rather than everything is change.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26813#issuecomment-1372456440",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813"
    },
    {
      "event": "commented",
      "id": 1372747549,
      "node_id": "IC_kwDOABII585R0ncd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1372747549",
      "actor": {
        "login": "vibs29",
        "id": 1073437,
        "node_id": "MDQ6VXNlcjEwNzM0Mzc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1073437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vibs29",
        "html_url": "https://github.com/vibs29",
        "followers_url": "https://api.github.com/users/vibs29/followers",
        "following_url": "https://api.github.com/users/vibs29/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vibs29/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vibs29/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vibs29/subscriptions",
        "organizations_url": "https://api.github.com/users/vibs29/orgs",
        "repos_url": "https://api.github.com/users/vibs29/repos",
        "events_url": "https://api.github.com/users/vibs29/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vibs29/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-05T21:01:58Z",
      "updated_at": "2023-01-05T21:08:03Z",
      "author_association": "NONE",
      "body": "> you reported it is working in a legacy watch-only wallet. How are you creating it ?\r\n\r\nI would have imported specific public items using one of importaddress, importmulti or importpubkey, rather than ranged descriptors (xpub/*). I would import the address or public key but not the private key. And listreceivedbyaddress would then always show what I expected. It was only when I switched to descriptor wallets and importdescriptor that I found that listreceivedbyaddress would produce an empty result.\r\n\r\nThinking back, it's likely that my legacy wallet experiments (and importing specific items) were only with an older bitcoind, e.g. whatever is currently in the docker hub image named: \"bitcoindevelopernetwork/bitcoind-regtest\"[0]. Otherwise, it would have created a descriptor wallet by default.\r\n\r\nMy guess is that the listreceivedbyaddress anomaly isn't to do with one version of bitcoind versus another, or even legacy wallets versus descriptor wallets, but in fact between importing specific public items and importing ranged public items.\r\n\r\nWith a ranged public descriptor, the wallet notices incoming payments, updates its balance, has listsinceblock answer what I'd expect, etc. So I'd never have predicted that a correct answer from listreceivedbyaddress would be the empty list. That led to my enquiry in IRC, which led to creating this GitHub issue. Updating listreceivedbyaddress's help text to say \"does not yet work with ranged public descriptors\" is also a great outcome if sorting out the underlying semantics is too hard or will only happen indefinitely far in the future.\r\n\r\n[0]:\r\ndocker image ID: 0a110218f3cb\r\nBitcoin Core Daemon version v0.17.1.0-gef70f9b52b851c7997a9f1a0834714e3eebc1fd8",
      "user": {
        "login": "vibs29",
        "id": 1073437,
        "node_id": "MDQ6VXNlcjEwNzM0Mzc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1073437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vibs29",
        "html_url": "https://github.com/vibs29",
        "followers_url": "https://api.github.com/users/vibs29/followers",
        "following_url": "https://api.github.com/users/vibs29/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vibs29/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vibs29/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vibs29/subscriptions",
        "organizations_url": "https://api.github.com/users/vibs29/orgs",
        "repos_url": "https://api.github.com/users/vibs29/repos",
        "events_url": "https://api.github.com/users/vibs29/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vibs29/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26813#issuecomment-1372747549",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26813"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-23T10:39:15Z",
      "updated_at": "2023-01-23T10:39:15Z",
      "source": {
        "issue": {
          "id": 1359015170,
          "node_id": "PR_kwDOABII584-OGE6",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25973",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25973/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25973/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25973/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25973",
          "number": 25973,
          "state": "open",
          "state_reason": null,
          "title": "wallet: Filter-out \"send\" addresses from `listreceivedby*`",
          "body": "`listreceivedbyaddress` & `listreceivedbylabel` RPCs list balances by receiving address and label respectively. That works by creating a tally (`mapTally[address]`) from all the transaction outputs in the wallet and then cross-reference that with the address book in order to calculate which addresses received funds.\r\n\r\nIf an address is in the address book but not in the tally, it's considered empty (never received funds) and is not returned unless `include_empty=true`. That effectively means that when `include_empty=true` the entire address book is included in the result.\r\n\r\n**This creates 2 issues:**\r\n\r\n1. As reported in https://github.com/bitcoin/bitcoin/issues/16159, the address book also includes addresses with a \"send\" purpose which should not be part of the response.\r\n2. As reported in https://github.com/bitcoin/bitcoin/issues/10468, if `include_watchonly=false` [the watchonly addresses are not included in `mapTally`](https://github.com/bitcoin/bitcoin/blob/fa5c224d444802dabec5841009e029b9754c92f1/src/wallet/rpc/transactions.cpp#L120-L122 ) leading to them being considered empty during the subsequent cross-reference with the address book thus becoming part of the result when `include_empty=true`.\r\n\r\nThis PR fixes https://github.com/bitcoin/bitcoin/issues/16159 by filtering-out \"send\" addresses, see https://github.com/bitcoin/bitcoin/issues/16159#issuecomment-1234405923 for more details on the issue. I haven't thought of a nice solution to fix (2) yet.\r\n\r\n**Edit**: Split `wallet_listreceivedby.py` tests for code maintainability as tests for more than one RPC have been added since the creation of the file. Added test coverage for the introduced change.",
          "user": {
            "login": "kouloumos",
            "id": 18506343,
            "node_id": "MDQ6VXNlcjE4NTA2MzQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/18506343?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kouloumos",
            "html_url": "https://github.com/kouloumos",
            "followers_url": "https://api.github.com/users/kouloumos/followers",
            "following_url": "https://api.github.com/users/kouloumos/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/kouloumos/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/kouloumos/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/kouloumos/subscriptions",
            "organizations_url": "https://api.github.com/users/kouloumos/orgs",
            "repos_url": "https://api.github.com/users/kouloumos/repos",
            "events_url": "https://api.github.com/users/kouloumos/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/kouloumos/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25973",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25973",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25973.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25973.patch"
          },
          "created_at": "2022-09-01T15:15:02Z",
          "updated_at": "2023-07-20T13:45:03Z"
        },
        "type": "issue"
      }
    }
  ]
}