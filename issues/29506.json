{
  "type": "issue",
  "issue": {
    "id": 2159614620,
    "node_id": "I_kwDOABII586AuRqc",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29506/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29506/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29506/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29506",
    "number": 29506,
    "state": "open",
    "state_reason": null,
    "title": "Since 0.16 Bitcoin can be stuck connected to adversarial/3rdparty node",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nThere is a bug in net_processing.cpp logic.\r\nWe are m_protect=true because that feature sees us as unsynced (easy to simulate/spoof by an adversary)\r\nSecondly something sets fDisconnect=true (could be anything)\r\nSo basically we kind of accumulate 200 remote bitcoins connected to us which want to disconnect from us but simultaneously can't.\r\nI mean on the live network we have 200 uploader slots so 200 bitcoins become connected to us who really can't disconnect from us.\r\nKind of silly bug in bitcoin.\r\nfDisconnect=true kills any messages to us except ping.\r\nm_protect=true (theoretically kills the actual disconnect)\n\n### Expected behaviour\n\nEventually the remote bitcoin should disconnect from us anyway, as we consume it's slot forever.\n\n### Steps to reproduce\n\n1. Adversary connects to Bitcoin\r\n2. Stays connected to bitcoin forever.\r\n\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\n25\n\n### Operating system and version\n\nubuntu\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "litecomb",
      "id": 121376577,
      "node_id": "U_kgDOBzwPQQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/121376577?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/litecomb",
      "html_url": "https://github.com/litecomb",
      "followers_url": "https://api.github.com/users/litecomb/followers",
      "following_url": "https://api.github.com/users/litecomb/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/litecomb/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/litecomb/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/litecomb/subscriptions",
      "organizations_url": "https://api.github.com/users/litecomb/orgs",
      "repos_url": "https://api.github.com/users/litecomb/repos",
      "events_url": "https://api.github.com/users/litecomb/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/litecomb/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "created_at": "2024-02-28T18:44:20Z",
    "updated_at": "2024-02-28T18:58:23Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1969648412,
      "node_id": "IC_kwDOABII5851ZnMc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969648412",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-28T18:58:22Z",
      "updated_at": "2024-02-28T18:58:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "I don't understand this. A node sets `m_protect=true` for a a maximum of 4 outbound peers (`MAX_OUTBOUND_PEERS_TO_PROTECT_FROM_DISCONNECT`) that have announced blocks to us that have improved our tip. See [here](https://github.com/bitcoin/bitcoin/blob/ba907f96ad37c09c49c0e1532fad118fcb8dd4a8/src/net_processing.cpp#L2880-L2886) for the code on master.\r\nIt is also never set for inbound peers, so if an \"Adversary connects to Bitcoin\" it won't be protected by it.\r\n",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-1969648412",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29506"
    }
  ]
}