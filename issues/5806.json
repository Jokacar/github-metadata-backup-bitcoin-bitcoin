{
  "type": "issue",
  "issue": {
    "id": 58256720,
    "node_id": "MDU6SXNzdWU1ODI1NjcyMA==",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/5806",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/5806/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/5806/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/5806/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/5806",
    "number": 5806,
    "state": "closed",
    "state_reason": "completed",
    "title": "Block download can stall after call to InvalidateBlock()",
    "body": "I observed that block propagation didn't work as I expected in testing with InvalidateBlock.\n\nLet's say we have two nodes connected and synced.  Then we use one to mine 20 blocks and sync the nodes.  Then we invalidate the first of those blocks via rpc call to each node.\n\nIf we then mine 19 blocks on that same node that generated the initial 20, those blocks won't all propagate to the other node (the first 16 will make it, because of the call to getdata on processing each inv, which occurs until we've maxed out the number of blocks in flight to that peer).  A specific test that fails is pasted below.\n\nI believe what is happening is that the CNodeState variable pindexBestKnownBlock is stuck pointing at an invalid but more-work chain, and consequently the block download logic believes it doesn't have a peer from which to download the blocks on the new headers chain.  \n\nI'm not sure what the best way to fix this is, maybe we could clear the pindexBestKnownBlock variables if they're pointing to now-invalid blocks before returning from InvalidateBlock, or perhaps we could check the validity of pindexBestKnownBlock when we are comparing it in UpdateBlockAvailability?  Both those approaches do appear to fix this test, but I'm not quite familiar enough with this logic to know whether either of those potential solutions makes sense.\n\n```\n#!/usr/bin/env python2\n# Copyright (c) 2014 The Bitcoin Core developers\n# Distributed under the MIT software license, see the accompanying\n# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n\n#\n# Test invalidateblock\n#\n\nfrom test_framework import BitcoinTestFramework\nfrom bitcoinrpc.authproxy import AuthServiceProxy, JSONRPCException\nfrom util import *\nimport os\nimport shutil\n\nclass InvalidateBlockTest(BitcoinTestFramework):\n\n    def setup_network(self):\n        self.nodes = []\n        self.nodes.append(start_node(0, self.options.tmpdir, ['-debug', '-whitelist=127.0.0.1']))\n        self.nodes.append(start_node(1, self.options.tmpdir, ['-debug', '-whitelist=127.0.0.1']))\n        connect_nodes(self.nodes[1], 0)\n        self.is_network_split = False\n        self.sync_all()\n\n    def run_test(self):\n        self.nodes[0].setgenerate(True, 1) # Leave IBD\n        self.sync_all()\n\n        cnt = self.nodes[0].getblockcount()\n\n        node1blocks = self.nodes[1].setgenerate(True, 18)\n\n        self.sync_all()\n        if (self.nodes[0].getblockcount() != cnt + 18):\n            raise AssertionError(\"Failed to sync initial blocks\")\n\n        self.nodes[0].invalidateblock(node1blocks[0])\n        self.nodes[1].invalidateblock(node1blocks[0])\n\n        if (self.nodes[0].getblockcount() != cnt):\n            raise AssertionError(\"Failed to invalidate initial blocks\")\n\n        self.nodes[1].setgenerate(True, 17)\n\n        print \"All blocks generated, trying to sync\"\n        self.sync_all()\n        if (self.nodes[0].getblockcount() != cnt + 17):\n            raise AssertionError(\"Failed to sync shorter but valid chain\")\n\nif __name__ == '__main__':\n    InvalidateBlockTest().main()\n```\n",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      },
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 1,
    "closed_at": "2019-11-02T23:14:57Z",
    "created_at": "2015-02-19T19:31:37Z",
    "updated_at": "2021-12-16T14:12:16Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 307247739,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMwNzI0NzczOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/307247739",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-05-18T10:29:34Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "labeled",
      "id": 307247740,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMwNzI0Nzc0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/307247740",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-05-18T10:29:34Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "domob1812",
        "id": 4943644,
        "node_id": "MDQ6VXNlcjQ5NDM2NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4943644?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/domob1812",
        "html_url": "https://github.com/domob1812",
        "followers_url": "https://api.github.com/users/domob1812/followers",
        "following_url": "https://api.github.com/users/domob1812/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/domob1812/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/domob1812/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/domob1812/subscriptions",
        "organizations_url": "https://api.github.com/users/domob1812/orgs",
        "repos_url": "https://api.github.com/users/domob1812/repos",
        "events_url": "https://api.github.com/users/domob1812/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/domob1812/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-11T16:57:59Z",
      "updated_at": "2016-09-11T16:57:59Z",
      "source": {
        "issue": {
          "id": 176253210,
          "node_id": "MDU6SXNzdWUxNzYyNTMyMTA=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8698",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8698/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8698/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8698/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/8698",
          "number": 8698,
          "state": "closed",
          "state_reason": "completed",
          "title": "Block notifications not working with invalidateblock",
          "body": "<!--- Remove sections that do not apply -->\n### Describe the issue\n\nThe notification callbacks for new blocks / changes to the tip are not invoked when using `invalidateblock`.  This leads, among other things, to the issue with the new `waitfornewblock` RPC and, consequently, to failures in regression tests using `sync_blocks` and `invalidateblock` to trigger reorgs.  (I'm not sure if that involves any of the official regression tests, but it can be observed with custom tests.)\n\nThis seems to be strongly related to #5806.\n\nAs far as I can tell, the problem is that `InvalidateBlock` (as called from the `invalidateblock` RPC handler) already changes `chainActive.Tip()`, and then `ActivateBestChain` (which is supposed to trigger the notifications and other updates) returns early as the most work block is already the chain tip.\n\nI'd like to fix the issue, but do not feel confident enough with the involved code to decide how to best do it.  I see two straight-forward solutions, which both have their pros and cons - I'd be grateful for any insights into which one (if any of them) is the correct:\n1. Trigger the notifications and updates from `ActivateBestChain` even if the most work block is already the chain tip.  This seems clean and straight-forward, but I'm not sure if `ActivateBestChain` might be called even without any changes done to the chain, in which case it would yield spurious notification calls.  Is this possible?\n2. `InvalidateBlock` is only called from the `invalidateblock` RPC and is a somewhat special situation.  We could manually trigger the same notifications as `ActivateBestChain` does from there.  This requires to either duplicate the notification and update code or factor it out into a new function, and feels less clean.\n### Is the issue reproducible?\n#### List steps to reproduce below:\n1. Run a regtest mode daemon.\n2. Call `waitfornewblock`.\n3. Call `invalidateblock` on the currently best block.\n### Expected behavior\n\n`waitfornewblock` should return with the new best block (i. e., the block that was previously the one just before the tip).\n### Actual behavior\n\nThe change to the chain tip is not noticed and `waitfornewblock` keeps on waiting.\n",
          "user": {
            "login": "domob1812",
            "id": 4943644,
            "node_id": "MDQ6VXNlcjQ5NDM2NDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4943644?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/domob1812",
            "html_url": "https://github.com/domob1812",
            "followers_url": "https://api.github.com/users/domob1812/followers",
            "following_url": "https://api.github.com/users/domob1812/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/domob1812/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/domob1812/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/domob1812/subscriptions",
            "organizations_url": "https://api.github.com/users/domob1812/orgs",
            "repos_url": "https://api.github.com/users/domob1812/repos",
            "events_url": "https://api.github.com/users/domob1812/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/domob1812/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 1,
          "closed_at": "2020-05-08T18:31:32Z",
          "created_at": "2016-09-11T16:57:59Z",
          "updated_at": "2022-02-15T11:03:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 246190751,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjE5MDc1MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246190751",
      "actor": {
        "login": "domob1812",
        "id": 4943644,
        "node_id": "MDQ6VXNlcjQ5NDM2NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4943644?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/domob1812",
        "html_url": "https://github.com/domob1812",
        "followers_url": "https://api.github.com/users/domob1812/followers",
        "following_url": "https://api.github.com/users/domob1812/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/domob1812/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/domob1812/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/domob1812/subscriptions",
        "organizations_url": "https://api.github.com/users/domob1812/orgs",
        "repos_url": "https://api.github.com/users/domob1812/repos",
        "events_url": "https://api.github.com/users/domob1812/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/domob1812/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-11T16:58:33Z",
      "updated_at": "2016-09-11T16:58:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "See also #8698, which seems to be caused by the same underlying issue.\n",
      "user": {
        "login": "domob1812",
        "id": 4943644,
        "node_id": "MDQ6VXNlcjQ5NDM2NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4943644?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/domob1812",
        "html_url": "https://github.com/domob1812",
        "followers_url": "https://api.github.com/users/domob1812/followers",
        "following_url": "https://api.github.com/users/domob1812/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/domob1812/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/domob1812/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/domob1812/subscriptions",
        "organizations_url": "https://api.github.com/users/domob1812/orgs",
        "repos_url": "https://api.github.com/users/domob1812/repos",
        "events_url": "https://api.github.com/users/domob1812/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/domob1812/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/5806#issuecomment-246190751",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/5806"
    },
    {
      "event": "referenced",
      "id": 2761696658,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3NjE2OTY2NTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2761696658",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "479dda1398533da20c3e066bc5861d64d61576cb",
      "commit_url": "https://api.github.com/repos/TheBlueMatt/bitcoin/commits/479dda1398533da20c3e066bc5861d64d61576cb",
      "created_at": "2019-10-31T23:09:40Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-10-31T23:09:57Z",
      "updated_at": "2019-10-31T23:09:57Z",
      "source": {
        "issue": {
          "id": 515805151,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MzM1MjAxNDQz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17335",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17335/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17335/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17335/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/17335",
          "number": 17335,
          "state": "closed",
          "state_reason": null,
          "title": "Add test for syncing blocks generated after invalidateblock.",
          "body": "Suhas wrote this test to demonstrate a bug in invalidateblock back\r\nin 2015, and at some point between then and now it started passing,\r\nso best to just merge it so we don't regress.\r\n\r\nCloses #5806 (the original issue in which this test was written)",
          "user": {
            "login": "TheBlueMatt",
            "id": 649246,
            "node_id": "MDQ6VXNlcjY0OTI0Ng==",
            "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheBlueMatt",
            "html_url": "https://github.com/TheBlueMatt",
            "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
            "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
            "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
            "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
            "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17335",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/17335",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/17335.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/17335.patch"
          },
          "closed_at": "2020-06-12T20:04:50Z",
          "created_at": "2019-10-31T23:09:57Z",
          "updated_at": "2022-02-15T10:32:56Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 2761740308,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3NjE3NDAzMDg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2761740308",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1b0a68c783a487a2326cde1e1cd1bb86c85a51ee",
      "commit_url": "https://api.github.com/repos/TheBlueMatt/bitcoin/commits/1b0a68c783a487a2326cde1e1cd1bb86c85a51ee",
      "created_at": "2019-10-31T23:35:00Z"
    },
    {
      "event": "referenced",
      "id": 2761869857,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3NjE4Njk4NTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2761869857",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6f6808b32e2d95d530aecbed48b2c4aac875db1d",
      "commit_url": "https://api.github.com/repos/TheBlueMatt/bitcoin/commits/6f6808b32e2d95d530aecbed48b2c4aac875db1d",
      "created_at": "2019-11-01T00:56:35Z"
    },
    {
      "event": "referenced",
      "id": 2761886821,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3NjE4ODY4MjE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2761886821",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7b3518f957096f21faf278d1e5f333d4eb7671da",
      "commit_url": "https://api.github.com/repos/TheBlueMatt/bitcoin/commits/7b3518f957096f21faf278d1e5f333d4eb7671da",
      "created_at": "2019-11-01T01:10:06Z"
    },
    {
      "event": "referenced",
      "id": 2761918192,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3NjE5MTgxOTI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2761918192",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "50190dfaafac7f6bf7f1b8ff2dcc494ec7643912",
      "commit_url": "https://api.github.com/repos/TheBlueMatt/bitcoin/commits/50190dfaafac7f6bf7f1b8ff2dcc494ec7643912",
      "created_at": "2019-11-01T01:35:02Z"
    },
    {
      "event": "closed",
      "id": 2765634927,
      "node_id": "MDExOkNsb3NlZEV2ZW50Mjc2NTYzNDkyNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2765634927",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-02T23:14:57Z"
    },
    {
      "event": "referenced",
      "id": 2768500191,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3Njg1MDAxOTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2768500191",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "df117c82129f1a7ef0898d46794fc9d9bad64923",
      "commit_url": "https://api.github.com/repos/TheBlueMatt/bitcoin/commits/df117c82129f1a7ef0898d46794fc9d9bad64923",
      "created_at": "2019-11-04T17:07:30Z"
    },
    {
      "event": "referenced",
      "id": 2884090055,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI4ODQwOTAwNTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2884090055",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "24227b227ac7b0863e817d8ffdd36c7e4dfbcc1b",
      "commit_url": "https://api.github.com/repos/jnewbery/bitcoin/commits/24227b227ac7b0863e817d8ffdd36c7e4dfbcc1b",
      "created_at": "2019-12-15T16:51:37Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-27T16:15:35Z",
      "updated_at": "2020-06-27T16:15:35Z",
      "source": {
        "issue": {
          "id": 646710084,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDQwOTMxNDY5",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19397",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19397/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19397/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19397/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19397",
          "number": 19397,
          "state": "closed",
          "state_reason": null,
          "title": "test: resyncing to tip of blocks generated after invalidateblock",
          "body": "This commit picks up #17335 to add an updated version of a test by Suhas Daftuar in issue #5806 to demonstrate a block propagation issue for the first coinbase following an `invalidateblock`. As Suhas reported: *\"[only] the first 16 [blocks] will make it, because of the call to getdata on processing each inv, which occurs until we've maxed out the number of blocks in flight to that peer.\"*\r\n\r\nHere we test that after running `invalidateblock`, on the first coinbase transaction nodes will resync to a new lower chain tip, but for the non-mining node only reliably up to the number of blocks equal to the value (16) of `MAX_BLOCKS_IN_TRANSIT_PER_PEER`. We then check that it catches up to the chain tip with the next coinbase transactions.\r\n\r\nReviewers may test this by running the test with different values of `BLOCKS` in the test and with rebuilding using different values of `MAX_BLOCKS_IN_TRANSIT_PER_PEER` in net_processing.cpp.",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19397",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19397",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19397.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19397.patch"
          },
          "closed_at": "2020-07-23T17:15:33Z",
          "created_at": "2020-06-27T16:15:35Z",
          "updated_at": "2022-02-15T11:04:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "locked",
      "id": 5778625616,
      "node_id": "LOE_lADOABII584DeO1QzwAAAAFYbtRQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5778625616",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-16T14:12:16Z",
      "lock_reason": "resolved"
    }
  ]
}