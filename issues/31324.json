{
  "type": "issue",
  "issue": {
    "id": 2672911876,
    "node_id": "I_kwDOABII586fUWYE",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31324",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31324/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31324/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31324/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31324",
    "number": 31324,
    "state": "open",
    "state_reason": null,
    "title": "Feature request: Backup of datadir state",
    "body": "### Please describe the feature you'd like to see added.\n\nIt will be good to have a option included in bitcoind to backup and restore the current state of the datadir periodically. \n\n### Is your feature related to a problem, if so please describe it.\n\nNot a software problem, but its the environment. Many events can corrupt data inside datadir, to name some: power outages, out of resources (RAM), network fail (in case of network storage).\r\nOnce corrupted, it's costly to re-sync it again from scratch. So instead of syncing, it can just restore the backed datadir to some point in time.\n\n### Describe the solution you'd like\n\nAdd a folder called backup to datadir, it can have 4 files: the last two backups named with timestamp and compressed as tar.gz (or other better format) and one text file for each backup with info to restore them.\r\nAdd options to bitcoind:\r\n`-restorebackup=<0|1>`\r\n`-backup=<n>`\r\nwhere n can be\r\n - 0, to disable\r\n - 1 to backup only once after node are synced, and do not update this backup in case of it already present in backup folder\r\n - greater than 1 indicating the period in days since last backup to do it again. It will keep always two backups to address the case in which a failure occurs during the backup process.\n\n### Describe any alternatives you've considered\n\nThe backed data to reconstruct any state in time are (i think):\r\n - chainstate folder;\r\n - Last blocks/*.blk and .rev files that are not completely full;\r\n - blocks/index folder\r\n - Any other file that are used with specific configuration, like bloom filters (or in the case of restoring the backup, just reconstruct them to avoid conflicts)\r\n\r\nActually i do it manually, i keep an HDD with datadir up to May/2024, and when restoring, just copy chainstate, last blk/rev files of backup, excluding the others not present in backup, blocks/index\r\nSince my node uses HDD and have 2GB RAM, it takes one month to sync from scratch. So i restored this backup sometimes and saved a lot of time.\r\n\r\nThe creation of this backup also can be automated using scripts in bash, python, etc.\r\nThe script need to stop bitcoind, write chainstate, blocks/index and some last .blk and .rev files. The restoration can be done manually, jsut replace chainstate, blocks/index and exclude .blk/.rev files down to current in the backup.\n\n### Please leave any additional context\n\n_No response_",
    "user": {
      "login": "lcharles123",
      "id": 8680067,
      "node_id": "MDQ6VXNlcjg2ODAwNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8680067?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lcharles123",
      "html_url": "https://github.com/lcharles123",
      "followers_url": "https://api.github.com/users/lcharles123/followers",
      "following_url": "https://api.github.com/users/lcharles123/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/lcharles123/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/lcharles123/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/lcharles123/subscriptions",
      "organizations_url": "https://api.github.com/users/lcharles123/orgs",
      "repos_url": "https://api.github.com/users/lcharles123/repos",
      "events_url": "https://api.github.com/users/lcharles123/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/lcharles123/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "created_at": "2024-11-19T17:13:08Z",
    "updated_at": "2024-11-19T17:33:32Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 15352827000,
      "node_id": "LE_lADOABII586fUWYEzwAAAAOTGYx4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15352827000",
      "actor": {
        "login": "lcharles123",
        "id": 8680067,
        "node_id": "MDQ6VXNlcjg2ODAwNjc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8680067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/lcharles123",
        "html_url": "https://github.com/lcharles123",
        "followers_url": "https://api.github.com/users/lcharles123/followers",
        "following_url": "https://api.github.com/users/lcharles123/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/lcharles123/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/lcharles123/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/lcharles123/subscriptions",
        "organizations_url": "https://api.github.com/users/lcharles123/orgs",
        "repos_url": "https://api.github.com/users/lcharles123/repos",
        "events_url": "https://api.github.com/users/lcharles123/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/lcharles123/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-19T17:13:08Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 2486339380,
      "node_id": "IC_kwDOABII586UMoc0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2486339380",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-19T17:33:31Z",
      "updated_at": "2024-11-19T17:33:31Z",
      "author_association": "MEMBER",
      "body": "I think backups should be the users job not bitcoind. Especially putting backups in datadir -- wouldn't it make more sense to be on a completely different drive ?",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31324#issuecomment-2486339380",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31324"
    }
  ]
}