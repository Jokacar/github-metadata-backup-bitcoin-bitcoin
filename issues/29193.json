{
  "type": "issue",
  "issue": {
    "id": 2068511429,
    "node_id": "I_kwDOABII5857SvrF",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29193",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29193/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29193/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29193/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29193",
    "number": 29193,
    "state": "open",
    "state_reason": null,
    "title": "Failed loading mempool when restarting bitcoind",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nAfter a clean shutdown, bitcoind failed to load the majority of mempool transactions from mempool.dat. I keep a node up for months for webpage mempoolexplorer.com with options:\r\nmaxmempool=2000\r\nmempoolfullrbf=1\r\nmempoolexpiry=999999\r\nto maximize the number of txs in my mempool.\r\nThe node is currently loading and saving mempool txs when shutdown ok (but with only a small number of them instead of a fully synchronized mempool). So I think It could be related to the currently mempool size spike. (larger than ever according [jochen-hoenicke](https://jochen-hoenicke.de/queue/#BTC,all,weight) )\n\n### Expected behaviour\n\nThe expected behavior is to save/load all the transactions again no matter the size of the mempool\n\n### Steps to reproduce\n\nIt's a issue difficult to reproduce, because I have no access to a node syncronized with \"the full mempool\" since mine failed.\r\n\r\nIn order to reproduce the issue you must have access to a big mempool and try to start/stop bitcoind and monitor mempool.dat. (Mine is currenty erased and only with a few transactions)\r\n\r\nNot sure if the problem was writing the txs into mempool.dat or reading them.\r\n\r\nMaybe this utility I created can help copying a live mempool from one node to another:\r\n\r\nhttps://github.com/dev7ba/mempoolcp\n\n### Relevant log output\n\nI did not copy the debug.log line (currently erased) but it was something like this:\r\n\r\nImported mempool transactions from disk: (small number here) succeeded, (big number here) failed, 0 expired, 0 already there, 0 waiting for initial broadcast\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv24.0.0\n\n### Operating system and version\n\nUbuntu 20.04.6 LTS\n\n### Machine specifications\n\nIntel(R) Core(TM) i5-6260U CPU @ 1.80GHz 16GB RAM",
    "user": {
      "login": "dev7ba",
      "id": 93706552,
      "node_id": "U_kgDOBZXZOA",
      "avatar_url": "https://avatars.githubusercontent.com/u/93706552?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dev7ba",
      "html_url": "https://github.com/dev7ba",
      "followers_url": "https://api.github.com/users/dev7ba/followers",
      "following_url": "https://api.github.com/users/dev7ba/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dev7ba/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dev7ba/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dev7ba/subscriptions",
      "organizations_url": "https://api.github.com/users/dev7ba/orgs",
      "repos_url": "https://api.github.com/users/dev7ba/repos",
      "events_url": "https://api.github.com/users/dev7ba/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dev7ba/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 164208572,
        "node_id": "MDU6TGFiZWwxNjQyMDg1NzI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Mempool",
        "name": "Mempool",
        "color": "fef2c0",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "created_at": "2024-01-06T10:04:59Z",
    "updated_at": "2024-01-06T11:27:15Z"
  },
  "events": [
    {
      "event": "renamed",
      "id": 11407837995,
      "node_id": "RTE_lADOABII5857SvrFzwAAAAKn9csr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11407837995",
      "actor": {
        "login": "dev7ba",
        "id": 93706552,
        "node_id": "U_kgDOBZXZOA",
        "avatar_url": "https://avatars.githubusercontent.com/u/93706552?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dev7ba",
        "html_url": "https://github.com/dev7ba",
        "followers_url": "https://api.github.com/users/dev7ba/followers",
        "following_url": "https://api.github.com/users/dev7ba/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dev7ba/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dev7ba/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dev7ba/subscriptions",
        "organizations_url": "https://api.github.com/users/dev7ba/orgs",
        "repos_url": "https://api.github.com/users/dev7ba/repos",
        "events_url": "https://api.github.com/users/dev7ba/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dev7ba/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T10:16:00Z",
      "rename": {
        "from": "Failed load mempool when restarting bitcoind",
        "to": "Failed loading mempool when restarting bitcoind"
      }
    },
    {
      "event": "commented",
      "id": 1879631591,
      "node_id": "IC_kwDOABII585wCObn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879631591",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T10:32:06Z",
      "updated_at": "2024-01-06T10:32:06Z",
      "author_association": "MEMBER",
      "body": "Hard to guess without logs (which would tell us why transactions failed). How much time elapsed between saving the mempool.dat and loading it? Mempool transactions that had confirmed during that time would be marked as \"failed.\"\r\n\r\nAnd to clarify, are you restarting with the same config? What are mempoolexpiry and maxmempool now? (Is it possible you have less space or expired old transactions?)\r\n\r\n> Not sure if the problem was writing the txs into mempool.dat or reading them.\r\n\r\nMust be loading given the \"X failed\" log line.\r\n\r\n> v24.0.0\r\n\r\nMaybe try upgrading to a newer version?",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29193#issuecomment-1879631591",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29193"
    },
    {
      "event": "commented",
      "id": 1879634958,
      "node_id": "IC_kwDOABII585wCPQO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1879634958",
      "actor": {
        "login": "dev7ba",
        "id": 93706552,
        "node_id": "U_kgDOBZXZOA",
        "avatar_url": "https://avatars.githubusercontent.com/u/93706552?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dev7ba",
        "html_url": "https://github.com/dev7ba",
        "followers_url": "https://api.github.com/users/dev7ba/followers",
        "following_url": "https://api.github.com/users/dev7ba/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dev7ba/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dev7ba/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dev7ba/subscriptions",
        "organizations_url": "https://api.github.com/users/dev7ba/orgs",
        "repos_url": "https://api.github.com/users/dev7ba/repos",
        "events_url": "https://api.github.com/users/dev7ba/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dev7ba/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T10:46:54Z",
      "updated_at": "2024-01-06T10:48:12Z",
      "author_association": "NONE",
      "body": "> How much time elapsed between saving the mempool.dat and loading it?\r\n\r\nOnly a few minutes.\r\n\r\n> And to clarify, are you restarting with the same config? What are mempoolexpiry and maxmempool now?\r\n\r\nI restarted with the same config. Checked I have enough disk space.\r\n\r\n> Must be loading given the \"X failed\" log line.\r\n\r\nYes, I see.\r\n\r\n> Maybe try upgrading to a newer version?\r\n\r\nI can't test it anyway, I'm trying to contact people with a \"full mempool\", And asking them to restart the node and see what happens.",
      "user": {
        "login": "dev7ba",
        "id": 93706552,
        "node_id": "U_kgDOBZXZOA",
        "avatar_url": "https://avatars.githubusercontent.com/u/93706552?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dev7ba",
        "html_url": "https://github.com/dev7ba",
        "followers_url": "https://api.github.com/users/dev7ba/followers",
        "following_url": "https://api.github.com/users/dev7ba/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dev7ba/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dev7ba/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dev7ba/subscriptions",
        "organizations_url": "https://api.github.com/users/dev7ba/orgs",
        "repos_url": "https://api.github.com/users/dev7ba/repos",
        "events_url": "https://api.github.com/users/dev7ba/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dev7ba/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29193#issuecomment-1879634958",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29193"
    },
    {
      "event": "labeled",
      "id": 11408064447,
      "node_id": "LE_lADOABII5857SvrFzwAAAAKn-T-_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11408064447",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T11:27:01Z",
      "label": {
        "name": "Mempool",
        "color": "fef2c0"
      }
    },
    {
      "event": "labeled",
      "id": 11408064459,
      "node_id": "LE_lADOABII5857SvrFzwAAAAKn-T_L",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11408064459",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T11:27:01Z",
      "label": {
        "name": "Data corruption",
        "color": "f7c6c7"
      }
    },
    {
      "event": "unlabeled",
      "id": 11408067006,
      "node_id": "UNLE_lADOABII5857SvrFzwAAAAKn-Um-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11408067006",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T11:27:15Z",
      "label": {
        "name": "Data corruption",
        "color": "f7c6c7"
      }
    }
  ]
}