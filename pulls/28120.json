{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120",
    "id": 1444535818,
    "node_id": "PR_kwDOABII585WGd4K",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/28120",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/28120.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/28120.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
    "number": 28120,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "p2p: make block download logic aware of limited peers threshold",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Even when the node believes it has IBD completed, need to avoid\r\nrequesting historical blocks from network-limited peers.\r\nOtherwise, the limited peer will disconnect right away.\r\n\r\nThe simplest scenario could be a node that gets synced, drops\r\nconnections, and stays inactive for a while. Then, once it re-connects\r\n(IBD stays completed), the node tries to fetch all the missing blocks\r\nfrom any peer, getting disconnected by the limited ones.\r\n\r\nNote:\r\nCan verify the behavior by cherry-picking the test commit alone on\r\nmaster. It will fail there.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2023-07-21T13:55:22Z",
    "updated_at": "2023-12-04T12:58:36Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "50d4193856923db99514a84f9a4d0a1bd68371c9",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2023_net_limited_peers",
      "ref": "2023_net_limited_peers",
      "sha": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 389320,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-12-03T14:53:34Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-08-30T13:12:58Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5800c558eb5efb4839ed00d6967e43306d68e1c3",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36078,
        "stargazers_count": 72443,
        "watchers_count": 72443,
        "size": 246235,
        "default_branch": "master",
        "open_issues_count": 654,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-12-04T12:54:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-12-04T11:49:32Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 96,
    "deletions": 16,
    "changed_files": 2,
    "commits": 3,
    "review_comments": 27,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 1645631813,
      "node_id": "IC_kwDOABII585iFllF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1645631813",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-21T13:55:25Z",
      "updated_at": "2023-12-03T18:21:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28120).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1729314172), [andrewtoth](https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1761328425) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#issuecomment-1645631813",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120"
    },
    {
      "event": "labeled",
      "id": 9885664044,
      "node_id": "LE_lADOABII585sO8VEzwAAAAJNO0Ms",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9885664044",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-21T13:55:27Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "reviewed",
      "id": 1541662993,
      "node_id": "PRR_kwDOABII585b4-kR",
      "url": null,
      "actor": null,
      "commit_id": "8e9143977f8068306fae4ae206e3b842d3f5af3c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Maybe getting disconnected could be beneficial in this rare situation? If our tip is that much behind but we're not in IBD, we can't help them and they can't help us, so our priority should be to get the missing blocks asap, and getting disconnected by useless peers seems like it's not such a bad thing towards that goal.\r\n\r\nWhat would be bad is if all our current peers were limited, and we wouldn't try to request the needed blocks from anyone, but also wouldn't try to exchange them for better peers, so that we would be stuck.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1541662993",
      "submitted_at": "2023-07-21T18:53:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "reviewed",
      "id": 1541838521,
      "node_id": "PRR_kwDOABII585b5pa5",
      "url": null,
      "actor": null,
      "commit_id": "8e9143977f8068306fae4ae206e3b842d3f5af3c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> Maybe getting disconnected could be beneficial in this rare situation? If our tip is that much behind but we're not in IBD, we can't help them and they can't help us, so our priority should be to get the missing blocks asap, and getting disconnected by useless peers seems like it's not such a bad thing towards that goal.\r\n\r\nAgree but, while the outcome might be the desired one, the approach to achieve it isn't the best. It seems unwise to have the node sending a message through the wire, knowing it will fail, just to force the other peer to disconnect.\r\nThe node should be smarter than that and not rely on external factors to take decisions.\r\n\r\nMoreover, in cases where the other peer chooses to ignore the message without disconnecting (maybe due to using different software than bitcoin-core), the node will end up waiting for a response that will never arrive, wasting time and resources, which could have been easily avoided.\r\n\r\nAnd also, while the node has more connection slots available, I don't see why should disconnect a peer that is behaving properly.\r\n\r\nInstead, I think that we should try to keep processes separated. The eviction process should be in charge of disconnecting peers that aren't/will not provide any meaningful data. And the block downloading logic should only be responsible of deciding which blocks request to each peer and which ones not.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1541838521",
      "submitted_at": "2023-07-21T20:54:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "commented",
      "id": 1649479100,
      "node_id": "IC_kwDOABII585iUQ28",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649479100",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-25T09:40:13Z",
      "updated_at": "2023-07-25T09:40:13Z",
      "author_association": "MEMBER",
      "body": "> What would be bad is if all our current peers were limited, and we wouldn't try to request the needed blocks from anyone, but also wouldn't try to exchange them for better peers, so that we would be stuck.\r\n\r\nI agree with this part. I think the solution should be expanded to give a chance in such cases, and it should be merged within the same PR.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#issuecomment-1649479100",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120"
    },
    {
      "event": "commented",
      "id": 1650338677,
      "node_id": "IC_kwDOABII585iXit1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650338677",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-25T18:33:06Z",
      "updated_at": "2023-07-25T18:33:06Z",
      "author_association": "MEMBER",
      "body": "Agree with @mzumsande and @naumenkogs. Maybe not the same PR if it's substantially different, but the new eviction logic should be merged before this fix.",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#issuecomment-1650338677",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120"
    },
    {
      "event": "mentioned",
      "id": 9915131974,
      "node_id": "MEE_lADOABII585sO8VEzwAAAAJO_OhG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9915131974",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-25T18:33:06Z"
    },
    {
      "event": "subscribed",
      "id": 9915131989,
      "node_id": "SE_lADOABII585sO8VEzwAAAAJO_OhV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9915131989",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-25T18:33:06Z"
    },
    {
      "event": "mentioned",
      "id": 9915132010,
      "node_id": "MEE_lADOABII585sO8VEzwAAAAJO_Ohq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9915132010",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-25T18:33:06Z"
    },
    {
      "event": "subscribed",
      "id": 9915132025,
      "node_id": "SE_lADOABII585sO8VEzwAAAAJO_Oh5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9915132025",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-25T18:33:06Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-27T15:34:45Z",
      "updated_at": "2023-07-27T15:34:45Z",
      "source": {
        "issue": {
          "id": 1824626893,
          "node_id": "PR_kwDOABII585Wjy4M",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28170",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28170/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28170/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28170/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28170",
          "number": 28170,
          "state": "open",
          "state_reason": null,
          "title": "p2p: adaptive connections services flags",
          "body": "Derived from #28120 discussion.\r\n\r\nBy relocating the peer desirable services flags into the peer manager, we\r\nallow the connections acceptance process to handle post-IBD potential\r\nstalling scenarios.\r\n\r\nThe peer manager will be able to dynamically adjust the services flags\r\nbased on the node's proximity to the tip (back and forth). Allowing the node\r\nto recover from the following post-IBD scenario:\r\nSuppose the node has successfully synced the chain, but later experienced\r\ndropped connections and remained inactive for a duration longer than the limited\r\npeers threshold (the timeframe within which limited peers can provide blocks). In\r\nsuch cases, upon reconnecting to the network, the node might only establish\r\nconnections with limited peers, filling up all available outbound slots. Resulting\r\nin an inability to synchronize the chain (because limited peers will not provide\r\nblocks older than the `NODE_NETWORK_LIMITED_MIN_BLOCKS` threshold).",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28170",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28170",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28170.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28170.patch"
          },
          "created_at": "2023-07-27T15:34:45Z",
          "updated_at": "2023-12-03T16:24:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1557211930,
      "node_id": "PRR_kwDOABII585c0Ssa",
      "url": null,
      "actor": null,
      "commit_id": "8e9143977f8068306fae4ae206e3b842d3f5af3c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> What would be bad is if all our current peers were limited, and we wouldn't try to request the needed blocks from anyone, but also wouldn't try to exchange them for better peers, so that we would be stuck.\r\n\r\nRight now, this will hardly happen. The reason is `CheckForStaleTipAndEvictPeers`. The logic is as follows:\r\n\r\nWhen the node doesn't update the tip for a period longer than 30 minutes (`TipMayBeStale()`), it triggers the extra outbound connection process. Which instructs the net layer to bypass the maximum outbound connection restriction and create another full relay outbound connection to sync up the missing blocks.\r\n\r\nThen, considering the worst-case scenario: when the extra outbound connection is also a limited peer. In that case, 45 seconds after connecting to the extra peer (scheduler task timeout), `CheckForStaleTipAndEvictPeers` will call `EvictExtraOutboundPeers`, which will evict the peer that least recently announced a block header.\r\nThen, in case of no chain movement; the process starts again, adding an extra outbound connection, and so on, until it finds a peer that can provide the missing blocks.\r\n\r\nNote:\r\nWhile this sooner or later corrects the stalling situation, it's not ideal to continue establishing connections to limited peers, on the extra outbound connection process, when the peer is stalled. So, to address this issue, have created #28170. Which basically disallows connections to limited peers when the node is behind enough to know that limited peers will not provide any of the required historical blocks (although they will still provide valid headers).",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1557211930",
      "submitted_at": "2023-08-01T14:56:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T21:29:29Z",
      "updated_at": "2023-08-01T21:29:29Z",
      "source": {
        "issue": {
          "id": 1746501636,
          "node_id": "PR_kwDOABII585ScjM9",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27837",
          "number": 27837,
          "state": "open",
          "state_reason": null,
          "title": "net: introduce block tracker to retry to download blocks after failure",
          "body": "Built on top of #28120 and #28170. Coming from #27652.\r\n\r\nThe general idea is to keep track of the user requested blocks so, in\r\ncase of a bad behaving peer or a network disconnection, they can be\r\nfetched from another one automatically without any further user interaction.\r\n\r\nThis was requested by users because the `getblockfrompeer` RPC command\r\nlacks the functionality to notify them about block request failures or peer\r\ndisconnections (which is expected due to the asynchronous nature of the block\r\nrequests).\r\n\r\nCurrently, this new functionality is limited to blocks requested by the\r\nuser via the 'getblockfrompeer' RPC command.\r\n\r\nIn the future, this class could expand its scope and be utilized in the\r\nregular chain synchronization process. Or, even could be employed in\r\nspecial procedures like a prune node rescan that uses BIP158 block filters,\r\nor even into BIP157 itself.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27837",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27837",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27837.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27837.patch"
          },
          "created_at": "2023-06-07T19:01:56Z",
          "updated_at": "2023-10-19T18:29:38Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T23:05:07Z",
      "updated_at": "2023-08-24T23:05:07Z",
      "source": {
        "issue": {
          "id": 1700441577,
          "node_id": "PR_kwDOABII585QAqXJ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27596",
          "number": 27596,
          "state": "closed",
          "state_reason": null,
          "title": "assumeutxo (2)",
          "body": "- Background and FAQ: https://github.com/jamesob/assumeutxo-docs/tree/2019-04-proposal/proposal\r\n- Prior progress/project: https://github.com/bitcoin/bitcoin/projects/11\r\n- Replaces https://github.com/bitcoin/bitcoin/pull/15606, which was closed due to Github slowness. Original description and commentary can be found there.\r\n\r\n---\r\n\r\nThis changeset finishes the first phase of the assumeutxo project. It makes UTXO snapshots loadable via RPC (`loadtxoutset`) and adds `assumeutxo` parameters to chainparams. It contains all the remaining changes necessary to both use an assumedvalid snapshot chainstate and do a full validation sync in the background.\r\n\r\nThis may look like a lot to review, but note that\r\n- ~200 lines are a (non-essential) demo shell script\r\n- Many lines are functional test, documentation, and relatively dilute RPC code.\r\n\r\nSo it shouldn't be as burdensome to review as the linecount might suggest.\r\n\r\n- **P2P**: minor changes are made to `init.cpp` and `net_processing.cpp` to make simultaneous IBD across multiple chainstates work.\r\n- **Pruning**: implement correct pruning behavior when using a background chainstate\r\n- **Blockfile separation**: to prevent \"fragmentation\" in blockfile storage, have background chainstates use separate blockfiles from active snapshot chainstates to avoid interleaving heights and impairing pruning.\r\n- **Indexing**: some `CValidationInterface` events are given with an additional parameter, ChainstateRole, and all indexers ignore events from ChainstateRole::ASSUMEDVALID so that indexation only happens sequentially.\r\n- Have `-reindex` properly wipe snapshot chainstates.\r\n- **RPC**: introduce RPC commands `loadtxoutset` and (hidden) `getchainstates`.\r\n- **Release docs & first assumeutxo commitment**: add notes and a particular assumeutxo hash value for first AU-enabled release.\r\n  - This will complete the project and allow use of UTXO snapshots for faster node bootstrap.\r\n\r\nThe next phase, if it were to be pursued, would be coming up with a way to distribute the UTXO snapshots over the P2P network.\r\n\r\n---\r\n\r\n### UTXO snapshots\r\n\r\nCreate your own with `./contrib/devtools/utxo_snapshot.sh`, e.g. \r\n```shell\r\n./contrib/devtools/utxo_snapshot.sh 788000 utxo.dat ./src/bitcoin-cli -datadir=$(pwd)/testdata`)\r\n```\r\nor use the pre-generated ones listed below.\r\n\r\n- Testnet: **2'500'000** (Sjors):\r\n  - torrent: `magnet:?xt=urn:btih:511e09f4bf853aefab00de5c070b1e031f0ecbe9&dn=utxo-testnet-2500000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n  - sha256: `79db4b025448cc0ac388d8589a28eab02de53055d181e34eb47391717aa16388`\r\n- Signet: **160'000** (Sjors):\r\n  - torrent: `magnet:?xt=urn:btih:9da986cb27b3980ea7fd06b21e199b148d486880&dn=utxo-signet-160000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n  - sha256: `eeeca845385ba91e84ef58c09d38f98f246a24feadaad57fe1e5874f3f92ef8c`\r\n- Mainnet: **800'000** (Sjors):\r\n  - Note: this needs the following commit cherry-picked in: https://github.com/Sjors/bitcoin/commit/24deb2022b822f22fba9fcbee201e37a83225eb2\r\n  - torrent: `magnet:?xt=urn:btih:50ee955bef37f5ec3e5b0df4cf0288af3d715a2e&dn=utxo-800000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n\r\n### Testing\r\n\r\n#### For fun (~5min)\r\n\r\nIf you want to do a quick test, you can run `./contrib/devtools/test_utxo_snapshots.sh` and follow the instructions. This is mostly obviated by the functional tests, though.\r\n\r\n#### For real (longer)\r\n\r\nIf you'd like to experience a real usage of assumeutxo, you can do that too.\r\nI've cut a new snapshot at height 788'000 (http://img.jameso.be/utxo-788000.dat - but you can do it yourself with `./contrib/devtools/utxo_snapshot.sh` if you want). Download that, and then create a datadir for testing:\r\n```sh\r\n$ cd ~/src/bitcoin  # or whatever\r\n\r\n# get the snapshot\r\n$ curl http://img.jameso.be/utxo-788000.dat > utxo-788000.dat\r\n\r\n# you'll want to do this if you like copy/pasting \r\n$ export AU_DATADIR=/home/${USER}/au-test # or wherever\r\n\r\n$ mkdir ${AU_DATADIR}\r\n$ vim ${AU_DATADIR}/bitcoin.conf\r\n\r\ndbcache=8000  # or, you know, something high\r\nblockfilterindex=1\r\ncoinstatsindex=1\r\nprune=3000\r\nlogthreadnames=1\r\n```\r\nObtain this branch, build it, and then start bitcoind:\r\n```sh\r\n$ git remote add jamesob https://github.com/jamesob/bitcoin\r\n$ git fetch jamesob assumeutxo\r\n$ git checkout jamesob/assumeutxo\r\n\r\n$ ./configure $conf_args && make  # (whatever you like to do here)\r\n\r\n# start 'er up and watch the logs\r\n$ ./src/bitcoind -datadir=${AU_DATADIR}\r\n```\r\nThen, in some other window, load the snapshot\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} loadtxoutset $(pwd)/utxo-788000.dat\r\n```\r\n\r\nYou'll see some log messages about headers retrieval and waiting to see the snapshot in the headers chain. Once you get the full headers chain, you'll spend a decent amount of time (~10min) loading the snapshot, checking it, and flushing it to disk. After all that happens, you should be syncing to tip in pretty short order, and you'll see the occasional `[background validation]` log message go by.\r\n\r\nIn yet another window, you can check out chainstate status with\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} getchainstates\r\n```\r\nas well as usual favorites like `getblockchaininfo`.",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 57,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27596",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27596.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27596.patch"
          },
          "closed_at": "2023-10-02T21:10:18Z",
          "created_at": "2023-05-08T15:08:28Z",
          "updated_at": "2023-10-10T11:02:16Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "review_requested",
      "id": 10425940800,
      "node_id": "RRE_lADOABII585sO8VEzwAAAAJtbztA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10425940800",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-20T17:22:40Z",
      "requested_reviewer": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 10425941540,
      "node_id": "RRE_lADOABII585sO8VEzwAAAAJtbz4k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10425941540",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-20T17:22:46Z",
      "requested_reviewer": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-21T18:45:29Z",
      "updated_at": "2023-09-21T18:45:29Z",
      "source": {
        "issue": {
          "id": 1907083935,
          "node_id": "PR_kwDOABII585a5S31",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28516",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28516/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28516/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28516/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28516",
          "number": 28516,
          "state": "closed",
          "state_reason": null,
          "title": "validation: assumeutxo params for testnet and signet",
          "body": "Based on #27596. This adds snapshot parameters for testnet block 2,500,000 and signet block 160,000.\r\n\r\nYou can generate the snapshots yourself using `./contrib/devtools/utxo_snapshot.sh` or download my torrent:\r\n* testnet: `magnet:?xt=urn:btih:511e09f4bf853aefab00de5c070b1e031f0ecbe9&dn=utxo-testnet-2500000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n* signet: `magnet:?xt=urn:btih:9da986cb27b3980ea7fd06b21e199b148d486880&dn=utxo-signet-160000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n\r\nIt would be a good idea to test:\r\n1. That you can produce the same snapshot files, sha256 sums:\r\n\r\n```\r\neeeca845385ba91e84ef58c09d38f98f246a24feadaad57fe1e5874f3f92ef8c utxo-signet-160000.dat\r\n79db4b025448cc0ac388d8589a28eab02de53055d181e34eb47391717aa16388 utxo-testnet-2500000.dat\r\n```\r\n\r\n2. That the snapshots work\r\n\r\n---\r\n\r\nNot part of this PR:\r\n\r\nI also have a branch with a mainnet snapshot at height 800,000. It can be used for testing, but I'm not proposing it for merge just yet. I think more testing and conceptual discussion should happen first.\r\n* branch: [2023/09/assume_mainnet](https://github.com/Sjors/bitcoin/tree/2023/09/assume_mainnet)\r\n* torrent: `magnet:?xt=urn:btih:50ee955bef37f5ec3e5b0df4cf0288af3d715a2e&dn=utxo-800000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28516",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28516",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28516.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28516.patch"
          },
          "closed_at": "2023-09-30T12:53:22Z",
          "created_at": "2023-09-21T14:12:54Z",
          "updated_at": "2023-09-30T12:53:22Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-30T14:44:51Z",
      "updated_at": "2023-09-30T14:44:51Z",
      "source": {
        "issue": {
          "id": 1920247340,
          "node_id": "PR_kwDOABII585blnyW",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28553",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28553/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28553/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28553/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28553",
          "number": 28553,
          "state": "open",
          "state_reason": null,
          "title": "[do not merge] validation: assumeutxo params mainnet",
          "body": "This adds snapshot parameters for mainnet block 800,000.\r\n\r\nIt can be used for testing, but I'm not proposing it for merge just yet. I think more testing and conceptual discussion should happen.\r\n\r\nIn particular I think we should first:\r\n- [ ] make the snapshot slightly smaller: #26045\r\n- [ ] consider (something like) MuHash instead or in addition #27669\r\n- [ ] consider not hardcoding the params at all\r\n  * find another way to make them relatively safe to use\r\n  * make it easier to fresh snapshots more frequently (if only to prevent malicious actors from shipping \"faster\" binaries)\r\n- [ ] go through the \"longer term questions\" in https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1727936044\r\n\r\nYou can generate the snapshot yourself using `./contrib/devtools/utxo_snapshot.sh` or download my torrent:\r\n* torrent: `magnet:?xt=urn:btih:50ee955bef37f5ec3e5b0df4cf0288af3d715a2e&dn=utxo-800000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n\r\nIt would be a good idea to test:\r\n1. That you can produce the same snapshot file, sha256 sum:\r\n\r\n```\r\n59c6d1a021b03693b022c357c7ae23520e2786507ffe85c115ccbb8e20a8a4c7 utxo-800000.dat\r\n```\r\n\r\n2. That the snapshot works",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28553",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28553",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28553.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28553.patch"
          },
          "created_at": "2023-09-30T12:53:11Z",
          "updated_at": "2023-11-10T13:20:11Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 10530996745,
      "node_id": "LE_lADOABII585sO8VEzwAAAAJzskIJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10530996745",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-02T21:54:35Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-16T19:16:12Z",
      "updated_at": "2023-10-16T19:16:12Z",
      "source": {
        "issue": {
          "id": 1708710593,
          "node_id": "I_kwDOABII585l2NrB",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/27652",
          "number": 27652,
          "state": "open",
          "state_reason": null,
          "title": "Allow getblockfrompeer to use any peer",
          "body": "### Please describe the feature you'd like to see added.\n\nWhen you use `getblockfrompeer` you have to specify an index of a specific peer. But it would be much easier if it allowed you to use ANY peer.\r\n\r\nFor example, if you run a pruned node, and your first peer happens to be also pruned, the call will fail. If the call tried all nodes, until it finds a peer that has the block, it wouldn't require you that implement any logic for that.\n\n### Is your feature related to a problem, if so please describe it.\n\n_No response_\n\n### Describe the solution you'd like\n\nThe solution would be simple: if you don't specify any index, then try all peers untill you find one that does have block, otherwise fail.\n\n### Describe any alternatives you've considered\n\n_No response_\n\n### Please leave any additional context\n\n_No response_",
          "user": {
            "login": "kroese",
            "id": 5763256,
            "node_id": "MDQ6VXNlcjU3NjMyNTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kroese",
            "html_url": "https://github.com/kroese",
            "followers_url": "https://api.github.com/users/kroese/followers",
            "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
            "organizations_url": "https://api.github.com/users/kroese/orgs",
            "repos_url": "https://api.github.com/users/kroese/repos",
            "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/kroese/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "NONE",
          "locked": false,
          "comments": 12,
          "created_at": "2023-05-13T18:44:59Z",
          "updated_at": "2023-10-16T19:21:58Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10693157620,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAJ9XKL0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10693157620",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-18T13:34:24Z"
    },
    {
      "event": "reviewed",
      "id": 1685102164,
      "node_id": "PRR_kwDOABII585kcJ5U",
      "url": null,
      "actor": null,
      "commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "rebased. Conflicts solved.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1685102164",
      "submitted_at": "2023-10-18T13:35:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "unlabeled",
      "id": 10693978126,
      "node_id": "UNLE_lADOABII585sO8VEzwAAAAJ9aSgO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10693978126",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-18T14:30:13Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1703037733,
      "node_id": "PRR_kwDOABII585lgksl",
      "url": null,
      "actor": null,
      "commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1703037733",
      "submitted_at": "2023-10-29T21:14:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "reviewed",
      "id": 1708290287,
      "node_id": "PRR_kwDOABII585l0nDv",
      "url": null,
      "actor": null,
      "commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK c1612ea1f0",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1708290287",
      "submitted_at": "2023-11-01T15:20:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUzYWM1YmVmZGZjYWE3M2QzZjhhNWYwMzU5YTIwMTNlZmU4ZDQzODA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380",
      "tree": {
        "sha": "486eac7cfee46b3cce3165e6dd0e184d270b268d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/486eac7cfee46b3cce3165e6dd0e184d270b268d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 486eac7cfee46b3cce3165e6dd0e184d270b268d\nparent 655dc716aa6043613171a1338e22928de89a7d3e\nauthor furszy <matiasfurszyfer@protonmail.com> 1689896676 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1698953389 -0300\n\nrefactor: Make FindNextBlocks friendlier\n\nNo behavior change.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmVD+K4ACgkQXdI8zGhq\npiOhxQ//eveB/WP2wa3PJmRHsRfYJcgjeWnZhQEyLT9lBMYYzO88RvYoYL23rKAQ\nkEIgR04GhiEmFBhq9Hb5M/E2K+f0QS6A5WKCp6JsIsv8YOe94BFtLDccJTE00v2A\nqZEL1QBudxGQNfyhB1Yf8TXkZPXX/uZev7PWi2cEuVBt7xhws1BMqqoDrfJAieSP\nebvm7wyBcy/1RamQanYjHUO7Tl2lUPhdCXqko42NKVQoEMBQNo5lVZqgd7dyp38t\nHL+T03Wa4DGvRaxhccMb5cIRstlkIs11myey79ihp+Rvt/rzOIRI6hB8hPn8j13W\nQAA5u8TLijfV4hU8UAw3Gl0THShVXLkkl6HZodw9Oy5i/WYOUTC07T5C/hcHObdL\nl3MRcybiC6d+RZDUBFsQJc8jypA620WN97ydowtLzM3u0myK0+QKJOoUAtPxfsuV\n5MFVPp6piWXjOkie8vDrGurkAUIveBc2+AzN/MiYGVZuRy4N7jQJtM3FGlWbIqbd\nTRC9uN5245YDYhRz/6NIBhJSUBGrqOE7dyzKQ2FbRKud+J8HoxpRwS2YTFZigU2N\n9tn30sXgQ0o33QsoZV3MYQ9EEKgbyg1PVZuaEjo6IEf5MySB+lmK6jSxSSb+Q0Rb\nCnKrxvLwA1/soirz90LxE4g86q4kTv8rTdA42ih5ZZXsAWyiS5o=\n=HXj/\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/655dc716aa6043613171a1338e22928de89a7d3e",
          "sha": "655dc716aa6043613171a1338e22928de89a7d3e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/655dc716aa6043613171a1338e22928de89a7d3e"
        }
      ],
      "message": "refactor: Make FindNextBlocks friendlier\n\nNo behavior change.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-11-02T19:29:49Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-20T23:44:36Z"
      },
      "sha": "e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10849762994,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAKGsj6y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10849762994",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-02T22:30:17Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10849780223,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAKGsoH_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10849780223",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-02T22:33:12Z"
    },
    {
      "event": "reviewed",
      "id": 1711359884,
      "node_id": "PRR_kwDOABII585mAUeM",
      "url": null,
      "actor": null,
      "commit_id": "9eba981808a56eee61a20b8378447bd0972ad589",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback, thanks for the review!\r\n\r\nFixed the two blocks buffer extension (now is reduction). Small [diff](https://github.com/bitcoin/bitcoin/compare/c1612ea1f050b3daede6a181464bbbce6e254b2d..9eba981808a56eee61a20b8378447bd0972ad589).\r\n",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1711359884",
      "submitted_at": "2023-11-02T22:40:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-07T03:42:35Z",
      "updated_at": "2023-11-07T03:42:35Z",
      "source": {
        "issue": {
          "id": 1980150868,
          "node_id": "PR_kwDOABII585evhgd",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28805",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28805/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28805/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28805/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28805",
          "number": 28805,
          "state": "closed",
          "state_reason": null,
          "title": "test: Make existing functional tests compatible with --v2transport",
          "body": "This makes the functional test suite compatible with BIP324, so that \r\n`python3 test_runner.py --v2transport`\r\nshould succeed (currently, 12 tests fail for me on master).\r\nIncludes two commits by TheStack I found in an old discussion https://github.com/bitcoin/bitcoin/pull/28331#discussion_r1326714164\r\n\r\nNote that even though all tests should pass, the python `p2p.py` module will do v2 connections only after the merge of #24748, so that for now only connections between two full nodes will actually run v2.\r\nSome of the fixed tests were added with `--v2transport` to the test runner. Though after #24748 we might also want to consider running the entire suite with `--v2transport` in some CI.",
          "user": {
            "login": "mzumsande",
            "id": 48763452,
            "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mzumsande",
            "html_url": "https://github.com/mzumsande",
            "followers_url": "https://api.github.com/users/mzumsande/followers",
            "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
            "organizations_url": "https://api.github.com/users/mzumsande/orgs",
            "repos_url": "https://api.github.com/users/mzumsande/repos",
            "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/mzumsande/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 13,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28805",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28805",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28805.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28805.patch"
          },
          "closed_at": "2023-11-28T19:17:43Z",
          "created_at": "2023-11-06T22:06:03Z",
          "updated_at": "2023-11-28T22:28:18Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1724999237,
      "node_id": "PRR_kwDOABII585m0WZF",
      "url": null,
      "actor": null,
      "commit_id": "534996ab5351a7aa2b98f0d7c93dab0dfe073407",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1724999237",
      "submitted_at": "2023-11-10T15:16:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10930720932,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAKLhZCk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10930720932",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-11T00:33:28Z"
    },
    {
      "event": "reviewed",
      "id": 1725862532,
      "node_id": "PRR_kwDOABII585m3pKE",
      "url": null,
      "actor": null,
      "commit_id": "adfc9c7d0c43ab0616775f464483756a01b9d829",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback, thanks for the review @vasild!\r\n\r\nThe node will now request blocks within the limited peers threshold when the block download window contemplates them and not only when the previous blocks arrived or are in-flight. Added test coverage exercising this behavior and verifying that the node can get synced even when the blocks arrived out of order.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1725862532",
      "submitted_at": "2023-11-11T01:06:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "labeled",
      "id": 10930833876,
      "node_id": "LE_lADOABII585sO8VEzwAAAAKLh0nU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10930833876",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-11T01:24:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10930944137,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAKLiPiJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10930944137",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-11T02:09:03Z"
    },
    {
      "event": "unlabeled",
      "id": 10931082610,
      "node_id": "UNLE_lADOABII585sO8VEzwAAAAKLixVy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10931082610",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-11T02:58:41Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1726995757,
      "node_id": "PRR_kwDOABII585m790t",
      "url": null,
      "actor": null,
      "commit_id": "930e531046e7215dccdf7c69e81030d49772c4a8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1726995757",
      "submitted_at": "2023-11-13T13:28:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVhMzEzOGI3YjE4OTE1OGRiODBiZmQxZjlkOWRkMTdlN2VmNTJmM2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f",
      "tree": {
        "sha": "b239a4100ae91798f6f68c4d78dbc78841385a21",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b239a4100ae91798f6f68c4d78dbc78841385a21"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b239a4100ae91798f6f68c4d78dbc78841385a21\nparent e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380\nauthor furszy <matiasfurszyfer@protonmail.com> 1689897188 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1699910736 -0300\n\np2p: sync from limited peer, only request blocks below threshold\n\nRequesting historical blocks from network limited peers is a\ndirect disconnection cause.\nThe node must only request the blocks who know for sure the\nlimited peer can provide.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmVSlFAACgkQXdI8zGhq\npiNymA/9GaTcY3Ly+lMKKkcp8dzYOr/YLeDjcXd4JeIlzYn0sOSGVg9R9KcJMxEm\nqc4rr4B6xmbBo7QILphthFa936/FwLUzrOLLfleaVIUcrGRf2rrY2ndBHW8regm8\ndGUALF8o9RbQkgvY5nYt2xmdN5EUR3sxwqpkKLP9hd/KH2VlUZEAU+2lWDXjr0+8\n3pcXbHTH8KZtg8sAyjE4wT+ftW/0UKN3L9ZhV5sK1e2MFbjpbDQkLMfwJmYAfUNb\nvaNJ/1vky4x1Y4kEwEu3y4+4XOVjDXi6oD5JBrI2Oqv+zIG3ylaegf9RSVVMxdFL\nma3tci9qDVJQn8FDLyAA+hsQjCGYGCy2cCr6B1jkJo5uiKN6DSnV88UP/yYMEczl\nW4E02uEPQTV4VfWvKY17l7es11XRfS27GK11ho/EHv7X+Z9deiHvDAngNSTo6AuK\n2Cnx6q3vIqXJS0Q1/xxgB/Q7rTHcygNMWC4uJlXpPe1FM2aL9LPWYZo25LTOCzTY\ngsT0/0tuy1ZrvFtkwcYoL8v1goEBqML8Do2YByPaOWLCT4GgDyMY34TEXpAWDCF3\nggy2wqwmXY2og38oDcwsy1ulGKQphfcOd1QAejiRMOyv2XSmmZ78Rhyz07ugf2qr\nwyNllD48x5W8ETA2RL4L8Nc8WkwNvCPTS1xeKUpC36ImZvN7SZQ=\n=XdPP\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380",
          "sha": "e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e3ac5befdfcaa73d3f8a5f0359a2013efe8d4380"
        }
      ],
      "message": "p2p: sync from limited peer, only request blocks below threshold\n\nRequesting historical blocks from network limited peers is a\ndirect disconnection cause.\nThe node must only request the blocks who know for sure the\nlimited peer can provide.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-11-13T21:25:36Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-20T23:53:08Z"
      },
      "sha": "ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10947307027,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAKMgqYT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10947307027",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-13T21:31:22Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEwNjg3ZmZkNTY4YjA5ODRhOGIxZTUxZmQwMDYxZjg3ZjI1ZTk1ZDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "tree": {
        "sha": "01747c569af2e840f331025c76b5d86fedd48445",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/01747c569af2e840f331025c76b5d86fedd48445"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 01747c569af2e840f331025c76b5d86fedd48445\nparent ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f\nauthor furszy <matiasfurszyfer@protonmail.com> 1689930411 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1699911897 -0300\n\ntest: avoid requesting blocks beyond limited peer threshold\n\nEven when the node believes it completed IBD, need to avoid\nrequesting historical blocks from network-limited peers.\nOtherwise, the limited peer will disconnect right away.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmVSmNkACgkQXdI8zGhq\npiNXQw/+PbpKi7MT7iIHtvDbbeQMmotq2t7+aL//wwFzlZWDNIuKvS18Kyyy9QJW\nGHqKC0fTHM9iLi5yi3hpZdxrez2G2u9d9s7dqeH6nSGLHJzmYoI7MqExnfzJK+QX\neYl4uMDfdaDug9KoJOSs//hLH+jhJTrGQ9dIYWsXGM1GrNZ9AWWVvPaHf+JeuZMO\nPsTjOQ4rP8qXNuMKvGjXF79xr5jumx4S3YX4pWQrUyrRRKQ0acKxB45y/zw+L1nY\ncEOgUZNAsun2cI52zIV1AEafvUUNTIIx0tKc+BxBHcaG91d1+i5Bb3vJSem4xcY6\nSRLUDc6xDTJEYUPFPkWp8nXX0wf2+ymzLVH50YZ1IB2YTBaF3EOzDiC2zIRcMZ7w\n1ZJCoynIel4kn0euah612k/Sea9ngg+u3YdNIxHB71LnLCtpQb/95ooZWZ1h0KbG\nj+ojKI5/rW/yVCEORNQdmzGl+IY8CUraZrwGlaWQO0ReuY/EMaJbrID2jbm0j4dd\nuJJq9LQK9CTzIL9U4hM5FkuDcf8fqsNo5zg2r0DYihbl39yfUm6jNMkGO+kaDjJF\nFFeOCdjdutGH4bhnJVVAdmt09B6EFYctkiLqSVrdh5r0YHJz6Udmb/F7kdSq2Z9N\nJSAWimIgfEez43WONc0jgKjlLFGU31iq85cO8/wIT+ChMwvQad8=\n=pumJ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f",
          "sha": "ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ea3138b7b189158db80bfd1f9d9dd17e7ef52f3f"
        }
      ],
      "message": "test: avoid requesting blocks beyond limited peer threshold\n\nEven when the node believes it completed IBD, need to avoid\nrequesting historical blocks from network-limited peers.\nOtherwise, the limited peer will disconnect right away.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-11-13T21:44:57Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-21T09:06:51Z"
      },
      "sha": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10947418401,
      "node_id": "HRFPE_lADOABII585sO8VEzwAAAAKMhFkh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10947418401",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-13T21:45:22Z"
    },
    {
      "event": "labeled",
      "id": 10947419168,
      "node_id": "LE_lADOABII585sO8VEzwAAAAKMhFwg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10947419168",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-13T21:45:28Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 10948442202,
      "node_id": "UNLE_lADOABII585sO8VEzwAAAAKMk_ha",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10948442202",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-14T00:27:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1729314172,
      "node_id": "PRR_kwDOABII585nEz18",
      "url": null,
      "actor": null,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK a0687ffd568b0984a8b1e51fd0061f87f25e95d7\r\n\r\nThanks!",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1729314172",
      "submitted_at": "2023-11-14T09:39:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-22T00:52:26Z",
      "updated_at": "2023-11-22T00:52:26Z",
      "source": {
        "issue": {
          "id": 2002532391,
          "node_id": "PR_kwDOABII585f7Ye-",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28920",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28920/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28920/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28920/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28920",
          "number": 28920,
          "state": "open",
          "state_reason": null,
          "title": "wallet: birth time update during tx scanning",
          "body": "Fixing #28897.\r\n\r\nAs the user may have imported a descriptor with a timestamp newer\r\nthan the actual birth time of the first key (by setting 'timestamp=now'),\r\nthe wallet needs to update the birth time when it detects a transaction\r\nolder than the oldest descriptor timestamp.\r\n\r\nTesting Notes:\r\nCan cherry-pick the test commit on top of master. It will fail there.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28920",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28920",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28920.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28920.patch"
          },
          "created_at": "2023-11-20T16:05:49Z",
          "updated_at": "2023-11-30T19:53:14Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1761328425,
      "node_id": "PRR_kwDOABII585o-70p",
      "url": null,
      "actor": null,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#pullrequestreview-1761328425",
      "submitted_at": "2023-12-03T18:21:05Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375513667",
      "pull_request_review_id": 1703037733,
      "id": 1375513667,
      "node_id": "PRRC_kwDOABII585R_KxD",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think we want to keep the + 2 buffer here. This means we would potentially still request blocks 2 blocks after 288, so up to 290. The buffer for sending requested blocks up to 288 + 2 is there for when the sender sees new blocks but the requester has not yet seen it. In this case we are requesting so we should respect the 288 limit.",
      "created_at": "2023-10-29T21:14:46Z",
      "updated_at": "2023-10-29T21:42:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1375513667",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1375513667"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378843710",
      "pull_request_review_id": 1708290287,
      "id": 1378843710,
      "node_id": "PRRC_kwDOABII585SL3w-",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+",
      "path": "src/net_processing.cpp",
      "position": 17,
      "original_position": 17,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In the commit message of f3089e57aadac462e59499fdeb8091c42f39327b `refactor: Make FindNextBlocksToDownload friendlier`:\r\n\r\n`s/FindNextBlocksToDownload/PeerManagerImpl::FindNextBlocks()/`",
      "created_at": "2023-11-01T14:02:36Z",
      "updated_at": "2023-11-01T15:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1378843710",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378843710"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1452,
      "original_line": 1452,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378886266",
      "pull_request_review_id": 1708290287,
      "id": 1378886266,
      "node_id": "PRRC_kwDOABII585SMCJ6",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1375513667,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I agree - no need for +2, or even it could be harmful and defeat the margin on the sender side - e.g. if the sender is at height 1290, this logic would allow requesting block 1000. Then if the sender progresses to height 1291 in the meantime and sees request for 1000 they will disconnect.\r\n\r\nFurther, to make this symmetric with the sender maybe it should be -2? If we assume the sender has no margin and disconnects for anything >288 then the requester should request only up to 286 (incl)?",
      "created_at": "2023-11-01T14:36:47Z",
      "updated_at": "2023-11-01T15:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1378886266",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378886266"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378905232",
      "pull_request_review_id": 1708290287,
      "id": 1378905232,
      "node_id": "PRRC_kwDOABII585SMGyQ",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {\n+                return;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 62,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should this not be `continue;`? I find `PeerManagerImpl::FindNextBlocks()` hard to follow. Are the entries in `vToFetch` sorted in ascending or descending order?",
      "created_at": "2023-11-01T14:51:00Z",
      "updated_at": "2023-11-01T15:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1378905232",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378905232"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378928478",
      "pull_request_review_id": 1708290287,
      "id": 1378928478,
      "node_id": "PRRC_kwDOABII585SMMde",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 41,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is the intention here to mimic `NODE_NETWORK_LIMITED_MIN_BLOCKS` from the C++ source code, which is `288`? `MIN_BLOCKS_TO_KEEP` is a different constant defined in both the C++ and Python code which happens to be also `288`. Should `NODE_NETWORK_LIMITED_MIN_BLOCKS` be defined in the Python code (equal to 288, but not necessary equal or tied to `MIN_BLOCKS_TO_KEEP`)?",
      "created_at": "2023-11-01T15:08:35Z",
      "updated_at": "2023-11-01T15:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1378928478",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378928478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378931951",
      "pull_request_review_id": 1708290287,
      "id": 1378931951,
      "node_id": "PRRC_kwDOABII585SMNTv",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": 40,
      "original_position": 42,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Here `sync_blocks()` is used and above `self.wait_until(lambda: node.getbestblockhash() == ...` is used to achieve the same purpose. For consistency maybe use only one of the methods.",
      "created_at": "2023-11-01T15:11:22Z",
      "updated_at": "2023-11-01T15:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1378931951",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378931951"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 76,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378941093",
      "pull_request_review_id": 1708290287,
      "id": 1378941093,
      "node_id": "PRRC_kwDOABII585SMPil",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])\n+\n+        # Connect full_node to prune_node and check peers don't disconnect right away.\n+        # (they will disconnect if full_node, which is chain-wise behind, request blocks\n+        #  older than MIN_BLOCKS_TO_KEEP)\n+        self.connect_nodes(0, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 1)\n+        time.sleep(3)  # Wait for a few seconds to ensure peers remain connected\n+        assert_equal(len(full_node.getpeerinfo()), 1)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 50,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This sleep is non-deterministic. The good thing is that it will not cause sporadic test failures, but still, it could occasionally report success even if the full node requests an old block and gets disconnected (false positive). Also it adds unconditional 3 seconds to the tests execution time.\r\n\r\nIs it possible to lookup something in the log or via RPC to cross check that the full node has made a decision not to request blocks from the pruned node?",
      "created_at": "2023-11-01T15:18:53Z",
      "updated_at": "2023-11-01T15:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1378941093",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378941093"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 87,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380681598",
      "pull_request_review_id": 1711092950,
      "id": 1380681598,
      "node_id": "PRRC_kwDOABII585SS4d-",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1375513667,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Upps yeah. This was intended to be -2.. fixing it.",
      "created_at": "2023-11-02T19:29:11Z",
      "updated_at": "2023-11-02T22:30:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1380681598",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380681598"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380702499",
      "pull_request_review_id": 1711092950,
      "id": 1380702499,
      "node_id": "PRRC_kwDOABII585SS9kj",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {\n+                return;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 62,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378905232,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Should this not be `continue;`? I find `PeerManagerImpl::FindNextBlocks()` hard to follow. Are the entries in `vToFetch` sorted in ascending or descending order?\r\n\r\n`vToFetch` is arranged in increasing order. Needs to stop once it reaches the last block the peer can provide, without continuing further.\r\n\r\n`FindNextBlocks` begins from the last block in common with the peer. Then, during each iteration of the loop, it gets the block that is 128 blocks ahead and populates `vToFetch` by moving backwards: it pushes the last block of the window to the last position of the array, the second to last block to the second to last position of the array, and so on.\r\nSubsequently, the function iterates over, the now ordered, `vToFetch` in forward direction, adding the blocks that will be requested to `vBlocks`.\r\n",
      "created_at": "2023-11-02T19:54:11Z",
      "updated_at": "2023-11-02T22:30:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1380702499",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380702499"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380719816",
      "pull_request_review_id": 1711092950,
      "id": 1380719816,
      "node_id": "PRRC_kwDOABII585STBzI",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 41,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378928478,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Is the intention here to mimic `NODE_NETWORK_LIMITED_MIN_BLOCKS` from the C++ source code, which is `288`?\r\n\r\nYeah, I used `MIN_BLOCKS_TO_KEEP` merely because it is already part of the test framework.\r\n\r\n> `MIN_BLOCKS_TO_KEEP` is a different constant defined in both the C++ and Python code which happens to be also `288`. Should `NODE_NETWORK_LIMITED_MIN_BLOCKS` be defined in the Python code (equal to 288, but not necessary equal or tied to `MIN_BLOCKS_TO_KEEP`)?\r\n\r\nIf it helps readability, sure (I would just need to see where to place it).\r\nIt is important to note that `NODE_NETWORK_LIMITED_MIN_BLOCKS` is dependent on `MIN_BLOCKS_TO_KEEP` and should always be less than or equal to it.\r\n\r\n",
      "created_at": "2023-11-02T20:12:32Z",
      "updated_at": "2023-11-02T22:30:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1380719816",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380719816"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380733259",
      "pull_request_review_id": 1711092950,
      "id": 1380733259,
      "node_id": "PRRC_kwDOABII585STFFL",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])\n+\n+        # Connect full_node to prune_node and check peers don't disconnect right away.\n+        # (they will disconnect if full_node, which is chain-wise behind, request blocks\n+        #  older than MIN_BLOCKS_TO_KEEP)\n+        self.connect_nodes(0, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 1)\n+        time.sleep(3)  # Wait for a few seconds to ensure peers remain connected\n+        assert_equal(len(full_node.getpeerinfo()), 1)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 50,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378941093,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Is it possible to lookup something in the log or via RPC to cross check that the full node has made a decision not to request blocks from the pruned node?\r\n\r\nHmm, not really. We aren't logging any of the reasons behind a lack of a getdata request for a certain block from a certain peer (invalid tree, no segwit support, already in-flight). The approach would lead to excessive logging for no real gain.\r\n\r\nWhat we could do, maybe in a follow-up?, to eliminate the unnecessary sleep time, is migrate this functional test check into a unit test. Similar to what I'm doing on #28170 for `FindNextBlocks`.",
      "created_at": "2023-11-02T20:28:10Z",
      "updated_at": "2023-11-02T22:30:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1380733259",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380733259"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 87,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380849706",
      "pull_request_review_id": 1711349344,
      "id": 1380849706,
      "node_id": "PRRC_kwDOABII585SThgq",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+",
      "path": "src/net_processing.cpp",
      "position": 17,
      "original_position": 17,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378843710,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thx, done as suggested.",
      "created_at": "2023-11-02T22:30:33Z",
      "updated_at": "2023-11-02T22:30:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1380849706",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380849706"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1452,
      "original_line": 1452,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380849886",
      "pull_request_review_id": 1711349665,
      "id": 1380849886,
      "node_id": "PRRC_kwDOABII585SThje",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": 40,
      "original_position": 42,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378931951,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thx, done as suggested.",
      "created_at": "2023-11-02T22:30:41Z",
      "updated_at": "2023-11-02T22:30:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1380849886",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1380849886"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 76,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389521297",
      "pull_request_review_id": 1724990529,
      "id": 1389521297,
      "node_id": "PRRC_kwDOABII585S0mmR",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {\n+                return;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 62,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378905232,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ok, lets use an example (from the newly added test):\r\n\r\n`vToFetch = [2 ... 129]`\r\n`state->pindexBestKnownBlock->nHeight = 301`\r\nSo the peer's height is `301`. We can assume they can provide blocks `[13 ... 301]`.\r\nAt the first iteration of the loop `pindex->nHeight` is 2 (`vToFetch[0]`).\r\nThe code ends up with `return;` because `301 - 2 > 286` and we never request any blocks from that peer.\r\n\r\nShouldn't we request blocks `[13 ... 301]` instead?",
      "created_at": "2023-11-10T15:11:05Z",
      "updated_at": "2023-11-10T15:11:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1389521297",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389521297"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389526651",
      "pull_request_review_id": 1724999237,
      "id": 1389526651,
      "node_id": "PRRC_kwDOABII585S0n57",
      "diff_hunk": "@@ -46,6 +49,42 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 23,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "534996ab5351a7aa2b98f0d7c93dab0dfe073407",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The test would fail if run standalone without the preceding tests. The failure is on line 78: `self.sync_blocks([miner, pruned_node])`. That is because the test relies on the pruned node being connected to the miner which is indeed the case - some leftover from previous tests. This diff makes it succeed when run standalone:\r\n\r\n```diff\r\n--- i/test/functional/p2p_node_network_limited.py\r\n+++ w/test/functional/p2p_node_network_limited.py\r\n@@ -54,25 +54,24 @@ class NodeNetworkLimitedTest(BitcoinTestFramework):\r\n         # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\r\n         pruned_node = self.nodes[0]\r\n         miner = self.nodes[1]\r\n         full_node = self.nodes[2]\r\n \r\n         # Connect and generate block to ensure IBD=false\r\n+        self.connect_nodes(0, 1)\r\n         self.connect_nodes(1, 2)\r\n-        self.connect_nodes(0, 2)\r\n         self.generate(miner, 1, sync_fun=self.no_op)\r\n \r\n         # Verify all peers are at the same height\r\n         self.sync_blocks([miner, pruned_node])\r\n                                      \r\n         # Verify peers are out of IBD\r\n         for node in self.nodes:\r\n             assert not node.getblockchaininfo()['initialblockdownload']    \r\n \r\n         # Disconnect full_node from the other two peers (the node will remain out of IBD)\r\n-        self.disconnect_nodes(0, 2)\r\n         self.disconnect_nodes(1, 2)                                       \r\n         assert_equal(len(full_node.getpeerinfo()), 0)                     \r\n \r\n         # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\r\n```\r\n\r\nIt is also shorter and I think more clear.",
      "created_at": "2023-11-10T15:16:21Z",
      "updated_at": "2023-11-10T15:16:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1389526651",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1389526651"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 59,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390030476",
      "pull_request_review_id": 1725803875,
      "id": 1390030476,
      "node_id": "PRRC_kwDOABII585S2i6M",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) + 2 /* add two blocks buffer extension for possible races */)) {\n+                return;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 62,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378905232,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, that will only happen when the node is close to the tip, because of the 1024 block download window. More precisely, when the node is within 1312 blocks from the tip (window + limited peers threshold). Nice observation!.\r\nWill modify it and add coverage for it.",
      "created_at": "2023-11-10T23:41:55Z",
      "updated_at": "2023-11-10T23:49:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1390030476",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390030476"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390075262",
      "pull_request_review_id": 1725865759,
      "id": 1390075262,
      "node_id": "PRRC_kwDOABII585S2t1-",
      "diff_hunk": "@@ -46,6 +49,42 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 23,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "534996ab5351a7aa2b98f0d7c93dab0dfe073407",
      "in_reply_to_id": 1389526651,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ended up doing it in a slightly different way. Using `setnetworkactive` to isolate the full node from the other two. I think that is clearer in this way.",
      "created_at": "2023-11-11T01:09:10Z",
      "updated_at": "2023-11-11T01:09:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1390075262",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390075262"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 59,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390079370",
      "pull_request_review_id": 1725871224,
      "id": 1390079370,
      "node_id": "PRRC_kwDOABII585S2u2K",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])\n+\n+        # Connect full_node to prune_node and check peers don't disconnect right away.\n+        # (they will disconnect if full_node, which is chain-wise behind, request blocks\n+        #  older than MIN_BLOCKS_TO_KEEP)\n+        self.connect_nodes(0, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 1)\n+        time.sleep(3)  # Wait for a few seconds to ensure peers remain connected\n+        assert_equal(len(full_node.getpeerinfo()), 1)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 50,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378941093,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Removed the unconditional wait on the last update :).",
      "created_at": "2023-11-11T01:10:32Z",
      "updated_at": "2023-11-11T01:10:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1390079370",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390079370"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 87,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390079461",
      "pull_request_review_id": 1725871339,
      "id": 1390079461,
      "node_id": "PRRC_kwDOABII585S2u3l",
      "diff_hunk": "@@ -46,6 +49,44 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_old_blocks(self):\n+        self.log.info(\"Test node not requesting blocks beyond limited peer threshold\")\n+        # The request of blocks further than the NETWORK_NODE_LIMITED threshold causes a direct disconnection.\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 2)\n+        self.connect_nodes(0, 2)\n+        self.generate(miner, 1, sync_fun=self.no_op)\n+\n+        # Verify all peers are at the same height\n+        best_block = miner.getbestblockhash()\n+        for node in [full_node, pruned_node]:\n+            self.wait_until(lambda: node.getbestblockhash() == best_block, timeout=10)\n+\n+        # Verify that all peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Disconnect full_node from the other two peers (the node will remain out of IBD)\n+        self.disconnect_nodes(0, 2)\n+        self.disconnect_nodes(1, 2)\n+        assert_equal(len(full_node.getpeerinfo()), 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, MIN_BLOCKS_TO_KEEP + 12, sync_fun=self.no_op)",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 41,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "c1612ea1f050b3daede6a181464bbbce6e254b2d",
      "in_reply_to_id": 1378928478,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added `NODE_NETWORK_LIMITED_MIN_BLOCKS` on the last update.",
      "created_at": "2023-11-11T01:10:54Z",
      "updated_at": "2023-11-11T01:10:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1390079461",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1390079461"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391086424",
      "pull_request_review_id": 1726995757,
      "id": 1391086424,
      "node_id": "PRRC_kwDOABII585S6ktY",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) - 2 /* two blocks buffer for possible races */)) {\n+                continue;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 62,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "930e531046e7215dccdf7c69e81030d49772c4a8",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think there is an off-by-one error here, should this be `>=` instead of `>`? Lets say the limited peer is at height `H` then the intention of this is to request blocks `(H-286, H]` from it, a total of `286` blocks. However it would not `continue` for height `H-286` and would request that block too.",
      "created_at": "2023-11-13T13:00:59Z",
      "updated_at": "2023-11-13T13:28:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1391086424",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391086424"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 1480,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391104472",
      "pull_request_review_id": 1726995757,
      "id": 1391104472,
      "node_id": "PRRC_kwDOABII585S6pHY",
      "diff_hunk": "@@ -46,6 +50,65 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_historical_blocks(self):\n+        self.log.info(\"Test full node does not request blocks beyond the limited peer threshold\")\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 0)\n+        self.connect_nodes(1, 2)\n+        self.generate(miner, 1)\n+\n+        # Verify peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Isolate full_node (the node will remain out of IBD)\n+        full_node.setnetworkactive(False)\n+        self.wait_until(lambda: len(full_node.getpeerinfo()) == 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, NODE_NETWORK_LIMITED_MIN_BLOCKS, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])\n+\n+        # Connect full_node to prune_node and check peers don't disconnect right away.\n+        # (they will disconnect if full_node, which is chain-wise behind, request blocks\n+        # older than NODE_NETWORK_LIMITED_MIN_BLOCKS)\n+        start_height_full_node = full_node.getblockcount()\n+        full_node.setnetworkactive(True)\n+        self.connect_nodes(2, 0)\n+        assert_equal(len(full_node.getpeerinfo()), 1)\n+\n+        # Wait until the full_node is headers-wise sync\n+        best_block_hash = pruned_node.getbestblockhash()\n+        self.wait_until(lambda: next(filter(lambda x: x['hash'] == best_block_hash, full_node.getchaintips()))['status'] == \"headers-only\")\n+\n+        # Now, since the node aims to download a window of 1024 blocks,\n+        # ensure it requests the blocks below the threshold only (with a\n+        # 2-block buffer). And also, ensure it does not request blocks\n+        # deeper than the threshold (minus the buffer).\n+        limited_threshold_buffer = 2\n+\n+        # Traverse in reverse order, ensuring the node stores all blocks\n+        # expected to be downloaded from the limited peer.\n+        tip_height = pruned_node.getblockcount()\n+        self.wait_until(lambda: not try_rpc(-1, \"Block not found\", full_node.getblock, pruned_node.getbestblockhash()))\n+        for height in range(tip_height, start_height_full_node + limited_threshold_buffer, -1):\n+            full_node.getblock(pruned_node.getblockhash(height))  # just need to assert it does not raise an exception\n+\n+        # Verify all blocks that should not have been requested.\n+        for move in range(1, limited_threshold_buffer):\n+            height = start_height_full_node + move\n+            assert_raises_rpc_error(-1, \"Block not found on disk\", full_node.getblock, pruned_node.getblockhash(height))",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 68,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "930e531046e7215dccdf7c69e81030d49772c4a8",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The full node is at height `1` and the pruned node is at height `289`. The first loop verifies that the full node has blocks `[4, 289]` (`286` blocks in total), which is ok. But then it only checks that the full node does not have block `2`. What about block `3`? It is not checked and should not have been downloaded but it has been downloaded.\r\n\r\nTo avoid the gap the range in the second loop should be `range(1, limited_threshold_buffer + 1)` or even:\r\n\r\n```python\r\nfor height in range(start_height_full_node + 1, start_height_full_node + 1 + limited_threshold_buffer):\r\n```\r\n\r\nor have one loop instead of two:\r\n\r\n```python\r\nfor height in range(start_height_full_node + 1, tip_height + 1):\r\n    if height <= tip_height - (NODE_NETWORK_LIMITED_MIN_BLOCKS - 2):\r\n        assert_raises_rpc_error(-1, \"Block not found on disk\", full_node.getblock, pruned_node.getblockhash(height))\r\n    else:\r\n        full_node.getblock(pruned_node.getblockhash(height))\r\n```",
      "created_at": "2023-11-13T13:17:49Z",
      "updated_at": "2023-11-13T13:28:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1391104472",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391104472"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 98,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 104,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391727015",
      "pull_request_review_id": 1728318505,
      "id": 1391727015,
      "node_id": "PRRC_kwDOABII585S9BGn",
      "diff_hunk": "@@ -46,6 +50,65 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_historical_blocks(self):\n+        self.log.info(\"Test full node does not request blocks beyond the limited peer threshold\")\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 0)\n+        self.connect_nodes(1, 2)\n+        self.generate(miner, 1)\n+\n+        # Verify peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Isolate full_node (the node will remain out of IBD)\n+        full_node.setnetworkactive(False)\n+        self.wait_until(lambda: len(full_node.getpeerinfo()) == 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        self.generate(miner, NODE_NETWORK_LIMITED_MIN_BLOCKS, sync_fun=self.no_op)\n+        self.sync_blocks([miner, pruned_node])\n+\n+        # Connect full_node to prune_node and check peers don't disconnect right away.\n+        # (they will disconnect if full_node, which is chain-wise behind, request blocks\n+        # older than NODE_NETWORK_LIMITED_MIN_BLOCKS)\n+        start_height_full_node = full_node.getblockcount()\n+        full_node.setnetworkactive(True)\n+        self.connect_nodes(2, 0)\n+        assert_equal(len(full_node.getpeerinfo()), 1)\n+\n+        # Wait until the full_node is headers-wise sync\n+        best_block_hash = pruned_node.getbestblockhash()\n+        self.wait_until(lambda: next(filter(lambda x: x['hash'] == best_block_hash, full_node.getchaintips()))['status'] == \"headers-only\")\n+\n+        # Now, since the node aims to download a window of 1024 blocks,\n+        # ensure it requests the blocks below the threshold only (with a\n+        # 2-block buffer). And also, ensure it does not request blocks\n+        # deeper than the threshold (minus the buffer).\n+        limited_threshold_buffer = 2\n+\n+        # Traverse in reverse order, ensuring the node stores all blocks\n+        # expected to be downloaded from the limited peer.\n+        tip_height = pruned_node.getblockcount()\n+        self.wait_until(lambda: not try_rpc(-1, \"Block not found\", full_node.getblock, pruned_node.getbestblockhash()))\n+        for height in range(tip_height, start_height_full_node + limited_threshold_buffer, -1):\n+            full_node.getblock(pruned_node.getblockhash(height))  # just need to assert it does not raise an exception\n+\n+        # Verify all blocks that should not have been requested.\n+        for move in range(1, limited_threshold_buffer):\n+            height = start_height_full_node + move\n+            assert_raises_rpc_error(-1, \"Block not found on disk\", full_node.getblock, pruned_node.getblockhash(height))",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": null,
      "original_position": 68,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "930e531046e7215dccdf7c69e81030d49772c4a8",
      "in_reply_to_id": 1391104472,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done as suggested. Thanks.",
      "created_at": "2023-11-13T21:30:31Z",
      "updated_at": "2023-11-13T21:46:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1391727015",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391727015"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 98,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 104,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391727313",
      "pull_request_review_id": 1728318505,
      "id": 1391727313,
      "node_id": "PRRC_kwDOABII585S9BLR",
      "diff_hunk": "@@ -1443,30 +1444,46 @@ void PeerManagerImpl::FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, c\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n+\n             if (!CanServeWitnesses(peer) && DeploymentActiveAt(*pindex, m_chainman, Consensus::DEPLOYMENT_SEGWIT)) {\n                 // We wouldn't download this block or its descendants from this peer.\n                 return;\n             }\n+\n             if (pindex->nStatus & BLOCK_HAVE_DATA || (activeChain && activeChain->Contains(pindex))) {\n-                if (activeChain && pindex->HaveNumChainTxs())\n+                if (activeChain && pindex->HaveNumChainTxs()) {\n                     state->pindexLastCommonBlock = pindex;\n-            } else if (!IsBlockRequested(pindex->GetBlockHash())) {\n-                // The block is not already downloaded, and not yet in flight.\n-                if (pindex->nHeight > nWindowEnd) {\n-                    // We reached the end of the window.\n-                    if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n-                        // We aren't able to fetch anything, but we would be if the download window was one larger.\n-                        if (nodeStaller) *nodeStaller = waitingfor;\n-                    }\n-                    return;\n                 }\n-                vBlocks.push_back(pindex);\n-                if (vBlocks.size() == count) {\n-                    return;\n+                continue;\n+            }\n+\n+            // Is block in-flight?\n+            if (IsBlockRequested(pindex->GetBlockHash())) {\n+                if (waitingfor == -1) {\n+                    // This is the first already-in-flight block.\n+                    waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n                 }\n-            } else if (waitingfor == -1) {\n-                // This is the first already-in-flight block.\n-                waitingfor = mapBlocksInFlight.lower_bound(pindex->GetBlockHash())->second.first;\n+                continue;\n+            }\n+\n+            // The block is not already downloaded, and not yet in flight.\n+            if (pindex->nHeight > nWindowEnd) {\n+                // We reached the end of the window.\n+                if (vBlocks.size() == 0 && waitingfor != peer.m_id) {\n+                    // We aren't able to fetch anything, but we would be if the download window was one larger.\n+                    if (nodeStaller) *nodeStaller = waitingfor;\n+                }\n+                return;\n+            }\n+\n+            // Don't request blocks that go further than what limited peers can provide\n+            if (is_limited_peer && (state->pindexBestKnownBlock->nHeight - pindex->nHeight > static_cast<int>(NODE_NETWORK_LIMITED_MIN_BLOCKS) - 2 /* two blocks buffer for possible races */)) {\n+                continue;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 62,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "930e531046e7215dccdf7c69e81030d49772c4a8",
      "in_reply_to_id": 1391086424,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sounds good. Corrected.",
      "created_at": "2023-11-13T21:30:51Z",
      "updated_at": "2023-11-13T21:30:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1391727313",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391727313"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": 1480,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413170635",
      "pull_request_review_id": 1761328425,
      "id": 1413170635,
      "node_id": "PRRC_kwDOABII585UO0XL",
      "diff_hunk": "@@ -46,6 +50,63 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_historical_blocks(self):\n+        self.log.info(\"Test full node does not request blocks beyond the limited peer threshold\")\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 0)\n+        self.connect_nodes(1, 2)\n+        self.generate(miner, 1)\n+\n+        # Verify peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Isolate full_node (the node will remain out of IBD)\n+        full_node.setnetworkactive(False)\n+        self.wait_until(lambda: len(full_node.getpeerinfo()) == 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        # Blocks deeper than the threshold are considered \"historical blocks\"\n+        num_historial_blocks = 12",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": 38,
      "original_position": 38,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Could add a comment on why number 12 is chosen here?",
      "created_at": "2023-12-03T18:20:26Z",
      "updated_at": "2023-12-03T18:21:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1413170635",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413170635"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 74,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413826104",
      "pull_request_review_id": 1762325628,
      "id": 1413826104,
      "node_id": "PRRC_kwDOABII585URUY4",
      "diff_hunk": "@@ -46,6 +50,63 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_historical_blocks(self):\n+        self.log.info(\"Test full node does not request blocks beyond the limited peer threshold\")\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 0)\n+        self.connect_nodes(1, 2)\n+        self.generate(miner, 1)\n+\n+        # Verify peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Isolate full_node (the node will remain out of IBD)\n+        full_node.setnetworkactive(False)\n+        self.wait_until(lambda: len(full_node.getpeerinfo()) == 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        # Blocks deeper than the threshold are considered \"historical blocks\"\n+        num_historial_blocks = 12",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": 38,
      "original_position": 38,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "in_reply_to_id": 1413170635,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sure. Will do if I have to retouch.\r\nThe number is to test the blocks download procedure and its moving window.\r\nFor instance, if the peer is at block 100, and it mines 300 blocks (288 + 12). The test verifies the node only download the blocks that are below the threshold from the limited peer (last 288 blocks minus the buffer). Then, the test connects a full node and it checks the node download the remaining historical blocks from it.\r\n",
      "created_at": "2023-12-04T12:49:30Z",
      "updated_at": "2023-12-04T12:49:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1413826104",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413826104"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 74,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413832532",
      "pull_request_review_id": 1762335924,
      "id": 1413832532,
      "node_id": "PRRC_kwDOABII585URV9U",
      "diff_hunk": "@@ -46,6 +50,63 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_historical_blocks(self):\n+        self.log.info(\"Test full node does not request blocks beyond the limited peer threshold\")\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 0)\n+        self.connect_nodes(1, 2)\n+        self.generate(miner, 1)\n+\n+        # Verify peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Isolate full_node (the node will remain out of IBD)\n+        full_node.setnetworkactive(False)\n+        self.wait_until(lambda: len(full_node.getpeerinfo()) == 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        # Blocks deeper than the threshold are considered \"historical blocks\"\n+        num_historial_blocks = 12",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": 38,
      "original_position": 38,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "in_reply_to_id": 1413170635,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah yes, it makes sense what `num_historical_blocks` purpose is. The nit is why the number 12 was chosen specifically. I suppose to just make it an even 300, and it can be arbitrary?",
      "created_at": "2023-12-04T12:55:00Z",
      "updated_at": "2023-12-04T12:55:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1413832532",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413832532"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 74,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413837545",
      "pull_request_review_id": 1762343933,
      "id": 1413837545,
      "node_id": "PRRC_kwDOABII585URXLp",
      "diff_hunk": "@@ -46,6 +50,63 @@ def setup_network(self):\n         self.add_nodes(self.num_nodes, self.extra_args)\n         self.start_nodes()\n \n+    def test_avoid_requesting_historical_blocks(self):\n+        self.log.info(\"Test full node does not request blocks beyond the limited peer threshold\")\n+        pruned_node = self.nodes[0]\n+        miner = self.nodes[1]\n+        full_node = self.nodes[2]\n+\n+        # Connect and generate block to ensure IBD=false\n+        self.connect_nodes(1, 0)\n+        self.connect_nodes(1, 2)\n+        self.generate(miner, 1)\n+\n+        # Verify peers are out of IBD\n+        for node in self.nodes:\n+            assert not node.getblockchaininfo()['initialblockdownload']\n+\n+        # Isolate full_node (the node will remain out of IBD)\n+        full_node.setnetworkactive(False)\n+        self.wait_until(lambda: len(full_node.getpeerinfo()) == 0)\n+\n+        # Mine blocks and sync the pruned node. Surpass the NETWORK_NODE_LIMITED threshold.\n+        # Blocks deeper than the threshold are considered \"historical blocks\"\n+        num_historial_blocks = 12",
      "path": "test/functional/p2p_node_network_limited.py",
      "position": 38,
      "original_position": 38,
      "commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "original_commit_id": "a0687ffd568b0984a8b1e51fd0061f87f25e95d7",
      "in_reply_to_id": 1413170635,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Ah yes, it makes sense what `num_historical_blocks` purpose is. The nit is why the number 12 was chosen specifically. I suppose to just make it an even 300, and it can be arbitrary?\r\n\r\nYep.",
      "created_at": "2023-12-04T12:58:36Z",
      "updated_at": "2023-12-04T12:58:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28120#discussion_r1413837545",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1413837545"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 74,
      "original_line": 74,
      "side": "RIGHT"
    }
  ]
}