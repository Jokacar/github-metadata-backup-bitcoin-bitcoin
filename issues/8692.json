{
  "type": "issue",
  "issue": {
    "id": 176033489,
    "node_id": "MDU6SXNzdWUxNzYwMzM0ODk=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8692",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8692/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8692/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8692/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/8692",
    "number": 8692,
    "state": "closed",
    "state_reason": "completed",
    "title": "Marking chains of txs conflicted properly",
    "body": "(These obscure notes are for eventually cleaning up wallet confliction and are low priority)\n\nIn the block connection logic we call\n\n```\nBOOST_FOREACH(const CTransaction &tx, txConflicted)\n        {\n            SyncWithWallets(tx, pindexNewTip);\n        }\n```\n\n`txConflicted` is returned by `mempool.removeForBlock` and can therefore contain transactions that should be marked conflicted that wouldn't be caught by the wallets own dependency tracking code (chains of mempool txs not all of which are in the wallet).\n\nHowever, calling `SyncWithWallets` without setting a `posInBlock` has virtually no effect other than marking the cached credit/debit values as dirty.  Since #7105 however wallet txs, that aren't explicitly marked conflicted via the wallets code, aren't actually known to be conflicted and are treated as just unconfirmed.   I think the result of this is this SyncWithWallets loop is of dubious value.\n- All txs that are caught by the wallets conflict detection would already be marked dirty, and the new txs this loop catches, can't correctly reflect the right balance state anyway.\n- It actually serves a detrimental effect on the transactions that were marked as abandoned that will now erroneously have their abandoned state cleared and be treated as unconfirmed.  Their true state of conflicted matches much more closely to abandoned.  (This will be corrected in the immediately following loop for txs that the wallet code catches)\n\nIt may be possible to just correctly MarkConflicted all these transactions, and then I think the only issue will be the txs that are only conflicted because they are dependents won't properly have their cached values dirtied if the conflict goes away.  This issue already exists #7315.\n\nSee IRC discussion https://botbot.me/freenode/bitcoin-core-dev/2016-09-09/?msg=72745343&page=3\n",
    "user": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 2,
    "closed_at": "2021-01-11T13:36:29Z",
    "created_at": "2016-09-09T15:11:18Z",
    "updated_at": "2022-08-18T18:33:40Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 246056038,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjA1NjAzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/246056038",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-09T22:16:55Z",
      "updated_at": "2016-09-09T22:16:55Z",
      "author_association": "MEMBER",
      "body": "@sipa I just tested removing that loop, and having that loop actually call MarkConflicted.  Both seem to pass the tests (not sure that counts for much).  I'm not sure which I like better, the latter duplicates much of the MarkConflicted thats about to happen anyway and makes the wallet unreachable txs hard to unconflict...\n",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/8692#issuecomment-246056038",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8692"
    },
    {
      "event": "mentioned",
      "id": 784627284,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Nzg0NjI3Mjg0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/784627284",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-09T22:16:55Z"
    },
    {
      "event": "subscribed",
      "id": 784627285,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDc4NDYyNzI4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/784627285",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-09T22:16:55Z"
    },
    {
      "event": "labeled",
      "id": 784824062,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDc4NDgyNDA2Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/784824062",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-10T06:18:16Z",
      "label": {
        "name": "Wallet",
        "color": "02d7e1"
      }
    },
    {
      "event": "labeled",
      "id": 784824063,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDc4NDgyNDA2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/784824063",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-09-10T06:18:16Z",
      "label": {
        "name": "Priority Low",
        "color": "ededed"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-11-14T18:55:36Z",
      "updated_at": "2016-11-14T18:55:36Z",
      "source": {
        "issue": {
          "id": 141625180,
          "node_id": "MDU6SXNzdWUxNDE2MjUxODA=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7704",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7704/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7704/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7704/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/7704",
          "number": 7704,
          "state": "closed",
          "state_reason": "completed",
          "title": "Pending issues for `abandontransaction`",
          "body": "#7312 introduced the RPC call `abandontransaction` last minute before 0.12, there was still some work to be done:\n- [x] Return abandoned status in listtransactions\n- [x] Return abandoned status in GUI\n- [x] Fix any issues with how abandoned txs should sort\n- [x] Add a way to abandon transactions from GUI\n- [ ] abandontransaction may not work in some cases for conflicted transactions imported from old wallets (see #7690)\n",
          "user": {
            "login": "laanwj",
            "id": 126646,
            "node_id": "MDQ6VXNlcjEyNjY0Ng==",
            "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/laanwj",
            "html_url": "https://github.com/laanwj",
            "followers_url": "https://api.github.com/users/laanwj/followers",
            "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
            "organizations_url": "https://api.github.com/users/laanwj/orgs",
            "repos_url": "https://api.github.com/users/laanwj/repos",
            "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/laanwj/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135946,
              "node_id": "MDU6TGFiZWwxMzU5NDY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/GUI",
              "name": "GUI",
              "color": "02d7e1",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 7,
          "closed_at": "2016-11-14T20:44:28Z",
          "created_at": "2016-03-17T15:54:12Z",
          "updated_at": "2021-09-08T12:35:15Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-11-29T23:03:47Z",
      "updated_at": "2016-11-29T23:03:47Z",
      "source": {
        "issue": {
          "id": 192427540,
          "node_id": "MDExOlB1bGxSZXF1ZXN0OTU3OTQ1NzI=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9240",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9240/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9240/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9240/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/9240",
          "number": 9240,
          "state": "closed",
          "state_reason": null,
          "title": "Remove txConflicted",
          "body": "In the block connection logic we were tracking a vector of transactions found via the mempool that are now conflicted by transactions newly in blocks.  This allowed us to potentially find transactions that couldn't be found through only the wallets own conflict detection.  However we were not doing anything useful with this information, essentially only marking the cached credits/debits of the inputs dirty.  This wouldn't change balance calculations though as we weren't marking txs detected this way as conflicted in the wallet.  \r\n\r\nIn the future we might try to improve the best efforts detection of conflicted txs to use the mempool, but we can always resurrect this code if we find it useful.  In the meantime it serves as a confusion since it has no practical effect.   Getting conflict tracking correct is very difficult as transactions needed to make the connection may no longer be in the mempool and it's also important to be able to re-find any txs marked as conflicted if they become unconflicted.\r\n\r\nSee #8692  for more context.\r\n\r\nPlease note that the wallet still marks as conflicted txs it can find (anything linked only through wallet txs) and that the mempool still removes all conflicts (and dependents in the mempool).\r\n\r\n\r\n",
          "user": {
            "login": "morcos",
            "id": 4360349,
            "node_id": "MDQ6VXNlcjQzNjAzNDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/morcos",
            "html_url": "https://github.com/morcos",
            "followers_url": "https://api.github.com/users/morcos/followers",
            "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
            "organizations_url": "https://api.github.com/users/morcos/orgs",
            "repos_url": "https://api.github.com/users/morcos/repos",
            "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/morcos/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9240",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/9240",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/9240.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/9240.patch"
          },
          "closed_at": "2016-12-10T00:31:21Z",
          "created_at": "2016-11-29T23:03:47Z",
          "updated_at": "2021-09-08T11:42:17Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unlabeled",
      "id": 1374860115,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MTM3NDg2MDExNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1374860115",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-12-06T14:16:40Z",
      "label": {
        "name": "Priority Low",
        "color": "ededed"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-08-15T21:16:39Z",
      "updated_at": "2019-08-15T21:16:39Z",
      "source": {
        "issue": {
          "id": 481342859,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MzA3ODYxMTA4",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16624",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16624/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16624/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16624/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/16624",
          "number": 16624,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: encapsulate transactions state",
          "body": "While working on #15931, I've tried to rationalize tx state management to ease integration of block height tracking per-wallet tx. We currently rely on a combination of `hashBlock` and `nIndex` with magic value to determine tx confirmation, conflicted or abandoned state. It's hard to reason and error-prone.  To solve that, we encapsulate these fields in a `TxConfirmation` struct and introduce a `TxState` member that we update accordingly at block connection/disconnection.\r\n\r\nFollowing jnewbery [recommendation](https://github.com/bitcoin/bitcoin/pull/15931#discussion_r312576506), I've taken these changes in its own commit, and open a PR to get them first. It would ease review of aforementioned PR, but above all should ease fixing of long-term issues like :\r\n* https://github.com/bitcoin/bitcoin/issues/7315 (but maybe we should abandon abandontransaction or relieve it to only free outpoints not track the transaction as abandoned in itself, need its own discussion)\r\n* https://github.com/bitcoin/bitcoin/issues/8692 where we should cancel conflicted state of transactions chain smoothly\r\n* `MarkConflicted` in `LoadToWallet` is likely useless if we track conflicts rights at block connection\r\n\r\nMain changes of this PR to get right are tx update in `AddToWallet` and serialization/deserialization logic.",
          "user": {
            "login": "ariard",
            "id": 23310655,
            "node_id": "MDQ6VXNlcjIzMzEwNjU1",
            "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ariard",
            "html_url": "https://github.com/ariard",
            "followers_url": "https://api.github.com/users/ariard/followers",
            "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
            "organizations_url": "https://api.github.com/users/ariard/orgs",
            "repos_url": "https://api.github.com/users/ariard/repos",
            "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ariard/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 18,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16624",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/16624",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/16624.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/16624.patch"
          },
          "closed_at": "2019-09-05T13:30:03Z",
          "created_at": "2019-08-15T21:16:39Z",
          "updated_at": "2022-08-16T17:02:14Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 2610611046,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI2MTA2MTEwNDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2610611046",
      "actor": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5e202382a987351a59d5cda98ea9f2aee99f61a5",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5e202382a987351a59d5cda98ea9f2aee99f61a5",
      "created_at": "2019-09-05T13:29:13Z"
    },
    {
      "event": "referenced",
      "id": 2623469552,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI2MjM0Njk1NTI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2623469552",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4c9cc729fcddbceff0704b80c28a73c7535ea4bf",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/4c9cc729fcddbceff0704b80c28a73c7535ea4bf",
      "created_at": "2019-09-10T19:45:35Z"
    },
    {
      "event": "commented",
      "id": 757955279,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1Nzk1NTI3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/757955279",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-11T13:36:29Z",
      "updated_at": "2021-01-11T13:36:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "Closing this issue. Notes are still somewhat relevant but a lot has changed since this was written and https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking which references this is probably a better starting point for understanding wallet conflict tracking and how it can be improved currently. Particularly the [*idea-more-conflicts*](https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking#idea-more-conflicts) section covers the information in these notes and discusses how the wallet can handle block-connected conflicts better.\r\n\r\nBelow is the original issue description annotated with details of what's changed since this was opened.\r\n\r\n---\r\n\r\nre: https://github.com/bitcoin/bitcoin/issues/8692#issue-176033489\r\n> (These obscure notes are for eventually cleaning up wallet confliction and are low priority)\r\n>\r\n> In the block connection logic we call\r\n>\r\n> ```\r\n> BOOST_FOREACH(const CTransaction &tx, txConflicted)\r\n>         {\r\n>             SyncWithWallets(tx, pindexNewTip);\r\n>         }\r\n> ```\r\n>\r\n\r\nAt the time, this code was part of [`ActivateBestChain`](https://github.com/bitcoin/bitcoin/blob/b3b3c2a5623d5c942d2b3565cc2d833c65105555/src/main.cpp#L3052-L3057). This code was first added in https://github.com/bitcoin/bitcoin/pull/3694, and removed in https://github.com/bitcoin/bitcoin/pull/9240, because it was mistakenly thought to be unnecessary after https://github.com/bitcoin/bitcoin/pull/7105. It was then added back in https://github.com/bitcoin/bitcoin/pull/9371 and then accidentally removed again in https://github.com/bitcoin/bitcoin/pull/16624/commits/7e89994133725125dddbfa8d45484e3b9ed51c6e from https://github.com/bitcoin/bitcoin/pull/16624. Finally it was added back again in https://github.com/bitcoin/bitcoin/pull/18982.\r\n\r\n> `txConflicted` is returned by `mempool.removeForBlock` and can therefore contain transactions that should be marked conflicted that wouldn't be caught by the wallets own dependency tracking code (chains of mempool txs not all of which are in the wallet).\r\n\r\nIt's still true that block connection code can detect conflicts that wallet code will miss.\r\n\r\n> However, calling `SyncWithWallets` without setting a `posInBlock` has virtually no effect other than marking the cached credit/debit values as dirty. Since #7105 however wallet txs, that aren't explicitly marked conflicted via the wallets code, aren't actually known to be conflicted and are treated as just unconfirmed. I think the result of this is this SyncWithWallets loop is of dubious value.\r\n\r\nIt's still true that the these transactions are marked as unconfirmed instead of conflicted, but this could easily be changed as suggested in the wiki. It would just require some new code to update these from conflicted to unconflicted during reorgs.\r\n\r\nIt isn't not true the notification loop doesn't have value. It's just that the current value comes from triggering external notifications, not from updating internal state.\r\n\r\n> * All txs that are caught by the wallets conflict detection would already be marked dirty, and the new txs this loop catches, can't correctly reflect the right balance state anyway.\r\n\r\nThis is still true, but doesn't have to be. It's only true because the transactions are currently marked unconfirmed instead of conflicted.\r\n\r\n> * It actually serves a detrimental effect on the transactions that were marked as abandoned that will now erroneously have their abandoned state cleared and be treated as unconfirmed.  Their true state of conflicted matches much more closely to abandoned.  (This will be corrected in the immediately following loop for txs that the wallet code catches)\r\n\r\nI didn't go back and check if this was true at the time when this was written, but it's not true now. These transactions could not already be marked as abandoned because they are being removed from the mempool and transactions that are in the mempool can't be abandoned.\r\n\r\n> It may be possible to just correctly MarkConflicted all these transactions, and then I think the only issue will be the txs that are only conflicted because they are dependents won't properly have their cached values dirtied if the conflict goes away. This issue already exists #7315.\r\n\r\nThis is still possible. #7315 has changed since this was reported, but #7315 is just about reorg handling, and marking these conflicted and handling reorgs is easily possible\r\n\r\n> See IRC discussion [botbot.me/freenode/bitcoin-core-dev/2016-09-09/?msg=72745343&page=3](https://botbot.me/freenode/bitcoin-core-dev/2016-09-09/?msg=72745343&page=3)\r\n\r\nUpdated link: http://www.erisian.com.au/bitcoin-core-dev/log-2016-09-09.html#l-322\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/8692#issuecomment-757955279",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8692"
    },
    {
      "event": "closed",
      "id": 4190813005,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDE5MDgxMzAwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4190813005",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-11T13:36:29Z"
    },
    {
      "event": "locked",
      "id": 7216595566,
      "node_id": "LOE_lADOABII584Kfg7RzwAAAAGuJIJu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7216595566",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-18T18:33:40Z",
      "lock_reason": "resolved"
    }
  ]
}