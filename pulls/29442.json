{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442",
    "id": 1729853245,
    "node_id": "PR_kwDOABII585nG3c9",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29442",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29442.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29442.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/85a049ddceb854106efea8316462e356d9b88b21",
    "number": 29442,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Target a pre-defined utxo set composition by adjusting change outputs",
    "user": {
      "login": "remyers",
      "id": 8568892,
      "node_id": "MDQ6VXNlcjg1Njg4OTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/remyers",
      "html_url": "https://github.com/remyers",
      "followers_url": "https://api.github.com/users/remyers/followers",
      "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
      "organizations_url": "https://api.github.com/users/remyers/orgs",
      "repos_url": "https://api.github.com/users/remyers/repos",
      "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/remyers/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR is designed for the use case of a Lightning node that provides liquidity of predefined amounts via [liquidity ads](https://github.com/lightning/bolts/pull/878).\r\n\r\nCoin selection is currently optimized to reduce the size of the utxo set and create change optimized for privacy. A liquidity provider instead needs to service multiple liquidity requests by spending confirmed utxos of known sizes.\r\n\r\nIdeally most liquidity transactions would be funded by a single input or a small set of inputs optimized to reduce fees. To minimize the number of unconfirmed transactions, inputs should also be sized in a range where most transactions do not produce change. When change is created, it should be divided into outputs of the sizes needed so that the wallet's utxo set converges towards an ideal utxo set specified by the user.\r\n\r\nI am opening this PR as a draft to get feedback and suggestions on the concept and my implementation to address this use case.\r\n\r\nThe algorithm described below can be implemented externally via RPC calls or directly in the wallet. \r\n\r\n1. Externally: use a new option to set the change target used for coin selection. \r\n2. Wallet (opportunistic): a new configuration file defines the desired utxo set which the wallet uses to compute the change target used for coin selection and to split change outputs (if any). \r\n4. Wallet (reactive/proactive):  pre-select a large input to force coin selection to produce change when fees are below some specified threshold or the desired set of utxos falls below some threshold. \r\n\r\n## utxo targets file example:\r\n\r\n```json\r\n{\r\n    \"buckets\": [\r\n        {\r\n            \"start_satoshis\": 10000,\r\n            \"end_satoshis\": 25000,\r\n            \"target_utxo_count\": 150\r\n        },\r\n        {\r\n            \"start_satoshis\": 50000,\r\n            \"end_satoshis\": 75000,\r\n            \"target_utxo_count\": 50\r\n        },\r\n        {\r\n            \"start_satoshis\": 200000,\r\n            \"end_satoshis\": 250000,\r\n            \"target_utxo_count\": 20\r\n        },\r\n        {\r\n            \"start_satoshis\": 1000000,\r\n            \"end_satoshis\": 1400000,\r\n            \"target_utxo_count\": 5\r\n        }\r\n    ],\r\n    \"bucket_refill_feerate\": 30000\r\n}\r\n```\r\n - The `target_utxo_count` for a bucket should be larger than the anticipated number of liquidity requests of `bucket_start_satoshis` within the expected confirmation time of a liquidity transaction.\r\n - The range from `bucket_start_satoshis` to `bucket_end_satoshis` should encompass expected fee variance.\r\n - The `bucket_refill_feerate` should be set to the expected median fee rate (?).\r\n - This file will be reloaded for every spend request to allow for on-the-fly updates\r\n\r\n## Algorithm steps\r\n\r\nFor each payment do the following:\r\n\r\n1) Calculate the current capacity of each target bucket from the wallet's utxo set.\r\n    - Include outputs from both confirmed and unconfirmed transactions in the wallet to calculate capacity.\r\n2) Add our largest confirmed utxo as an input IF the capacity of the least full target bucket is below some threshold (eg. < 30% full) or less than some higher threshold (eg. < 70%) and fee rates are below the `bucket_refill_feerate`.\r\n    - When the largest confirmed utxo is from one of our target buckets, then we should refill our wallet with a utxo from cold storage.\r\n3) Set the minimum change target [`m_min_change_target`](https://github.com/bitcoin/bitcoin/blob/3054416f62644120a4a6bc76e927054c7fbbd487/src/wallet/coinselection.h#L147) to a value from the target bucket with the lowest current capacity.\r\n    - Generate a random change target of the amount: current `change_fee` (the fee for creating an output) + a random value in the range: `bucket_start_satoshis` to `bucket_end_satoshi` - `change_fee`.\r\n    - Currently the change target is set by [`GenerateChangeTarget()`](https://github.com/bitcoin/bitcoin/blob/6ff0aa089c01ff3e610ecb47814ed739d685a14c/src/wallet/coinselection.cpp#L824) in a hard coded range.\r\n    - This parameter is only used by the 'knapsack' and 'coingrinder' algorithms.\r\n4) Call ['SelectCoins()'](https://github.com/bitcoin/bitcoin/blob/3054416f62644120a4a6bc76e927054c7fbbd487/src/wallet/spend.cpp#L1132) with the input from step 2 (if any) added to the `preset_inputs` parameter and with the minimum change target from step 3.\r\n    - The `consolidatefeerate=0` configuration option should always be set so that utxos are not preemptively cosolidated. Coin selection sets the parameter [`m_long_term_feerate`](https://github.com/bitcoin/bitcoin/blob/37fdf5a492786c1772b5b40773a1031237447070/src/wallet/coinselection.h#L160) to the wallets `consolidatefeerate`.\r\n    - Ideally, only the 'bnb' and 'cg' coin selection algorithms should be used and the others disabled to optimize for low fees.\r\n5) If the coin selection result includes a change output, then split the single change output amount into multiple outputs.\r\n    - Add the mimimum change target as an output first.\r\n    - If there is remaining value after paying the fee for a new output, then add a target from the next most empty target bucket.\r\n    - If there is not enough value to add a new output and fees, add remaining value to the last output added instead.\r\n\r\n",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2024-02-16T16:45:09Z",
    "updated_at": "2024-02-26T09:16:04Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "b009b3e6709ccfb290e6c702f08d6b888bbcb4a6",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "remyers:2024-02-change-target",
      "ref": "2024-02-change-target",
      "sha": "85a049ddceb854106efea8316462e356d9b88b21",
      "user": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 221530299,
        "node_id": "MDEwOlJlcG9zaXRvcnkyMjE1MzAyOTk=",
        "name": "bitcoin",
        "full_name": "remyers/bitcoin",
        "owner": {
          "login": "remyers",
          "id": 8568892,
          "node_id": "MDQ6VXNlcjg1Njg4OTI=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/remyers",
          "html_url": "https://github.com/remyers",
          "followers_url": "https://api.github.com/users/remyers/followers",
          "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
          "organizations_url": "https://api.github.com/users/remyers/orgs",
          "repos_url": "https://api.github.com/users/remyers/repos",
          "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/remyers/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/remyers/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/remyers/bitcoin",
        "archive_url": "https://api.github.com/repos/remyers/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/remyers/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/remyers/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/remyers/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/remyers/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/remyers/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/remyers/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/remyers/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/remyers/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/remyers/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/remyers/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/remyers/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/remyers/bitcoin/events",
        "forks_url": "https://api.github.com/repos/remyers/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/remyers/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/remyers/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/remyers/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/remyers/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/remyers/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/remyers/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/remyers/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/remyers/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/remyers/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/remyers/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/remyers/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/remyers/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/remyers/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/remyers/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/remyers/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:remyers/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/remyers/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/remyers/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/remyers/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/remyers/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/remyers/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/remyers/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/remyers/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/remyers/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/remyers/bitcoin/hooks",
        "svn_url": "https://github.com/remyers/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 213576,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": true,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-16T22:20:26Z",
        "created_at": "2019-11-13T18:56:20Z",
        "updated_at": "2021-10-12T01:52:43Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "3cbc8cbc71d3d6ecfaf41164ce59c24ac94bae99",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34680,
        "stargazers_count": 74161,
        "watchers_count": 74161,
        "size": 250347,
        "default_branch": "master",
        "open_issues_count": 686,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-26T03:15:58Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-02-26T09:35:23Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 167,
    "deletions": 5,
    "changed_files": 8,
    "commits": 3,
    "review_comments": 5,
    "comments": 6
  },
  "events": [
    {
      "event": "commented",
      "id": 1948862298,
      "node_id": "IC_kwDOABII5850KUda",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1948862298",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T16:45:12Z",
      "updated_at": "2024-02-20T12:29:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29442).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29015](https://github.com/bitcoin/bitcoin/pull/29015) (kernel: Streamline util library by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#issuecomment-1948862298",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442"
    },
    {
      "event": "labeled",
      "id": 11831179519,
      "node_id": "LE_lADOABII585_fkYfzwAAAALBMXj_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11831179519",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T16:45:14Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIwM2VlMzljNjVkZTRiN2ZlZGNkNjk4YzIxNzQ5MDNiY2MxYWY0NWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b03ee39c65de4b7fedcd698c2174903bcc1af45d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b03ee39c65de4b7fedcd698c2174903bcc1af45d",
      "tree": {
        "sha": "27ae35f52af4f4ba0b312c1b416b988f2b2af33a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/27ae35f52af4f4ba0b312c1b416b988f2b2af33a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 27ae35f52af4f4ba0b312c1b416b988f2b2af33a\nparent 3cbc8cbc71d3d6ecfaf41164ce59c24ac94bae99\nauthor Richard Myers <remyers@yakshaver.org> 1707840382 +0100\ncommitter Richard Myers <remyers@yakshaver.org> 1708102368 +0100\n\nwallet: Add change_target parameter to coin control\n\nAdd a coin control parameter to optionally force a particular change target for coin selection algorithms that result in a change output.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJKBAABCgA0FiEEf/pts4wRKAyFfYbezLEmUJDpO2IFAmXPkuAWHHJlbXllcnNA\neWFrc2hhdmVyLm9yZwAKCRDMsSZQkOk7YpHHD/sF8FOscVWSz/Wozv6Xp0FE1HDQ\nkP/Jt0r1Dr+BoaV/mYW0HGH1UMNt2PUBcW0Ly1bSbygTLK47nb6h0jB6Jh30PgCN\n3dLZr/h2A/fIQc1ZzJmQMlVQAYaGFUGUySRq8hDko9zDtHMwlv2yHlZQO91n5Wy4\nkbMNo6mDdvRcc+Axib5MriFK7s2l5B5/l+TF0H2lc82/c+Q3KgmE/6X0lK5xneJu\n1XxCTwecIsST86h7oBlYU+ewOniESXrYZXOveJgITrK3RCjspH11bjuOWE3ENszx\npqiHexlluwF2WxywaD++zoQX1Cb3tMShWA1Emv/FthWloTuE0OLoUVQC843Vp7iC\ndd0uR5BtQDv3EHEOl8giGZwsjkfDgN5awVPGet0YqSWM7RywgmJyX8glbKh3vFAe\n7yQaU4BmvlJ2KhrEkvmAgpwOt61QChHbafsM3/200svzW138KlUNgBileRa+l8Va\neVAqCK8jEV+h9gSPP83Jf4qSaVMrgR7g3cwqKUA2aHCvFw78ABz7JcTx8l8s0+bc\nZFNV/tEJ+J5l4Dd09dNG4EzcvSAQ5wUD8F2ITm+jZgpcurijP+vENXuknjbsQO5J\nhFrX+8iEtGVufzUsIw/xxmI5wrOMpSfPTHmnbi6z6nPKgNB3mxbrnwOMhMuP9DtC\n9030ROdWGrQpqoplEg==\n=9usI\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3cbc8cbc71d3d6ecfaf41164ce59c24ac94bae99",
          "sha": "3cbc8cbc71d3d6ecfaf41164ce59c24ac94bae99",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3cbc8cbc71d3d6ecfaf41164ce59c24ac94bae99"
        }
      ],
      "message": "wallet: Add change_target parameter to coin control\n\nAdd a coin control parameter to optionally force a particular change target for coin selection algorithms that result in a change output.",
      "committer": {
        "name": "Richard Myers",
        "email": "remyers@yakshaver.org",
        "date": "2024-02-16T16:52:48Z"
      },
      "author": {
        "name": "Richard Myers",
        "email": "remyers@yakshaver.org",
        "date": "2024-02-13T16:06:22Z"
      },
      "sha": "b03ee39c65de4b7fedcd698c2174903bcc1af45d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11831263913,
      "node_id": "HRFPE_lADOABII585_fkYfzwAAAALBMsKp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11831263913",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T16:53:06Z"
    },
    {
      "event": "labeled",
      "id": 11831265260,
      "node_id": "LE_lADOABII585_fkYfzwAAAALBMsfs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11831265260",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T16:53:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1948874005,
      "node_id": "IC_kwDOABII5850KXUV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1948874005",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T16:53:13Z",
      "updated_at": "2024-02-16T16:53:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\n🚧 At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21662752091</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#issuecomment-1948874005",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11832889282,
      "node_id": "HRFPE_lADOABII585_fkYfzwAAAALBS4_C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11832889282",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T19:29:54Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZlOGFlODhhNjE5ZDBkMTAzMTUwNTg4ODBhZDQ2ZTliMzI3ZmFhMjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe8ae88a619d0d10315058880ad46e9b327faa24",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fe8ae88a619d0d10315058880ad46e9b327faa24",
      "tree": {
        "sha": "c17f77dd05c24956a80d3e8d978d4935f6e642de",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c17f77dd05c24956a80d3e8d978d4935f6e642de"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c17f77dd05c24956a80d3e8d978d4935f6e642de\nparent b03ee39c65de4b7fedcd698c2174903bcc1af45d\nauthor Richard Myers <remyers@yakshaver.org> 1706102379 +0100\ncommitter Richard Myers <remyers@yakshaver.org> 1708122006 +0100\n\nwallet: Define utxo set targets to replenish when spends have change\n\nAdd a config option to load a json file that defines a set of utxo target buckets with a value range and count. When the current utxo set for the wallet does not match or exceed the counts for the value ranges of the buckets, opportunistically split the change output produced by coin selection (if any) into additional outputs.\n\nTarget buckets will be refilled from most to least depleted. The value of a new output to refill a target bucket will be randomly selected from its value range.\n\nOnce all buckets are full the change output will not be further split.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJKBAABCgA0FiEEf/pts4wRKAyFfYbezLEmUJDpO2IFAmXP35YWHHJlbXllcnNA\neWFrc2hhdmVyLm9yZwAKCRDMsSZQkOk7Ys26EACko/rS1e30zIE20AQ6vxSwH0O4\nW3qfiBmgAWXjQ9W0S1j1eMP/d+K5hojE02LkKpalRNTDaN7IUSsP+sVI6D1AbEgE\n7ZIA3KGOMXfzCGEYwkOBWh0PKTg0Hu6C+G6/RoKmQS9HoWxQ8XyKFsduptPJtG1k\nShWE392cCbZ2i1GlhQu6cawijdssC9BWcSlUIonkyklh8A2PErk0XHTXvjZbDXJ1\nfeqmtf/dD93Re46E9niw5mZPZ2NbAzDIpQJ5bjMPc9NUU4aGx/WcS0xdPe3yet1R\nvcUA+sjPa1ZpfIRToCi/jGQv/8FSD0UMrMXJnMEMSMxzSOg+xE9ZQt/gQw9FTRV1\ny3lruJ9jwzSjYoT+tVMlcYJEQaXwQzXROiuVpTw5EXtCD+xw+thwmY48DaZRc6Hm\nm4+Cx2u91nOsYQQJYet/KQZsw1093EuFKTzKl1NVlzhCDEU6EUkvx2yEBNXut2iQ\nVdAVOdKKqsTr84OPvp1xgYVX2BOrFFKZwxx+EwvAT4fxKkyq3Q5A1LJDNMqvPK90\nQvh94TRR9RuhloOxynJrOpsSXEDPDIH/tt8PSxcLzlBy6/OdULh30ojV3ZrgXNfu\n/kXNimvPCbX0AcXERS67+6jEo8nttXHBZNMHVos3e+NYQuLQ3NEWrtx61Yb7oFqX\neSbocRP8OUNpzbN4+Q==\n=VG/G\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b03ee39c65de4b7fedcd698c2174903bcc1af45d",
          "sha": "b03ee39c65de4b7fedcd698c2174903bcc1af45d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b03ee39c65de4b7fedcd698c2174903bcc1af45d"
        }
      ],
      "message": "wallet: Define utxo set targets to replenish when spends have change\n\nAdd a config option to load a json file that defines a set of utxo target buckets with a value range and count. When the current utxo set for the wallet does not match or exceed the counts for the value ranges of the buckets, opportunistically split the change output produced by coin selection (if any) into additional outputs.\n\nTarget buckets will be refilled from most to least depleted. The value of a new output to refill a target bucket will be randomly selected from its value range.\n\nOnce all buckets are full the change output will not be further split.",
      "committer": {
        "name": "Richard Myers",
        "email": "remyers@yakshaver.org",
        "date": "2024-02-16T22:20:06Z"
      },
      "author": {
        "name": "Richard Myers",
        "email": "remyers@yakshaver.org",
        "date": "2024-01-24T13:19:39Z"
      },
      "sha": "fe8ae88a619d0d10315058880ad46e9b327faa24"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg1YTA0OWRkY2ViODU0MTA2ZWZlYTgzMTY0NjJlMzU2ZDliODhiMjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/85a049ddceb854106efea8316462e356d9b88b21",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/85a049ddceb854106efea8316462e356d9b88b21",
      "tree": {
        "sha": "4510657941a189353e5a9d115d4467326f45b17d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4510657941a189353e5a9d115d4467326f45b17d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4510657941a189353e5a9d115d4467326f45b17d\nparent fe8ae88a619d0d10315058880ad46e9b327faa24\nauthor Richard Myers <remyers@yakshaver.org> 1707838360 +0100\ncommitter Richard Myers <remyers@yakshaver.org> 1708122007 +0100\n\nwallet: Refill utxo target buckets proactively\n\nWhen utxo targets are specified and a utxo target bucket is depleted, or fees are low, produce excess change that can be split to replenish the utxo target set. This is accomplished by including a large valued utxo as an input to coin selection.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJKBAABCgA0FiEEf/pts4wRKAyFfYbezLEmUJDpO2IFAmXP35cWHHJlbXllcnNA\neWFrc2hhdmVyLm9yZwAKCRDMsSZQkOk7YvwfEACuUR9lNaQtOCYRTvYrTpu8qcVp\nPG0wfahRSD1jxj8hPd4/oWng+vW82Jv2pplBrrlq9JKK4E7dodQyk7mNFPoDmdc9\n0gmvxZDqBLrFrIwJiZ71fOzsy4+M1WdlfNgGR1IqPVR7sryXaFwh6v1+cOtjfNlH\nOzmVqPh5NrVbqjD4fmn4e59C+e1g92AtK8WhxDu2gzT+8PzyIXT8BF0SrT/kJAHg\nfQSQ0Oo7hhQgX1x/cN5b4sCYLZytvpb1V/XU8QcvloI+vtxIrReeFQWuoKdoHyed\nlridF3VV+6CsMGEb9OhqbLckgxHxCz9Jd6EMVtgkzIG+0hWGxOQg57sGY9135Klv\npT30FIHkdPh+fwZfPks1vLxbupRYsUfw0FhjAfBQJWGbyqLjnA5tFaJT48FyzxdI\ndJWMqnoQaPIBDKAAkmXs/aI3s8A2pPzFUKfGYIdQwfTnT+l/ZH4bP81Ocbps0RQC\n8l2eqQk50m+o79MC8q4UPfJDLxHbfNfHEilTnvQX3/yGBHN/WGesuTl7hn/joxn1\nA7nDoj40LGanNz61eZ4nUlGv9Rd2Xx3VnIXgG060jn3GJBM1eJgwM8ahnIlDnEfk\nHv4aNWF2hnyprqaNonSGU1X8j1W82YhfCiFX1HGtrnnCaJ+aPF2FN9XKe3910LI3\nRVW5PWb8/a4ux5+HPg==\n=vcH7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe8ae88a619d0d10315058880ad46e9b327faa24",
          "sha": "fe8ae88a619d0d10315058880ad46e9b327faa24",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fe8ae88a619d0d10315058880ad46e9b327faa24"
        }
      ],
      "message": "wallet: Refill utxo target buckets proactively\n\nWhen utxo targets are specified and a utxo target bucket is depleted, or fees are low, produce excess change that can be split to replenish the utxo target set. This is accomplished by including a large valued utxo as an input to coin selection.",
      "committer": {
        "name": "Richard Myers",
        "email": "remyers@yakshaver.org",
        "date": "2024-02-16T22:20:07Z"
      },
      "author": {
        "name": "Richard Myers",
        "email": "remyers@yakshaver.org",
        "date": "2024-02-13T15:32:40Z"
      },
      "sha": "85a049ddceb854106efea8316462e356d9b88b21"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11834253537,
      "node_id": "HRFPE_lADOABII585_fkYfzwAAAALBYGDh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11834253537",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T22:20:27Z"
    },
    {
      "event": "unlabeled",
      "id": 11834570500,
      "node_id": "UNLE_lADOABII585_fkYfzwAAAALBZTcE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11834570500",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-16T23:19:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-17T00:02:54Z",
      "updated_at": "2024-02-17T00:02:54Z",
      "source": {
        "issue": {
          "id": 2029493410,
          "node_id": "PR_kwDOABII585hWvMx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29015",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29015/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29015/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29015/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29015",
          "number": 29015,
          "state": "open",
          "state_reason": null,
          "title": "kernel: Streamline util library",
          "body": "Remove `fees.h`, `errors.h`, and `spanparsing.h` from the util library. Specifically:\r\n\r\n- Move `Split` functions from `util/spanparsing.h` to `util/string.h`, using `util` namespace for clarity.\r\n- Move remaining spanparsing functions to `script/parsing.h` since they are used for descriptor and miniscript parsing.\r\n- Combine `util/fees.h` and `util/errors.h` into `common/messages.h` so there is a place for simple functions that generate user messages to live, and these functions are not part of the util library.\r\n\r\nMotivation for this change is that the util library is a dependency of the kernel, and we should remove functionality from util that shouldn't be called by kernel code or kernel applications. These changes should also improve code organization and make functions easier to discover. Some of these same moves are (or were) part of #28690, but did not help with code organization, or made it worse, so it is better to move them and clean them up in the same PR so code only has to change one time.\r\n",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 18,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29015",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29015",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29015.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29015.patch"
          },
          "created_at": "2023-12-06T22:26:39Z",
          "updated_at": "2024-02-21T18:49:32Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-17T01:58:11Z",
      "updated_at": "2024-02-17T01:58:11Z",
      "source": {
        "issue": {
          "id": 1833542215,
          "node_id": "PR_kwDOABII585XB4Gh",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28201",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28201/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28201/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28201/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28201",
          "number": 28201,
          "state": "open",
          "state_reason": null,
          "title": "Silent Payments: sending",
          "body": "This PR is part of integrating silent payments into Bitcoin Core. Status and tracking for the project is managed in https://github.com/bitcoin/bitcoin/issues/28536\r\n\r\nThis PR depends on #28122 and is marked as a draft until it is merged. If interested in those commits, please review on #28122\r\n\r\n## Sending \r\n### Silent Payments logic\r\n\r\nThe main focus of this PR is:\r\n\r\n* Applying the Taptweak to a taproot internal private key (this is a copy-paste of the code for applying the taptweak in the signing process)\r\n* Getting a private key from a given `scriptPubKey`\r\n* Creating silent payment outputs\r\n* Applying the created scriptPubKeys back to the vector of `CRecipients`\r\n\r\nThe functions are then used together to create silent payment outputs during `CreateTransactionInternal`.\r\n\r\n### Final steps\r\n\r\nThe last commits ensure that:\r\n\r\n* Coin selection is silent payments aware and knows to exclude taproot script path spends and inputs with unknown witness when funding a transaction which pays to a silent payment address\r\n* The change output type is correctly chosen when paying to a silent payment address\r\n* Functional tests\r\n",
          "user": {
            "login": "josibake",
            "id": 7444140,
            "node_id": "MDQ6VXNlcjc0NDQxNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/josibake",
            "html_url": "https://github.com/josibake",
            "followers_url": "https://api.github.com/users/josibake/followers",
            "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
            "organizations_url": "https://api.github.com/users/josibake/orgs",
            "repos_url": "https://api.github.com/users/josibake/repos",
            "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/josibake/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 249581124,
              "node_id": "MDU6TGFiZWwyNDk1ODExMjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Privacy",
              "name": "Privacy",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28201",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28201",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28201.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28201.patch"
          },
          "created_at": "2023-08-02T16:37:04Z",
          "updated_at": "2024-02-20T11:53:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1952151548,
      "node_id": "IC_kwDOABII5850W3f8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1952151548",
      "actor": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-19T10:30:39Z",
      "updated_at": "2024-02-19T10:30:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "@murchandamus we'd love to get your feedback on this! I'll try to summarize at a higher level what we'd like to achieve.\r\n\r\nThe `bitcoind` wallet currently tries to keep a somewhat \"minimal\" utxo set and actively consolidates user utxos, because it assumes that we receive transactions as much (or more) than we send transactions and wants outgoing transactions to be as cheap as possible. But that's not true of liquidity service providers, who usually only receive funds when refilling the wallet from cold storage, and want to make sure they always have enough confirmed utxos to satisfy user demand efficiently. In such cases, the wallet operator has a good idea of what they'd like their utxo pool to look like (because they're selling a limited sets of specific amounts), and would like `bitcoind` to try to maintain that utxo pool as much as possible, while optimizing mostly for transaction weight, especially when feerate is high (above a user-defined threshold, similar to `consolidatefeerate` but with the exact opposite semantics - when below that threshold, we want to actively _create_ more utxos, not _consolidate_ them).\r\n\r\nWe can think of this type of wallet as a slowly draining wallet: its total amount is linearly decreasing over time, and is occasionally topped-up from cold storage.\r\n\r\nWe're not sure how to best achieve that. Our goal is to do it inside `bitcoind` (which is the source of truth for the wallet state), but with minimal changes to the coin selection code itself. We'd like this to be as much as possible done by simply pre-processing inputs to the coin selection algorithms and post-processing their outputs, which would make this:\r\n\r\n- easy to rebase on top of bitcoind releases if this work doesn't make sense to be accepted into `bitcoind`\r\n- or as a user-configurable option if that PR can be merged to `bitcoind`",
      "user": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#issuecomment-1952151548",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442"
    },
    {
      "event": "mentioned",
      "id": 11847586352,
      "node_id": "MEE_lADOABII585_fkYfzwAAAALCK9Iw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11847586352",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-19T10:30:41Z"
    },
    {
      "event": "subscribed",
      "id": 11847586371,
      "node_id": "SE_lADOABII585_fkYfzwAAAALCK9JD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11847586371",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-19T10:30:41Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "notmandatory",
        "id": 4724730,
        "node_id": "MDQ6VXNlcjQ3MjQ3MzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4724730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/notmandatory",
        "html_url": "https://github.com/notmandatory",
        "followers_url": "https://api.github.com/users/notmandatory/followers",
        "following_url": "https://api.github.com/users/notmandatory/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/notmandatory/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/notmandatory/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/notmandatory/subscriptions",
        "organizations_url": "https://api.github.com/users/notmandatory/orgs",
        "repos_url": "https://api.github.com/users/notmandatory/repos",
        "events_url": "https://api.github.com/users/notmandatory/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/notmandatory/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-20T18:07:56Z",
      "updated_at": "2024-02-20T18:07:56Z",
      "source": {
        "issue": {
          "id": 2144978504,
          "node_id": "I_kwDODgwEWM5_2cZI",
          "url": "https://api.github.com/repos/bitcoindevkit/bdk/issues/1356",
          "repository_url": "https://api.github.com/repos/bitcoindevkit/bdk",
          "labels_url": "https://api.github.com/repos/bitcoindevkit/bdk/issues/1356/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoindevkit/bdk/issues/1356/comments",
          "events_url": "https://api.github.com/repos/bitcoindevkit/bdk/issues/1356/events",
          "html_url": "https://github.com/bitcoindevkit/bdk/issues/1356",
          "number": 1356,
          "state": "open",
          "state_reason": null,
          "title": "wallet: target a pre-defined utxo set composition by adjusting change outputs",
          "body": "**Describe the enhancement**  \r\n\r\nThis is an interesting feature that was suggested for the bitcoin core wallet that I think could be useful for bdk wallet users also. See description here: https://github.com/bitcoin/bitcoin/pull/29442\r\n\r\n**Use case**  \r\n\r\nThis would be useful for LN liquidity providers who are using BDK instead of the core wallet, or any other users who might want to maintain a utxo set composition of pre-defined sizes. Could this be useful for payjoin or coinjoin?\r\n\r\n**Additional context**\r\n\r\nThis is very low priority right now, but putting it out there as a reminder for future discussion.",
          "user": {
            "login": "notmandatory",
            "id": 4724730,
            "node_id": "MDQ6VXNlcjQ3MjQ3MzA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4724730?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/notmandatory",
            "html_url": "https://github.com/notmandatory",
            "followers_url": "https://api.github.com/users/notmandatory/followers",
            "following_url": "https://api.github.com/users/notmandatory/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/notmandatory/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/notmandatory/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/notmandatory/subscriptions",
            "organizations_url": "https://api.github.com/users/notmandatory/orgs",
            "repos_url": "https://api.github.com/users/notmandatory/repos",
            "events_url": "https://api.github.com/users/notmandatory/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/notmandatory/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 1803493658,
              "node_id": "MDU6TGFiZWwxODAzNDkzNjU4",
              "url": "https://api.github.com/repos/bitcoindevkit/bdk/labels/enhancement",
              "name": "enhancement",
              "description": "New feature or request",
              "color": "a2eeef",
              "default": true
            },
            {
              "id": 1803493671,
              "node_id": "MDU6TGFiZWwxODAzNDkzNjcx",
              "url": "https://api.github.com/repos/bitcoindevkit/bdk/labels/discussion",
              "name": "discussion",
              "description": "There's still a discussion ongoing",
              "color": "d876e3",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 0,
          "created_at": "2024-02-20T18:07:56Z",
          "updated_at": "2024-02-20T18:09:32Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1893495240,
      "node_id": "PRR_kwDOABII585w3HHI",
      "url": null,
      "actor": null,
      "commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I really like the fact that it consists mostly of a pre-processing step before coin selection runs, followed by a post-processing step on the output of coin selection.\r\n\r\nShould we also tweak which coin selection algorithms are run depending on whether we're trying to refill buckets (and how aggressive we'd like to be) or not? Some of them may not be well suited for that?",
      "user": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#pullrequestreview-1893495240",
      "submitted_at": "2024-02-21T15:55:17Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
    },
    {
      "event": "commented",
      "id": 1961125346,
      "node_id": "IC_kwDOABII58505GXi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1961125346",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-23T11:01:44Z",
      "updated_at": "2024-02-23T11:01:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Should we also tweak which coin selection algorithms are run depending on whether we're trying to refill buckets (and how aggressive we'd like to be) or not? Some of them may not be well suited for that?\r\n\r\nYes, I think we should only run BnB and Coingrinder. Currently SRD and Knapsack are fallbacks that could win when BnB and CoinGrinder have higher waste metrics. When `consolidatefeerate=0` then `longTermFeeRate=0` and the waste metric used to compare the results of the different algorithms should be based on how much we overshoot the target value + how much it costs to add more inputs.\r\n```c\r\nwaste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\r\n```\r\nIf one of the algorithms can find a solution with less overshoot than the cost of adding more (small value) inputs, then it seems like they would win. Coingrinder should always find a solution with the least input weight. \r\n\r\nWhen fees are high, I think we should not care if we overshoot our target. We should always prefer a changeless BnB solution over one with change. When we have to produce change, we would prefer the Coingrinder solution with minimal input weight. We will allocate change to outputs sized to favor BnB in the future.\r\n\r\nWhen fees are low, I think we will want to create more change to refill our target buckets, but still not favor more exact matches that use more inputs.",
      "user": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#issuecomment-1961125346",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442"
    },
    {
      "event": "commented",
      "id": 1963579537,
      "node_id": "IC_kwDOABII5851CdiR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1963579537",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-26T08:37:58Z",
      "updated_at": "2024-02-26T08:37:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think we should consider a pluggable architecture for coin selection algorithms.\r\n\r\nIt's clear that there are multiple personas using the bitcoin core wallet, e.g. merchant, customer, lightning wallets. They have different and conflicting needs. So we either will have to have a complicated code and configuration surface to reconcile them or make our code extendable. \r\n\r\nThe interface of coin selection is pretty well defined, so it seems like it is a good fit for extensibility. The coin selection plug-in could receive utxo_pool and target amount as inputs (plus maybe some additional info), and return selected utxo's as result. @remyers @t-bast would something like this work in your case?",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#issuecomment-1963579537",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442"
    },
    {
      "event": "mentioned",
      "id": 11917527211,
      "node_id": "MEE_lADOABII585_fkYfzwAAAALGVwir",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11917527211",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-26T08:37:59Z"
    },
    {
      "event": "subscribed",
      "id": 11917527229,
      "node_id": "SE_lADOABII585_fkYfzwAAAALGVwi9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11917527229",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-26T08:37:59Z"
    },
    {
      "event": "mentioned",
      "id": 11917527248,
      "node_id": "MEE_lADOABII585_fkYfzwAAAALGVwjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11917527248",
      "actor": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-26T08:38:00Z"
    },
    {
      "event": "subscribed",
      "id": 11917527263,
      "node_id": "SE_lADOABII585_fkYfzwAAAALGVwjf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11917527263",
      "actor": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-26T08:38:00Z"
    },
    {
      "event": "commented",
      "id": 1963645226,
      "node_id": "IC_kwDOABII5851Ctkq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1963645226",
      "actor": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-26T09:16:02Z",
      "updated_at": "2024-02-26T09:16:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I think we should consider a pluggable architecture for coin selection algorithms.\r\n\r\nThat's an interesting suggestion. So far in our case I don't see a need to use a different coin selection algorithm, though I do think there might be value in having the ability to selectively disable SRD and knapsack. The current scheme proposed in this PR is more of a wrapper around the existing coin selection system.\r\n\r\nI can not rule out the possibility that there might exist a superior custom coin selection algorithm for this use case. If someone were to propose a different algorithm then that would certainly help motivate a pluggable coin selection architecture.",
      "user": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#issuecomment-1963645226",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497769911",
      "pull_request_review_id": 1893495240,
      "id": 1497769911,
      "node_id": "PRRC_kwDOABII585ZRie3",
      "diff_hunk": "@@ -1128,6 +1225,36 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         available_coins = AvailableCoins(wallet, &coin_control, coin_selection_params.m_effective_feerate);\n     }\n \n+    // Load a json file that describes a target utxo set",
      "path": "src/wallet/spend.cpp",
      "position": 138,
      "original_position": 138,
      "commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "original_commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "in_reply_to_id": null,
      "user": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Loading this file every time we fund a transaction doesn't seem reasonable. I think we should start with a static file that needs a restart whenever the node operator wants to change values, and we can later decide how to make this more dynamic (if it's even necessary).",
      "created_at": "2024-02-21T15:17:52Z",
      "updated_at": "2024-02-21T15:55:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#discussion_r1497769911",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497769911"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1228,
      "original_line": 1228,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497820248",
      "pull_request_review_id": 1893495240,
      "id": 1497820248,
      "node_id": "PRRC_kwDOABII585ZRuxY",
      "diff_hunk": "@@ -799,6 +815,83 @@ util::Result<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& av\n     return op_selection_result;\n }\n \n+/** Returns UTXO targets and compute their current count from available coins */\n+std::vector<UtxoTarget> UtxoTargetsFromJson(const UniValue& utxo_targets_json, const CoinsResult& available_coins)\n+{\n+    std::vector<UtxoTarget> utxo_targets;\n+    for (const auto& bucket : utxo_targets_json.getValues()) {\n+        UtxoTarget target = {\n+            bucket[\"start_satoshis\"].getInt<CAmount>(),\n+            bucket[\"end_satoshis\"].getInt<CAmount>(),\n+            bucket[\"target_utxo_count\"].getInt<uint32_t>()};\n+        utxo_targets.push_back(target);\n+    }\n+    for (const auto& [type, outputs] : available_coins.coins) {\n+        for (const wallet::COutput& output : outputs) {\n+            for (UtxoTarget& target : utxo_targets) {\n+                if (output.txout.nValue >= target.start_satoshis && output.txout.nValue <= target.end_satoshis) {\n+                    target.current_utxo_count++;\n+                    break;\n+                }\n+            }\n+        }\n+    }\n+\n+    return utxo_targets;\n+}\n+\n+/** Returns a random change amount in the range of the most depleted Utxo bucket and sets `capacity`\n+ * to the capacity of that change target, if any.\n+ */\n+std::optional<CAmount> GenerateChangeTargetFromUtxoTargets(const std::vector<UtxoTarget>& utxo_targets, const CAmount change_fee, double& capacity, FastRandomContext& rng)",
      "path": "src/wallet/spend.cpp",
      "position": 69,
      "original_position": 69,
      "commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "original_commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "in_reply_to_id": null,
      "user": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not sure this is really what we want. I think this function should try to refill multiple buckets at once (when amounts allow it), not just the most depleted one:\r\n\r\n- Check which utxo buckets should be refilled:\r\n  - Initialize a `to_refill` list of `(bucket, target_quantity)`\r\n  - For each utxo bucket:\r\n    - If the feerate is low (below a to-be-defined threshold) and the bucket is less than 70% full (or a to-be-defined threshold that could be configurable):\r\n      - Add this bucket to `to_refill` with a `target_quantity` of `target_utxo_count - current_utxo_count` (when feerate is low, we'd like to refill as much as possible)\r\n    - If the feerate is higher than our threshold and the bucket is less than 30% full (or a to-be-defined threshold that could be configurable), we refill less aggressively:\r\n      - Add this bucket to `to_refill` with a `target_quantity` that we scale (somehow) based on feerate and how many utxos we're missing\r\n  - Order `to_refill` by `target_quantity`, descending (we'll want to refill the buckets that are missing the most utxos first)\r\n- Check the utxos that we have outside of our buckets: we ideally want to spend those utxos to refill our buckets. We have no guarantee that those are the ones that will be used by the coin selection, but we can use their total amount as the maximum amount of funds we allocate to refill our buckets. This part is a bit fuzzy for me right now, I'm not sure this is the best approach, it definitely deserves more thoughts.\r\n  - Iterate over those utxos and add their amount to obtain `utxos_outside_buckets_total_amount`\r\n- Compute the change target based on `to_refill` and `utxos_outside_buckets_total_amount`:\r\n  - Initialize `change_target` to `0`\r\n  - Iterate over `to_refill`, and for each bucket that needs to be refilled:\r\n    - Decide how much of the `target_quantity` we want to refill based on `utxos_outside_buckets_total_amount` and the current `change_target`\r\n    - Add the corresponding amount to `change_target`\r\n    - That step probably has a lot of issues as well and deserves more thought. If we have a lot of utxos outside of our buckets, we may end up targeting a very large change amount and thus create a huge transaction, which is generally undesirable, but maybe desirable when our buckets are close to being empty. Maybe it makes sense to bound the `change_target` to a (small) multiplier of the funding amount? Or have a very different behavior when the feerate is very low, because when that happens we may want to fully refill our buckets?\r\n\r\nAs you can see, this is still very early discussion on what the algorithm should look like. It feels like we're still trying to understand the pitfalls we want to avoid we should try to write the algorithm in pseudo-code first in order to converge on an initial version (maybe to be detailed and discussed in a delving bitcoin post).\r\n\r\nAlso, when we don't want to actively refill buckets, we should target a changeless transaction, I'm not sure that is done right now?",
      "created_at": "2024-02-21T15:47:29Z",
      "updated_at": "2024-02-21T15:55:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#discussion_r1497820248",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497820248"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 846,
      "original_line": 846,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497828903",
      "pull_request_review_id": 1893495240,
      "id": 1497828903,
      "node_id": "PRRC_kwDOABII585ZRw4n",
      "diff_hunk": "@@ -799,6 +815,83 @@ util::Result<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& av\n     return op_selection_result;\n }\n \n+/** Returns UTXO targets and compute their current count from available coins */\n+std::vector<UtxoTarget> UtxoTargetsFromJson(const UniValue& utxo_targets_json, const CoinsResult& available_coins)\n+{\n+    std::vector<UtxoTarget> utxo_targets;\n+    for (const auto& bucket : utxo_targets_json.getValues()) {\n+        UtxoTarget target = {\n+            bucket[\"start_satoshis\"].getInt<CAmount>(),\n+            bucket[\"end_satoshis\"].getInt<CAmount>(),\n+            bucket[\"target_utxo_count\"].getInt<uint32_t>()};\n+        utxo_targets.push_back(target);\n+    }\n+    for (const auto& [type, outputs] : available_coins.coins) {\n+        for (const wallet::COutput& output : outputs) {\n+            for (UtxoTarget& target : utxo_targets) {\n+                if (output.txout.nValue >= target.start_satoshis && output.txout.nValue <= target.end_satoshis) {\n+                    target.current_utxo_count++;\n+                    break;\n+                }\n+            }\n+        }\n+    }\n+\n+    return utxo_targets;\n+}\n+\n+/** Returns a random change amount in the range of the most depleted Utxo bucket and sets `capacity`\n+ * to the capacity of that change target, if any.\n+ */\n+std::optional<CAmount> GenerateChangeTargetFromUtxoTargets(const std::vector<UtxoTarget>& utxo_targets, const CAmount change_fee, double& capacity, FastRandomContext& rng)\n+{\n+    // Refill the most depleted utxo targets first.\n+    auto target_iter = std::min_element(utxo_targets.begin(), utxo_targets.end(), [](const UtxoTarget& a, const UtxoTarget& b) {\n+        return (double(a.current_utxo_count) / a.target_utxo_count) < (double(b.current_utxo_count) / b.target_utxo_count);\n+    });\n+    std::optional<CAmount> change_target;\n+    if (target_iter != utxo_targets.end()) {\n+        // Adjust the range of the target bucket based on the current fee rate.\n+        change_target = rng.randrange(target_iter->end_satoshis - target_iter->start_satoshis - change_fee) + target_iter->start_satoshis + change_fee;\n+        capacity = double(target_iter->current_utxo_count) / target_iter->target_utxo_count;\n+    }\n+    return change_target;\n+}\n+\n+std::list<CTxOut> SplitChangeFromUtxoTargets(CAmount change_amount, std::vector<UtxoTarget> utxo_targets, CAmount change_target, const CAmount change_fee, FastRandomContext& rng, CScript script_change)",
      "path": "src/wallet/spend.cpp",
      "position": 84,
      "original_position": 84,
      "commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "original_commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "in_reply_to_id": null,
      "user": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm wondering whether we should use a fully deterministic algorithm to split the change into buckets, I'm afraid this is exactly the kind of algorithm that may end up in a loop where one funding attempt does something, and the next one undoes it. It feels like adding randomization may be the simple way to avoid this? But maybe it's too early in the algorithm design phase to decide.",
      "created_at": "2024-02-21T15:52:42Z",
      "updated_at": "2024-02-21T15:55:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#discussion_r1497828903",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1497828903"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 861,
      "original_line": 861,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500540279",
      "pull_request_review_id": 1897914077,
      "id": 1500540279,
      "node_id": "PRRC_kwDOABII585ZcG13",
      "diff_hunk": "@@ -1128,6 +1225,36 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         available_coins = AvailableCoins(wallet, &coin_control, coin_selection_params.m_effective_feerate);\n     }\n \n+    // Load a json file that describes a target utxo set",
      "path": "src/wallet/spend.cpp",
      "position": 138,
      "original_position": 138,
      "commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "original_commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "in_reply_to_id": 1497769911,
      "user": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That makes sense. I also think a static file could describe the buckets in a way that better adapts to a changing fee environment.\r\n\r\nFor example, rather than `start_satoshis` and `end_satoshi` we could define a bucket as:\r\n\r\n```json\r\n        \"confirmation_target\": 6,\r\n        \"fee_rate_std\": 10000, \r\n        \"buckets\": [\r\n        {\r\n            \"target_satoshis\": 10000,\r\n            \"target_utxo_count\": 150\r\n        },\r\n```\r\n\r\nThe range of values you want to spend should be \"target_satoshis\" + the fee to spend that input at a fee rate that will confirm in \"confirmation_target\" blocks. Because free rates vary, we randomize the current fee rate within a range +/- \"fee_rate_std\".\r\n\r\nTo refill a bucket, compute the `target_output` as:\r\n```\r\ntarget_feerate = current_feerate(\"confirmation_target\") + random(-1 * \"fee_rate_std\", \"fee_rate_std\")\r\ntarget_output = \"target_satoshis\" + size_of_input * target_feerate \r\n``` \r\nIdeally we would only need to restart when we add/remove buckets, change their counts or when fee variance changes dramatically.\r\n",
      "created_at": "2024-02-23T11:33:13Z",
      "updated_at": "2024-02-23T11:33:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#discussion_r1500540279",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500540279"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1228,
      "original_line": 1228,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500904878",
      "pull_request_review_id": 1898503321,
      "id": 1500904878,
      "node_id": "PRRC_kwDOABII585Zdf2u",
      "diff_hunk": "@@ -799,6 +815,83 @@ util::Result<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& av\n     return op_selection_result;\n }\n \n+/** Returns UTXO targets and compute their current count from available coins */\n+std::vector<UtxoTarget> UtxoTargetsFromJson(const UniValue& utxo_targets_json, const CoinsResult& available_coins)\n+{\n+    std::vector<UtxoTarget> utxo_targets;\n+    for (const auto& bucket : utxo_targets_json.getValues()) {\n+        UtxoTarget target = {\n+            bucket[\"start_satoshis\"].getInt<CAmount>(),\n+            bucket[\"end_satoshis\"].getInt<CAmount>(),\n+            bucket[\"target_utxo_count\"].getInt<uint32_t>()};\n+        utxo_targets.push_back(target);\n+    }\n+    for (const auto& [type, outputs] : available_coins.coins) {\n+        for (const wallet::COutput& output : outputs) {\n+            for (UtxoTarget& target : utxo_targets) {\n+                if (output.txout.nValue >= target.start_satoshis && output.txout.nValue <= target.end_satoshis) {\n+                    target.current_utxo_count++;\n+                    break;\n+                }\n+            }\n+        }\n+    }\n+\n+    return utxo_targets;\n+}\n+\n+/** Returns a random change amount in the range of the most depleted Utxo bucket and sets `capacity`\n+ * to the capacity of that change target, if any.\n+ */\n+std::optional<CAmount> GenerateChangeTargetFromUtxoTargets(const std::vector<UtxoTarget>& utxo_targets, const CAmount change_fee, double& capacity, FastRandomContext& rng)",
      "path": "src/wallet/spend.cpp",
      "position": 69,
      "original_position": 69,
      "commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "original_commit_id": "85a049ddceb854106efea8316462e356d9b88b21",
      "in_reply_to_id": 1497820248,
      "user": {
        "login": "remyers",
        "id": 8568892,
        "node_id": "MDQ6VXNlcjg1Njg4OTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/remyers",
        "html_url": "https://github.com/remyers",
        "followers_url": "https://api.github.com/users/remyers/followers",
        "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
        "organizations_url": "https://api.github.com/users/remyers/orgs",
        "repos_url": "https://api.github.com/users/remyers/repos",
        "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/remyers/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it is unavoidable that refilling buckets cannibalizes utxos from other buckets unless there is a pool of utxos larger than the largest target bucket to pick from. The goal though is that in the long run the system wastes as little value from fees and over payment as possible in aggregate.\r\n\r\nThis is how I think the process as implemented currently ([85a049d](https://github.com/bitcoin/bitcoin/pull/29442/commits/85a049ddceb854106efea8316462e356d9b88b21)) should work: \r\n\r\nBecause we always set our minimum change value to be *at least* as large as one of our target buckets that is depleted,  all of the wallet utxos are either in the range of one of our target buckets or larger than one of our target buckets.\r\n\r\nA changeless BnB solution is found when:\r\n1) there is a single utxo in the corresponding target bucket that does not overpay by too much in fees\r\n2) a combination of multiple utxos smaller than the target bucket exist that do not overpay by too much in fees\r\n\r\nA CoinGrinder solution is preferred when the cost of fees and over payment of the best BnB solution is more than the fees from using:\r\n1) a single larger utxo with change outputs \r\n2) a combination of multiple smaller utxos and change outputs\r\n\r\nThe largest wallet utxo will hold the residual value after initially refilling the buckets from cold storage. This residual funding utxo will be used as a single input when:\r\n1) this utxo is available and CoinGrinder selects it to refill buckets opportunistically \r\n2) fees are low, or buckets are severely depleted, we force this input to be selected to refill buckets. \r\n\r\nWhen a large residual value utxo is used to refill all buckets via change outputs, another large residual utxo may also be created. That residual value utxo can not be used again until the tx that uses it confirms. This seems like an area that can be optimized. Perhaps a separate automatic refill transaction that confirms quickly makes more sense than using it for opportunistic bucket refills.\r\n\r\nEventually the largest utxo in the wallet will be in the range of the target buckets. The utxo set will then no longer be able to refill buckets without also depleting other buckets. This should be a signal to refill the wallet from cold storage.",
      "created_at": "2024-02-23T16:30:06Z",
      "updated_at": "2024-02-23T16:30:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29442#discussion_r1500904878",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1500904878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 846,
      "original_line": 846,
      "side": "RIGHT"
    }
  ]
}