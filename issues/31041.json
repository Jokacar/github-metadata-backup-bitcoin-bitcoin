{
  "type": "issue",
  "issue": {
    "id": 2568806811,
    "node_id": "I_kwDOABII586ZHOGb",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31041",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31041/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31041/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31041/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31041",
    "number": 31041,
    "state": "open",
    "state_reason": null,
    "title": "Crash upon RPC v1 connection in v28.0.0",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nOn RPC v1 connection, after the block sync and mempool read is complete, a crash happens (see logs). I used mempool fork of electrs indexer which did an RPC request. \r\n\r\nOriginal report can be found here: https://github.com/bitcoin/bitcoin/issues/31039#issuecomment-2395525458\n\n### Expected behaviour\n\nNo crash is expected\n\n### Steps to reproduce\n\nRun Bitcoin Core (I used machine with 8 cores, and 4GB or 8GB of memory)\n\n### Relevant log output\n\n```\r\nOct 06 17:54:18 core bitcoind[16532]: 2024-10-06T17:54:18Z initload thread exit\r\nOct 06 17:55:43 core systemd[1]: bitcoind.service: A process of this unit has been killed by the OOM killer.\r\n░░ Subject: A process of bitcoind.service unit has been killed by the OOM killer.\r\n░░ Defined-By: systemd\r\n░░ Support: https://www.debian.org/support\r\n░░ \r\n░░ A process of unit @UNIT has been killed by the Linux kernel out-of-memory (OOM)\r\n░░ killer logic. This usually indicates that the system is low on memory and that\r\n░░ memory needed to be freed. A process associated with bitcoind.service has been determined\r\n░░ as the best process to terminate and has been forcibly terminated by the\r\n░░ kernel.\r\n░░ \r\n░░ Note that the memory pressure might or might not have been caused by bitcoind.service.\r\nOct 06 17:55:43 core systemd[1]: bitcoind.service: Main process exited, code=killed, status=9/KILL\r\n░░ Subject: Unit process exited\r\n░░ Defined-By: systemd\r\n░░ Support: https://www.debian.org/support\r\n░░ \r\n░░ An ExecStart= process belonging to unit bitcoind.service has exited.\r\n░░ \r\n░░ The process' exit code is 'killed' and its exit status is 9.\r\nOct 06 17:55:43 core systemd[1]: bitcoind.service: Failed with result 'oom-kill'.\r\n░░ Subject: Unit failed\r\n░░ Defined-By: systemd\r\n░░ Support: https://www.debian.org/support\r\n░░ \r\n░░ The unit bitcoind.service has entered the 'failed' state with result 'oom-kill'.\r\nOct 06 17:55:43 core systemd[1]: bitcoind.service: Consumed 3min 18.749s CPU time.\r\n░░ Subject: Resources consumed by unit runtime\r\n░░ Defined-By: systemd\r\n░░ Support: https://www.debian.org/support\r\n░░ \r\n░░ The unit bitcoind.service completed and consumed the indicated resources.\r\nOct 06 17:55:43 core systemd[1]: bitcoind.service: Scheduled restart job, restart counter is at 1.\r\n░░ Subject: Automatic restarting of a unit has been scheduled\r\n░░ Defined-By: systemd\r\n░░ Support: https://www.debian.org/support\r\n░░ \r\n░░ Automatic restarting of the unit bitcoind.service has been scheduled, as the result for\r\n```\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nv28.0.0\n\n### Operating system and version\n\nDebian Bookworm\n\n### Machine specifications\n\n8 CPUs; 4GB RAM",
    "user": {
      "login": "dr-orlovsky",
      "id": 372034,
      "node_id": "MDQ6VXNlcjM3MjAzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/372034?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dr-orlovsky",
      "html_url": "https://github.com/dr-orlovsky",
      "followers_url": "https://api.github.com/users/dr-orlovsky/followers",
      "following_url": "https://api.github.com/users/dr-orlovsky/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dr-orlovsky/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dr-orlovsky/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dr-orlovsky/subscriptions",
      "organizations_url": "https://api.github.com/users/dr-orlovsky/orgs",
      "repos_url": "https://api.github.com/users/dr-orlovsky/repos",
      "events_url": "https://api.github.com/users/dr-orlovsky/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dr-orlovsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "created_at": "2024-10-06T18:14:42Z",
    "updated_at": "2024-10-06T18:24:08Z"
  },
  "events": [
    {
      "event": "renamed",
      "id": 14531206090,
      "node_id": "RTE_lADOABII586ZHOGbzwAAAANiIJvK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14531206090",
      "actor": {
        "login": "dr-orlovsky",
        "id": 372034,
        "node_id": "MDQ6VXNlcjM3MjAzNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/372034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dr-orlovsky",
        "html_url": "https://github.com/dr-orlovsky",
        "followers_url": "https://api.github.com/users/dr-orlovsky/followers",
        "following_url": "https://api.github.com/users/dr-orlovsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dr-orlovsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dr-orlovsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dr-orlovsky/subscriptions",
        "organizations_url": "https://api.github.com/users/dr-orlovsky/orgs",
        "repos_url": "https://api.github.com/users/dr-orlovsky/repos",
        "events_url": "https://api.github.com/users/dr-orlovsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dr-orlovsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-06T18:16:03Z",
      "rename": {
        "from": "Crash due to inadequate memory allocation request upon RPC v1 connection in v28.0.0",
        "to": "Crash upon RPC v1 connection in v28.0.0"
      }
    },
    {
      "event": "commented",
      "id": 2395534798,
      "node_id": "IC_kwDOABII586OyPXO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2395534798",
      "actor": {
        "login": "dr-orlovsky",
        "id": 372034,
        "node_id": "MDQ6VXNlcjM3MjAzNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/372034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dr-orlovsky",
        "html_url": "https://github.com/dr-orlovsky",
        "followers_url": "https://api.github.com/users/dr-orlovsky/followers",
        "following_url": "https://api.github.com/users/dr-orlovsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dr-orlovsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dr-orlovsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dr-orlovsky/subscriptions",
        "organizations_url": "https://api.github.com/users/dr-orlovsky/orgs",
        "repos_url": "https://api.github.com/users/dr-orlovsky/repos",
        "events_url": "https://api.github.com/users/dr-orlovsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dr-orlovsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-06T18:24:07Z",
      "updated_at": "2024-10-06T18:24:07Z",
      "author_association": "NONE",
      "body": "With the increase in memory to 8GB the crash has disappeared.",
      "user": {
        "login": "dr-orlovsky",
        "id": 372034,
        "node_id": "MDQ6VXNlcjM3MjAzNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/372034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dr-orlovsky",
        "html_url": "https://github.com/dr-orlovsky",
        "followers_url": "https://api.github.com/users/dr-orlovsky/followers",
        "following_url": "https://api.github.com/users/dr-orlovsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dr-orlovsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dr-orlovsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dr-orlovsky/subscriptions",
        "organizations_url": "https://api.github.com/users/dr-orlovsky/orgs",
        "repos_url": "https://api.github.com/users/dr-orlovsky/repos",
        "events_url": "https://api.github.com/users/dr-orlovsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dr-orlovsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31041#issuecomment-2395534798",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31041"
    }
  ]
}