{
  "type": "issue",
  "issue": {
    "id": 2167545008,
    "node_id": "I_kwDOABII586BMhyw",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29559",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29559/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29559/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29559/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29559",
    "number": 29559,
    "state": "open",
    "state_reason": null,
    "title": "bitcoin-wallet requires write permissions when unneeded",
    "body": "### Is there an existing issue for this?\r\n\r\n- [x] I have searched the existing issues\r\n\r\n### Current behaviour\r\n\r\nI have some wallets that are write protected and want to use `bitcoin-wallet info` and `bitcoin-wallet dump` but am unable to do so because these commands require write permission.\r\n\r\n```text\r\n$ bitcoin-wallet -datadir=. -wallet=wallet-name -dumpfile=wallet.dump dump\r\nSQLiteDatabase: Database opened in readonly mode but read-write permissions are needed\r\n$ bitcoin-wallet -datadir=. -wallet=wallet-name info                     \r\nSQLiteDatabase: Database opened in readonly mode but read-write permissions are needed\r\n```\r\n\r\n### Expected behaviour\r\n\r\nI would expect commands that are not intended to change the wallet to only require read permissions and be able to work on wallet directories and files that are read only.\r\n\r\nThis will also stop mistakes from corrupting the database.\r\n\r\n### Steps to reproduce\r\n\r\n```sh\r\nchmod -R a-w <wallet-directory>\r\nbitcoin-wallet -datadir=<wallet-directory> -wallet=<wallet-name> -dumpfile=wallet.dump dump\r\nbitcoin-wallet -datadir=<wallet-directory> -wallet=<wallet-name> info\r\n```\r\n\r\n### Relevant log output\r\n\r\n_No response_\r\n\r\n### How did you obtain Bitcoin Core\r\n\r\nPackage manager\r\n\r\n### What version of Bitcoin Core are you using?\r\n\r\nv25.0.0\r\n\r\n### Operating system and version\r\n\r\nOpenBSD 7.4 Stable\r\n\r\n### Machine specifications\r\n\r\n_No response_",
    "user": {
      "login": "BebeSparkelSparkel",
      "id": 10747532,
      "node_id": "MDQ6VXNlcjEwNzQ3NTMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/10747532?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BebeSparkelSparkel",
      "html_url": "https://github.com/BebeSparkelSparkel",
      "followers_url": "https://api.github.com/users/BebeSparkelSparkel/followers",
      "following_url": "https://api.github.com/users/BebeSparkelSparkel/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/BebeSparkelSparkel/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/BebeSparkelSparkel/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/BebeSparkelSparkel/subscriptions",
      "organizations_url": "https://api.github.com/users/BebeSparkelSparkel/orgs",
      "repos_url": "https://api.github.com/users/BebeSparkelSparkel/repos",
      "events_url": "https://api.github.com/users/BebeSparkelSparkel/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/BebeSparkelSparkel/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "created_at": "2024-03-04T19:04:30Z",
    "updated_at": "2024-03-04T20:14:42Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1977378151,
      "node_id": "IC_kwDOABII58513GVn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1977378151",
      "actor": {
        "login": "BebeSparkelSparkel",
        "id": 10747532,
        "node_id": "MDQ6VXNlcjEwNzQ3NTMy",
        "avatar_url": "https://avatars.githubusercontent.com/u/10747532?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BebeSparkelSparkel",
        "html_url": "https://github.com/BebeSparkelSparkel",
        "followers_url": "https://api.github.com/users/BebeSparkelSparkel/followers",
        "following_url": "https://api.github.com/users/BebeSparkelSparkel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BebeSparkelSparkel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BebeSparkelSparkel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BebeSparkelSparkel/subscriptions",
        "organizations_url": "https://api.github.com/users/BebeSparkelSparkel/orgs",
        "repos_url": "https://api.github.com/users/BebeSparkelSparkel/repos",
        "events_url": "https://api.github.com/users/BebeSparkelSparkel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BebeSparkelSparkel/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-04T20:14:16Z",
      "updated_at": "2024-03-04T20:14:42Z",
      "author_association": "NONE",
      "body": "Seems like this should solve it\r\n\r\n- `struct DatabaseOptions` in `src/wallet/db.h` needs a `writePermission` field of type `bool` with a default value of `false`\r\n- the method `Open` of class`SQLiteDatabase` in `src/wallet/sqlite.h` needs a flag argument of type `Int` added\r\n- the `SQLiteDatabase` constructor in `src/wallet/sqlite.cpp` needs to pass the flag `SQLITE_OPEN_READONLY` if `options.writePermission` is false else flag `SQLITE_OPEN_READWRITE`\r\n- in `src/wallet/wallettool.cpp` when `command ==` create, salvage, or createfromdump then `options.writePermission = true;`",
      "user": {
        "login": "BebeSparkelSparkel",
        "id": 10747532,
        "node_id": "MDQ6VXNlcjEwNzQ3NTMy",
        "avatar_url": "https://avatars.githubusercontent.com/u/10747532?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BebeSparkelSparkel",
        "html_url": "https://github.com/BebeSparkelSparkel",
        "followers_url": "https://api.github.com/users/BebeSparkelSparkel/followers",
        "following_url": "https://api.github.com/users/BebeSparkelSparkel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/BebeSparkelSparkel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/BebeSparkelSparkel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/BebeSparkelSparkel/subscriptions",
        "organizations_url": "https://api.github.com/users/BebeSparkelSparkel/orgs",
        "repos_url": "https://api.github.com/users/BebeSparkelSparkel/repos",
        "events_url": "https://api.github.com/users/BebeSparkelSparkel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/BebeSparkelSparkel/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29559#issuecomment-1977378151",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29559"
    }
  ]
}