{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005",
    "id": 1847691447,
    "node_id": "PR_kwDOABII585uIYi3",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30005",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30005.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30005.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/4395a42c5df14e211ca78405f599a2ed24466334",
    "number": 30005,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "[PoC, nomerge] IPv6 PCP pinhole test",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The overarching goal here is to increase the number of connectable nodes that are not in the big datacenters.\r\n\r\n**Context:** IPv6 doesn't have NAT. Computers behind a router tend to get a globally routable address. However, by default this address is usually completely firewalled for incoming connections, as a security measure. See issue #17012.\r\n\r\nThis is where \"pinholing\" comes in. By sending a request, a machine on the network can request a port to be opened. This is similar to requesting a port forward for IPv4 but simpler.\r\n\r\nThis PR implements the so-called PCP (Port Control Protocol) from [RFC6887](https://datatracker.ietf.org/doc/html/rfc6887). This is a simple UDP based protocol with fixed-size packets, so is safe to possibly even enable by default. Much simpler than UPnP which also has commands to open a pinhole, but relies on SSDP, HTTP, and XML parsing (and miniupnpc has had serious RCEs in the past). This implementation is self-contained, no external dependency is added.\r\n\r\nBefore integrating it into Bitcoin Core i would first like to investigate whether this implementation is correct and whether routers support it.  So this adds a binary, `ipv6-pinhole-test`, which:\r\n\r\n- Enumerates local publicly routable IPv6 addresses\r\n- Gets the default gateway to get the PCP endpoint\r\n- Requests pinholes for 100 seconds to port 1234 on all addreses, and prints the result.\r\n\r\ni've tested this on two routers myself--Turris Omnia and Fritz!Box, where it worked. Please help testing, by just running it behind the router of your choice!\r\n\r\nFor now, this is for Linux only. Implementing it for other platforms requires implementing a way to get the default route. i'll get to this later.\r\n\r\nBe careful with publicly posting the full output of this program-it will contain your IP address information.\r\n\r\n[skip ci]",
    "labels": [
      {
        "id": 234878,
        "node_id": "MDU6TGFiZWwyMzQ4Nzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Linux/Unix",
        "name": "Linux/Unix",
        "color": "770000",
        "default": false
      },
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2024-04-30T11:35:27Z",
    "updated_at": "2024-05-02T12:45:04Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "433435bc5bd4163e3e817223b434b23d4b2e375c",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "laanwj:2024-04-pcp-pinhole-test",
      "ref": "2024-04-pcp-pinhole-test",
      "sha": "4395a42c5df14e211ca78405f599a2ed24466334",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 1750308,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNzUwMzA4",
        "name": "bitcoin",
        "full_name": "laanwj/bitcoin",
        "owner": {
          "login": "laanwj",
          "id": 126646,
          "node_id": "MDQ6VXNlcjEyNjY0Ng==",
          "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/laanwj",
          "html_url": "https://github.com/laanwj",
          "followers_url": "https://api.github.com/users/laanwj/followers",
          "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
          "organizations_url": "https://api.github.com/users/laanwj/orgs",
          "repos_url": "https://api.github.com/users/laanwj/repos",
          "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/laanwj/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/laanwj/bitcoin",
        "description": "Laanwj's Bitcoin Core fork - see README.md on \"readme\" branch",
        "fork": true,
        "url": "https://api.github.com/repos/laanwj/bitcoin",
        "archive_url": "https://api.github.com/repos/laanwj/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/laanwj/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/laanwj/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/laanwj/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/laanwj/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/laanwj/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/laanwj/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/laanwj/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/laanwj/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/laanwj/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/laanwj/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/laanwj/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/laanwj/bitcoin/events",
        "forks_url": "https://api.github.com/repos/laanwj/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/laanwj/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/laanwj/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/laanwj/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/laanwj/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/laanwj/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/laanwj/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/laanwj/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/laanwj/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/laanwj/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/laanwj/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/laanwj/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/laanwj/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/laanwj/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/laanwj/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/laanwj/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:laanwj/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/laanwj/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/laanwj/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/laanwj/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/laanwj/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/laanwj/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/laanwj/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/laanwj/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/laanwj/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/laanwj/bitcoin/hooks",
        "svn_url": "https://github.com/laanwj/bitcoin",
        "homepage": "",
        "forks_count": 14,
        "stargazers_count": 43,
        "watchers_count": 43,
        "size": 230438,
        "default_branch": "readme",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-05-02T11:59:11Z",
        "created_at": "2011-05-15T07:09:54Z",
        "updated_at": "2023-10-20T10:27:51Z"
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "15f696b454047f5dafc3c95e36fcd677c1901de9",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35332,
        "stargazers_count": 76120,
        "watchers_count": 76120,
        "size": 258115,
        "default_branch": "master",
        "open_issues_count": 692,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-05-02T12:58:45Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-05-02T12:58:54Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 339,
    "deletions": 2,
    "changed_files": 4,
    "commits": 12,
    "review_comments": 9,
    "comments": 6
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkwYzBkZDA3NjU4YzU2N2MxMjAyZGZiNWU3M2E2YzA3MWYxNzEwNWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/90c0dd07658c567c1202dfb5e73a6c071f17105d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/90c0dd07658c567c1202dfb5e73a6c071f17105d",
      "tree": {
        "sha": "0d4f00ac83bac2e58b818fc9ef8e8d6d387e0021",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0d4f00ac83bac2e58b818fc9ef8e8d6d387e0021"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3aaf7328eb656b642e5f0f74f3e4d51645a1d0ab",
          "sha": "3aaf7328eb656b642e5f0f74f3e4d51645a1d0ab",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3aaf7328eb656b642e5f0f74f3e4d51645a1d0ab"
        }
      ],
      "message": "crypto: Add missing WriteBE16 function",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-28T19:39:20Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-28T19:39:20Z"
      },
      "sha": "90c0dd07658c567c1202dfb5e73a6c071f17105d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFhMjg2ZjUwZmVjNDQ1NjYwNzAyM2Y5MDcwNDA0MzA5NWQ0MmU3NTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa286f50fec4456607023f90704043095d42e751",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aa286f50fec4456607023f90704043095d42e751",
      "tree": {
        "sha": "2952f2f0c9cc1081c73a0ab1030694296b5f2af1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2952f2f0c9cc1081c73a0ab1030694296b5f2af1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/90c0dd07658c567c1202dfb5e73a6c071f17105d",
          "sha": "90c0dd07658c567c1202dfb5e73a6c071f17105d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/90c0dd07658c567c1202dfb5e73a6c071f17105d"
        }
      ],
      "message": "util: Allow overriding base for ToIntegral\n\nStill default to 10, of course. Need this for parsing a hexadecimal integer.",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T09:02:25Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-28T20:46:27Z"
      },
      "sha": "aa286f50fec4456607023f90704043095d42e751"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM0MThmMmIwNWIyYzJkMWRkNzQwY2MzYjgxMTI1MGY4NDhiMzdmYjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c418f2b05b2c2d1dd740cc3b811250f848b37fb1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c418f2b05b2c2d1dd740cc3b811250f848b37fb1",
      "tree": {
        "sha": "e5e5529ddf0863ec36a7bde5d0a32306f0310868",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e5e5529ddf0863ec36a7bde5d0a32306f0310868"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa286f50fec4456607023f90704043095d42e751",
          "sha": "aa286f50fec4456607023f90704043095d42e751",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/aa286f50fec4456607023f90704043095d42e751"
        }
      ],
      "message": "PoC PCP",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T09:02:39Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-28T19:40:17Z"
      },
      "sha": "c418f2b05b2c2d1dd740cc3b811250f848b37fb1"
    },
    {
      "event": "labeled",
      "id": 12656548480,
      "node_id": "LE_lADOABII586HYBVkzwAAAALyY5qA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12656548480",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T11:35:27Z",
      "label": {
        "name": "Linux/Unix",
        "color": "770000"
      }
    },
    {
      "event": "labeled",
      "id": 12656548485,
      "node_id": "LE_lADOABII586HYBVkzwAAAALyY5qF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12656548485",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T11:35:27Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 2085061946,
      "node_id": "IC_kwDOABII5858R4U6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2085061946",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T11:35:30Z",
      "updated_at": "2024-05-02T12:45:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30005).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/30005#pullrequestreview-2035221223) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#issuecomment-2085061946",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005"
    },
    {
      "event": "labeled",
      "id": 12656549968,
      "node_id": "LE_lADOABII586HYBVkzwAAAALyY6BQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12656549968",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T11:35:34Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM5NTkzZjhlZmU5MzVjMjlmYWUwODFkNWZjZjc2Mjc4ZjBkM2FlOTc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/39593f8efe935c29fae081d5fcf76278f0d3ae97",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/39593f8efe935c29fae081d5fcf76278f0d3ae97",
      "tree": {
        "sha": "8c38787e19a693bd8a21f2e88222d859d549eb7f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8c38787e19a693bd8a21f2e88222d859d549eb7f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c418f2b05b2c2d1dd740cc3b811250f848b37fb1",
          "sha": "c418f2b05b2c2d1dd740cc3b811250f848b37fb1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c418f2b05b2c2d1dd740cc3b811250f848b37fb1"
        }
      ],
      "message": "GetLocalAddresses function",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T11:36:28Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T10:49:08Z"
      },
      "sha": "39593f8efe935c29fae081d5fcf76278f0d3ae97"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12656563478,
      "node_id": "HRFPE_lADOABII586HYBVkzwAAAALyY9UW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12656563478",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T11:36:38Z"
    },
    {
      "event": "review_requested",
      "id": 12656720235,
      "node_id": "RRE_lADOABII586HYBVkzwAAAALyZjlr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12656720235",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T11:48:22Z",
      "requested_reviewer": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 2085177069,
      "node_id": "IC_kwDOABII5858SUbt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2085177069",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T12:18:26Z",
      "updated_at": "2024-04-30T12:18:26Z",
      "author_association": "MEMBER",
      "body": "Tried with a router running OPNsense:\r\n\r\n```\r\n2024-04-30T12:16:13Z [net:debug] pcp6: gateway: ...\r\n2024-04-30T12:16:13Z [net:warning] pcp6: Opening pinhole for addr: ...\r\n2024-04-30T12:16:14Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:14Z [net:debug] pcp6: Retrying (1)\r\n2024-04-30T12:16:15Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:15Z [net:debug] pcp6: Retrying (2)\r\n2024-04-30T12:16:16Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:16Z [net:debug] pcp6: Giving up after 3 tries\r\n2024-04-30T12:16:16Z [net:warning] pcp6: Opening pinhole for addr: ...\r\n2024-04-30T12:16:17Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:17Z [net:debug] pcp6: Retrying (1)\r\n2024-04-30T12:16:18Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:18Z [net:debug] pcp6: Retrying (2)\r\n2024-04-30T12:16:19Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:19Z [net:debug] pcp6: Giving up after 3 tries\r\n2024-04-30T12:16:19Z [net:warning] pcp6: Opening pinhole for addr: ...\r\n2024-04-30T12:16:20Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:20Z [net:debug] pcp6: Retrying (1)\r\n2024-04-30T12:16:21Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:21Z [net:debug] pcp6: Retrying (2)\r\n2024-04-30T12:16:22Z [net:debug] pcp6: Timeout\r\n2024-04-30T12:16:22Z [net:debug] pcp6: Giving up after 3 tries\r\n```\r\n\r\nI probably have to actively turn on some permission.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#issuecomment-2085177069",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005"
    },
    {
      "event": "commented",
      "id": 2085190180,
      "node_id": "IC_kwDOABII5858SXok",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2085190180",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T12:23:15Z",
      "updated_at": "2024-04-30T12:56:32Z",
      "author_association": "MEMBER",
      "body": "It may be some router setting to enable it, the more secure routers have these kind of protocols disabled by default. Or maybe it doesn't support it. There isn't any reply, not even 2  NOT_AUTHORIZED (but nice to see the retry code is working 😄 ).",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#issuecomment-2085190180",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005"
    },
    {
      "event": "commented",
      "id": 2085298601,
      "node_id": "IC_kwDOABII5858SyGp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2085298601",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T13:10:11Z",
      "updated_at": "2024-04-30T13:10:27Z",
      "author_association": "MEMBER",
      "body": "Unfortunately I'm not able to find any documentation for this.\r\n\r\nThere is a UPnP plugin, but that's not what you're using (and probably best left uninstalled).\r\n\r\nAnyway, people who run OPNsense will now how to manually forward a port, so that's not really the target demographic here.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#issuecomment-2085298601",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005"
    },
    {
      "event": "commented",
      "id": 2086638251,
      "node_id": "IC_kwDOABII5858X5Kr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2086638251",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T19:02:34Z",
      "updated_at": "2024-04-30T20:48:08Z",
      "author_association": "MEMBER",
      "body": ">There is a UPnP plugin, but that's not what you're using (and probably best left uninstalled).\r\n\r\nYea, according to [this list](https://github.com/opnsense/plugins/tree/master), UPnP and PCP is the same plugin. It could be that they can be turned on and off seperately in the plugin configuration (it's similar for OpenWRT). The most well-known open source implementation of a PCP server is... ironically, [miniupnpd](https://github.com/miniupnp/miniupnp/blob/master/miniupnpd/pcpserver.c).",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#issuecomment-2086638251",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU1MzQyZmM4MDI3MGI0NTJlNTVhMjI1MTc4NTRjMmIwNDAyOTE4NzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55342fc80270b452e55a22517854c2b040291875",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/55342fc80270b452e55a22517854c2b040291875",
      "tree": {
        "sha": "0ed1dbe4baac5c22b1f0c33ddf7526a2bfb6e89c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0ed1dbe4baac5c22b1f0c33ddf7526a2bfb6e89c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/39593f8efe935c29fae081d5fcf76278f0d3ae97",
          "sha": "39593f8efe935c29fae081d5fcf76278f0d3ae97",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/39593f8efe935c29fae081d5fcf76278f0d3ae97"
        }
      ],
      "message": "fixup: comments and clarifications",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T20:10:31Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T11:54:43Z"
      },
      "sha": "55342fc80270b452e55a22517854c2b040291875"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYzMjUxMzdhMmQzNDkyMWIzZTQ3ZTUyOWQ2MGZkN2MyMmViNDQyZjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6325137a2d34921b3e47e529d60fd7c22eb442f5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6325137a2d34921b3e47e529d60fd7c22eb442f5",
      "tree": {
        "sha": "20e04cfd34feca4abb400137a7a85b8f356d45d4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/20e04cfd34feca4abb400137a7a85b8f356d45d4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55342fc80270b452e55a22517854c2b040291875",
          "sha": "55342fc80270b452e55a22517854c2b040291875",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/55342fc80270b452e55a22517854c2b040291875"
        }
      ],
      "message": "fixup: comments and clarifications",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:00:10Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T20:23:29Z"
      },
      "sha": "6325137a2d34921b3e47e529d60fd7c22eb442f5"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEzN2NjOGU1Nzc4NjY0ZjA2NzdjMTlmYjgxMjdjMjBlMzhhY2MzNzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a37cc8e5778664f0677c19fb8127c20e38acc374",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a37cc8e5778664f0677c19fb8127c20e38acc374",
      "tree": {
        "sha": "a7399c56039e949e0334fa1796149159fba62484",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a7399c56039e949e0334fa1796149159fba62484"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6325137a2d34921b3e47e529d60fd7c22eb442f5",
          "sha": "6325137a2d34921b3e47e529d60fd7c22eb442f5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6325137a2d34921b3e47e529d60fd7c22eb442f5"
        }
      ],
      "message": "fixup: check protocol and internal port in response",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:24:23Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:11:51Z"
      },
      "sha": "a37cc8e5778664f0677c19fb8127c20e38acc374"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE3ZjliNTVjYzI5NmFiMzJjMmU1MDk3MGM2ODQxZmI3ZTI2Yzg2N2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a7f9b55cc296ab32c2e50970c6841fb7e26c867f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a7f9b55cc296ab32c2e50970c6841fb7e26c867f",
      "tree": {
        "sha": "b213257edb48c0104b9e6b903ae0199e1cac195d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b213257edb48c0104b9e6b903ae0199e1cac195d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a37cc8e5778664f0677c19fb8127c20e38acc374",
          "sha": "a37cc8e5778664f0677c19fb8127c20e38acc374",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a37cc8e5778664f0677c19fb8127c20e38acc374"
        }
      ],
      "message": "fixup: Check assigned external port and addr",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:24:27Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:17:11Z"
      },
      "sha": "a7f9b55cc296ab32c2e50970c6841fb7e26c867f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYwM2Y3ODQwNzIzYmFkNGZiZTdlMDA5Y2NjMzUwMDVhYTNlODM5MTI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f03f7840723bad4fbe7e009ccc35005aa3e83912",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f03f7840723bad4fbe7e009ccc35005aa3e83912",
      "tree": {
        "sha": "8049d3ac50884e639946be02647e05a8f4bef0f8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8049d3ac50884e639946be02647e05a8f4bef0f8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a7f9b55cc296ab32c2e50970c6841fb7e26c867f",
          "sha": "a7f9b55cc296ab32c2e50970c6841fb7e26c867f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a7f9b55cc296ab32c2e50970c6841fb7e26c867f"
        }
      ],
      "message": "fixup: clarifications and comments",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:26:45Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:26:45Z"
      },
      "sha": "f03f7840723bad4fbe7e009ccc35005aa3e83912"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZiNDk5ZjU1NWUwYzU1OWZiNTk1ZmJjN2IzNzVhYTYzMmQ4NjM1ZWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fb499f555e0c559fb595fbc7b375aa632d8635ed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fb499f555e0c559fb595fbc7b375aa632d8635ed",
      "tree": {
        "sha": "3bc83cdf27034746efc0d49030e295a8efe4ed84",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3bc83cdf27034746efc0d49030e295a8efe4ed84"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f03f7840723bad4fbe7e009ccc35005aa3e83912",
          "sha": "f03f7840723bad4fbe7e009ccc35005aa3e83912",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f03f7840723bad4fbe7e009ccc35005aa3e83912"
        }
      ],
      "message": "fixup: use ADDR_IPV6_SIZE constant",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:52:41Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-04-30T21:52:02Z"
      },
      "sha": "fb499f555e0c559fb595fbc7b375aa632d8635ed"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA3MDg1ODkyZTFmMTk4ZmI2Y2I4OTU5YjJjZjAxMDZjMzNlMDM4NjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/07085892e1f198fb6cb8959b2cf0106c33e03865",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/07085892e1f198fb6cb8959b2cf0106c33e03865",
      "tree": {
        "sha": "1bf9ca9bbff3b278b937176e00734bd0c0f4717d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1bf9ca9bbff3b278b937176e00734bd0c0f4717d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fb499f555e0c559fb595fbc7b375aa632d8635ed",
          "sha": "fb499f555e0c559fb595fbc7b375aa632d8635ed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fb499f555e0c559fb595fbc7b375aa632d8635ed"
        }
      ],
      "message": "fixup: Comments",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-05-01T05:51:03Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-05-01T05:51:03Z"
      },
      "sha": "07085892e1f198fb6cb8959b2cf0106c33e03865"
    },
    {
      "event": "commented",
      "id": 2089935185,
      "node_id": "IC_kwDOABII5858keFR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2089935185",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T08:53:26Z",
      "updated_at": "2024-05-02T09:09:38Z",
      "author_association": "MEMBER",
      "body": "Ah, that's confusing. The OPNsense is indeed just [MiniUPnPd](https://miniupnp.tuxfamily.org/) and described as \"Universal Plug and Play (UPnP IGD & PCP/NAT-PMP) Service\", in other words: all the things :-)\r\n\r\nIt lets you choose what to enable, in this case I selected \"PCP/NAT-PMP Port Mapping\".\r\n\r\nNow your utility is happy.\r\n\r\nOn Ubuntu I additionally had to do `sudo ufw allow 1234` though for the nc connection to succeed (ufw is disabled by default on new systems).\r\n\r\nI tested that the machine was indeed reachable from the outside world (and that it no longer is after 120 seconds, existing connections are preserved).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#issuecomment-2089935185",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30005"
    },
    {
      "event": "unsubscribed",
      "id": 12679873301,
      "node_id": "UE_lADOABII586HYBVkzwAAAALzx4MV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12679873301",
      "actor": {
        "login": "ArturRomanchenko",
        "id": 149331842,
        "node_id": "U_kgDOCOafgg",
        "avatar_url": "https://avatars.githubusercontent.com/u/149331842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ArturRomanchenko",
        "html_url": "https://github.com/ArturRomanchenko",
        "followers_url": "https://api.github.com/users/ArturRomanchenko/followers",
        "following_url": "https://api.github.com/users/ArturRomanchenko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ArturRomanchenko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ArturRomanchenko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ArturRomanchenko/subscriptions",
        "organizations_url": "https://api.github.com/users/ArturRomanchenko/orgs",
        "repos_url": "https://api.github.com/users/ArturRomanchenko/repos",
        "events_url": "https://api.github.com/users/ArturRomanchenko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ArturRomanchenko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T09:08:53Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQzOTVhNDJjNWRmMTRlMjExY2E3ODQwNWY1OTlhMmVkMjQ0NjYzMzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4395a42c5df14e211ca78405f599a2ed24466334",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4395a42c5df14e211ca78405f599a2ed24466334",
      "tree": {
        "sha": "e72ef6015b28cfbedadfe198626fa19832436c06",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e72ef6015b28cfbedadfe198626fa19832436c06"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/07085892e1f198fb6cb8959b2cf0106c33e03865",
          "sha": "07085892e1f198fb6cb8959b2cf0106c33e03865",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/07085892e1f198fb6cb8959b2cf0106c33e03865"
        }
      ],
      "message": "fixup: comment spelling",
      "committer": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-05-02T11:54:04Z"
      },
      "author": {
        "name": "laanwj",
        "email": "126646+laanwj@users.noreply.github.com",
        "date": "2024-05-02T11:53:47Z"
      },
      "sha": "4395a42c5df14e211ca78405f599a2ed24466334"
    },
    {
      "event": "reviewed",
      "id": 2035221223,
      "node_id": "PRR_kwDOABII5855TwLn",
      "url": null,
      "actor": null,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK. RFC 6887 is quite readable and simple for a client to support.\r\n\r\nIPv6 always returns multiple addresses. I'm not sure what the logic behind that is, but should we gossiping and pinholing all of them? Or is one \"supposed\" to be used?\r\n\r\nWhy not also use PCP for IPv4 NAT? If it's widely supported enough, maybe it lets us drop both upnp and natpmp from the dependencies (immediately or at some point in the future if there's actually a problem with them).\r\n\r\nThis appears to be trivial:\r\n\r\n> When the address field holds an IPv4 address, an IPv4-mapped IPv6 address RFC4291 is used (::ffff:0:0/96).\r\n\r\nOne nice feature of PCP is that it gives us the external IP(v4) address.  We could use that in lieu of / in addition to asking our peers for it. But note that section [11.6](https://datatracker.ietf.org/doc/html/rfc6887#section-11.6) recommends against doing this without _also_ requesting a port forward / pinhole.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#pullrequestreview-2035221223",
      "submitted_at": "2024-05-02T12:45:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587310888",
      "pull_request_review_id": 2035221223,
      "id": 1587310888,
      "node_id": "PRRC_kwDOABII585enHEo",
      "diff_hunk": "@@ -801,6 +801,15 @@ bitcoind_CXXFLAGS = $(bitcoin_bin_cxxflags)\n bitcoind_LDFLAGS = $(bitcoin_bin_ldflags)\n bitcoind_LDADD = $(LIBBITCOIN_NODE) $(bitcoin_bin_ldadd)\n \n+#################################################################\n+bin_PROGRAMS += ipv6-pinhole-test",
      "path": "src/Makefile.am",
      "position": 5,
      "original_position": 5,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "fb499f555e0c559fb595fbc7b375aa632d8635ed",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You could make this a permanent debugging utility by adding it to `bitcoin-util`.",
      "created_at": "2024-05-02T09:08:05Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587310888",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587310888"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 805,
      "original_line": 805,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587412293",
      "pull_request_review_id": 2035221223,
      "id": 1587412293,
      "node_id": "PRRC_kwDOABII585enf1F",
      "diff_hunk": "@@ -0,0 +1,321 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see secion 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see secion 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see secion 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)\n+{\n+    LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Opening pinhole for addr: %s\\n\", CNetAddr(my_addr).ToStringAddr());\n+\n+    // Create IPv6 UDP socket.\n+    SOCKET sock_fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP);\n+    if (sock_fd == INVALID_SOCKET) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not create IPv6 UDP socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+    Sock sock(sock_fd);\n+\n+    // Make sure that we send from requested address, anything else will be\n+    // rejected by a security-conscious router.\n+    sockaddr_in6 bind_addr = {};\n+    bind_addr.sin6_family = AF_INET6;\n+    bind_addr.sin6_addr = my_addr;\n+    if (sock.Bind((struct sockaddr*)&bind_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to address: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    sockaddr_in6 dest_addr = gateway;\n+    dest_addr.sin6_port = htons(PCP_SERVER_PORT);\n+    if (sock.Connect((struct sockaddr*)&dest_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to connect to gateway: %s\\n\", NetworkErrorString(WSAGetLastError()));",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 117,
      "original_position": 117,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "fb499f555e0c559fb595fbc7b375aa632d8635ed",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Did you mean `pcp6: Could not connect to gateway`?",
      "created_at": "2024-05-02T10:35:41Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587412293",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587412293"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 117,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587415945",
      "pull_request_review_id": 2035221223,
      "id": 1587415945,
      "node_id": "PRRC_kwDOABII585enguJ",
      "diff_hunk": "@@ -0,0 +1,321 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see secion 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see secion 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see secion 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)\n+{\n+    LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Opening pinhole for addr: %s\\n\", CNetAddr(my_addr).ToStringAddr());\n+\n+    // Create IPv6 UDP socket.\n+    SOCKET sock_fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP);",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 97,
      "original_position": 97,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "fb499f555e0c559fb595fbc7b375aa632d8635ed",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "See also the mockackable sockets introduced by @vasild in #26812, which - if this goes beyond just PoC - can be used to test how we handle the various failure modes. ",
      "created_at": "2024-05-02T10:39:23Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587415945",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587415945"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 97,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587530201",
      "pull_request_review_id": 2035221223,
      "id": 1587530201,
      "node_id": "PRRC_kwDOABII585en8nZ",
      "diff_hunk": "@@ -0,0 +1,321 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 36,
      "original_position": 36,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "fb499f555e0c559fb595fbc7b375aa632d8635ed",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "To make it easier to understand that 0x80 refers to R, which happens to be the most significant bit of second byte of the message, and 0x01 is the actual Opcode:\r\n\r\n```h\r\n// PCP Request Header. See section 7.1\r\nconstexpr uint8_t PCP_REQUEST = 0x00; // R = 0\r\n// PCP Response Header. See section 7.2\r\nconstexpr uint8_t PCP_RESPONSE = 0x80; // R = 1\r\n//! Map opcode. See section 19.2\r\nconstexpr uint8_t PCP_OP_MAP = 0x01;\r\n//! Map request opcode.\r\nconstexpr uint8_t PCP_OP_MAP_REQUEST = PCP_REQUEST | PCP_OP_MAP;\r\n//! Map response opcode.\r\nconstexpr uint8_t PCP_OP_MAP_RESPONSE = PCP_RESPONSE | PCP_OP_MAP;\r\n```",
      "created_at": "2024-05-02T12:09:49Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587530201",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587530201"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 36,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587540017",
      "pull_request_review_id": 2035221223,
      "id": 1587540017,
      "node_id": "PRRC_kwDOABII585en_Ax",
      "diff_hunk": "@@ -0,0 +1,322 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see section 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see section 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see section 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)\n+{\n+    LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Opening pinhole for addr: %s\\n\", CNetAddr(my_addr).ToStringAddr());\n+\n+    // Create IPv6 UDP socket.\n+    SOCKET sock_fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP);\n+    if (sock_fd == INVALID_SOCKET) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not create IPv6 UDP socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+    Sock sock(sock_fd);\n+\n+    // Make sure that we send from requested address, anything else will be\n+    // rejected by a security-conscious router.\n+    sockaddr_in6 bind_addr = {};\n+    bind_addr.sin6_family = AF_INET6;\n+    bind_addr.sin6_addr = my_addr;\n+    if (sock.Bind((struct sockaddr*)&bind_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to address: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    sockaddr_in6 dest_addr = gateway;\n+    dest_addr.sin6_port = htons(PCP_SERVER_PORT);\n+    if (sock.Connect((struct sockaddr*)&dest_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to connect to gateway: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    // Build request packet. Make sure the packet is zeroed so that reserved fields are zero\n+    // as required by the spec (and not potentially leak data).\n+    // Make sure there's space for the request header, MAP specific request\n+    // data, and one option header.\n+    uint8_t request[PCP_REQUEST_HDR_SIZE + PCP_MAP_REQUEST_SIZE + PCP_OPTION_HDR_SIZE] = {};\n+    // Fill in request header, See Figure 2.\n+    size_t ofs = 0;\n+    request[ofs + 0] = PCP_VERSION;\n+    request[ofs + 1] = PCP_OP_MAP_REQUEST;\n+    WriteBE32(request + ofs + 4, lifetime);\n+    memcpy(request + ofs + 8, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_REQUEST_HDR_SIZE;\n+\n+    // Fill in MAP request packet, See Figure 9.\n+    // Randomize mapping nonce (this is repeated in the response, to be able to\n+    // correlate requests and responses, and used to authenticate changes to the mapping).\n+    // TODO: remember this value when periodically renewing a mapping.\n+    GetRandBytes(Span(request + ofs + 0, PCP_MAP_NONCE_SIZE));\n+    request[ofs + 12] = PCP_PROTOCOL_TCP;\n+    WriteBE16(request + ofs + 16, port);\n+    WriteBE16(request + ofs + 18, port);\n+    memcpy(request + ofs + 20, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_MAP_REQUEST_SIZE;\n+\n+    // Fill in option header. See Figure 4.\n+    // Prefer failure to a different external address mapping than we expect.\n+    request[ofs] = PCP_OPTION_PREFER_FAILURE;\n+\n+    ofs += PCP_OPTION_HDR_SIZE;\n+\n+    // UDP is a potentially lossy protocol, so we try to send again a few times.\n+    bool got_response = false;\n+    uint8_t response[PCP_MAX_SIZE];\n+    for (int ntry = 0; !got_response && ntry < num_tries; ++ntry) {\n+        if (ntry > 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Retrying (%d)\\n\", ntry);\n+        }\n+        // Dispatch packet to gateway.\n+        if (sock.Send(request, ofs, 0) != static_cast<ssize_t>(ofs)) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not send request: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+            return false; // Network-level error, probably no use retrying.\n+        }\n+\n+        // Wait for response(s) until we get a valid response, a network error, or time out.\n+        while (true) {\n+            Sock::Event occured = 0;\n+            if (!sock.Wait(std::chrono::milliseconds(1000), Sock::RECV, &occured)) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not wait on socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+                return false; // Network-level error, probably no use retrying.\n+            }\n+            if (!occured) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Timeout\\n\");\n+                break; // Retry.\n+            }\n+\n+            // Receive response.\n+            int recvsz = sock.Recv(response, sizeof(response), MSG_DONTWAIT);\n+            if (recvsz < 0) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not receive response: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+                return false; // Network-level error, probably no use retrying.\n+            }\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Received response of %d bytes: %s\\n\", recvsz, HexStr(Span(response, recvsz)));\n+            if (static_cast<size_t>(recvsz) < (PCP_RESPONSE_HDR_SIZE + PCP_MAP_RESPONSE_SIZE)) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Response too small\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            if (response[0] != PCP_VERSION || response[1] != PCP_OP_MAP_RESPONSE) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Response to wrong command\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            // Handle MAP opcode response. See Figure 10.\n+            // Check that returned mapping nonce matches our request.\n+            if (memcmp(response + PCP_RESPONSE_HDR_SIZE, request + PCP_REQUEST_HDR_SIZE, PCP_MAP_NONCE_SIZE) != 0) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Mapping nonce mismatch\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            uint8_t protocol = response[PCP_RESPONSE_HDR_SIZE + 12];\n+            uint16_t internal_port = ReadBE16(response + PCP_RESPONSE_HDR_SIZE + 16);\n+            if (protocol != PCP_PROTOCOL_TCP || internal_port != port) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Response protocol or port doesn't match request\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            got_response = true; // Got expected response, break from receive loop as well as from retry loop.\n+            break;\n+        }\n+    }\n+    if (!got_response) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Giving up after %d tries\\n\", num_tries);\n+        return false;\n+    }\n+    // If we get here, we got a valid MAP response to our request.\n+    // Check to see if we got the result we expected.\n+    int result_code = response[3];\n+    uint32_t lifetime_ret = ReadBE32(response + 4);\n+    uint16_t external_port = ReadBE16(response + PCP_RESPONSE_HDR_SIZE + 18);\n+    struct in6_addr external_addr;\n+    memcpy(&external_addr, response + PCP_RESPONSE_HDR_SIZE + 20, ADDR_IPV6_SIZE);\n+    if (result_code != PCP_RESULT_SUCCESS) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Mapping failed with result code %d\\n\", result_code);",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 221,
      "original_position": 221,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In a real implementation we should log the meaning of each result code, if known. Especially `UNSUPP_OPTION` and `CANNOT_PROVIDE_EXTERNAL` seems useful to know about.",
      "created_at": "2024-05-02T12:18:15Z",
      "updated_at": "2024-05-02T12:48:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587540017",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587540017"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 221,
      "original_line": 221,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587549683",
      "pull_request_review_id": 2035221223,
      "id": 1587549683,
      "node_id": "PRRC_kwDOABII585eoBXz",
      "diff_hunk": "@@ -0,0 +1,322 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see section 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see section 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see section 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)\n+{\n+    LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Opening pinhole for addr: %s\\n\", CNetAddr(my_addr).ToStringAddr());\n+\n+    // Create IPv6 UDP socket.\n+    SOCKET sock_fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP);\n+    if (sock_fd == INVALID_SOCKET) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not create IPv6 UDP socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+    Sock sock(sock_fd);\n+\n+    // Make sure that we send from requested address, anything else will be\n+    // rejected by a security-conscious router.\n+    sockaddr_in6 bind_addr = {};\n+    bind_addr.sin6_family = AF_INET6;\n+    bind_addr.sin6_addr = my_addr;\n+    if (sock.Bind((struct sockaddr*)&bind_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to address: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    sockaddr_in6 dest_addr = gateway;\n+    dest_addr.sin6_port = htons(PCP_SERVER_PORT);\n+    if (sock.Connect((struct sockaddr*)&dest_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to connect to gateway: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    // Build request packet. Make sure the packet is zeroed so that reserved fields are zero\n+    // as required by the spec (and not potentially leak data).\n+    // Make sure there's space for the request header, MAP specific request\n+    // data, and one option header.\n+    uint8_t request[PCP_REQUEST_HDR_SIZE + PCP_MAP_REQUEST_SIZE + PCP_OPTION_HDR_SIZE] = {};\n+    // Fill in request header, See Figure 2.\n+    size_t ofs = 0;\n+    request[ofs + 0] = PCP_VERSION;\n+    request[ofs + 1] = PCP_OP_MAP_REQUEST;\n+    WriteBE32(request + ofs + 4, lifetime);\n+    memcpy(request + ofs + 8, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_REQUEST_HDR_SIZE;\n+\n+    // Fill in MAP request packet, See Figure 9.\n+    // Randomize mapping nonce (this is repeated in the response, to be able to\n+    // correlate requests and responses, and used to authenticate changes to the mapping).\n+    // TODO: remember this value when periodically renewing a mapping.\n+    GetRandBytes(Span(request + ofs + 0, PCP_MAP_NONCE_SIZE));\n+    request[ofs + 12] = PCP_PROTOCOL_TCP;\n+    WriteBE16(request + ofs + 16, port);\n+    WriteBE16(request + ofs + 18, port);\n+    memcpy(request + ofs + 20, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_MAP_REQUEST_SIZE;\n+\n+    // Fill in option header. See Figure 4.\n+    // Prefer failure to a different external address mapping than we expect.\n+    request[ofs] = PCP_OPTION_PREFER_FAILURE;",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 149,
      "original_position": 149,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We should explicitly set that we want this option to be mandatory (if we do indeed care that much):\r\n\r\n> Its most significant bit indicates if this\r\n> option is mandatory (0) or optional (1) to process.",
      "created_at": "2024-05-02T12:26:35Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587549683",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587549683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587555746",
      "pull_request_review_id": 2035221223,
      "id": 1587555746,
      "node_id": "PRRC_kwDOABII585eoC2i",
      "diff_hunk": "@@ -0,0 +1,322 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see section 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see section 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see section 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)\n+{\n+    LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Opening pinhole for addr: %s\\n\", CNetAddr(my_addr).ToStringAddr());\n+\n+    // Create IPv6 UDP socket.\n+    SOCKET sock_fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP);\n+    if (sock_fd == INVALID_SOCKET) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not create IPv6 UDP socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+    Sock sock(sock_fd);\n+\n+    // Make sure that we send from requested address, anything else will be\n+    // rejected by a security-conscious router.\n+    sockaddr_in6 bind_addr = {};\n+    bind_addr.sin6_family = AF_INET6;\n+    bind_addr.sin6_addr = my_addr;\n+    if (sock.Bind((struct sockaddr*)&bind_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to address: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    sockaddr_in6 dest_addr = gateway;\n+    dest_addr.sin6_port = htons(PCP_SERVER_PORT);\n+    if (sock.Connect((struct sockaddr*)&dest_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to connect to gateway: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    // Build request packet. Make sure the packet is zeroed so that reserved fields are zero\n+    // as required by the spec (and not potentially leak data).\n+    // Make sure there's space for the request header, MAP specific request\n+    // data, and one option header.\n+    uint8_t request[PCP_REQUEST_HDR_SIZE + PCP_MAP_REQUEST_SIZE + PCP_OPTION_HDR_SIZE] = {};\n+    // Fill in request header, See Figure 2.\n+    size_t ofs = 0;\n+    request[ofs + 0] = PCP_VERSION;\n+    request[ofs + 1] = PCP_OP_MAP_REQUEST;\n+    WriteBE32(request + ofs + 4, lifetime);\n+    memcpy(request + ofs + 8, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_REQUEST_HDR_SIZE;\n+\n+    // Fill in MAP request packet, See Figure 9.\n+    // Randomize mapping nonce (this is repeated in the response, to be able to\n+    // correlate requests and responses, and used to authenticate changes to the mapping).\n+    // TODO: remember this value when periodically renewing a mapping.\n+    GetRandBytes(Span(request + ofs + 0, PCP_MAP_NONCE_SIZE));\n+    request[ofs + 12] = PCP_PROTOCOL_TCP;\n+    WriteBE16(request + ofs + 16, port);\n+    WriteBE16(request + ofs + 18, port);\n+    memcpy(request + ofs + 20, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_MAP_REQUEST_SIZE;\n+\n+    // Fill in option header. See Figure 4.\n+    // Prefer failure to a different external address mapping than we expect.\n+    request[ofs] = PCP_OPTION_PREFER_FAILURE;\n+\n+    ofs += PCP_OPTION_HDR_SIZE;",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 151,
      "original_position": 151,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So this has the effect of expanding the message by 4 bytes, where we set the first byte to `PCP_OPTION_PREFER_FAILURE` and the rest to zero (since there's no option data)?",
      "created_at": "2024-05-02T12:30:18Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587555746",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587555746"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587560006",
      "pull_request_review_id": 2035221223,
      "id": 1587560006,
      "node_id": "PRRC_kwDOABII585eoD5G",
      "diff_hunk": "@@ -0,0 +1,322 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see section 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see section 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see section 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 92,
      "original_position": 92,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "IIUC this might as well be called `RequestPortMap`, with the clarification that this boils down to a pinhole for IPv6.",
      "created_at": "2024-05-02T12:33:29Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587560006",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587560006"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 92,
      "original_line": 92,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587569941",
      "pull_request_review_id": 2035221223,
      "id": 1587569941,
      "node_id": "PRRC_kwDOABII585eoGUV",
      "diff_hunk": "@@ -0,0 +1,322 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <util/readwritefile.h>\n+#include <util/sock.h>\n+#include <util/strencodings.h>\n+#include <util/translation.h> // Remove this\n+\n+#include <linux/route.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr; // Remove this\n+\n+// RFC 6887 Port Control Protocol (PCP) implementation.\n+// PCP uses network byte order (big-endian).\n+// References to sections and figures in the code below refer to https://datatracker.ietf.org/doc/html/rfc6887.\n+\n+// Protocol constants.\n+//! Maximum packet size in bytes (see section 7).\n+constexpr size_t PCP_MAX_SIZE = 1100;\n+//! PCP uses a fixed server port number (see section 19.1).\n+constexpr uint16_t PCP_SERVER_PORT = 5351;\n+//! Version byte. 0 is NAT-PMP, 1 is forbidden, 2 for PCP RFC-6887.\n+constexpr uint8_t PCP_VERSION = 2;\n+//! Map request opcode. See sections 19.2, 7.1.\n+constexpr uint8_t PCP_OP_MAP_REQUEST = 0x01;\n+//! Map response opcode. See sections 19.2, 7.2.\n+constexpr uint8_t PCP_OP_MAP_RESPONSE = 0x01 | 0x80;\n+//! TCP protocol number (IANA).\n+constexpr uint16_t PCP_PROTOCOL_TCP = 6;\n+//! Option: prefer failure to half-functional mapping. See section 13.2.\n+constexpr uint8_t PCP_OPTION_PREFER_FAILURE = 2;\n+//! Request header size in bytes (see section 7.1).\n+constexpr size_t PCP_REQUEST_HDR_SIZE = 24;\n+//! Response header size in bytes (see section 7.2).\n+constexpr size_t PCP_RESPONSE_HDR_SIZE = 24;\n+//! Option header size in bytes (see section 7.2).\n+constexpr size_t PCP_OPTION_HDR_SIZE = 4;\n+//! Map request size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_REQUEST_SIZE = 36;\n+//! Map response size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_RESPONSE_SIZE = 36;\n+//! Mapping nonce size in bytes (see section 11.1).\n+constexpr size_t PCP_MAP_NONCE_SIZE = 12;\n+//! Result code representing SUCCESS status (7.4).\n+constexpr uint8_t PCP_RESULT_SUCCESS = 0;\n+\n+//! Find IPv6 default gateway.\n+std::optional<sockaddr_in6> FindIPv6DefaultGateway()\n+{\n+    const auto& [read_ok, data] = ReadBinaryFile(\"/proc/net/ipv6_route\");\n+    if (!read_ok) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not read /proc/net/ipv6_route to find default IPv6 gateway\\n\");\n+        return std::nullopt;\n+    }\n+    // 149 length (longer if interface name is longer)\n+    // destination                      prefix                                 nexthop                                                     flags     iface\n+    // 00000000000000000000000000000000 00 00000000000000000000000000000000 00 fe80000000000000da58d7fffe0077cd 00000064 00000007 00000000 00000003     eth0\n+    for(std::string &line: SplitString(data, \"\\n\")) {\n+        if (line.size() < 149) continue;\n+        const std::optional<std::vector<uint8_t>> nexthop(TryParseHex<uint8_t>(line.substr(72, 32)));\n+        const std::optional<uint8_t> prefix(ToIntegral<uint8_t>(line.substr(33,  2), ADDR_IPV6_SIZE));\n+        const std::optional<uint32_t> flags(ToIntegral<uint32_t>(line.substr(132,  8), ADDR_IPV6_SIZE));\n+        const std::string iface(TrimString(line.substr(141)));\n+        if (!prefix || !nexthop | !flags || nexthop->size() != ADDR_IPV6_SIZE || iface.empty()) continue; // Parse error\n+        if (prefix.value() != 0 || (flags.value() & (RTF_GATEWAY | RTF_UP)) != (RTF_GATEWAY | RTF_UP)) continue; // Not default gw\n+        // Look up scope id for interface name string.\n+        int gateway_scope_id = if_nametoindex(iface.c_str());\n+        if (gateway_scope_id <= 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not parse gateway interface %s\\n\", iface.c_str());\n+            return std::nullopt;\n+        }\n+\n+        sockaddr_in6 dest_addr = {};\n+        dest_addr.sin6_family = AF_INET6;\n+        memcpy(&dest_addr.sin6_addr, nexthop->data(), ADDR_IPV6_SIZE);\n+        dest_addr.sin6_scope_id = gateway_scope_id;\n+        return dest_addr;\n+    }\n+    return std::nullopt;\n+}\n+\n+//! Try to open a IPv6 pinhole port using RFC 6887 Port Control Protocol (PCP).\n+bool OpenPinhole(const sockaddr_in6 &gateway, const struct in6_addr &my_addr, uint16_t port, uint32_t lifetime, int num_tries = 3)\n+{\n+    LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Opening pinhole for addr: %s\\n\", CNetAddr(my_addr).ToStringAddr());\n+\n+    // Create IPv6 UDP socket.\n+    SOCKET sock_fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP);\n+    if (sock_fd == INVALID_SOCKET) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not create IPv6 UDP socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+    Sock sock(sock_fd);\n+\n+    // Make sure that we send from requested address, anything else will be\n+    // rejected by a security-conscious router.\n+    sockaddr_in6 bind_addr = {};\n+    bind_addr.sin6_family = AF_INET6;\n+    bind_addr.sin6_addr = my_addr;\n+    if (sock.Bind((struct sockaddr*)&bind_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to address: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    sockaddr_in6 dest_addr = gateway;\n+    dest_addr.sin6_port = htons(PCP_SERVER_PORT);\n+    if (sock.Connect((struct sockaddr*)&dest_addr, sizeof(sockaddr_in6)) != 0) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not bind to connect to gateway: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    // Build request packet. Make sure the packet is zeroed so that reserved fields are zero\n+    // as required by the spec (and not potentially leak data).\n+    // Make sure there's space for the request header, MAP specific request\n+    // data, and one option header.\n+    uint8_t request[PCP_REQUEST_HDR_SIZE + PCP_MAP_REQUEST_SIZE + PCP_OPTION_HDR_SIZE] = {};\n+    // Fill in request header, See Figure 2.\n+    size_t ofs = 0;\n+    request[ofs + 0] = PCP_VERSION;\n+    request[ofs + 1] = PCP_OP_MAP_REQUEST;\n+    WriteBE32(request + ofs + 4, lifetime);\n+    memcpy(request + ofs + 8, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_REQUEST_HDR_SIZE;\n+\n+    // Fill in MAP request packet, See Figure 9.\n+    // Randomize mapping nonce (this is repeated in the response, to be able to\n+    // correlate requests and responses, and used to authenticate changes to the mapping).\n+    // TODO: remember this value when periodically renewing a mapping.\n+    GetRandBytes(Span(request + ofs + 0, PCP_MAP_NONCE_SIZE));\n+    request[ofs + 12] = PCP_PROTOCOL_TCP;\n+    WriteBE16(request + ofs + 16, port);\n+    WriteBE16(request + ofs + 18, port);\n+    memcpy(request + ofs + 20, &my_addr, ADDR_IPV6_SIZE);\n+\n+    ofs += PCP_MAP_REQUEST_SIZE;\n+\n+    // Fill in option header. See Figure 4.\n+    // Prefer failure to a different external address mapping than we expect.\n+    request[ofs] = PCP_OPTION_PREFER_FAILURE;\n+\n+    ofs += PCP_OPTION_HDR_SIZE;\n+\n+    // UDP is a potentially lossy protocol, so we try to send again a few times.\n+    bool got_response = false;\n+    uint8_t response[PCP_MAX_SIZE];\n+    for (int ntry = 0; !got_response && ntry < num_tries; ++ntry) {\n+        if (ntry > 0) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Retrying (%d)\\n\", ntry);\n+        }\n+        // Dispatch packet to gateway.\n+        if (sock.Send(request, ofs, 0) != static_cast<ssize_t>(ofs)) {\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not send request: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+            return false; // Network-level error, probably no use retrying.\n+        }\n+\n+        // Wait for response(s) until we get a valid response, a network error, or time out.\n+        while (true) {\n+            Sock::Event occured = 0;\n+            if (!sock.Wait(std::chrono::milliseconds(1000), Sock::RECV, &occured)) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not wait on socket: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+                return false; // Network-level error, probably no use retrying.\n+            }\n+            if (!occured) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Timeout\\n\");\n+                break; // Retry.\n+            }\n+\n+            // Receive response.\n+            int recvsz = sock.Recv(response, sizeof(response), MSG_DONTWAIT);\n+            if (recvsz < 0) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Could not receive response: %s\\n\", NetworkErrorString(WSAGetLastError()));\n+                return false; // Network-level error, probably no use retrying.\n+            }\n+            LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Received response of %d bytes: %s\\n\", recvsz, HexStr(Span(response, recvsz)));\n+            if (static_cast<size_t>(recvsz) < (PCP_RESPONSE_HDR_SIZE + PCP_MAP_RESPONSE_SIZE)) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Response too small\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            if (response[0] != PCP_VERSION || response[1] != PCP_OP_MAP_RESPONSE) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Response to wrong command\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            // Handle MAP opcode response. See Figure 10.\n+            // Check that returned mapping nonce matches our request.\n+            if (memcmp(response + PCP_RESPONSE_HDR_SIZE, request + PCP_REQUEST_HDR_SIZE, PCP_MAP_NONCE_SIZE) != 0) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Mapping nonce mismatch\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            uint8_t protocol = response[PCP_RESPONSE_HDR_SIZE + 12];\n+            uint16_t internal_port = ReadBE16(response + PCP_RESPONSE_HDR_SIZE + 16);\n+            if (protocol != PCP_PROTOCOL_TCP || internal_port != port) {\n+                LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Response protocol or port doesn't match request\\n\");\n+                continue; // Wasn't response to what we expected, try receiving next packet.\n+            }\n+            got_response = true; // Got expected response, break from receive loop as well as from retry loop.\n+            break;\n+        }\n+    }\n+    if (!got_response) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Debug, \"pcp6: Giving up after %d tries\\n\", num_tries);\n+        return false;\n+    }\n+    // If we get here, we got a valid MAP response to our request.\n+    // Check to see if we got the result we expected.\n+    int result_code = response[3];\n+    uint32_t lifetime_ret = ReadBE32(response + 4);\n+    uint16_t external_port = ReadBE16(response + PCP_RESPONSE_HDR_SIZE + 18);\n+    struct in6_addr external_addr;\n+    memcpy(&external_addr, response + PCP_RESPONSE_HDR_SIZE + 20, ADDR_IPV6_SIZE);\n+    if (result_code != PCP_RESULT_SUCCESS) {\n+        LogPrintLevel(BCLog::NET, BCLog::Level::Warning, \"pcp6: Mapping failed with result code %d\\n\", result_code);\n+        return false;\n+    } else {\n+        // Mapping was successful. Just to be sure, check that the external port and address match what we expect.",
      "path": "src/ipv6-pinhole-test.cpp",
      "position": 224,
      "original_position": 224,
      "commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "original_commit_id": "4395a42c5df14e211ca78405f599a2ed24466334",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "For IPv4 we should print the external address regardless, since we had no expectation.",
      "created_at": "2024-05-02T12:41:15Z",
      "updated_at": "2024-05-02T12:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30005#discussion_r1587569941",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587569941"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30005"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 224,
      "original_line": 224,
      "side": "RIGHT"
    }
  ]
}