{
  "type": "issue",
  "issue": {
    "id": 1809513852,
    "node_id": "I_kwDOABII585r2v18",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28094",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28094/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28094/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28094/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/28094",
    "number": 28094,
    "state": "closed",
    "state_reason": "completed",
    "title": "failure in wallet_resendwallettransactions.py --legacy-wallet",
    "body": "https://cirrus-ci.com/task/5656433702731776?logs=ci#L7912 from #26288:\r\n```bash\r\n................................................................\r\n                                                                \r\n194/268 - wallet_resendwallettransactions.py --legacy-wallet failed, Duration: 111 s\r\nstdout:\r\n2023-07-17T21:30:03.351000Z TestFramework (INFO): PRNG seed is: 4625691275301666838\r\n2023-07-17T21:30:03.352000Z TestFramework (INFO): Initializing test directory /tmp/cirrus-ci-build/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20230717_204920/wallet_resendwallettransactions_69\r\n2023-07-17T21:30:18.443000Z TestFramework (INFO): Create a new transaction and wait until it's broadcast\r\n2023-07-17T21:30:22.728000Z TestFramework (INFO): Create a block\r\n2023-07-17T21:30:22.733000Z TestFramework (INFO): Bump time & check that transaction is rebroadcast\r\n2023-07-17T21:30:23.639000Z TestFramework (INFO): Chain of unconfirmed not-in-mempool txs are rebroadcast\r\n2023-07-17T21:31:23.811000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 131, in main\r\n    self.run_test()\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/wallet_resendwallettransactions.py\", line 116, in run_test\r\n    assert_raises_rpc_error(-5, \"Transaction not in mempool\", node.getmempoolentry, txid)\r\n  File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/test_framework/util.py\", line 131, in assert_raises_rpc_error\r\n    assert try_rpc(code, message, fun, *args, **kwds), \"No exception raised\"\r\nAssertionError: No exception raised\r\n2023-07-17T21:31:23.862000Z TestFramework (INFO): Stopping nodes\r\n2023-07-17T21:31:54.182000Z TestFramework (WARNING): Not cleaning up dir /tmp/cirrus-ci-build/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20230717_204920/wallet_resendwallettransactions_69\r\n2023-07-17T21:31:54.182000Z TestFramework (ERROR): Test failed. Test logging available at /tmp/cirrus-ci-build/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20230717_204920/wallet_resendwallettransactions_69/test_framework.log\r\n2023-07-17T21:31:54.182000Z TestFramework (ERROR): \r\n2023-07-17T21:31:54.183000Z TestFramework (ERROR): Hint: Call /tmp/cirrus-ci-build/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/combine_logs.py '/tmp/cirrus-ci-build/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20230717_204920/wallet_resendwallettransactions_69' to consolidate all logs\r\n2023-07-17T21:31:54.183000Z TestFramework (ERROR): \r\n2023-07-17T21:31:54.183000Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\r\n2023-07-17T21:31:54.183000Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\r\n2023-07-17T21:31:54.183000Z TestFramework (ERROR): \r\n```\r\n\r\nFull log: https://gist.github.com/fanquake/cb8e0dd478c6a63d448b4db4d29142c4.",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 0,
    "closed_at": "2023-07-20T15:39:41Z",
    "created_at": "2023-07-18T09:13:59Z",
    "updated_at": "2023-07-20T15:39:41Z"
  },
  "events": [
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-19T18:35:39Z",
      "updated_at": "2023-07-19T18:35:39Z",
      "source": {
        "issue": {
          "id": 1812510502,
          "node_id": "PR_kwDOABII585V7Dit",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28108",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28108/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28108/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28108/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28108",
          "number": 28108,
          "state": "closed",
          "state_reason": null,
          "title": "test: fix intermittent failure in wallet_resendwallettransactions.py",
          "body": "Fixes #28094\r\n\r\nThe test bumps the mocktime for ~2 weeks and then triggers eviction from the mempool. But this bump will also cause a new resubmit, and if the timing is such that this resubmit happens right after the eviction and before the check that the tx was evicted, the test can fail as in #28094:\r\n\r\n```\r\nnode0 2023-07-17T21:31:23.809483Z (mocktime: 2023-08-02T09:46:27Z) [httpworker.1] [validation.cpp:267] [LimitMempoolSize] [mempool] Expired 2 transactions from the memory pool\r\nnode0 2023-07-17T21:31:23.810079Z (mocktime: 2023-08-02T09:46:27Z) [scheduler] [wallet/wallet.h:895] [WalletLogPrintf] [default wallet] ResubmitWalletTransactions: resubmit 2 unconfirmed transactions\r\nnode0 2023-07-17T21:31:23.810474Z (mocktime: 2023-08-02T09:46:27Z) [httpworker.2] [rpc/request.cpp:181] [parse] [rpc] ThreadRPCServer method=getmempoolentry user=__cookie__ \r\n2023-07-17T21:31:23.811000Z TestFramework (ERROR): Assertion failed (...) AssertionError: No exception raised\r\n```\r\nFix this by flushing out the current resubmit call before triggering mempool eviction.",
          "user": {
            "login": "mzumsande",
            "id": 48763452,
            "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mzumsande",
            "html_url": "https://github.com/mzumsande",
            "followers_url": "https://api.github.com/users/mzumsande/followers",
            "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
            "organizations_url": "https://api.github.com/users/mzumsande/orgs",
            "repos_url": "https://api.github.com/users/mzumsande/repos",
            "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/mzumsande/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28108",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28108",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28108.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28108.patch"
          },
          "closed_at": "2023-07-20T15:39:42Z",
          "created_at": "2023-07-19T18:35:39Z",
          "updated_at": "2023-07-21T13:11:16Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "closed",
      "id": 9876191127,
      "node_id": "CE_lADOABII585r2v18zwAAAAJMqreX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9876191127",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b3022af0e25ad2f6a3abfb5ae5c91e4ecc3cdc52",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b3022af0e25ad2f6a3abfb5ae5c91e4ecc3cdc52",
      "created_at": "2023-07-20T15:39:42Z"
    },
    {
      "event": "referenced",
      "id": 9880507524,
      "node_id": "REFE_lADOABII585r2v18zwAAAAJM7JSE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9880507524",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "cfa97c3f8200d4c493bb9e72019c54d5e42f3477",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/cfa97c3f8200d4c493bb9e72019c54d5e42f3477",
      "created_at": "2023-07-21T01:05:41Z"
    }
  ]
}