{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611",
    "id": 2011069202,
    "node_id": "PR_kwDOABII58533nsS",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30611",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30611.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30611.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
    "number": 30611,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "validation: write chainstate to disk every hour",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Since #28233, periodically writing the chainstate to disk every 24 hours does not clear the dbcache. Since #28280, periodically writing the chainstate to disk is proportional only to the amount of dirty entries in the cache. Due to these changes, it is no longer beneficial to only write the chainstate to disk every 24 hours. The periodic flush interval was necessary because every write of the chainstate would clear the dbcache. Now, we can get rid of the periodic flush interval and simply write the chainstate along with blocks and block index at least every hour.\r\n\r\nTwo benefits of doing this:\r\n1. For IBD or reindex-chainstate with a combination of large dbcache setting, slow CPU, slow internet speed/unreliable peers, it could be up to 24 hours until the chainstate is persisted to disk. A power outage or crash could potentially lose up to 24 hours of progress, causing https://github.com/bitcoin/bitcoin/issues/11600. By syncing every hour in unison with the block index we avoid this problem entirely. For IBD with lower dbcache settings, faster CPU, or better internet speed/reliable peers, chainstate writes are already triggered more often than every hour so this change will have no effect on IBD.\r\n2. Based on discussion in #28280, writing only once every 24 hours during long running operation of a node causes IO spikes. Writing smaller chainstate changes every hour like we do with blocks and block index will reduce IO spikes.\r\n\r\nInspired by [this comment](https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-2121088705).\r\n\r\nResolves https://github.com/bitcoin/bitcoin/issues/11600",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "created_at": "2024-08-08T18:21:05Z",
    "updated_at": "2024-09-02T01:50:32Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "802d7478a5cc8ecb4be64ce258c0e722bcc73f1f",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:write-chainstate-every-hour",
      "ref": "write-chainstate-every-hour",
      "sha": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 247323,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-31T19:43:55Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b52d54736168bed82775e3c9e66c6320c7b83626",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35814,
        "stargazers_count": 77774,
        "watchers_count": 77774,
        "size": 267430,
        "default_branch": "master",
        "open_issues_count": 668,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-01T08:53:28Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-02T01:43:45Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 81,
    "deletions": 43,
    "changed_files": 4,
    "commits": 4,
    "review_comments": 4,
    "comments": 12
  },
  "events": [
    {
      "event": "commented",
      "id": 2276408912,
      "node_id": "IC_kwDOABII586Hrz5Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2276408912",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T18:21:08Z",
      "updated_at": "2024-09-01T15:19:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30611).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30610](https://github.com/bitcoin/bitcoin/pull/30610) (validation: do not wipe utxo cache for stats/scans/snapshots by sipa)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2276408912",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "labeled",
      "id": 13810695676,
      "node_id": "LE_lADOABII586SaWKgzwAAAAM3Ln38",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13810695676",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T18:21:10Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13810731181,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAAM3Lwit",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13810731181",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T18:24:53Z"
    },
    {
      "event": "commented",
      "id": 2276630980,
      "node_id": "IC_kwDOABII586HsqHE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2276630980",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-08T20:51:14Z",
      "updated_at": "2024-08-08T20:53:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Before someone suggests that it should do this every block,  a reason to not do this too much is that delaying writes prevents many writes from ever happening at all because many outputs are quickly spent.\r\n\r\nI don't see a particular problem for this, there will be some write traffic increase but I don't expect it will be enough to meaningfully reduce the life time of flash on cheap devices (and if that were a concern the default level of logging is probably more of an issue).  It's the sort of thing someone could test, however.\r\n\r\nSomeone might also want to test the latency impact (e.g. on block template creation) of the traversal.\r\n\r\nThough long term it would be preferable to introduce a data structure to track pending writes and keep a constantly flushing going which always lags the tip by N blocks, both avoiding the latency spikes and preventing unnecessary writes of entries that are just going to be spent in the next couple blocks.\r\n",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2276630980",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "reviewed",
      "id": 2230536256,
      "node_id": "PRR_kwDOABII586E80hA",
      "url": null,
      "actor": null,
      "commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Did you check if this would slow down IBD noticeably when running with a large dbcache?\r\nIf i understand it right, coins that are created and destroyed more than 1 hour of syncing apart would not have been written to disk before, but will be written and deleted after this PR - though presumably this is not a frequent event, so there wouldn't be much of an impact?!",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2230536256",
      "submitted_at": "2024-08-09T15:49:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "commented",
      "id": 2278349582,
      "node_id": "IC_kwDOABII586HzNsO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2278349582",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T16:47:34Z",
      "updated_at": "2024-08-09T16:47:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Before someone suggests that it should do this every block, a reason to not do this too much is that delaying writes prevents many writes from ever happening at all because many outputs are quickly spent.\r\n\r\n> If i understand it right, coins that are created and destroyed more than 1 hour of syncing apart would not have been written to disk before, but will be written and deleted after this PR\r\n\r\nCorrect, there will be significantly less utxo cut through with this PR.\r\n\r\n> I don't see a particular problem for this, there will be some write traffic increase but I don't expect it will be enough to meaningfully reduce the life time of flash on cheap devices (and if that were a concern the default level of logging is probably more of an issue). It's the sort of thing someone could test, however.\r\n\r\n> though presumably this is not a frequent event, so there wouldn't be much of an impact?!\r\n\r\nFor normal operation, this would mean writing 10s of MB every hour, vs 100s of MB every 24 hours. I don't think that we should be concerned about that increase in disk IO? Seems negligible to me.\r\n\r\n> Did you check if this would slow down IBD noticeably when running with a large dbcache?\r\n\r\nNot yet. I will run a reindex-chainstate benchmark with max dbcache and see what the impact is.\r\n\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2278349582",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2278726067,
      "node_id": "IC_kwDOABII586H0pmz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2278726067",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T20:40:11Z",
      "updated_at": "2024-08-09T20:41:50Z",
      "author_association": "MEMBER",
      "body": "It would be good to know what impact it has on IBD, as it's necessarily going to make things slower (more syncs means more disk writes, and more memory/cpu to remember UTXOs which must be marked spent on disk), for the benefit of reducing losses in case of crashes. The question is how much time & I/O it adds.\r\n\r\nRegarding doing it for every block (during steady state), the trade-off there is different but still exists. On the pro side there is a reduction of latency spikes instead of reducing crash losses (as these are inherently less relevant in steady state). On the con side there is an increase in frequency of writes (and the latency spikes they bring, albeit smaller ones) instead of a sync speed slowdown.\r\n\r\nWe don't necessarily need to use the same sync frequency during IBD and during steady state, but the effects during steady state seem harder to measure, so it's hard to say what is acceptable there.\r\n\r\nOne related idea: maybe we should randomize the sync event times a bit (say, uniformly random intervals between 50 and 70 minutes) to prevent a situation where the network over time settles into a few cohorts of synchronized syncers (think like communicating metronomes: they start randomly, but have synchronized events (blocks arriving) that slightly delay sync events if they were to coincide).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2278726067",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2278793149,
      "node_id": "IC_kwDOABII586H05-9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2278793149",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T21:44:31Z",
      "updated_at": "2024-08-09T21:44:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It would be good to know what impact it has on IBD, as it's necessarily going to make things slower\n\nNote that it is only necessarily slower when running with very high dbcache settings. For default settings the cache fills up and is flushed far more often than every hour, so this will have no effect.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2278793149",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2281899749,
      "node_id": "IC_kwDOABII586IAwbl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2281899749",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-10T13:54:13Z",
      "updated_at": "2024-08-10T13:54:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "This change didn't appear to have any speed impact for a reindex-chainstate using max dbcache. Ran the following benchmark:\r\n```\r\nnohup hyperfine \\\r\n--export-markdown ~/bench.md \\\r\n--show-output \\\r\n--parameter-list commit 81508954f1f89f95b6fdca10c3c471cdb6566c80,27a770b34b8f1dbb84760f442edb3e23a0c2420b \\\r\n--prepare 'git checkout {commit} && \\\r\nmake -j$(nproc) src/bitcoind; \\\r\nsync; sudo /sbin/sysctl vm.drop_caches=3;' \\\r\n-M 2 \\\r\n'echo '{commit}' && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000' &\r\n```\r\n\r\nResults are the same:\r\n\r\n```\r\nBenchmark 1: echo 81508954f1f89f95b6fdca10c3c471cdb6566c80 && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000\r\n\r\n81508954f1f89f95b6fdca10c3c471cdb6566c80\r\n  Time (mean ± σ):     12239.620 s ±  3.156 s    [User: 12366.988 s, System: 562.121 s]\r\n  Range (min … max):   12237.388 s … 12241.851 s    2 runs\r\n \r\nBenchmark 2: echo 27a770b34b8f1dbb84760f442edb3e23a0c2420b && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000\r\n\r\n27a770b34b8f1dbb84760f442edb3e23a0c2420b\r\n  Time (mean ± σ):     12243.072 s ±  6.588 s    [User: 12382.386 s, System: 559.349 s]\r\n  Range (min … max):   12238.413 s … 12247.730 s    2 runs\r\n \r\nSummary\r\n  'echo 81508954f1f89f95b6fdca10c3c471cdb6566c80 && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000' ran\r\n    1.00 ± 0.00 times faster than 'echo 27a770b34b8f1dbb84760f442edb3e23a0c2420b && \\\r\n./src/bitcoind -datadir=/home/user/.bitcoin \\\r\n-reindex-chainstate \\\r\n-dbcache=16384 \\\r\n-printtoconsole=0 \\\r\n-connect=0 \\\r\n-stopatheight=820000'\r\n```\r\n\r\nSo, I would say this PR is strictly beneficial for IBD/reindex-chainstate. It is the same speed, but protects against data loss.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2281899749",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2282238485,
      "node_id": "IC_kwDOABII586ICDIV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2282238485",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-10T18:32:49Z",
      "updated_at": "2024-08-10T18:32:49Z",
      "author_association": "CONTRIBUTOR",
      "body": "I didn't comment on IBD because I figured a hit per hour isn't that significant in the context of IBD and likely pays for itself in improving crash robustness.  I'm a little surprised that the effect is quite so small, but it does probably improve performance too by making writes a little more concurrent.\r\n\r\nSipa: good point on the injection locking, I've previously wondered if the the 24 hour behavior could sync up.",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2282238485",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2290369678,
      "node_id": "IC_kwDOABII586IhESO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2290369678",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-15T02:14:10Z",
      "updated_at": "2024-08-15T02:58:49Z",
      "author_association": "CONTRIBUTOR",
      "body": ">  I'm a little surprised that the effect is quite so small\r\n\r\n@gmaxwell I was as well, so I ran the same benchmark with `-reindex` as well and it gave me similar results:\r\n\r\n\r\n| Command | Mean [s] | Min [s] | Max [s] | Relative |\r\n|:---|---:|---:|---:|---:|\r\n| `echo 81508954f1f89f95b6fdca10c3c471cdb6566c80 && ./src/bitcoind -datadir=/home/user/.bitcoin -reindex -dbcache=16384 -printtoconsole=0 -connect=0 -stopatheight=820000` | 40765.075 ± 132.452 | 40671.417 | 40858.733 | 1.01 ± 0.00 |\r\n| `echo 27a770b34b8f1dbb84760f442edb3e23a0c2420b && ./src/bitcoind -datadir=/home/user/.bitcoin -reindex -dbcache=16384 -printtoconsole=0 -connect=0 -stopatheight=820000` | 40536.484 ± 46.379 | 40503.689 | 40569.279 | 1.00 |\r\n\r\n\r\nWill get some measurements for total chainstate bytes written and total time writing chainstate before and after this change during steady state. But, this will take a few weeks to get meaningful data. Even then there will be a lot of variance depending on how many utxos are being eagerly spent within 24 hours vs 1 hour at the time I am measuring.\r\n\r\n> Someone might also want to test the latency impact (e.g. on block template creation) of the traversal.\r\n\r\nI'm not sure I understand what you are suggesting to measure here, or what you mean by traversal. We can measure the total time writing chainstate to disk with `-debug=bench`, which would be the latency impact if that's what you mean.\r\n\r\n> Though long term it would be preferable to introduce a data structure to track pending writes and keep a constantly flushing going which always lags the tip by N blocks, both avoiding the latency spikes and preventing unnecessary writes of entries that are just going to be spent in the next couple blocks.\r\n\r\nYou mentioned a similar idea a while ago [here](https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457792904). I agree with you there that it is a much bigger project. If this change is accepted and merged, would there really be a benefit anymore of adding something like that?",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2290369678",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "mentioned",
      "id": 13890066178,
      "node_id": "MEE_lADOABII586SaWKgzwAAAAM76ZcC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13890066178",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-15T02:14:11Z"
    },
    {
      "event": "subscribed",
      "id": 13890066189,
      "node_id": "SE_lADOABII586SaWKgzwAAAAM76ZcN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13890066189",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-15T02:14:11Z"
    },
    {
      "event": "commented",
      "id": 2296577863,
      "node_id": "IC_kwDOABII586I4v9H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2296577863",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T13:26:54Z",
      "updated_at": "2024-08-19T13:26:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'll review this in more detail later, but I have a question first:\r\nWhenever a production change is made without corresponding test changes (yet the build passes), it suggests to me that there might be a gap in our coverage.\r\nDo you think it would make sense to add a test that reproduces some aspect of the old behavior before making the change—one that would need to be updated in the commit that introduces the change?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2296577863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "commented",
      "id": 2296587174,
      "node_id": "IC_kwDOABII586I4yOm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2296587174",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T13:31:03Z",
      "updated_at": "2024-08-19T13:31:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "> it would make sense to add a test that reproduces some aspect of the old behavior before making the change—one that would need to be updated in the commit that introduces the change?\r\n\r\nGood point, I can add a test that that expects flush every 24 hours, then reduce it to 1 hour after this change.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2296587174",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "reviewed",
      "id": 2245573919,
      "node_id": "PRR_kwDOABII586F2L0f",
      "url": null,
      "actor": null,
      "commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2245573919",
      "submitted_at": "2024-08-19T13:37:04Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "subscribed",
      "id": 14034224085,
      "node_id": "SE_lADOABII586SaWKgzwAAAANEgUPV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14034224085",
      "actor": {
        "login": "eragmus",
        "id": 11140618,
        "node_id": "MDQ6VXNlcjExMTQwNjE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/11140618?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eragmus",
        "html_url": "https://github.com/eragmus",
        "followers_url": "https://api.github.com/users/eragmus/followers",
        "following_url": "https://api.github.com/users/eragmus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eragmus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eragmus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eragmus/subscriptions",
        "organizations_url": "https://api.github.com/users/eragmus/orgs",
        "repos_url": "https://api.github.com/users/eragmus/repos",
        "events_url": "https://api.github.com/users/eragmus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eragmus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-27T20:05:42Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBhOWE3NzA1NTBkMTU1N2M5OTE3YTEzNmM5OTI2NjQyZTkxOWNmMGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0a9a770550d1557c9917a136c9926642e919cf0a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0a9a770550d1557c9917a136c9926642e919cf0a",
      "tree": {
        "sha": "a4a05794816236196d23a12447ba77fe000d39d3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a4a05794816236196d23a12447ba77fe000d39d3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a4a05794816236196d23a12447ba77fe000d39d3\nparent b52d54736168bed82775e3c9e66c6320c7b83626\nauthor Andrew Toth <andrewstoth@gmail.com> 1725117191 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725117191 -0400\n\nvalidation: write chainstate to disk every hour\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTMwcACgkQYAB6/Ik4\nsBjvjA//VIXUu9zbuEmPwhfL3fTXYwhPMRPoQYi6bMBdQeiuctH2bAgwik784+jF\nt520BhoRPpHaijIxmjG5l17hZE+j1zZNqtlCF2+kKUNba2NAg7xZk7RrlNMXv/An\ncFSLiJr77Ikb415ZHhnOjSazHNrJXx3a4E+Rds0W90fdKOzB/OCT4FXeEtUYY+zJ\nVidbQ8oCxX2d2tCUBFGQi+Y6U2yPesRo67eBolzRCMn43vh9pJLxTWatw4UKVx5+\nPiyUHxyyjX9px/gF2ua43rBJRjVP4rQaUO3bGV+hrqAtTYBZ6PW0jo6E5/UhU0od\n9QmGh7UpJE9DjXcACg0CR43sIvlwqTWJfIFM1I0kTnLQ0MRM2lxDHdlAj02NuXao\ngyHSZpgUC2GYfKFBpHQsYVmd3ClMBDnC+nfCNcpTk3Au9Up/W2oAKAUgrbiU5xBa\n201JhlaRWklEXbeTyQc0veDDaaztMlOGqfa6eJGGk1W+OA1W3oAxVo6mAQKcn7AE\n4nVjqL4KDSQ0zQjqpxQvRbDzCaP7mWpv4lFWg4kLoRB1muBzvaCHb9dzXMDiRgMO\n2Rc0NaWR5E5MWFaaxhfsZd+cgRr9MVWcLSgT2uk3HhhnrRzR3EjhvISP3RfJjYus\n7FJ1TnNe+02GyT/LygcvcFvWBKvUHbEORWVLRQnS4ugJBk7GEtU=\n=8BwO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b52d54736168bed82775e3c9e66c6320c7b83626",
          "sha": "b52d54736168bed82775e3c9e66c6320c7b83626",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b52d54736168bed82775e3c9e66c6320c7b83626"
        }
      ],
      "message": "validation: write chainstate to disk every hour",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:13:11Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:13:11Z"
      },
      "sha": "0a9a770550d1557c9917a136c9926642e919cf0a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYyOGM4OGRkNzVmY2UyODA0NjVlZjQ5ODZlNmMxNTViOGQ4OGI2ZGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/628c88dd75fce280465ef4986e6c155b8d88b6de",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/628c88dd75fce280465ef4986e6c155b8d88b6de",
      "tree": {
        "sha": "334a9e341f8bc560651d0102443b62ac263c20bd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/334a9e341f8bc560651d0102443b62ac263c20bd"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 334a9e341f8bc560651d0102443b62ac263c20bd\nparent 0a9a770550d1557c9917a136c9926642e919cf0a\nauthor Andrew Toth <andrewstoth@gmail.com> 1725117258 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725117258 -0400\n\nrefactor: remove early declaration of fDoFullFlush\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTM0oACgkQYAB6/Ik4\nsBj5GQ/6A3S41yb9KMoXEjpOIXuLhso2sBzbDa7Nm3fxImsd55HpcwiWdB8TWQd1\n444UC2k5gfG6diizN5PKUTCqvrO6UOJP9z4txqYHkGn2HygrIQc1pVBuoQ1X9Rlk\nZ8ylug2qzUva13KjoBmd9jDRCMz8boieqbb1GbEy3gQ4PGm5pOKw3fbZ4sgBQJRg\nfy/rEDVNecl69BsYk70Lwx9lc5G4LsdjvPJCt22HIyFkRVo80xhIzBOWLFEO5/Cm\nZftNOh3qjaHUh33as5wrhOhuoBfunWjWMkssU0CU/ub97nN9qIeZ3vUf/8ftHyEv\n0UNorF/25GJrSfUuP/hYVZp/SM8L393Y1gXQPhVTdDE6YLQNJC29VO2VhueWXMUZ\nNpetHUA6PACMzs2Iik3v/v3d+eAAIRicV8VbplZcfKqADMSbJ07rgfbVK3bcCb/n\nBvbRSAEZOn00Jan0P2VvHlKdd6PdTiLHMP/V6pEqGD/hyy8OSwpm9SWFQRbQoPyi\nbAQF/nsgL/dzYciKPL388N970Zo+6KFcCYb7XVSXrNui02eIkZshH2f22wiH4n1f\n2EiBaMkjcbfHv7kdzK3OiPMO/sXrKuuQoivDuUV4qe0ZkkYqHXUfHuIvJLnVOAn5\n64z1kcobgV4M/CYwfAd1LThsP4RtBPwA2sj+DDvXslInION9gKs=\n=6vOT\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0a9a770550d1557c9917a136c9926642e919cf0a",
          "sha": "0a9a770550d1557c9917a136c9926642e919cf0a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0a9a770550d1557c9917a136c9926642e919cf0a"
        }
      ],
      "message": "refactor: remove early declaration of fDoFullFlush",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:14:18Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:14:18Z"
      },
      "sha": "628c88dd75fce280465ef4986e6c155b8d88b6de"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIwMjRjYWJhMDk4M2FhMzk2MGFiNzM0Y2I2MzkxY2VlMDcyY2IzNjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b024caba0983aa3960ab734cb6391cee072cb360",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b024caba0983aa3960ab734cb6391cee072cb360",
      "tree": {
        "sha": "9ad2af672e7808681fb86758549572b52419cb1c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9ad2af672e7808681fb86758549572b52419cb1c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9ad2af672e7808681fb86758549572b52419cb1c\nparent 628c88dd75fce280465ef4986e6c155b8d88b6de\nauthor Andrew Toth <andrewstoth@gmail.com> 1725118246 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725126019 -0400\n\nvalidation: add randomness to periodic write interval\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTVYQACgkQYAB6/Ik4\nsBj5Rg/+MKqSoS6i83JBBj8DuYv1QGgWbwlrOJypgAflwjktEwwTnTuNin9UKfOR\nBRSMMsNhplOjC+MXArcXyVHjxwF+ns73AyUIymnOM1AeG/nj9uNDnOvi44MLsFKW\nfGSCRYYQfXYOvXaBmVYme2GvUPKu2onmlGpi8EQnEpgUijwgpohug5c2PPeXgclv\naa94jLgJR2zN98FQECNhWr6GKzDE5IV3sx5nNntcdJa51zBG1FfFeFiQX6hkmzOs\nFJb1g+it6hcxq0oDx6qi/mZapPp5YV1ba2daXWTly/VMqlXX9Yio6FLWNyR/XLPQ\np3iblRdX8zLI5OpMgQ4chfnEXUGG3i2MvrNHywXPutNXUdrbQRuffUW+M8ZKAQa9\nkCh1YDKLeOrCUlaN9c6ahcj+Ht64GlyzvuwIhAAJCoX5M1YWF4+VtiGgSf083FTE\nN0asBTaVEoOcSIuWHkq8nWcPbPstkCZBHX9tKdWAjSD1IgEOCU7lwUVCSi+kqfal\nmYRf926xzBvVjDajdsF3A9CvuzfSq3seerfuRpZNjzZ26gc+SVYt8CuWWrZLLwCu\nPYJuc2CRkYJmu7uVCUkIOe6ElvVDc9pcEMpgHwSBvkgEcFZOwiIPDqRR17rDFNZv\nkxsweO/5x76lUd0WlrQf5+J8qts4w3S6HEgVqkSLfeu7tbYmcrg=\n=5h4/\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/628c88dd75fce280465ef4986e6c155b8d88b6de",
          "sha": "628c88dd75fce280465ef4986e6c155b8d88b6de",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/628c88dd75fce280465ef4986e6c155b8d88b6de"
        }
      ],
      "message": "validation: add randomness to periodic write interval",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:40:19Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T15:30:46Z"
      },
      "sha": "b024caba0983aa3960ab734cb6391cee072cb360"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092316217,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANH9645",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092316217",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:43:35Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092323836,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANH98v8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092323836",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:47:20Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFjMWI2M2EwNDFiNzA3NWVmMDU4MGY3NjlkMWM2MmExZjlmYThkZjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "tree": {
        "sha": "3dfdf540b45c17954dcc58df25cd68baa2e5c93a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3dfdf540b45c17954dcc58df25cd68baa2e5c93a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3dfdf540b45c17954dcc58df25cd68baa2e5c93a\nparent b024caba0983aa3960ab734cb6391cee072cb360\nauthor Andrew Toth <andrewstoth@gmail.com> 1725126111 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725127134 -0400\n\ntest: chainstate write test for periodic chainstate flush\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTWd4ACgkQYAB6/Ik4\nsBis5BAAmFcapzTATkIUnPs2VN3z0L815MtUduOXlLyF1CqyecTNb7r/xvo828tP\nDa5Txl1zPqZpqH76oIvH/1NXVychAOAXVVZCGtAkW6rtHwoKv6BGT9YPCcq/CADH\nCgprB5Cm1ShlyimnZJQKbX6tD1pqzW40a0BmmXFxIkNTNRT7XMGIMCKRx7fJPV8U\nbmenOX6B6j8xRyc5c8UQvK+H2ZJUyqzcObYKcNSQHVdbTSA0VOkpN5jrJFj3Vzzz\nlWoecfX7dZz7mrUJ358IGm/BOBDYq6TSqWlCRFAc1ryNI/Oy2yp/tBQeD5HJffob\nuAUxbh2wCE3N+IRHU2vW9Jwhpir6esNwAXu7A2bpmc/mhjKlz9IU+MfjF8T6U3DO\nyqFazbL2W0Qa3ghq2vXKRjN0WBf/OPBqvw8/nrpD05UblezX7TPwQCuh+HWP/WUn\nM0+HF/zl1TjM2icHOnjfnADZBiarWLOA9OCNr6Mde97xW9hclpi2oVYG9UZRFhEu\ns7PJZZv3AjKM+lWkgVOY/VdldYDzJQP4sOoeEiLMXMiJXJ1A+wy/85BedoD/zJay\nBT/9ChmEk9P1nfTDQZVvS4XEUq476RgkkdkkCymRhPwM67HmxKe2zPvNgBqwt7xj\nSpUraLQbBUkSfxxX34zOMi8778SVpnBbYu0BLVA/XkQeHovbTs8=\n=IUrh\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b024caba0983aa3960ab734cb6391cee072cb360",
          "sha": "b024caba0983aa3960ab734cb6391cee072cb360",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b024caba0983aa3960ab734cb6391cee072cb360"
        }
      ],
      "message": "test: chainstate write test for periodic chainstate flush",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:58:54Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:41:51Z"
      },
      "sha": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092348373,
      "node_id": "HRFPE_lADOABII586SaWKgzwAAAANH-CvV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092348373",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:58:59Z"
    },
    {
      "event": "labeled",
      "id": 14092348455,
      "node_id": "LE_lADOABII586SaWKgzwAAAANH-Cwn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092348455",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:59:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2322994750,
      "node_id": "IC_kwDOABII586KdhY-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2322994750",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T17:59:04Z",
      "updated_at": "2024-08-31T17:59:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/29514781087</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2322994750",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    },
    {
      "event": "unlabeled",
      "id": 14092510957,
      "node_id": "UNLE_lADOABII586SaWKgzwAAAANH-qbt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092510957",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T19:28:30Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2274461800,
      "node_id": "PRR_kwDOABII586HkYho",
      "url": null,
      "actor": null,
      "commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#pullrequestreview-2274461800",
      "submitted_at": "2024-09-01T17:40:03Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
    },
    {
      "event": "commented",
      "id": 2323622796,
      "node_id": "IC_kwDOABII586Kf6uM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2323622796",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T01:50:30Z",
      "updated_at": "2024-09-02T01:50:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "I got some stats for running in steady state for this branch and master.\r\nI ran 4 nodes for 11 days and 18 hours using identical aws t2-small instances backed by 20GB EBS volumes all connected to another node in the same VPC.\r\n\r\n|  Branch | Total time writing chainstate | Total bytes written |\r\n|-----------:|----------:|----------:|\r\n| master 1 | 26372ms |497 MiB |\r\n| master 2 | 28188ms | 497 MiB |\r\n| branch 1 | 32496ms | 760 MiB |\r\n| branch 2 | 32566ms | 760 MiB |\r\n\r\nBy writing every hour, we write about 50% more data, but we are only spending 20% more time writing.\r\nOn master we write about 42 MiB every 24 hours which locks the main thread for 2.3 seconds.\r\nOn this branch we write about 2.7 MiB every hour which locks the main thread for 115 milliseconds.\r\n\r\nHere are the write operations charts for the time period. You can see the write operations are more evenly spaced out by writing every hour.\r\n![Master 1](https://github.com/user-attachments/assets/8770d491-4783-4503-9c26-f0dabce6af84)\r\n![Master 2](https://github.com/user-attachments/assets/776a21f1-3a1f-4cd5-b3b6-d5f39345cb14)\r\n![Branch 2](https://github.com/user-attachments/assets/6c2f25c9-2ab8-4aeb-bb01-9fb53247e91d)\r\n![Branch 1](https://github.com/user-attachments/assets/95ce7896-d483-4dc3-a106-17d75e7973c4)\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#issuecomment-2323622796",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30611"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721803828",
      "pull_request_review_id": 2245573919,
      "id": 1721803828,
      "node_id": "PRRC_kwDOABII585moKQ0",
      "diff_hunk": "@@ -2842,21 +2839,16 @@ bool Chainstate::FlushStateToDisk(\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n         }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n-        }\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\n         // The cache is over the limit, we have to write now.\n         bool fCacheCritical = mode == FlushStateMode::IF_NEEDED && cache_state >= CoinsCacheSizeState::CRITICAL;\n-        // It's been a while since we wrote the block index to disk. Do this frequently, so we don't need to redownload after a crash.\n+        // It's been a while since we wrote the block index and chainstate to disk. Do this frequently, so we don't need to redownload and reindex after a crash.\n         bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow > m_last_write + DATABASE_WRITE_INTERVAL;\n-        // It's been very long since we flushed the cache. Do this infrequently, to optimize cache usage.\n-        bool fPeriodicFlush = mode == FlushStateMode::PERIODIC && nNow > m_last_flush + DATABASE_FLUSH_INTERVAL;\n         // Combine all conditions that result in a full cache flush.\n-        fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicFlush || fFlushForPrune;\n+        bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;",
      "path": "src/validation.cpp",
      "position": 50,
      "original_position": 38,
      "commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "original_commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "To simplify review, could you please separate the concerns - having low-risk changes (e.g. moves, renames, inlines, rewording) in separate commits from high risk ones?",
      "created_at": "2024-08-19T13:37:04Z",
      "updated_at": "2024-08-19T13:37:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1721803828",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721803828"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2852,
      "original_line": 2852,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739870290",
      "pull_request_review_id": 2274071126,
      "id": 1739870290,
      "node_id": "PRRC_kwDOABII585ntFBS",
      "diff_hunk": "@@ -2842,21 +2839,16 @@ bool Chainstate::FlushStateToDisk(\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n         }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n-        }\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\n         // The cache is over the limit, we have to write now.\n         bool fCacheCritical = mode == FlushStateMode::IF_NEEDED && cache_state >= CoinsCacheSizeState::CRITICAL;\n-        // It's been a while since we wrote the block index to disk. Do this frequently, so we don't need to redownload after a crash.\n+        // It's been a while since we wrote the block index and chainstate to disk. Do this frequently, so we don't need to redownload and reindex after a crash.\n         bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow > m_last_write + DATABASE_WRITE_INTERVAL;\n-        // It's been very long since we flushed the cache. Do this infrequently, to optimize cache usage.\n-        bool fPeriodicFlush = mode == FlushStateMode::PERIODIC && nNow > m_last_flush + DATABASE_FLUSH_INTERVAL;\n         // Combine all conditions that result in a full cache flush.\n-        fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicFlush || fFlushForPrune;\n+        bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;",
      "path": "src/validation.cpp",
      "position": 50,
      "original_position": 38,
      "commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "original_commit_id": "81508954f1f89f95b6fdca10c3c471cdb6566c80",
      "in_reply_to_id": 1721803828,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There really isn't much I am doing here that can be split up. I added a second commit for moving the declaration of `fDoFullFlush` here.",
      "created_at": "2024-08-31T17:44:32Z",
      "updated_at": "2024-08-31T17:44:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1739870290",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739870290"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2852,
      "original_line": 2852,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740167716",
      "pull_request_review_id": 2274461800,
      "id": 1740167716,
      "node_id": "PRRC_kwDOABII585nuNok",
      "diff_hunk": "@@ -2837,26 +2836,22 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n-        }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n+            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};",
      "path": "src/validation.cpp",
      "position": 35,
      "original_position": 35,
      "commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "original_commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It'd be a bit cleaner (and more granular) to have:\r\n\r\n```c++\r\nstatic constexpr auto DATABASE_WRITE_INTERVAL_MIN{50min};\r\nstatic constexpr auto DATABASE_WRITE_INTERVAL_MAX{70min};\r\n...\r\nm_random_write_delay = DATABASE_WRITE_INTERVAL_MIN +\r\n    FastRandomContext().rand_uniform_duration<NodeClock>(DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);`\r\n```\r\n",
      "created_at": "2024-09-01T17:40:03Z",
      "updated_at": "2024-09-01T17:40:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740167716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740167716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2843,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740188239",
      "pull_request_review_id": 2274481459,
      "id": 1740188239,
      "node_id": "PRRC_kwDOABII585nuSpP",
      "diff_hunk": "@@ -2837,26 +2836,22 @@ bool Chainstate::FlushStateToDisk(\n                 }\n             }\n         }\n-        const auto nNow{SteadyClock::now()};\n+        const auto nNow{NodeClock::now()};\n         // Avoid writing/flushing immediately after startup.\n         if (m_last_write == decltype(m_last_write){}) {\n             m_last_write = nNow;\n-        }\n-        if (m_last_flush == decltype(m_last_flush){}) {\n-            m_last_flush = nNow;\n+            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};",
      "path": "src/validation.cpp",
      "position": 35,
      "original_position": 35,
      "commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "original_commit_id": "1c1b63a041b7075ef0580f769d1c62a1f9fa8df6",
      "in_reply_to_id": 1740167716,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "given that this delay is written multiple times, would that be more verbose?\r\nAlternatively maybe we could add an `m_next_write` next to `m_last_write`, like:\r\n```patch\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex b54446be4e..e2c7272531 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -86,10 +86,9 @@ using node::CBlockIndexHeightOnlyComparator;\r\n using node::CBlockIndexWorkComparator;\r\n using node::SnapshotMetadata;\r\n \r\n-/** Time to wait between writing blocks/block index and chainstate to disk. */\r\n-static constexpr std::chrono::minutes DATABASE_WRITE_INTERVAL{50};\r\n-/** Range of random delay to add to DATABASE_WRITE_INTERVAL */\r\n-static constexpr uint32_t DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE{20};\r\n+/** Minimum and maximum time to wait between writing blocks/block index and chainstate to disk. */\r\n+static constexpr auto DATABASE_WRITE_INTERVAL_MIN{50min};\r\n+static constexpr auto DATABASE_WRITE_INTERVAL_MAX{70min};\r\n /** Maximum age of our tip for us to be considered current for fee estimation */\r\n static constexpr std::chrono::hours MAX_FEE_ESTIMATION_TIP_AGE{3};\r\n const std::vector<std::string> CHECKLEVEL_DOC {\r\n@@ -2776,6 +2775,11 @@ CoinsCacheSizeState Chainstate::GetCoinsCacheSizeState(\r\n     return CoinsCacheSizeState::OK;\r\n }\r\n \r\n+NodeClock::time_point Chainstate::CalculateNextWrite(NodeClock::time_point after) const\r\n+{\r\n+    return FastRandomContext().rand_uniform_delay(after + DATABASE_WRITE_INTERVAL_MIN, DATABASE_WRITE_INTERVAL_MAX - DATABASE_WRITE_INTERVAL_MIN);\r\n+}\r\n+\r\n bool Chainstate::FlushStateToDisk(\r\n     BlockValidationState &state,\r\n     FlushStateMode mode,\r\n@@ -2840,14 +2844,14 @@ bool Chainstate::FlushStateToDisk(\r\n         // Avoid writing/flushing immediately after startup.\r\n         if (m_last_write == decltype(m_last_write){}) {\r\n             m_last_write = nNow;\r\n-            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};\r\n+            m_next_write = CalculateNextWrite(m_last_write);\r\n         }\r\n         // The cache is large and we're within 10% and 10 MiB of the limit, but we have time now (not in the middle of a block processing).\r\n         bool fCacheLarge = mode == FlushStateMode::PERIODIC && cache_state >= CoinsCacheSizeState::LARGE;\r\n         // The cache is over the limit, we have to write now.\r\n         bool fCacheCritical = mode == FlushStateMode::IF_NEEDED && cache_state >= CoinsCacheSizeState::CRITICAL;\r\n         // It's been a while since we wrote the block index to disk. Do this frequently, so we don't need to redownload after a crash.\r\n-        bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow > m_last_write + DATABASE_WRITE_INTERVAL + m_random_write_delay;\r\n+        bool fPeriodicWrite = mode == FlushStateMode::PERIODIC && nNow >= m_next_write;\r\n         // Combine all conditions that result in a full cache flush.\r\n         bool fDoFullFlush = (mode == FlushStateMode::ALWAYS) || fCacheLarge || fCacheCritical || fPeriodicWrite || fFlushForPrune;\r\n         // Write blocks, block index and best chain related state to disk.\r\n@@ -2882,7 +2886,7 @@ bool Chainstate::FlushStateToDisk(\r\n                 m_blockman.UnlinkPrunedFiles(setFilesToPrune);\r\n             }\r\n             m_last_write = nNow;\r\n-            m_random_write_delay = std::chrono::minutes{(FastRandomContext().randrange(DATABASE_WRITE_INTERVAL_RANDOM_DELAY_RANGE))};\r\n+            m_next_write = CalculateNextWrite(m_last_write);\r\n \r\n             if (!CoinsTip().GetBestBlock().IsNull()) {\r\n                 LOG_TIME_MILLIS_WITH_CATEGORY(strprintf(\"write coins cache to disk (%d coins, %.2fkB)\",\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex dfe33b8e29..953793bdf7 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -810,7 +810,9 @@ private:\r\n         EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n \r\n     NodeClock::time_point m_last_write{};\r\n-    std::chrono::minutes m_random_write_delay{};\r\n+    NodeClock::time_point m_next_write{};\r\n+\r\n+    NodeClock::time_point CalculateNextWrite(NodeClock::time_point after) const;\r\n \r\n     /**\r\n      * In case of an invalid snapshot, rename the coins leveldb directory so\r\n```\r\n\r\nnote: this way it should probably be `nNow >= m_next_write` instead of `nNow > m_next_write` to be consistent with the naming.",
      "created_at": "2024-09-01T20:19:51Z",
      "updated_at": "2024-09-01T20:19:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30611#discussion_r1740188239",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740188239"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30611"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2843,
      "original_line": 2843,
      "side": "RIGHT"
    }
  ]
}