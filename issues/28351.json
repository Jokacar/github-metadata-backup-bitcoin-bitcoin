{
  "type": "issue",
  "issue": {
    "id": 1868524948,
    "node_id": "I_kwDOABII585vX22U",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/28351",
    "number": 28351,
    "state": "closed",
    "state_reason": "completed",
    "title": "[bitcoin-cli] importdescriptors fail if `'` instead `h` as hardened indicator into key origin",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nI control if the descriptor that I want to import is valid:\r\n```shell\r\n$ bitcoin-cli -signet getdescriptorinfo \"wsh(or_d(pk([a5c6b76e/48'/1'/0'/2']tpubDF5861hj6vR3iJr3aPjGJz4rNbqDCRujQ21mczzKT5SiedaQqNVgHC8HT9ceyxvMFRoPMx4P6HAcL3NZrUPhRUbwCyj3TKSa64bAfnE3sLh/1/*),and_v(v:pkh([c477fd13/48'/1'/0'/2']tpubDFn7iPbFqGrTQ2aRACNsUK1MXQR4Z6dYfU2nD1WA9ifSaia642j3Wah4n5pBUEpERNWGJsyv3Dv5qwBabC9TLQrwSboKzukw9wmurGu7XVH/1/*),older(3))))\"\r\n```\r\noutput:\r\n```\r\n{\r\n  \"descriptor\": \"wsh(or_d(pk([a5c6b76e/48'/1'/0'/2']tpubDF5861hj6vR3iJr3aPjGJz4rNbqDCRujQ21mczzKT5SiedaQqNVgHC8HT9ceyxvMFRoPMx4P6HAcL3NZrUPhRUbwCyj3TKSa64bAfnE3sLh/1/*),and_v(v:pkh([c477fd13/48'/1'/0'/2']tpubDFn7iPbFqGrTQ2aRACNsUK1MXQR4Z6dYfU2nD1WA9ifSaia642j3Wah4n5pBUEpERNWGJsyv3Dv5qwBabC9TLQrwSboKzukw9wmurGu7XVH/1/*),older(3))))#vpa5k5p6\",\r\n  \"checksum\": \"vpa5k5p6\",\r\n  \"isrange\": true,\r\n  \"issolvable\": true,\r\n  \"hasprivatekeys\": false\r\n}\r\n```\r\n\r\nthen try to import descriptor (w/ checksum computed by core) returned by `getdescriptorinfo`:\r\n```shell\r\n$ bitcoin-cli -signet -rpcwallet=liana importdescriptors '[{\"desc\": \"wsh(or_d(pk([a5c6b76e/48'/1'/0'/2']tpubDF5861hj6vR3iJr3aPjGJz4rNbqDCRujQ21mczzKT5SiedaQqNVgHC8HT9ceyxvMFRoPMx4P6HAcL3NZrUPhRUbwCyj3TKSa64bAfnE3sLh/1/*),and_v(v:pkh([c477fd13/48'/1'/0'/2']tpubDFn7iPbFqGrTQ2aRACNsUK1MXQR4Z6dYfU2nD1WA9ifSaia642j3Wah4n5pBUEpERNWGJsyv3Dv5qwBabC9TLQrwSboKzukw9wmurGu7XVH/1/*),older(3))))#vpa5k5p6\", \"range\": [0,10000], \"timestamp\": 1682920310, \"active\": true, \"internal\":false}]'\r\n```\r\n\r\noutput:\r\n```\r\n[\r\n  {\r\n    \"success\": false,\r\n    \"error\": {\r\n      \"code\": -5,\r\n      \"message\": \"Provided checksum 'vpa5k5p6' does not match computed checksum 'lkv9vrah'\"\r\n    }\r\n  }\r\n]\r\n```\r\n\r\n\n\n### Expected behaviour\n\nThen I take the checksum given as a reference, and use it to replace the 'wrong' one:\r\n\r\n```shell\r\n$ bitcoin-cli -signet -rpcwallet=liana importdescriptors '[{\"desc\": \"wsh(or_d(pk([a5c6b76e/48'/1'/0'/2']tpubDF5861hj6vR3iJr3aPjGJz4rNbqDCRujQ21mczzKT5SiedaQqNVgHC8HT9ceyxvMFRoPMx4P6HAcL3NZrUPhRUbwCyj3TKSa64bAfnE3sLh/1/*),and_v(v:pkh([c477fd13/48'/1'/0'/2']tpubDFn7iPbFqGrTQ2aRACNsUK1MXQR4Z6dYfU2nD1WA9ifSaia642j3Wah4n5pBUEpERNWGJsyv3Dv5qwBabC9TLQrwSboKzukw9wmurGu7XVH/1/*),older(3))))#lkv9vrah\", \"range\": [0,10000], \"timestamp\": 1682920310, \"active\": true, \"internal\":false}]'\r\n```\r\noutput:\r\n```\r\n[\r\n  {\r\n    \"success\": true\r\n  }\r\n]\r\n```\r\nseems ok now\r\n\n\n### Steps to reproduce\n\nThen control the imported descriptor:\r\n\r\n```shell\r\n$ bitcoin-cli -signet -rpcwallet=liana listdescriptors\r\n```\r\n\r\noutput:\r\n```\r\n{\r\n  \"wallet_name\": \"liana\",\r\n  \"descriptors\": [\r\n    {\r\n      \"desc\": \"wsh(or_d(pk([a5c6b76e/48/1/0/2]tpubDF5861hj6vR3iJr3aPjGJz4rNbqDCRujQ21mczzKT5SiedaQqNVgHC8HT9ceyxvMFRoPMx4P6HAcL3NZrUPhRUbwCyj3TKSa64bAfnE3sLh/1/*),and_v(v:pkh([c477fd13/48/1/0/2]tpubDFn7iPbFqGrTQ2aRACNsUK1MXQR4Z6dYfU2nD1WA9ifSaia642j3Wah4n5pBUEpERNWGJsyv3Dv5qwBabC9TLQrwSboKzukw9wmurGu7XVH/1/*),older(3))))#lkv9vrah\",\r\n      \"timestamp\": 1682920310,\r\n      \"active\": true,\r\n      \"internal\": false,\r\n      \"range\": [\r\n        0,\r\n        10000\r\n      ],\r\n      \"next\": 0,\r\n      \"next_index\": 0\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nif we look at the key origins of the listed descriptor, we can see they do not match (hardened indicator missing) with imported ones:\r\n - [a5c6b76e/48/1/0/2] != [a5c6b76e/48`'`/1`'`/0`'`/2`'`]\r\n - [c477fd13/48/1/0/2] != [c477fd13/48`'`/1`'`/0`'`/2`'`]\n\n### Relevant log output\n\nIf I use `importdescriptors`  w/ `h` as hardened indicator, the issue doesn't appear.\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nv25.0\n\n### Operating system and version\n\nArch Linux w/ kernel 6.4.10-arch1-1\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "pythcoiner",
      "id": 124568858,
      "node_id": "U_kgDOB2zFGg",
      "avatar_url": "https://avatars.githubusercontent.com/u/124568858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pythcoiner",
      "html_url": "https://github.com/pythcoiner",
      "followers_url": "https://api.github.com/users/pythcoiner/followers",
      "following_url": "https://api.github.com/users/pythcoiner/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/pythcoiner/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/pythcoiner/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/pythcoiner/subscriptions",
      "organizations_url": "https://api.github.com/users/pythcoiner/orgs",
      "repos_url": "https://api.github.com/users/pythcoiner/repos",
      "events_url": "https://api.github.com/users/pythcoiner/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/pythcoiner/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "comments": 3,
    "closed_at": "2023-08-27T15:43:29Z",
    "created_at": "2023-08-27T14:55:50Z",
    "updated_at": "2024-08-26T13:13:42Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1694695865,
      "node_id": "IC_kwDOABII585lAwG5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1694695865",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T15:27:16Z",
      "updated_at": "2023-08-27T15:27:16Z",
      "author_association": "MEMBER",
      "body": "IIRC someone else had an issue like this and the problem was that their shell was eating the `'`. Can you check that that isn't what's happening?\r\n\r\nCan you also try with the latest master branch? There have been a few fixes for descriptors since 25.0 was released, so this may already be fixed.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28351#issuecomment-1694695865",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351"
    },
    {
      "event": "comment_deleted",
      "id": 10202035343,
      "node_id": "CDE_lADOABII585vX22UzwAAAAJgFrSP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10202035343",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T15:32:13Z"
    },
    {
      "event": "commented",
      "id": 1694697402,
      "node_id": "IC_kwDOABII585lAwe6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1694697402",
      "actor": {
        "login": "pythcoiner",
        "id": 124568858,
        "node_id": "U_kgDOB2zFGg",
        "avatar_url": "https://avatars.githubusercontent.com/u/124568858?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pythcoiner",
        "html_url": "https://github.com/pythcoiner",
        "followers_url": "https://api.github.com/users/pythcoiner/followers",
        "following_url": "https://api.github.com/users/pythcoiner/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pythcoiner/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pythcoiner/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pythcoiner/subscriptions",
        "organizations_url": "https://api.github.com/users/pythcoiner/orgs",
        "repos_url": "https://api.github.com/users/pythcoiner/repos",
        "events_url": "https://api.github.com/users/pythcoiner/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pythcoiner/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T15:34:03Z",
      "updated_at": "2023-08-27T15:36:30Z",
      "author_association": "NONE",
      "body": "I just tried with a direct RPC call using this [script](https://github.com/pythcoiner/BitcoinRpcClient/blob/30dd854a26ae4db89b860fbb2c23497db41571d0/main.py), everything goes well.\r\n\r\n> IIRC someone else had an issue like this and the problem was that their shell was eating the `'`. Can you check that that isn't what's happening?\r\n> \r\nany idea how to check this? using another shell?\r\n\r\n> Can you also try with the latest master branch? There have been a few fixes for descriptors since 25.0 was released, so this may already be fixed.\r\n\r\nwill build from the last master\r\n",
      "user": {
        "login": "pythcoiner",
        "id": 124568858,
        "node_id": "U_kgDOB2zFGg",
        "avatar_url": "https://avatars.githubusercontent.com/u/124568858?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pythcoiner",
        "html_url": "https://github.com/pythcoiner",
        "followers_url": "https://api.github.com/users/pythcoiner/followers",
        "following_url": "https://api.github.com/users/pythcoiner/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pythcoiner/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pythcoiner/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pythcoiner/subscriptions",
        "organizations_url": "https://api.github.com/users/pythcoiner/orgs",
        "repos_url": "https://api.github.com/users/pythcoiner/repos",
        "events_url": "https://api.github.com/users/pythcoiner/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pythcoiner/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28351#issuecomment-1694697402",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351"
    },
    {
      "event": "commented",
      "id": 1694699418,
      "node_id": "IC_kwDOABII585lAw-a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1694699418",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T15:43:29Z",
      "updated_at": "2023-08-27T15:44:56Z",
      "author_association": "MEMBER",
      "body": "> I just tried with a direct RPC call using this [script](https://github.com/pythcoiner/BitcoinRpcClient/blob/30dd854a26ae4db89b860fbb2c23497db41571d0/main.py), everything goes well.\r\n\r\nTo clarify, the script uses the checksum returned by `getdescriptorinfo`, and everything imports successfully and `listdescriptors` shows the correct descriptor as expected?\r\n\r\n> any idea how to check this? using another shell?\r\n\r\nUsing a script is good enough. It tells you that there's something wrong with your command or your shell.\r\n\r\n***\r\n\r\nLooking at this a bit more closely, I see now that the issue is that you've entered the command without escaping your `'`. You begin the entire imports argument with a `'`, so the internal `'` for the key origins are going to be interpreted by your shell as being the end of a string rather than a character to include in the string. You can even see this in how github renders those characters with different colors. You'll need to figure out how to escape them for your shell (typically `\\'` works), or just use `h`s.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28351#issuecomment-1694699418",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28351"
    },
    {
      "event": "closed",
      "id": 10202051257,
      "node_id": "CE_lADOABII585vX22UzwAAAAJgFvK5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10202051257",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T15:43:29Z"
    },
    {
      "event": "locked",
      "id": 14013375638,
      "node_id": "LOE_lADOABII585vX22UzwAAAANDQySW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14013375638",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T13:13:42Z"
    }
  ]
}