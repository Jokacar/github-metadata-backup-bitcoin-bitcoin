{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138",
    "id": 830446452,
    "node_id": "PR_kwDOABII584xf5t0",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/24138",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/24138.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/24138.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24138",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24138/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/691d45fdc83ec14f87a400f548553168ac70263f",
    "number": 24138,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "index: Commit MuHash and best block together for coinstatsindex",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixes #24076\r\n\r\nCoinstatsindex currently writes the MuHash (`DB_MUHASH`) to disk in `CoinStatsIndex::WriteBlock()` and `CoinStatsIndex::ReverseBlock()`, but the best synced block is written in `BaseIndex::Commit()`. These are called at different points in time, both during the ThreadSync phase, and also after the initial sync is finished and validation callbacks (`BlockConnected()` vs `ChainStateFlushed()`) perform the syncing.\r\n\r\nAs a result, the index DB is temporarily in an inconsistent state, and if bitcoind is terminated uncleanly (so that there is no time to call `Commit()` by receiving an interrupt or by flushing the chainstate) this leads to problems:\r\nOn the next startup, `Init()` will read the best block and a MuHash that corresponds to a different (higher) block. Indexing will  be picked up at the the best block processing some blocks again, but since MuHash is a rolling hash, it will process some utxos twice and the muhashes for all future blocks will be wrong, as was observed in #24076.\r\n\r\nFix this by always committing `DB_MUHASH` together with `DB_BEST_BLOCK`.\r\n\r\nNote that the block data for the index is still written at different times, but this does not corrupt the index - at worst, these entries will be processed another time and overwritten after an unclean shutdown and restart.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2022-01-24T14:10:20Z",
    "updated_at": "2023-03-09T10:18:14Z",
    "closed_at": "2022-03-09T10:45:32Z",
    "mergeable_state": "unknown",
    "merged_at": "2022-03-09T10:45:32Z",
    "merge_commit_sha": "7003b6ab24f6adfffd71d7b7d4182afde52ff859",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "mzumsande:202201_coinstatsindex_commits",
      "ref": "202201_coinstatsindex_commits",
      "sha": "691d45fdc83ec14f87a400f548553168ac70263f",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 187673073,
        "node_id": "MDEwOlJlcG9zaXRvcnkxODc2NzMwNzM=",
        "name": "bitcoin",
        "full_name": "mzumsande/bitcoin",
        "owner": {
          "login": "mzumsande",
          "id": 48763452,
          "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
          "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/mzumsande",
          "html_url": "https://github.com/mzumsande",
          "followers_url": "https://api.github.com/users/mzumsande/followers",
          "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
          "organizations_url": "https://api.github.com/users/mzumsande/orgs",
          "repos_url": "https://api.github.com/users/mzumsande/repos",
          "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/mzumsande/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/mzumsande/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/mzumsande/bitcoin",
        "archive_url": "https://api.github.com/repos/mzumsande/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/mzumsande/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/mzumsande/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/mzumsande/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/mzumsande/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/mzumsande/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/mzumsande/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/mzumsande/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/mzumsande/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/mzumsande/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/mzumsande/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/mzumsande/bitcoin/events",
        "forks_url": "https://api.github.com/repos/mzumsande/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/mzumsande/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/mzumsande/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/mzumsande/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/mzumsande/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/mzumsande/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/mzumsande/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/mzumsande/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/mzumsande/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/mzumsande/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/mzumsande/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/mzumsande/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/mzumsande/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:mzumsande/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/mzumsande/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/mzumsande/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/mzumsande/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/mzumsande/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/mzumsande/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/mzumsande/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/mzumsande/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/mzumsande/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/mzumsande/bitcoin/hooks",
        "svn_url": "https://github.com/mzumsande/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 218813,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-07-28T17:06:51Z",
        "created_at": "2019-05-20T16:03:10Z",
        "updated_at": "2023-07-28T06:57:51Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "48a90c61e2269e6de78416001dd28bf3e12d9ebe",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35476,
        "stargazers_count": 70608,
        "watchers_count": 70608,
        "size": 236222,
        "default_branch": "master",
        "open_issues_count": 672,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-08-02T23:07:27Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-08-02T18:21:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 83,
    "deletions": 12,
    "changed_files": 6,
    "commits": 2,
    "review_comments": 14,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 1020140609,
      "node_id": "IC_kwDOABII5848zhxB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1020140609",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-24T14:10:47Z",
      "updated_at": "2022-01-24T14:10:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "FYI @fjahr",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#issuecomment-1020140609",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24138"
    },
    {
      "event": "mentioned",
      "id": 5942783917,
      "node_id": "MEE_lADOABII585CUnCdzwAAAAFiN6-t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5942783917",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-24T14:10:48Z"
    },
    {
      "event": "subscribed",
      "id": 5942783922,
      "node_id": "SE_lADOABII585CUnCdzwAAAAFiN6-y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5942783922",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-24T14:10:48Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-24T14:13:50Z",
      "updated_at": "2022-01-24T14:13:50Z",
      "source": {
        "issue": {
          "id": 1104696689,
          "node_id": "I_kwDOABII585B2FVx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24076",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24076/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24076/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24076/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/24076",
          "number": 24076,
          "state": "closed",
          "state_reason": "completed",
          "title": "coinstatsindex way more fragile than any other data w.r.t. power loss",
          "body": "\r\n<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\n\r\n<!-- Describe the issue -->\r\n\r\n**Two times since a fresh 22.0 installation I've had a power loss event (artifically produced to test system behavior), and each time I've started getting incorrect muhash values for block heights since approximately that moment**\r\n\r\n\"Approximately\", as in I've not taken care to record the exact time of events because I've expecting nothing of interest from bitcoind in particular; \"incorrect\", as in compared to my another long-running nodes running with coinstatsindex without power outages, **and** to its own muhash for the current tip calculated without using the index, `gettxoutsetinfo muhash null false`.\r\n\r\n**Expected behavior**\r\n\r\nAs usual when testing power outage behavior, I've expected pretty much anything **except** silently returning incorrect data. Most desirable would be checking several recent block muhashes on restart and auto-correcting the problem.\r\n \r\n**To reproduce**\r\n\r\nUnsure if it can be reproduced reliably, but 2/2 times are rather good indicator that it may not be uncommon \r\n\r\n**System information**\r\n\r\nUbuntu Linux 20.04, `~/.bitcoin` on /dev/md raid1 over two HDDs, ext4 fs with default mount options\r\n\r\nRunning bitcoind 22.0 prebuilt binaries from bitcoincore (amd64).\r\n\r\nHere's debug.log from a typical restart (I see nothing interesting there, just in case if some configured or autodetected parameters are relevant):\r\n```\r\n 2022-01-14T17:10:34Z Bitcoin Core version v22.0.0 (release build)\r\n2022-01-14T17:10:34Z Assuming ancestors of block 00000000000000000008a89e854d57e5667df88f1cdef6fde2fbca1de5b639ad have valid signatures.\r\n2022-01-14T17:10:34Z Setting nMinimumChainWork=00000000000000000000000000000000000000001fa4663bbbe19f82de910280\r\n2022-01-14T17:10:34Z Using the 'shani(1way,2way)' SHA256 implementation\r\n2022-01-14T17:10:34Z Using RdSeed as additional entropy source\r\n2022-01-14T17:10:34Z Using RdRand as an additional entropy source\r\n2022-01-14T17:10:34Z Default data directory /home/bitnode/.bitcoin\r\n2022-01-14T17:10:34Z Using data directory /srv/slow/dot-bitcoin\r\n2022-01-14T17:10:34Z Config file: /etc/bitcoin/bitcoin.conf\r\n2022-01-14T17:10:34Z Config file arg: blockfilterindex=\"1\"\r\n2022-01-14T17:10:34Z Config file arg: coinstatsindex=\"1\"\r\n2022-01-14T17:10:34Z Config file arg: dbcache=\"2000\"\r\n2022-01-14T17:10:34Z Config file arg: listen=\"1\"\r\n2022-01-14T17:10:34Z Config file arg: maxuploadtarget=\"450\"\r\n2022-01-14T17:10:34Z Config file arg: peerblockfilters=\"1\"\r\n2022-01-14T17:10:34Z Config file arg: server=\"1\"\r\n2022-01-14T17:10:34Z Config file arg: txindex=\"1\"\r\n2022-01-14T17:10:34Z Config file arg: upnp=\"0\"\r\n2022-01-14T17:10:34Z Config file arg: whitelist=\"download@127.0.0.1\"\r\n2022-01-14T17:10:34Z Config file arg: whitelist=\"download@192.168.1.0/24\"\r\n2022-01-14T17:10:34Z Config file arg: zmqpubrawblock=\"tcp://127.0.0.1:28332\"\r\n2022-01-14T17:10:34Z Config file arg: zmqpubrawtx=\"tcp://127.0.0.1:28333\"\r\n2022-01-14T17:10:34Z Command-line arg: conf=\"/etc/bitcoin/bitcoin.conf\"\r\n2022-01-14T17:10:34Z Command-line arg: daemonwait=\"\"\r\n2022-01-14T17:10:34Z Command-line arg: datadir=\"/srv/slow/dot-bitcoin/\"\r\n2022-01-14T17:10:34Z Command-line arg: pid=\"/run/bitcoind/bitcoind.pid\"\r\n2022-01-14T17:10:34Z Using at most 125 automatic connections (1024 file descriptors available)\r\n2022-01-14T17:10:34Z Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2022-01-14T17:10:34Z Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2022-01-14T17:10:34Z Script verification uses 15 additional threads\r\n2022-01-14T17:10:34Z scheduler thread start\r\n2022-01-14T17:10:34Z HTTP: creating work queue of depth 16\r\n2022-01-14T17:10:34Z Using random cookie authentication.\r\n2022-01-14T17:10:34Z Generated RPC authentication cookie /srv/slow/dot-bitcoin/.cookie\r\n2022-01-14T17:10:34Z HTTP: starting 4 worker threads\r\n2022-01-14T17:10:34Z Using wallet directory /srv/slow/dot-bitcoin/wallets\r\n2022-01-14T17:10:34Z init message: Verifying wallet(s)…\r\n2022-01-14T17:10:34Z init message: Loading banlist…\r\n2022-01-14T17:10:34Z SetNetworkActive: true\r\n2022-01-14T17:10:34Z Using /16 prefix for IP bucketing\r\n2022-01-14T17:10:34Z Cache configuration:\r\n2022-01-14T17:10:34Z * Using 2.0 MiB for block index database\r\n2022-01-14T17:10:34Z * Using 249.8 MiB for transaction index database\r\n2022-01-14T17:10:34Z * Using 218.5 MiB for basic block filter index database\r\n2022-01-14T17:10:34Z * Using 8.0 MiB for chain state database\r\n2022-01-14T17:10:34Z * Using 1521.7 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\r\n2022-01-14T17:10:34Z init message: Loading block index…\r\n2022-01-14T17:10:34Z Switching active chainstate to Chainstate [ibd] @ height -1 (null)\r\n2022-01-14T17:10:34Z Opening LevelDB in /srv/slow/dot-bitcoin/blocks/index\r\n2022-01-14T17:10:34Z Opened LevelDB successfully\r\n2022-01-14T17:10:34Z Using obfuscation key for /srv/slow/dot-bitcoin/blocks/index: 0000000000000000\r\n2022-01-14T17:10:38Z LoadBlockIndexDB: last block file = 2883\r\n2022-01-14T17:10:38Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=17, size=20113255, heights=718645...718661, time=2022-01-14...2022-01-14)\r\n2022-01-14T17:10:38Z Checking all blk files are present...\r\n2022-01-14T17:10:38Z Opening LevelDB in /srv/slow/dot-bitcoin/chainstate\r\n2022-01-14T17:10:39Z Opened LevelDB successfully\r\n2022-01-14T17:10:39Z Using obfuscation key for /srv/slow/dot-bitcoin/chainstate: d57f45de91bd35fa\r\n2022-01-14T17:10:39Z Loaded best chain: hashBestChain=000000000000000000001cab1821f8b5ce71faccfde4d9ae11ab444c0dff979f height=718643 date=2022-01-14T14:19:04Z progress=0.999964\r\n2022-01-14T17:10:39Z init message: Verifying blocks…\r\n2022-01-14T17:10:39Z Verifying last 6 blocks at level 3\r\n2022-01-14T17:10:39Z [0%]...[16%]...[33%]...[50%]...[66%]...[83%]...[99%]...[DONE].\r\n2022-01-14T17:12:34Z No coin database inconsistencies in last 6 blocks (9259 transactions)\r\n2022-01-14T17:12:34Z  block index          120309ms\r\n2022-01-14T17:12:34Z Opening LevelDB in /srv/slow/dot-bitcoin/indexes/txindex\r\n2022-01-14T17:12:35Z Opened LevelDB successfully\r\n2022-01-14T17:12:35Z Using obfuscation key for /srv/slow/dot-bitcoin/indexes/txindex: 0000000000000000\r\n2022-01-14T17:12:35Z txindex thread start\r\n2022-01-14T17:12:35Z txindex is enabled at height 718643\r\n2022-01-14T17:12:35Z txindex thread exit\r\n2022-01-14T17:12:35Z Opening LevelDB in /srv/slow/dot-bitcoin/indexes/blockfilter/basic/db\r\n2022-01-14T17:12:35Z Opened LevelDB successfully\r\n2022-01-14T17:12:35Z Using obfuscation key for /srv/slow/dot-bitcoin/indexes/blockfilter/basic/db: 0000000000000000\r\n2022-01-14T17:12:35Z basic block filter index thread start\r\n2022-01-14T17:12:35Z basic block filter index is enabled at height 718643\r\n2022-01-14T17:12:35Z basic block filter index thread exit\r\n2022-01-14T17:12:35Z Opening LevelDB in /srv/slow/dot-bitcoin/indexes/coinstats/db\r\n2022-01-14T17:12:36Z Opened LevelDB successfully\r\n2022-01-14T17:12:36Z Using obfuscation key for /srv/slow/dot-bitcoin/indexes/coinstats/db: 0000000000000000\r\n2022-01-14T17:12:36Z coinstatsindex thread start\r\n2022-01-14T17:12:36Z coinstatsindex is enabled at height 718643\r\n2022-01-14T17:12:36Z coinstatsindex thread exit\r\n2022-01-14T17:12:36Z block tree size = 718667\r\n2022-01-14T17:12:36Z nBestHeight = 718643\r\n2022-01-14T17:12:36Z loadblk thread start\r\n....\r\n```\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\n<!-- GUI-related issue? What is your operating system and its version? If Linux, what is your desktop environment and graphical shell? -->\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n",
          "user": {
            "login": "akovalenko",
            "id": 366668,
            "node_id": "MDQ6VXNlcjM2NjY2OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/366668?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/akovalenko",
            "html_url": "https://github.com/akovalenko",
            "followers_url": "https://api.github.com/users/akovalenko/followers",
            "following_url": "https://api.github.com/users/akovalenko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/akovalenko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/akovalenko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/akovalenko/subscriptions",
            "organizations_url": "https://api.github.com/users/akovalenko/orgs",
            "repos_url": "https://api.github.com/users/akovalenko/repos",
            "events_url": "https://api.github.com/users/akovalenko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/akovalenko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "NONE",
          "locked": true,
          "comments": 6,
          "closed_at": "2022-03-09T10:45:30Z",
          "created_at": "2022-01-15T12:06:05Z",
          "updated_at": "2023-03-09T10:18:15Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5942846314,
      "node_id": "HRFPE_lADOABII585CUnCdzwAAAAFiOKNq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5942846314",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-24T14:19:10Z"
    },
    {
      "event": "labeled",
      "id": 5943286376,
      "node_id": "LE_lADOABII585CUnCdzwAAAAFiP1po",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5943286376",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-24T15:15:53Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-26T00:13:16Z",
      "updated_at": "2022-01-26T00:13:16Z",
      "source": {
        "issue": {
          "id": 1113845812,
          "node_id": "PR_kwDOABII584xjnwj",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24150",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24150/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24150/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24150/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24150",
          "number": 24150,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: move index class members from protected to private",
          "body": "Simplify the index base and child classes and improve encapsulation and clarity by making fully overridden virtual member functions `private`. In the child classes, this allows having only public and private members. This change also help contributors add virtual functions into the correct section. Also rename the `GetName()` getters to `GetIndexName()` for clarity and easier grepping/reviewing.\r\n\r\nSome context:\r\n\r\nA base class virtual function doesn't need to be accessible to be overridden, but it can only be `private` if fully overridden, e.g. no inherited base implementation is used by the child classes.\r\n\r\nReferences:\r\n\r\n- https://en.cppreference.com/w/cpp/language/virtual: \"Base::vf does not need to be accessible or visible to be overridden. (Base::vf can be declared private, or Base can be inherited using private inheritance.)\"\r\n\r\n- \"An implementation member should be protected if it provides an operation or data that a derived class will need to use in its own implementation. Otherwise, implementation members should be private.\" - C++ Primer (Lippman, Lajoie, Moo)\r\n\r\n- Herb Sutter in http://www.gotw.ca/publications/mill18.htm: \"Make virtual functions private, and only if derived classes need to invoke the base implementation of a virtual function, make the virtual function protected. Prefer to make interfaces non-virtual using the Template pattern.\"\r\n",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 16,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24150",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24150",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24150.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24150.patch"
          },
          "closed_at": "2023-04-25T11:08:34Z",
          "created_at": "2022-01-25T12:45:21Z",
          "updated_at": "2023-04-25T11:08:35Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1021753569,
      "node_id": "IC_kwDOABII58485rjh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1021753569",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-26T00:58:52Z",
      "updated_at": "2022-02-02T07:14:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#24230](https://github.com/bitcoin/bitcoin/pull/24230) (indexes: Stop using node internal types and locking cs_main, improve sync logic by ryanofsky)\n* [#24150](https://github.com/bitcoin/bitcoin/pull/24150) (refactor: move index class members from protected to private by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#issuecomment-1021753569",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24138"
    },
    {
      "event": "reviewed",
      "id": 867009704,
      "node_id": "PRR_kwDOABII584zrYSo",
      "url": null,
      "actor": null,
      "commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-867009704",
      "submitted_at": "2022-01-29T21:00:13Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-02T04:02:54Z",
      "updated_at": "2022-02-02T04:02:54Z",
      "source": {
        "issue": {
          "id": 1120958552,
          "node_id": "PR_kwDOABII584x6sdb",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24230",
          "number": 24230,
          "state": "open",
          "state_reason": null,
          "title": "indexes: Stop using node internal types and locking cs_main, improve sync logic",
          "body": "This PR lets indexing code mostly run outside of the node process. It also improves indexing sync logic, which is moved out of indexing code to a new [`node::SyncChain()`](https://github.com/ryanofsky/bitcoin/blob/8d8cdcb37005030f646ba3c45f7f54f556efb8bf/src/node/chain.h#L24-L39) function.\r\n\r\nAlmost all the commits in this PR are small refactoring changes that move code from `src/index/` to `src/node/`, or replace references to node types like `CBlockIndex`, `CChain`, `CChainState` in index code. There are only two commits affecting indexing sync logic which make complicated or substantive changes:\r\n\r\n- [`da6dc24e3c4f` indexes: Rewrite chain sync logic, remove racy init](https://github.com/bitcoin/bitcoin/pull/24230/commits/da6dc24e3c4fd8f99d869acc085384e8b2f32c8e)\r\n- [`d4a2320a77e1` indexes: Initialize indexes without holding cs_main](https://github.com/bitcoin/bitcoin/pull/24230/commits/d4a2320a77e1a25f89b53dbdda40551959c174c2)\r\n\r\nThe commit messages have more details about these and other changes. Followups to this PR will reuse indexing sync code for wallets (#15719, #11756) and let indexes run in separate processes (#10102)",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 35,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24230",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24230",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24230.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24230.patch"
          },
          "created_at": "2022-02-01T16:56:28Z",
          "updated_at": "2023-08-02T21:09:57Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 875969643,
      "node_id": "PRR_kwDOABII5840Njxr",
      "url": null,
      "actor": null,
      "commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nIt might be worth rebasing this on #24133 and if at all possible, add a test that triggers the error added there.\r\n\r\nI think overriding `CommitInternal` makes sense given that we require `DB_MUHASH` and `DB_BEST_BLOCK` to be in sync (which we explicitly check as of #24133).\r\n\r\nThe alternative would be to drop `DB_MUHASH` altogether, but since MuHash can't (?) be initialized from a finalized hash, we would have to index both the denominator and numerator.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-875969643",
      "submitted_at": "2022-02-08T12:43:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "reviewed",
      "id": 880885450,
      "node_id": "PRR_kwDOABII5840gT7K",
      "url": null,
      "actor": null,
      "commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 010156c07f28e2c8dc30d4408942d1e1d88ab54d\r\n\r\nWhile I can not reproduce the issue I agree that this is likely to fix #24076.\r\n\r\nI think there could still be inconsistencies between the running muhash and the coinstats data since those are not batched anymore now but at least that would then lead to a failure in `Init()` at restart. This could be avoided by squashing all of that into `CommitInternal()` as well ([drafted here](https://github.com/fjahr/bitcoin/commit/a90394efb9b348b7d3615d61fbea612470b1c75c)) but I don't think this is necessary right now. As I have reviewed this I am now really not sure about the boundaries between `Commit()` and `WriteBlock()` anymore and will think about refactoring that while reviewing #24230 (maybe that's already solved there).",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-880885450",
      "submitted_at": "2022-02-13T00:14:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-17T20:06:24Z",
      "updated_at": "2022-02-17T20:06:24Z",
      "source": {
        "issue": {
          "id": 1111920224,
          "node_id": "PR_kwDOABII584xdYf2",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24133",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24133/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24133/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24133/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24133",
          "number": 24133,
          "state": "closed",
          "state_reason": null,
          "title": "index: Improve robustness of coinstatsindex at restart",
          "body": "This change lets the `coinstatsindex` fail loudly in case the internal `muhash` state differs from the last finalized output saved on disk, which would indicate that the `muhash` state somehow got out of sync. This should generally not happen since both are written to disk in a batch but #24076 seems to indicate that the might still be an issue.\r\n\r\nSince #24076 so far can not be reproduced reliably, the issue should not be closed yet. Further investigation and testing needs to be done.",
          "user": {
            "login": "fjahr",
            "id": 1322187,
            "node_id": "MDQ6VXNlcjEzMjIxODc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fjahr",
            "html_url": "https://github.com/fjahr",
            "followers_url": "https://api.github.com/users/fjahr/followers",
            "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
            "organizations_url": "https://api.github.com/users/fjahr/orgs",
            "repos_url": "https://api.github.com/users/fjahr/repos",
            "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/fjahr/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24133",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24133",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24133.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24133.patch"
          },
          "closed_at": "2022-02-20T11:30:50Z",
          "created_at": "2022-01-23T16:33:35Z",
          "updated_at": "2023-02-20T10:13:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 886505099,
      "node_id": "PRR_kwDOABII58401v6L",
      "url": null,
      "actor": null,
      "commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 010156c07f28e2c8dc30d4408942d1e1d88ab54d\r\n\r\nIt would be good to add a unit test to coinstatsindex_tests that triggers the issue this is supposed to fix. I think the test would just need to make the index object, send a BlockConnected notification, and then destroy the index object without sending ChainStateFlushed notification. This would save a corrupted index that should result in errors next time it is loaded.\r\n\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-880885450\r\n\r\n> I think there could still be inconsistencies between the running muhash and the coinstats data since those are not batched anymore now but at least that would then lead to a failure in `Init()` at restart.\r\n\r\nI could be wrong but this seems fine to me since coinstats data is accessed by height and written before the muhash & best block. So if the coinstats data is ahead of the muhash. it is just ignored. In your suggested followup a90394efb9b348b7d3615d61fbea612470b1c75c, I think the `if (!m_db->Read(DBHeightKey(pindex->nHeight))` check would be good to add, but I think it should it should just trigger a fatal error if the key isn't found. I don't see how the recovery code added in that commit would work.\r\n\r\n> #24230 (maybe that's already solved there).\r\n\r\nMy guess is #24230 doesn't affect this, since it's trying to leave index's internal behavior the same, and just change the way it receives block connected and disconnected notifications, without changing the way it handles them.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-886505099",
      "submitted_at": "2022-02-17T20:53:57Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGViNmNjMDVkYTMyYzViZGUxMjI3MjVhMGJjOTA3ZDM3NjdhNzkxY2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb6cc05da32c5bde122725a0bc907d3767a791cd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/eb6cc05da32c5bde122725a0bc907d3767a791cd",
      "tree": {
        "sha": "5a9b70c648c3c1232b2feb1e2306345106ebba34",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5a9b70c648c3c1232b2feb1e2306345106ebba34"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48a90c61e2269e6de78416001dd28bf3e12d9ebe",
          "sha": "48a90c61e2269e6de78416001dd28bf3e12d9ebe",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/48a90c61e2269e6de78416001dd28bf3e12d9ebe"
        }
      ],
      "message": "index: Commit DB_MUHASH and DB_BEST_BLOCK to disk together\n\nIf these are written to disk at different times,\nunclean shutdowns can lead to index corruption.",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2022-02-21T16:37:19Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2022-01-24T13:34:28Z"
      },
      "sha": "eb6cc05da32c5bde122725a0bc907d3767a791cd"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6112900208,
      "node_id": "HRFPE_lADOABII585CUnCdzwAAAAFsW3Rw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6112900208",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-21T16:39:51Z"
    },
    {
      "event": "commented",
      "id": 1047069965,
      "node_id": "IC_kwDOABII584-aQUN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1047069965",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-21T16:51:50Z",
      "updated_at": "2022-02-21T16:53:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "I pushed an update, rebasing (with #24133 merged) and addressing feedback (adding a comment).\r\n\r\n> It would be good to add a unit test to coinstatsindex_tests that triggers the issue this is supposed to fix. I think the test would just need to make the index object, send a BlockConnected notification, and then destroy the index object without sending ChainStateFlushed notification. This would save a corrupted index that should result in errors next time it is loaded.\r\n\r\nThis would be great. I haven't done this with this push, because \r\na) I couldn't make it work yet, I had some technical difficulties with the test framework when restarting the index. I will look into it more unless\r\nb) @fjahr who said [here](https://github.com/bitcoin/bitcoin/pull/24133#discussion_r810605240) that he is working on this has more success.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#issuecomment-1047069965",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24138"
    },
    {
      "event": "mentioned",
      "id": 6112968251,
      "node_id": "MEE_lADOABII585CUnCdzwAAAAFsXH47",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6112968251",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-21T16:51:51Z"
    },
    {
      "event": "subscribed",
      "id": 6112968257,
      "node_id": "SE_lADOABII585CUnCdzwAAAAFsXH5B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6112968257",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-21T16:51:51Z"
    },
    {
      "event": "reviewed",
      "id": 890287985,
      "node_id": "PRR_kwDOABII5841ELdx",
      "url": null,
      "actor": null,
      "commit_id": "eb6cc05da32c5bde122725a0bc907d3767a791cd",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK eb6cc05da32c5bde122725a0bc907d3767a791cd.  Only changes since previous review are rebasing and adding comments.\r\n\r\n@mzumsande I wrote a little test which passes with this bugfix, and fails with the fix reverted. Feel free to add it to this PR or use the code in any way: ~ded9fda2b6e154ac64b2fc755ddaa738b309b7e9~ d3c2ebbfdc3c61a04b645c6bb435424fa60f4a0b",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-890287985",
      "submitted_at": "2022-02-22T19:50:21Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY5MWQ0NWZkYzgzZWMxNGY4N2E0MDBmNTQ4NTUzMTY4YWM3MDI2M2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/691d45fdc83ec14f87a400f548553168ac70263f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/691d45fdc83ec14f87a400f548553168ac70263f",
      "tree": {
        "sha": "b23ab4d4491be274e42abc4e961fe543884fbb2f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b23ab4d4491be274e42abc4e961fe543884fbb2f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb6cc05da32c5bde122725a0bc907d3767a791cd",
          "sha": "eb6cc05da32c5bde122725a0bc907d3767a791cd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eb6cc05da32c5bde122725a0bc907d3767a791cd"
        }
      ],
      "message": "Add coinstatsindex_unclean_shutdown test",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2022-02-25T21:06:27Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2022-02-22T19:48:57Z"
      },
      "sha": "691d45fdc83ec14f87a400f548553168ac70263f"
    },
    {
      "event": "commented",
      "id": 1055472029,
      "node_id": "IC_kwDOABII584-6Tmd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1055472029",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-01T14:02:19Z",
      "updated_at": "2022-03-01T14:02:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "> @mzumsande I wrote a little test which passes with this bugfix, and fails with the fix reverted. Feel free to add it to this PR or use the code in any way: ~[ded9fda](https://github.com/bitcoin/bitcoin/commit/ded9fda2b6e154ac64b2fc755ddaa738b309b7e9)~ [d3c2ebb](https://github.com/bitcoin/bitcoin/commit/d3c2ebbfdc3c61a04b645c6bb435424fa60f4a0b)\r\n\r\nThank you! The test looks great, I added your commit to this PR (and confirmed that it fails on master).\r\n",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#issuecomment-1055472029",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24138"
    },
    {
      "event": "mentioned",
      "id": 6162264214,
      "node_id": "MEE_lADOABII585CUnCdzwAAAAFvTLCW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6162264214",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-01T14:02:19Z"
    },
    {
      "event": "subscribed",
      "id": 6162264222,
      "node_id": "SE_lADOABII585CUnCdzwAAAAFvTLCe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6162264222",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-01T14:02:19Z"
    },
    {
      "event": "reviewed",
      "id": 898205256,
      "node_id": "PRR_kwDOABII5841iYZI",
      "url": null,
      "actor": null,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 691d45fdc83ec14f87a400f548553168ac70263f. Only change since last review is adding test",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-898205256",
      "submitted_at": "2022-03-02T21:38:38Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "reviewed",
      "id": 901078124,
      "node_id": "PRR_kwDOABII5841tVxs",
      "url": null,
      "actor": null,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK 691d45fdc83ec14f87a400f548553168ac70263f\r\n\r\nReviewed code and ensured that the newly added test fails when eb6cc05da32c5bde122725a0bc907d3767a791cd is reverted.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#pullrequestreview-901078124",
      "submitted_at": "2022-03-06T14:09:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
    },
    {
      "event": "merged",
      "id": 6208999535,
      "node_id": "ME_lADOABII585CUnCdzwAAAAFyFdBv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6208999535",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7003b6ab24f6adfffd71d7b7d4182afde52ff859",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7003b6ab24f6adfffd71d7b7d4182afde52ff859",
      "created_at": "2022-03-09T10:45:32Z"
    },
    {
      "event": "closed",
      "id": 6208999558,
      "node_id": "CE_lADOABII585CUnCdzwAAAAFyFdCG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6208999558",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-09T10:45:32Z"
    },
    {
      "event": "referenced",
      "id": 6211328517,
      "node_id": "REFE_lADOABII585CUnCdzwAAAAFyOVoF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6211328517",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "fea9761a68a7bdf2a508f9529dc5664f9cc62942",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/fea9761a68a7bdf2a508f9529dc5664f9cc62942",
      "created_at": "2022-03-09T16:28:00Z"
    },
    {
      "event": "locked",
      "id": 8705928293,
      "node_id": "LOE_lADOABII585CUnCdzwAAAAIG6exl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8705928293",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-09T10:18:14Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795092758",
      "pull_request_review_id": 867009704,
      "id": 795092758,
      "node_id": "PRRC_kwDOABII584vZCcW",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);\n-    batch.Write(DBHeightKey(pindex->nHeight), value);\n-    batch.Write(DB_MUHASH, m_muhash);\n-    return m_db->WriteBatch(batch);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't see why this should change. The `CommitInternal` override feels like a hacky refactor.",
      "created_at": "2022-01-29T20:59:12Z",
      "updated_at": "2022-01-29T21:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r795092758",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795092758"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": 231,
      "original_start_line": 231,
      "start_side": "LEFT",
      "line": 234,
      "original_line": 234,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795092834",
      "pull_request_review_id": 867009704,
      "id": 795092834,
      "node_id": "PRRC_kwDOABII584vZCdi",
      "diff_hunk": "@@ -481,5 +486,5 @@ bool CoinStatsIndex::ReverseBlock(const CBlock& block, const CBlockIndex* pindex\n     Assert(m_total_unspendables_scripts == read_out.second.total_unspendables_scripts);\n     Assert(m_total_unspendables_unclaimed_rewards == read_out.second.total_unspendables_unclaimed_rewards);\n \n-    return m_db->Write(DB_MUHASH, m_muhash);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 33,
      "original_position": 31,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Seems like the only problem is this lone line?",
      "created_at": "2022-01-29T21:00:08Z",
      "updated_at": "2022-01-29T21:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r795092834",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795092834"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 492,
      "original_line": 492,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795096236",
      "pull_request_review_id": 867012252,
      "id": 795096236,
      "node_id": "PRRC_kwDOABII584vZDSs",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);\n-    batch.Write(DBHeightKey(pindex->nHeight), value);\n-    batch.Write(DB_MUHASH, m_muhash);\n-    return m_db->WriteBatch(batch);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092758,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this is spot is problematic, and the reason for the behavior reported in #24076: \r\n\r\nIf we persist `DB_MUHASH` here in each `BlockConnected()` callback, but not `DB_BEST_BLOCK` (which is persisted only in `ChainStateFlushed()` callbacks and will therefore at this point in time have a lower height), the db is temporarily in an inconsistent state.\r\n\r\nSo in case of an unclean shutdown (with no time to flush the chainstate to disk to get in sync again), on next startup the index will initialize with the older `DB_BEST_BLOCK` but a `DB_MUHASH` which contains data from newer blocks. The index then reprocesses the blocks after `DB_BEST_BLOCK`'s height a second time. \r\nBut MuHash is a rolling hash, so it will incorporate data from these blocks twice, and the hash will be incorrect.",
      "created_at": "2022-01-29T21:41:44Z",
      "updated_at": "2022-01-29T21:41:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r795096236",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/795096236"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": 231,
      "original_start_line": 231,
      "start_side": "LEFT",
      "line": 234,
      "original_line": 234,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801593190",
      "pull_request_review_id": 875973739,
      "id": 801593190,
      "node_id": "PRRC_kwDOABII584vx1dm",
      "diff_hunk": "@@ -481,5 +486,5 @@ bool CoinStatsIndex::ReverseBlock(const CBlock& block, const CBlockIndex* pindex\n     Assert(m_total_unspendables_scripts == read_out.second.total_unspendables_scripts);\n     Assert(m_total_unspendables_unclaimed_rewards == read_out.second.total_unspendables_unclaimed_rewards);\n \n-    return m_db->Write(DB_MUHASH, m_muhash);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 33,
      "original_position": 31,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092834,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If I replace only that line with `true` (or `false` for that matter) the reorg test in `feature_coinstatsindex.py` still passes. But not sure if that helps with the original issue (and it indicates an obvious test coverage omission, cc @fjahr).",
      "created_at": "2022-02-08T12:46:53Z",
      "updated_at": "2022-02-08T12:48:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r801593190",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/801593190"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 492,
      "original_line": 492,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805197117",
      "pull_request_review_id": 880885450,
      "id": 805197117,
      "node_id": "PRRC_kwDOABII584v_lU9",
      "diff_hunk": "@@ -481,5 +486,5 @@ bool CoinStatsIndex::ReverseBlock(const CBlock& block, const CBlockIndex* pindex\n     Assert(m_total_unspendables_scripts == read_out.second.total_unspendables_scripts);\n     Assert(m_total_unspendables_unclaimed_rewards == read_out.second.total_unspendables_unclaimed_rewards);\n \n-    return m_db->Write(DB_MUHASH, m_muhash);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 33,
      "original_position": 31,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092834,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Only replacing this line means the rolling `muhash` state is not persisted during reorgs. That would be a problem if the node gets shut down during the reorg, then we would risk an inconsistent state or probably the index wouldn't even start up anymore because the guard check in `Init()` would fail.",
      "created_at": "2022-02-12T19:44:24Z",
      "updated_at": "2022-02-13T00:14:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r805197117",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805197117"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 492,
      "original_line": 492,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805201361",
      "pull_request_review_id": 880885450,
      "id": 805201361,
      "node_id": "PRRC_kwDOABII584v_mXR",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);\n-    batch.Write(DBHeightKey(pindex->nHeight), value);\n-    batch.Write(DB_MUHASH, m_muhash);\n-    return m_db->WriteBatch(batch);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092758,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it was not considered hacky by the author of the current index architecture because it's done the same way in `blockfilterindex.cpp` and the documentation in `index/base.h` also states that this method can be overridden.\r\n\r\nObviously, I did it differently here but I can't remember if that was a deliberate choice or rather just lack of understanding (probably the latter).\r\n\r\nAnd that doesn't mean there isn't mayor room for refactoring here. But it looks like #24230 should be considered first when thinking about it first. I have not started reviewing it yet.",
      "created_at": "2022-02-12T20:30:13Z",
      "updated_at": "2022-02-13T00:14:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r805201361",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/805201361"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": 231,
      "original_start_line": 231,
      "start_side": "LEFT",
      "line": 234,
      "original_line": 234,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/809434532",
      "pull_request_review_id": 886505099,
      "id": 809434532,
      "node_id": "PRRC_kwDOABII584wPv2k",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);\n-    batch.Write(DBHeightKey(pindex->nHeight), value);\n-    batch.Write(DB_MUHASH, m_muhash);\n-    return m_db->WriteBatch(batch);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092758,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: Commit DB_MUHASH and DB_BEST_BLOCK to disk together\" (010156c07f28e2c8dc30d4408942d1e1d88ab54d)\r\n\r\n> The `CommitInternal` override feels like a hacky refactor.\r\n\r\nI think I agree with luke if the point is that the override-and-call-base class code in `CommitInternal` is a little hacky, but fjahr's right this just the way the base index class was designed, so the override seems like appropriate way to handle this now. #24230 does clean up all the overrides and will simplify this a bit.",
      "created_at": "2022-02-17T20:17:30Z",
      "updated_at": "2022-02-17T20:53:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r809434532",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/809434532"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": 231,
      "original_start_line": 231,
      "start_side": "LEFT",
      "line": 234,
      "original_line": 234,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/809436879",
      "pull_request_review_id": 886505099,
      "id": 809436879,
      "node_id": "PRRC_kwDOABII584wPwbP",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: Commit DB_MUHASH and DB_BEST_BLOCK to disk together\" (010156c07f28e2c8dc30d4408942d1e1d88ab54d)\r\n\r\nI might add a code comment here like \"Intentionally do not update DB_MUHASH here so it stays in sync with DB_BEST_BLOCK, and index is not corrupted if there is an unclean shutdown\"",
      "created_at": "2022-02-17T20:21:07Z",
      "updated_at": "2022-02-17T20:53:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r809436879",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/809436879"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 231,
      "original_line": 231,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/810001814",
      "pull_request_review_id": 887280272,
      "id": 810001814,
      "node_id": "PRRC_kwDOABII584wR6WW",
      "diff_hunk": "@@ -481,5 +486,5 @@ bool CoinStatsIndex::ReverseBlock(const CBlock& block, const CBlockIndex* pindex\n     Assert(m_total_unspendables_scripts == read_out.second.total_unspendables_scripts);\n     Assert(m_total_unspendables_unclaimed_rewards == read_out.second.total_unspendables_unclaimed_rewards);\n \n-    return m_db->Write(DB_MUHASH, m_muhash);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 33,
      "original_position": 31,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092834,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">  if the node gets shut down during the reorg,\r\n\r\nI guess this is very non trivial to test, but maybe add a comment?",
      "created_at": "2022-02-18T13:33:33Z",
      "updated_at": "2022-02-18T13:33:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r810001814",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/810001814"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 492,
      "original_line": 492,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811280315",
      "pull_request_review_id": 888896253,
      "id": 811280315,
      "node_id": "PRRC_kwDOABII584wWye7",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);\n-    batch.Write(DBHeightKey(pindex->nHeight), value);\n-    batch.Write(DB_MUHASH, m_muhash);\n-    return m_db->WriteBatch(batch);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092758,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Just to make this clear: This is not a refactor, it changes behavior (the points in time when `DB_MUHASH` is written to disk).\r\n\r\nMy understanding is that the indexes work in general such that that all persisted data describing the current _progress_ of indexing (such as the best block) must be in sync with the persisted chainstate information (which is sometimes not flushed for several blocks received) - that is why `ChainStateFlushed()` callbacks are used. In case of an unclean shutdown, the chainstate will be constructed from this point on, so the indexes must as well.\r\n\r\nIn contrast to this is the actual indexed data for each block - I think we could in principle cache it and also write it to disk with each `ChainStateFlushed()` callback and not use `BlockConnected()` at all. \r\n\r\nBut it is also possible to write it to disk in advance with each `BlockConnected()` callback, as it is done:\r\nThis is dependent on the assumption that we will not read (and possibly overwrite) the indexed data in case it is ahead of the flushed chainstate data (and the best block), and also that _before_ flushing the chainstate, we have called `BlockConnected()` for each block.\r\n\r\nWith this in mind, I don't see a better way of doing this other than overriding `CommitInternal`.",
      "created_at": "2022-02-21T16:21:20Z",
      "updated_at": "2022-02-21T16:21:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r811280315",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811280315"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": 231,
      "original_start_line": 231,
      "start_side": "LEFT",
      "line": 234,
      "original_line": 234,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811294780",
      "pull_request_review_id": 888916281,
      "id": 811294780,
      "node_id": "PRRC_kwDOABII584wW2A8",
      "diff_hunk": "@@ -228,10 +228,7 @@ bool CoinStatsIndex::WriteBlock(const CBlock& block, const CBlockIndex* pindex)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n-    CDBBatch batch(*m_db);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 809436879,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, I added a comment here.",
      "created_at": "2022-02-21T16:40:07Z",
      "updated_at": "2022-02-21T16:40:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r811294780",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811294780"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 231,
      "original_line": 231,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811297574",
      "pull_request_review_id": 888920204,
      "id": 811297574,
      "node_id": "PRRC_kwDOABII584wW2sm",
      "diff_hunk": "@@ -481,5 +486,5 @@ bool CoinStatsIndex::ReverseBlock(const CBlock& block, const CBlockIndex* pindex\n     Assert(m_total_unspendables_scripts == read_out.second.total_unspendables_scripts);\n     Assert(m_total_unspendables_unclaimed_rewards == read_out.second.total_unspendables_unclaimed_rewards);\n \n-    return m_db->Write(DB_MUHASH, m_muhash);",
      "path": "src/index/coinstatsindex.cpp",
      "position": 33,
      "original_position": 31,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "010156c07f28e2c8dc30d4408942d1e1d88ab54d",
      "in_reply_to_id": 795092834,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I added a comment at the end of `CoinStatsIndex::WriteBlock` (as suggested by ryanofsky below). I think that duplicating this comment in `CoinStatsIndex::ReverseBlock` is not required, since this function doesn't write anything else to disk there wouldn't really be the expectation that for it to write `DB_MUHASH` here.",
      "created_at": "2022-02-21T16:43:46Z",
      "updated_at": "2022-02-21T16:43:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r811297574",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/811297574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 492,
      "original_line": 492,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/820237111",
      "pull_request_review_id": 901078124,
      "id": 820237111,
      "node_id": "PRRC_kwDOABII584w49M3",
      "diff_hunk": "@@ -78,4 +85,44 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n }\n \n+// Test shutdown between BlockConnected and ChainStateFlushed notifications,\n+// make sure index is not corrupted and is able to reload.\n+BOOST_FIXTURE_TEST_CASE(coinstatsindex_unclean_shutdown, TestChain100Setup)\n+{\n+    CChainState& chainstate = Assert(m_node.chainman)->ActiveChainstate();\n+    const CChainParams& params = Params();\n+    {\n+        CoinStatsIndex index{1 << 20};\n+        BOOST_REQUIRE(index.Start(chainstate));\n+        IndexWaitSynced(index);\n+        std::shared_ptr<const CBlock> new_block;\n+        CBlockIndex* new_block_index = nullptr;\n+        {\n+            const CScript script_pub_key{CScript() << ToByteVector(coinbaseKey.GetPubKey()) << OP_CHECKSIG};\n+            const CBlock block = this->CreateBlock({}, script_pub_key, chainstate);\n+\n+            new_block = std::make_shared<CBlock>(block);\n+\n+            LOCK(cs_main);\n+            BlockValidationState state;\n+            BOOST_CHECK(CheckBlock(block, state, params.GetConsensus()));\n+            BOOST_CHECK(chainstate.AcceptBlock(new_block, state, &new_block_index, true, nullptr, nullptr));\n+            CCoinsViewCache view(&chainstate.CoinsTip());\n+            BOOST_CHECK(chainstate.ConnectBlock(block, state, new_block_index, view));\n+        }\n+        // Send block connected notification, then stop the index without\n+        // sending a chainstate flushed notification. Prior to #24138, this\n+        // would cause the index to be corrupted and fail to reload.\n+        ValidationInterfaceTest::BlockConnected(index, new_block, new_block_index);\n+        index.Stop();\n+    }\n+\n+    {\n+        CoinStatsIndex index{1 << 20};\n+        // Make sure the index can be loaded.\n+        BOOST_REQUIRE(index.Start(chainstate));",
      "path": "src/test/coinstatsindex_tests.cpp",
      "position": 83,
      "original_position": 83,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in 691d45fdc83ec14f87a400f548553168ac70263f:\r\n\r\nNot sure why we need this whole block with the new `index` instead of reusing the old `index` above. It doesn't seem to make a difference in my testing? ",
      "created_at": "2022-03-06T13:47:05Z",
      "updated_at": "2022-03-06T14:09:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r820237111",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/820237111"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 123,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822521424",
      "pull_request_review_id": 904182906,
      "id": 822521424,
      "node_id": "PRRC_kwDOABII584xBq5Q",
      "diff_hunk": "@@ -78,4 +85,44 @@ BOOST_FIXTURE_TEST_CASE(coinstatsindex_initial_sync, TestChain100Setup)\n     // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n }\n \n+// Test shutdown between BlockConnected and ChainStateFlushed notifications,\n+// make sure index is not corrupted and is able to reload.\n+BOOST_FIXTURE_TEST_CASE(coinstatsindex_unclean_shutdown, TestChain100Setup)\n+{\n+    CChainState& chainstate = Assert(m_node.chainman)->ActiveChainstate();\n+    const CChainParams& params = Params();\n+    {\n+        CoinStatsIndex index{1 << 20};\n+        BOOST_REQUIRE(index.Start(chainstate));\n+        IndexWaitSynced(index);\n+        std::shared_ptr<const CBlock> new_block;\n+        CBlockIndex* new_block_index = nullptr;\n+        {\n+            const CScript script_pub_key{CScript() << ToByteVector(coinbaseKey.GetPubKey()) << OP_CHECKSIG};\n+            const CBlock block = this->CreateBlock({}, script_pub_key, chainstate);\n+\n+            new_block = std::make_shared<CBlock>(block);\n+\n+            LOCK(cs_main);\n+            BlockValidationState state;\n+            BOOST_CHECK(CheckBlock(block, state, params.GetConsensus()));\n+            BOOST_CHECK(chainstate.AcceptBlock(new_block, state, &new_block_index, true, nullptr, nullptr));\n+            CCoinsViewCache view(&chainstate.CoinsTip());\n+            BOOST_CHECK(chainstate.ConnectBlock(block, state, new_block_index, view));\n+        }\n+        // Send block connected notification, then stop the index without\n+        // sending a chainstate flushed notification. Prior to #24138, this\n+        // would cause the index to be corrupted and fail to reload.\n+        ValidationInterfaceTest::BlockConnected(index, new_block, new_block_index);\n+        index.Stop();\n+    }\n+\n+    {\n+        CoinStatsIndex index{1 << 20};\n+        // Make sure the index can be loaded.\n+        BOOST_REQUIRE(index.Start(chainstate));",
      "path": "src/test/coinstatsindex_tests.cpp",
      "position": 83,
      "original_position": 83,
      "commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "original_commit_id": "691d45fdc83ec14f87a400f548553168ac70263f",
      "in_reply_to_id": 820237111,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is there a huge cost to spinning up the second index? If not, I think both versions are fine.",
      "created_at": "2022-03-09T10:49:49Z",
      "updated_at": "2022-03-09T10:49:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24138#discussion_r822521424",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822521424"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24138"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 123,
      "side": "RIGHT"
    }
  ]
}